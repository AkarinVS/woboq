<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>floatundisf.S source code [llvm/compiler-rt/lib/builtins/i386/floatundisf.S] - Woboq Code Browser</title>
<link rel="stylesheet" href="../../../../.././data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../../.././data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../../.././data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../../.././data/jquery/jquery-ui.min.js"></script>
<script>var file = 'llvm/compiler-rt/lib/builtins/i386/floatundisf.S'; var root_path = '../../../../..'; var data_path = '../../../../.././data'; var ecma_script_api_version = 2;</script>
<script src='../../../../.././data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../../../..'>llvm</a>/<a href='../../..'>compiler-rt</a>/<a href='../..'>lib</a>/<a href='..'>builtins</a>/<a href='./'>i386</a>/<a href='floatundisf.S.html'>floatundisf.S</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</i></td></tr>
<tr><th id="2">2</th><td><i>// See <a href="https://llvm.org/LICENSE.txt">https://llvm.org/LICENSE.txt</a> for license information.</i></td></tr>
<tr><th id="3">3</th><td><i>// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</i></td></tr>
<tr><th id="4">4</th><td></td></tr>
<tr><th id="5">5</th><td><u>#include <a href="../assembly.h.html">"../assembly.h"</a></u></td></tr>
<tr><th id="6">6</th><td></td></tr>
<tr><th id="7">7</th><td><i>// float __floatundisf(du_int a);</i></td></tr>
<tr><th id="8">8</th><td><i></i></td></tr>
<tr><th id="9">9</th><td><i>// Note that there is a hardware instruction, fildll, that does most of what</i></td></tr>
<tr><th id="10">10</th><td><i>// this function needs to do.  However, because of our ia32 ABI, it will take</i></td></tr>
<tr><th id="11">11</th><td><i>// a write-small read-large stall, so the software implementation here is</i></td></tr>
<tr><th id="12">12</th><td><i>// actually several cycles faster.</i></td></tr>
<tr><th id="13">13</th><td><i></i></td></tr>
<tr><th id="14">14</th><td><i>// This is a branch-free implementation.  A branchy implementation might be</i></td></tr>
<tr><th id="15">15</th><td><i>// faster for the common case if you know something a priori about the input</i></td></tr>
<tr><th id="16">16</th><td><i>// distribution.</i></td></tr>
<tr><th id="17">17</th><td></td></tr>
<tr><th id="18">18</th><td><i>/* branch-free x87 implementation - one cycle slower than without x87.</i></td></tr>
<tr><th id="19">19</th><td><i></i></td></tr>
<tr><th id="20">20</th><td><i>#ifdef __i386__</i></td></tr>
<tr><th id="21">21</th><td><i></i></td></tr>
<tr><th id="22">22</th><td><i>CONST_SECTION</i></td></tr>
<tr><th id="23">23</th><td><i>.balign 3</i></td></tr>
<tr><th id="24">24</th><td><i></i></td></tr>
<tr><th id="25">25</th><td><i>		.quad	0x43f0000000000000</i></td></tr>
<tr><th id="26">26</th><td><i>twop64:	.quad	0x0000000000000000</i></td></tr>
<tr><th id="27">27</th><td><i></i></td></tr>
<tr><th id="28">28</th><td><i>#define			TWOp64			twop64-0b(%ecx,%eax,8)</i></td></tr>
<tr><th id="29">29</th><td><i></i></td></tr>
<tr><th id="30">30</th><td><i>.text</i></td></tr>
<tr><th id="31">31</th><td><i>.balign 4</i></td></tr>
<tr><th id="32">32</th><td><i>DEFINE_COMPILERRT_FUNCTION(__floatundisf)</i></td></tr>
<tr><th id="33">33</th><td><i>	movl		8(%esp),		%eax</i></td></tr>
<tr><th id="34">34</th><td><i>	movd		8(%esp),		%xmm1</i></td></tr>
<tr><th id="35">35</th><td><i>	movd		4(%esp),		%xmm0</i></td></tr>
<tr><th id="36">36</th><td><i>	punpckldq	%xmm1,			%xmm0</i></td></tr>
<tr><th id="37">37</th><td><i>	calll		0f</i></td></tr>
<tr><th id="38">38</th><td><i>0:	popl		%ecx</i></td></tr>
<tr><th id="39">39</th><td><i>	sarl		$31,			%eax</i></td></tr>
<tr><th id="40">40</th><td><i>	movq		%xmm0,			4(%esp)</i></td></tr>
<tr><th id="41">41</th><td><i>	fildll		4(%esp)</i></td></tr>
<tr><th id="42">42</th><td><i>	faddl		TWOp64</i></td></tr>
<tr><th id="43">43</th><td><i>	fstps		4(%esp)</i></td></tr>
<tr><th id="44">44</th><td><i>	flds		4(%esp)</i></td></tr>
<tr><th id="45">45</th><td><i>	ret</i></td></tr>
<tr><th id="46">46</th><td><i>END_COMPILERRT_FUNCTION(__floatundisf)</i></td></tr>
<tr><th id="47">47</th><td><i></i></td></tr>
<tr><th id="48">48</th><td><i>#endif // __i386__</i></td></tr>
<tr><th id="49">49</th><td><i></i></td></tr>
<tr><th id="50">50</th><td><i>*/</i></td></tr>
<tr><th id="51">51</th><td><i></i></td></tr>
<tr><th id="52">52</th><td><i>// branch-free, x87-free implementation - faster at the expense of code size</i></td></tr>
<tr><th id="53">53</th><td></td></tr>
<tr><th id="54">54</th><td><u>#<span data-ppcond="54">ifdef</span> <span class="macro" data-ref="_M/__i386__">__i386__</span></u></td></tr>
<tr><th id="55">55</th><td></td></tr>
<tr><th id="56">56</th><td><a class="macro" href="../assembly.h.html#43" title=".section .rodata" data-ref="_M/CONST_SECTION">CONST_SECTION</a></td></tr>
<tr><th id="57">57</th><td></td></tr>
<tr><th id="58">58</th><td>	.balign <var>16</var></td></tr>
<tr><th id="59">59</th><td>twop52:</td></tr>
<tr><th id="60">60</th><td>	.quad <var>0x4330000000000000</var></td></tr>
<tr><th id="61">61</th><td>	.quad <var>0x0000000000000fff</var></td></tr>
<tr><th id="62">62</th><td></td></tr>
<tr><th id="63">63</th><td>	.balign <var>16</var></td></tr>
<tr><th id="64">64</th><td>sticky:</td></tr>
<tr><th id="65">65</th><td>	.quad <var>0x0000000000000000</var></td></tr>
<tr><th id="66">66</th><td>	.<em>long</em> <var>0x00000012</var></td></tr>
<tr><th id="67">67</th><td></td></tr>
<tr><th id="68">68</th><td>	.balign <var>16</var></td></tr>
<tr><th id="69">69</th><td>twelve:</td></tr>
<tr><th id="70">70</th><td>	.<em>long</em> <var>0x00000000</var></td></tr>
<tr><th id="71">71</th><td></td></tr>
<tr><th id="72">72</th><td><u>#define			<dfn class="macro" id="_M/TWOp52" data-ref="_M/TWOp52">TWOp52</dfn>			twop52-0b(%ecx)</u></td></tr>
<tr><th id="73">73</th><td><u>#define			<dfn class="macro" id="_M/STICKY" data-ref="_M/STICKY">STICKY</dfn>			sticky-0b(%ecx,%eax,8)</u></td></tr>
<tr><th id="74">74</th><td></td></tr>
<tr><th id="75">75</th><td>.text</td></tr>
<tr><th id="76">76</th><td>.balign <var>4</var></td></tr>
<tr><th id="77">77</th><td><a class="macro" href="../assembly.h.html#211" title=" ; .globl __floatundisf ; .type __floatundisf,@function ; .hidden __floatundisf ; __floatundisf:" data-ref="_M/DEFINE_COMPILERRT_FUNCTION">DEFINE_COMPILERRT_FUNCTION</a>(<span class='warning' title="type specifier missing, defaults to &apos;int&apos;"><dfn class="decl def" id="__floatundisf" title='__floatundisf' data-ref="__floatundisf" data-ref-filename="__floatundisf">__floatundisf</dfn></span>)</td></tr>
<tr><th id="78">78</th><td>	<span class='error' title="unknown type name &apos;movl&apos;">movl</span>		<span class='error' title="expected identifier or &apos;(&apos;"><var>8</var></span>(%esp),		%eax</td></tr>
<tr><th id="79">79</th><td>	movd		<var>8</var>(%esp),		%xmm1</td></tr>
<tr><th id="80">80</th><td>	movd		<var>4</var>(%esp),		%xmm0</td></tr>
<tr><th id="81">81</th><td>	punpckldq	%xmm1,			%xmm0</td></tr>
<tr><th id="82">82</th><td></td></tr>
<tr><th id="83">83</th><td>	calll		<var>0f</var></td></tr>
<tr><th id="84">84</th><td><var>0</var>:	popl		%ecx</td></tr>
<tr><th id="85">85</th><td>	shrl		%eax					<i>// high 31 bits of input as sint32</i></td></tr>
<tr><th id="86">86</th><td>	addl		$<var>0x7ff80000</var>,	%eax</td></tr>
<tr><th id="87">87</th><td>	sarl		$<var>31</var>,			%eax	<i>// (big input) ? -1 : 0</i></td></tr>
<tr><th id="88">88</th><td>	movsd		<a class="macro" href="#73" title="sticky-0b(%ecx,%eax,8)" data-ref="_M/STICKY">STICKY</a>,			%xmm1	<i>// (big input) ? 0xfff : 0</i></td></tr>
<tr><th id="89">89</th><td>	movl		$<var>12</var>,			%edx</td></tr>
<tr><th id="90">90</th><td>	andl		%eax,			%edx	<i>// (big input) ? 12 : 0</i></td></tr>
<tr><th id="91">91</th><td>	movd		%edx,			%xmm3</td></tr>
<tr><th id="92">92</th><td>	andpd		%xmm0,			%xmm1	<i>// (big input) ? input &amp; 0xfff : 0</i></td></tr>
<tr><th id="93">93</th><td>	movsd		<a class="macro" href="#72" title="twop52-0b(%ecx)" data-ref="_M/TWOp52">TWOp52</a>,			%xmm2	<i>// 0x1.0p52</i></td></tr>
<tr><th id="94">94</th><td>	psrlq		%xmm3,			%xmm0	<i>// (big input) ? input &gt;&gt; 12 : input</i></td></tr>
<tr><th id="95">95</th><td>	orpd		%xmm2,			%xmm1	<i>// 0x1.0p52 + ((big input) ? input &amp; 0xfff : input)</i></td></tr>
<tr><th id="96">96</th><td>	orpd		%xmm1,			%xmm0	<i>// 0x1.0p52 + ((big input) ? (input &gt;&gt; 12 | input &amp; 0xfff) : input)</i></td></tr>
<tr><th id="97">97</th><td>	subsd		%xmm2,			%xmm0	<i>// (double)((big input) ? (input &gt;&gt; 12 | input &amp; 0xfff) : input)</i></td></tr>
<tr><th id="98">98</th><td>	cvtsd2ss	%xmm0,			%xmm0	<i>// (float)((big input) ? (input &gt;&gt; 12 | input &amp; 0xfff) : input)</i></td></tr>
<tr><th id="99">99</th><td>	pslld		$<var>23</var>,			%xmm3</td></tr>
<tr><th id="100">100</th><td>	paddd		%xmm3,			%xmm0	<i>// (float)input</i></td></tr>
<tr><th id="101">101</th><td>	movd		%xmm0,			<var>4</var>(%esp)</td></tr>
<tr><th id="102">102</th><td>	flds		<var>4</var>(%esp)</td></tr>
<tr><th id="103">103</th><td>	ret</td></tr>
<tr><th id="104">104</th><td><a class="macro" href="../assembly.h.html#270" title=".size __floatundisf, . - __floatundisf" data-ref="_M/END_COMPILERRT_FUNCTION">END_COMPILERRT_FUNCTION</a>(__floatundisf)</td></tr>
<tr><th id="105">105</th><td></td></tr>
<tr><th id="106">106</th><td><u>#<span data-ppcond="54">endif</span> // __i386__</u></td></tr>
<tr><th id="107">107</th><td></td></tr>
<tr><th id="108">108</th><td><a class="macro" href="../assembly.h.html#47" title=".section .note.GNU-stack,&quot;&quot;,%progbits" data-ref="_M/NO_EXEC_STACK_DIRECTIVE">NO_EXEC_STACK_DIRECTIVE</a></td></tr>
<tr><th id="109">109</th><td></td></tr>
<tr><th id="110">110</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2021-Jul-01</em> from project llvm revision <em>12</em>