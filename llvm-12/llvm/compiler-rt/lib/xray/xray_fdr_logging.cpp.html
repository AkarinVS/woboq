<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>xray_fdr_logging.cpp source code [llvm/compiler-rt/lib/xray/xray_fdr_logging.cpp] - Woboq Code Browser</title>
<meta name="woboq:interestingDefinitions" content="__xray::TSCAndCPU "/>
<link rel="stylesheet" href="../../../.././data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../.././data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../.././data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../.././data/jquery/jquery-ui.min.js"></script>
<script>var file = 'llvm/compiler-rt/lib/xray/xray_fdr_logging.cpp'; var root_path = '../../../..'; var data_path = '../../../.././data'; var ecma_script_api_version = 2;</script>
<script src='../../../.././data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../../..'>llvm</a>/<a href='../..'>compiler-rt</a>/<a href='..'>lib</a>/<a href='./'>xray</a>/<a href='xray_fdr_logging.cpp.html'>xray_fdr_logging.cpp</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>//===-- xray_fdr_logging.cpp -----------------------------------*- C++ -*-===//</i></td></tr>
<tr><th id="2">2</th><td><i>//</i></td></tr>
<tr><th id="3">3</th><td><i>// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</i></td></tr>
<tr><th id="4">4</th><td><i>// See <a href="https://llvm.org/LICENSE.txt">https://llvm.org/LICENSE.txt</a> for license information.</i></td></tr>
<tr><th id="5">5</th><td><i>// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</i></td></tr>
<tr><th id="6">6</th><td><i>//</i></td></tr>
<tr><th id="7">7</th><td><i>//===----------------------------------------------------------------------===//</i></td></tr>
<tr><th id="8">8</th><td><i>//</i></td></tr>
<tr><th id="9">9</th><td><i>// This file is a part of XRay, a dynamic runtime instrumentation system.</i></td></tr>
<tr><th id="10">10</th><td><i>//</i></td></tr>
<tr><th id="11">11</th><td><i>// Here we implement the Flight Data Recorder mode for XRay, where we use</i></td></tr>
<tr><th id="12">12</th><td><i>// compact structures to store records in memory as well as when writing out the</i></td></tr>
<tr><th id="13">13</th><td><i>// data to files.</i></td></tr>
<tr><th id="14">14</th><td><i>//</i></td></tr>
<tr><th id="15">15</th><td><i>//===----------------------------------------------------------------------===//</i></td></tr>
<tr><th id="16">16</th><td><u>#include <a href="xray_fdr_logging.h.html">"xray_fdr_logging.h"</a></u></td></tr>
<tr><th id="17">17</th><td><u>#include &lt;cassert&gt;</u></td></tr>
<tr><th id="18">18</th><td><u>#include <a href="../../../../include/errno.h.html">&lt;errno.h&gt;</a></u></td></tr>
<tr><th id="19">19</th><td><u>#include &lt;limits&gt;</u></td></tr>
<tr><th id="20">20</th><td><u>#include &lt;memory&gt;</u></td></tr>
<tr><th id="21">21</th><td><u>#include <a href="../../../../include/pthread.h.html">&lt;pthread.h&gt;</a></u></td></tr>
<tr><th id="22">22</th><td><u>#include <a href="../../../../include/sys/time.h.html">&lt;sys/time.h&gt;</a></u></td></tr>
<tr><th id="23">23</th><td><u>#include <a href="../../../../include/time.h.html">&lt;time.h&gt;</a></u></td></tr>
<tr><th id="24">24</th><td><u>#include <a href="../../../../include/unistd.h.html">&lt;unistd.h&gt;</a></u></td></tr>
<tr><th id="25">25</th><td></td></tr>
<tr><th id="26">26</th><td><u>#include <a href="../sanitizer_common/sanitizer_allocator_internal.h.html">"sanitizer_common/sanitizer_allocator_internal.h"</a></u></td></tr>
<tr><th id="27">27</th><td><u>#include <a href="../sanitizer_common/sanitizer_atomic.h.html">"sanitizer_common/sanitizer_atomic.h"</a></u></td></tr>
<tr><th id="28">28</th><td><u>#include <a href="../sanitizer_common/sanitizer_common.h.html">"sanitizer_common/sanitizer_common.h"</a></u></td></tr>
<tr><th id="29">29</th><td><u>#include <a href="../../include/xray/xray_interface.h.html">"xray/xray_interface.h"</a></u></td></tr>
<tr><th id="30">30</th><td><u>#include <a href="../../include/xray/xray_records.h.html">"xray/xray_records.h"</a></u></td></tr>
<tr><th id="31">31</th><td><u>#include <a href="xray_allocator.h.html">"xray_allocator.h"</a></u></td></tr>
<tr><th id="32">32</th><td><u>#include <a href="xray_buffer_queue.h.html">"xray_buffer_queue.h"</a></u></td></tr>
<tr><th id="33">33</th><td><u>#include <a href="xray_defs.h.html">"xray_defs.h"</a></u></td></tr>
<tr><th id="34">34</th><td><u>#include <a href="xray_fdr_controller.h.html">"xray_fdr_controller.h"</a></u></td></tr>
<tr><th id="35">35</th><td><u>#include <a href="xray_fdr_flags.h.html">"xray_fdr_flags.h"</a></u></td></tr>
<tr><th id="36">36</th><td><u>#include <a href="xray_fdr_log_writer.h.html">"xray_fdr_log_writer.h"</a></u></td></tr>
<tr><th id="37">37</th><td><u>#include <a href="xray_flags.h.html">"xray_flags.h"</a></u></td></tr>
<tr><th id="38">38</th><td><u>#include <a href="xray_recursion_guard.h.html">"xray_recursion_guard.h"</a></u></td></tr>
<tr><th id="39">39</th><td><u>#include <a href="xray_tsc.h.html">"xray_tsc.h"</a></u></td></tr>
<tr><th id="40">40</th><td><u>#include <a href="xray_utils.h.html">"xray_utils.h"</a></u></td></tr>
<tr><th id="41">41</th><td></td></tr>
<tr><th id="42">42</th><td><b>namespace</b> <span class="namespace">__xray</span> {</td></tr>
<tr><th id="43">43</th><td></td></tr>
<tr><th id="44">44</th><td><em>static</em> <a class="type" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::atomic_sint32_t" title='__sanitizer::atomic_sint32_t' data-ref="__sanitizer::atomic_sint32_t" data-ref-filename="__sanitizer..atomic_sint32_t">atomic_sint32_t</a> <dfn class="tu decl def" id="__xray::LoggingStatus" title='__xray::LoggingStatus' data-type='__sanitizer::atomic_sint32_t' data-ref="__xray::LoggingStatus" data-ref-filename="__xray..LoggingStatus">LoggingStatus</dfn> = {</td></tr>
<tr><th id="45">45</th><td>    <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogInitStatus" title='XRayLogInitStatus' data-ref="XRayLogInitStatus" data-ref-filename="XRayLogInitStatus">XRayLogInitStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_UNINITIALIZED" title='XRAY_LOG_UNINITIALIZED' data-ref="XRAY_LOG_UNINITIALIZED" data-ref-filename="XRAY_LOG_UNINITIALIZED">XRAY_LOG_UNINITIALIZED</a>};</td></tr>
<tr><th id="46">46</th><td></td></tr>
<tr><th id="47">47</th><td><b>namespace</b> {</td></tr>
<tr><th id="48">48</th><td></td></tr>
<tr><th id="49">49</th><td><i  data-doc="__xray::(anonymousnamespace)::ThreadLocalData">// Group together thread-local-data in a struct, then hide it behind a function</i></td></tr>
<tr><th id="50">50</th><td><i  data-doc="__xray::(anonymousnamespace)::ThreadLocalData">// call so that it can be initialized on first use instead of as a global. We</i></td></tr>
<tr><th id="51">51</th><td><i  data-doc="__xray::(anonymousnamespace)::ThreadLocalData">// force the alignment to 64-bytes for x86 cache line alignment, as this</i></td></tr>
<tr><th id="52">52</th><td><i  data-doc="__xray::(anonymousnamespace)::ThreadLocalData">// structure is used in the hot path of implementation.</i></td></tr>
<tr><th id="53">53</th><td><b>struct</b> <a class="macro" href="xray_defs.h.html#27" title="alignas(64)" data-ref="_M/XRAY_TLS_ALIGNAS">XRAY_TLS_ALIGNAS</a>(<var>64</var>) <dfn class="tu type def" id="__xray::(anonymousnamespace)::ThreadLocalData" title='__xray::(anonymous namespace)::ThreadLocalData' data-ref="__xray::(anonymousnamespace)::ThreadLocalData" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData">ThreadLocalData</dfn> {</td></tr>
<tr><th id="54">54</th><td>  <a class="type" href="xray_buffer_queue.h.html#__xray::BufferQueue" title='__xray::BufferQueue' data-ref="__xray::BufferQueue" data-ref-filename="__xray..BufferQueue">BufferQueue</a>::<a class="type" href="xray_buffer_queue.h.html#__xray::BufferQueue::Buffer" title='__xray::BufferQueue::Buffer' data-ref="__xray::BufferQueue::Buffer" data-ref-filename="__xray..BufferQueue..Buffer">Buffer</a> <dfn class="tu decl field" id="__xray::(anonymousnamespace)::ThreadLocalData::Buffer" title='__xray::(anonymous namespace)::ThreadLocalData::Buffer' data-type='BufferQueue::Buffer' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Buffer" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Buffer">Buffer</dfn><a class="ref fn" href="xray_buffer_queue.h.html#54" title='__xray::BufferQueue::Buffer::Buffer' data-ref="__xray::BufferQueue::Buffer::Buffer" data-ref-filename="__xray..BufferQueue..Buffer..Buffer">{</a>};</td></tr>
<tr><th id="55">55</th><td>  <a class="type" href="xray_buffer_queue.h.html#__xray::BufferQueue" title='__xray::BufferQueue' data-ref="__xray::BufferQueue" data-ref-filename="__xray..BufferQueue">BufferQueue</a> *<dfn class="tu decl field" id="__xray::(anonymousnamespace)::ThreadLocalData::BQ" title='__xray::(anonymous namespace)::ThreadLocalData::BQ' data-type='__xray::BufferQueue *' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::BQ" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..BQ">BQ</dfn> = <b>nullptr</b>;</td></tr>
<tr><th id="56">56</th><td></td></tr>
<tr><th id="57">57</th><td>  <b>using</b> <dfn class="tu typedef" id="__xray::(anonymousnamespace)::ThreadLocalData::LogWriterStorage" title='__xray::(anonymous namespace)::ThreadLocalData::LogWriterStorage' data-type='typename std::aligned_storage&lt;sizeof(FDRLogWriter), alignof(FDRLogWriter)&gt;::type' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::LogWriterStorage" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..LogWriterStorage">LogWriterStorage</dfn> =</td></tr>
<tr><th id="58">58</th><td>      <b>typename</b> <span class="namespace">std::</span><span class='type' title='std::aligned_storage' data-ref="std::aligned_storage" data-ref-filename="std..aligned_storage">aligned_storage</span>&lt;<b>sizeof</b>(<a class="type" href="xray_fdr_log_writer.h.html#__xray::FDRLogWriter" title='__xray::FDRLogWriter' data-ref="__xray::FDRLogWriter" data-ref-filename="__xray..FDRLogWriter">FDRLogWriter</a>),</td></tr>
<tr><th id="59">59</th><td>                                    <b>alignof</b>(<a class="type" href="xray_fdr_log_writer.h.html#__xray::FDRLogWriter" title='__xray::FDRLogWriter' data-ref="__xray::FDRLogWriter" data-ref-filename="__xray..FDRLogWriter">FDRLogWriter</a>)&gt;::<span class='type' title='std::aligned_storage::type' data-ref="std::aligned_storage::type" data-ref-filename="std..aligned_storage..type">type</span>;</td></tr>
<tr><th id="60">60</th><td></td></tr>
<tr><th id="61">61</th><td>  <a class="tu typedef" href="#__xray::(anonymousnamespace)::ThreadLocalData::LogWriterStorage" title='__xray::(anonymous namespace)::ThreadLocalData::LogWriterStorage' data-type='typename std::aligned_storage&lt;sizeof(FDRLogWriter), alignof(FDRLogWriter)&gt;::type' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::LogWriterStorage" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..LogWriterStorage">LogWriterStorage</a> <dfn class="tu decl field" id="__xray::(anonymousnamespace)::ThreadLocalData::LWStorage" title='__xray::(anonymous namespace)::ThreadLocalData::LWStorage' data-type='__xray::(anonymous namespace)::ThreadLocalData::LogWriterStorage' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::LWStorage" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..LWStorage">LWStorage</dfn>;</td></tr>
<tr><th id="62">62</th><td>  <a class="type" href="xray_fdr_log_writer.h.html#__xray::FDRLogWriter" title='__xray::FDRLogWriter' data-ref="__xray::FDRLogWriter" data-ref-filename="__xray..FDRLogWriter">FDRLogWriter</a> *<dfn class="tu decl field" id="__xray::(anonymousnamespace)::ThreadLocalData::Writer" title='__xray::(anonymous namespace)::ThreadLocalData::Writer' data-type='__xray::FDRLogWriter *' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Writer" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Writer">Writer</dfn> = <b>nullptr</b>;</td></tr>
<tr><th id="63">63</th><td></td></tr>
<tr><th id="64">64</th><td>  <b>using</b> <dfn class="tu typedef" id="__xray::(anonymousnamespace)::ThreadLocalData::ControllerStorage" title='__xray::(anonymous namespace)::ThreadLocalData::ControllerStorage' data-type='typename std::aligned_storage&lt;sizeof(FDRController&lt;&gt;), alignof(FDRController&lt;&gt;)&gt;::type' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::ControllerStorage" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..ControllerStorage">ControllerStorage</dfn> =</td></tr>
<tr><th id="65">65</th><td>      <b>typename</b> <span class="namespace">std::</span><span class='type' title='std::aligned_storage' data-ref="std::aligned_storage" data-ref-filename="std..aligned_storage">aligned_storage</span>&lt;<b>sizeof</b>(<a class="type" href="xray_fdr_controller.h.html#__xray::FDRController" title='__xray::FDRController' data-ref="__xray::FDRController" data-ref-filename="__xray..FDRController">FDRController</a>&lt;&gt;),</td></tr>
<tr><th id="66">66</th><td>                                    <b>alignof</b>(<a class="type" href="xray_fdr_controller.h.html#__xray::FDRController" title='__xray::FDRController' data-ref="__xray::FDRController" data-ref-filename="__xray..FDRController">FDRController</a>&lt;&gt;)&gt;::<span class='type' title='std::aligned_storage::type' data-ref="std::aligned_storage::type" data-ref-filename="std..aligned_storage..type">type</span>;</td></tr>
<tr><th id="67">67</th><td>  <a class="tu typedef" href="#__xray::(anonymousnamespace)::ThreadLocalData::ControllerStorage" title='__xray::(anonymous namespace)::ThreadLocalData::ControllerStorage' data-type='typename std::aligned_storage&lt;sizeof(FDRController&lt;&gt;), alignof(FDRController&lt;&gt;)&gt;::type' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::ControllerStorage" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..ControllerStorage">ControllerStorage</a> <dfn class="tu decl field" id="__xray::(anonymousnamespace)::ThreadLocalData::CStorage" title='__xray::(anonymous namespace)::ThreadLocalData::CStorage' data-type='__xray::(anonymous namespace)::ThreadLocalData::ControllerStorage' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::CStorage" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..CStorage">CStorage</dfn>;</td></tr>
<tr><th id="68">68</th><td>  <a class="type" href="xray_fdr_controller.h.html#__xray::FDRController" title='__xray::FDRController' data-ref="__xray::FDRController" data-ref-filename="__xray..FDRController">FDRController</a>&lt;&gt; *<dfn class="tu decl field" id="__xray::(anonymousnamespace)::ThreadLocalData::Controller" title='__xray::(anonymous namespace)::ThreadLocalData::Controller' data-type='FDRController&lt;&gt; *' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Controller" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Controller">Controller</dfn> = <b>nullptr</b>;</td></tr>
<tr><th id="69">69</th><td>};</td></tr>
<tr><th id="70">70</th><td></td></tr>
<tr><th id="71">71</th><td>} <i>// namespace</i></td></tr>
<tr><th id="72">72</th><td></td></tr>
<tr><th id="73">73</th><td><b>static_assert</b>(<span class="namespace">std::</span><span class='type' title='std::is_trivially_destructible' data-ref="std::is_trivially_destructible" data-ref-filename="std..is_trivially_destructible">is_trivially_destructible</span>&lt;<a class="tu type" href="#__xray::(anonymousnamespace)::ThreadLocalData" title='__xray::(anonymous namespace)::ThreadLocalData' data-ref="__xray::(anonymousnamespace)::ThreadLocalData" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData">ThreadLocalData</a>&gt;::<span class='ref' title='std::integral_constant::value' data-ref="std::integral_constant::value" data-ref-filename="std..integral_constant..value">value</span>,</td></tr>
<tr><th id="74">74</th><td>              <q>"ThreadLocalData must be trivially destructible"</q>);</td></tr>
<tr><th id="75">75</th><td></td></tr>
<tr><th id="76">76</th><td><i  data-doc="__xray::Key">// Use a global pthread key to identify thread-local data for logging.</i></td></tr>
<tr><th id="77">77</th><td><em>static</em> <a class="typedef" href="../../../../include/bits/pthreadtypes.h.html#pthread_key_t" title='pthread_key_t' data-type='unsigned int' data-ref="pthread_key_t" data-ref-filename="pthread_key_t">pthread_key_t</a> <dfn class="tu decl def" id="__xray::Key" title='__xray::Key' data-type='pthread_key_t' data-ref="__xray::Key" data-ref-filename="__xray..Key">Key</dfn>;</td></tr>
<tr><th id="78">78</th><td></td></tr>
<tr><th id="79">79</th><td><i  data-doc="__xray::BufferQueueStorage">// Global BufferQueue.</i></td></tr>
<tr><th id="80">80</th><td><em>static</em> <span class="namespace">std::</span><span class='type' title='std::aligned_storage' data-ref="std::aligned_storage" data-ref-filename="std..aligned_storage">aligned_storage</span>&lt;<b>sizeof</b>(<a class="type" href="xray_buffer_queue.h.html#__xray::BufferQueue" title='__xray::BufferQueue' data-ref="__xray::BufferQueue" data-ref-filename="__xray..BufferQueue">BufferQueue</a>)&gt;::<span class='type' title='std::aligned_storage::type' data-ref="std::aligned_storage::type" data-ref-filename="std..aligned_storage..type">type</span> <span class='ref fn fake' title='std::aligned_storage&lt;80, 16&gt;::type::type' data-ref="_ZNSt15aligned_storageILm80ELm16EE4typeC1Ev" data-ref-filename="_ZNSt15aligned_storageILm80ELm16EE4typeC1Ev"></span><dfn class="tu decl def" id="__xray::BufferQueueStorage" title='__xray::BufferQueueStorage' data-type='std::aligned_storage&lt;sizeof(BufferQueue)&gt;::type' data-ref="__xray::BufferQueueStorage" data-ref-filename="__xray..BufferQueueStorage">BufferQueueStorage</dfn>;</td></tr>
<tr><th id="81">81</th><td><em>static</em> <a class="type" href="xray_buffer_queue.h.html#__xray::BufferQueue" title='__xray::BufferQueue' data-ref="__xray::BufferQueue" data-ref-filename="__xray..BufferQueue">BufferQueue</a> *<dfn class="tu decl def" id="__xray::BQ" title='__xray::BQ' data-type='__xray::BufferQueue *' data-ref="__xray::BQ" data-ref-filename="__xray..BQ">BQ</dfn> = <b>nullptr</b>;</td></tr>
<tr><th id="82">82</th><td></td></tr>
<tr><th id="83">83</th><td><i  data-doc="__xray::ThresholdTicks">// Global thresholds for function durations.</i></td></tr>
<tr><th id="84">84</th><td><em>static</em> <a class="type" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::atomic_uint64_t" title='__sanitizer::atomic_uint64_t' data-ref="__sanitizer::atomic_uint64_t" data-ref-filename="__sanitizer..atomic_uint64_t">atomic_uint64_t</a> <dfn class="tu decl def" id="__xray::ThresholdTicks" title='__xray::ThresholdTicks' data-type='__sanitizer::atomic_uint64_t' data-ref="__xray::ThresholdTicks" data-ref-filename="__xray..ThresholdTicks">ThresholdTicks</dfn>{<var>0</var>};</td></tr>
<tr><th id="85">85</th><td></td></tr>
<tr><th id="86">86</th><td><i  data-doc="__xray::TicksPerSec">// Global for ticks per second.</i></td></tr>
<tr><th id="87">87</th><td><em>static</em> <a class="type" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::atomic_uint64_t" title='__sanitizer::atomic_uint64_t' data-ref="__sanitizer::atomic_uint64_t" data-ref-filename="__sanitizer..atomic_uint64_t">atomic_uint64_t</a> <dfn class="tu decl def" id="__xray::TicksPerSec" title='__xray::TicksPerSec' data-type='__sanitizer::atomic_uint64_t' data-ref="__xray::TicksPerSec" data-ref-filename="__xray..TicksPerSec">TicksPerSec</dfn>{<var>0</var>};</td></tr>
<tr><th id="88">88</th><td></td></tr>
<tr><th id="89">89</th><td><em>static</em> <a class="type" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::atomic_sint32_t" title='__sanitizer::atomic_sint32_t' data-ref="__sanitizer::atomic_sint32_t" data-ref-filename="__sanitizer..atomic_sint32_t">atomic_sint32_t</a> <dfn class="tu decl def" id="__xray::LogFlushStatus" title='__xray::LogFlushStatus' data-type='__sanitizer::atomic_sint32_t' data-ref="__xray::LogFlushStatus" data-ref-filename="__xray..LogFlushStatus">LogFlushStatus</dfn> = {</td></tr>
<tr><th id="90">90</th><td>    <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogFlushStatus" title='XRayLogFlushStatus' data-ref="XRayLogFlushStatus" data-ref-filename="XRayLogFlushStatus">XRayLogFlushStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_NOT_FLUSHING" title='XRAY_LOG_NOT_FLUSHING' data-ref="XRAY_LOG_NOT_FLUSHING" data-ref-filename="XRAY_LOG_NOT_FLUSHING">XRAY_LOG_NOT_FLUSHING</a>};</td></tr>
<tr><th id="91">91</th><td></td></tr>
<tr><th id="92">92</th><td><i>// This function will initialize the thread-local data structure used by the FDR</i></td></tr>
<tr><th id="93">93</th><td><i>// logging implementation and return a reference to it. The implementation</i></td></tr>
<tr><th id="94">94</th><td><i>// details require a bit of care to maintain.</i></td></tr>
<tr><th id="95">95</th><td><i>//</i></td></tr>
<tr><th id="96">96</th><td><i>// First, some requirements on the implementation in general:</i></td></tr>
<tr><th id="97">97</th><td><i>//</i></td></tr>
<tr><th id="98">98</th><td><i>//   - XRay handlers should not call any memory allocation routines that may</i></td></tr>
<tr><th id="99">99</th><td><i>//     delegate to an instrumented implementation. This means functions like</i></td></tr>
<tr><th id="100">100</th><td><i>//     malloc() and free() should not be called while instrumenting.</i></td></tr>
<tr><th id="101">101</th><td><i>//</i></td></tr>
<tr><th id="102">102</th><td><i>//   - We would like to use some thread-local data initialized on first-use of</i></td></tr>
<tr><th id="103">103</th><td><i>//     the XRay instrumentation. These allow us to implement unsynchronized</i></td></tr>
<tr><th id="104">104</th><td><i>//     routines that access resources associated with the thread.</i></td></tr>
<tr><th id="105">105</th><td><i>//</i></td></tr>
<tr><th id="106">106</th><td><i>// The implementation here uses a few mechanisms that allow us to provide both</i></td></tr>
<tr><th id="107">107</th><td><i>// the requirements listed above. We do this by:</i></td></tr>
<tr><th id="108">108</th><td><i>//</i></td></tr>
<tr><th id="109">109</th><td><i>//   1. Using a thread-local aligned storage buffer for representing the</i></td></tr>
<tr><th id="110">110</th><td><i>//      ThreadLocalData struct. This data will be uninitialized memory by</i></td></tr>
<tr><th id="111">111</th><td><i>//      design.</i></td></tr>
<tr><th id="112">112</th><td><i>//</i></td></tr>
<tr><th id="113">113</th><td><i>//   2. Not requiring a thread exit handler/implementation, keeping the</i></td></tr>
<tr><th id="114">114</th><td><i>//      thread-local as purely a collection of references/data that do not</i></td></tr>
<tr><th id="115">115</th><td><i>//      require cleanup.</i></td></tr>
<tr><th id="116">116</th><td><i>//</i></td></tr>
<tr><th id="117">117</th><td><i>// We're doing this to avoid using a `thread_local` object that has a</i></td></tr>
<tr><th id="118">118</th><td><i>// non-trivial destructor, because the C++ runtime might call std::malloc(...)</i></td></tr>
<tr><th id="119">119</th><td><i>// to register calls to destructors. Deadlocks may arise when, for example, an</i></td></tr>
<tr><th id="120">120</th><td><i>// externally provided malloc implementation is XRay instrumented, and</i></td></tr>
<tr><th id="121">121</th><td><i>// initializing the thread-locals involves calling into malloc. A malloc</i></td></tr>
<tr><th id="122">122</th><td><i>// implementation that does global synchronization might be holding a lock for a</i></td></tr>
<tr><th id="123">123</th><td><i>// critical section, calling a function that might be XRay instrumented (and</i></td></tr>
<tr><th id="124">124</th><td><i>// thus in turn calling into malloc by virtue of registration of the</i></td></tr>
<tr><th id="125">125</th><td><i>// thread_local's destructor).</i></td></tr>
<tr><th id="126">126</th><td><u>#<span data-ppcond="126">if</span> <a class="macro" href="xray_defs.h.html#28" title="1" data-ref="_M/XRAY_HAS_TLS_ALIGNAS">XRAY_HAS_TLS_ALIGNAS</a></u></td></tr>
<tr><th id="127">127</th><td><b>static_assert</b>(<b>alignof</b>(<a class="tu type" href="#__xray::(anonymousnamespace)::ThreadLocalData" title='__xray::(anonymous namespace)::ThreadLocalData' data-ref="__xray::(anonymousnamespace)::ThreadLocalData" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData">ThreadLocalData</a>) &gt;= <var>64</var>,</td></tr>
<tr><th id="128">128</th><td>              <q>"ThreadLocalData must be cache line aligned."</q>);</td></tr>
<tr><th id="129">129</th><td><u>#<span data-ppcond="126">endif</span></u></td></tr>
<tr><th id="130">130</th><td><em>static</em> <a class="tu type" href="#__xray::(anonymousnamespace)::ThreadLocalData" title='__xray::(anonymous namespace)::ThreadLocalData' data-ref="__xray::(anonymousnamespace)::ThreadLocalData" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData">ThreadLocalData</a> &amp;<dfn class="tu decl def fn" id="__xray::getThreadLocalData" title='__xray::getThreadLocalData' data-type='__xray::(anonymous namespace)::ThreadLocalData &amp; __xray::getThreadLocalData()' data-ref="__xray::getThreadLocalData" data-ref-filename="__xray..getThreadLocalData">getThreadLocalData</dfn>() {</td></tr>
<tr><th id="131">131</th><td>  <b>thread_local</b> <b>typename</b> <span class="namespace">std::</span><span class='type' title='std::aligned_storage' data-ref="std::aligned_storage" data-ref-filename="std..aligned_storage">aligned_storage</span>&lt;</td></tr>
<tr><th id="132">132</th><td>      <b>sizeof</b>(<a class="tu type" href="#__xray::(anonymousnamespace)::ThreadLocalData" title='__xray::(anonymous namespace)::ThreadLocalData' data-ref="__xray::(anonymousnamespace)::ThreadLocalData" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData">ThreadLocalData</a>), <b>alignof</b>(<a class="tu type" href="#__xray::(anonymousnamespace)::ThreadLocalData" title='__xray::(anonymous namespace)::ThreadLocalData' data-ref="__xray::(anonymousnamespace)::ThreadLocalData" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData">ThreadLocalData</a>)&gt;::<span class='type' title='std::aligned_storage::type' data-ref="std::aligned_storage::type" data-ref-filename="std..aligned_storage..type">type</span> <dfn class="local col2 decl" id="92TLDStorage" title='TLDStorage' data-type='typename std::aligned_storage&lt;sizeof(ThreadLocalData), alignof(ThreadLocalData)&gt;::type' data-ref="92TLDStorage" data-ref-filename="92TLDStorage">TLDStorage</dfn>{};</td></tr>
<tr><th id="133">133</th><td></td></tr>
<tr><th id="134">134</th><td>  <b>if</b> (<a class="ref fn" href="../../../../include/pthread.h.html#pthread_getspecific" title='pthread_getspecific' data-ref="pthread_getspecific" data-ref-filename="pthread_getspecific">pthread_getspecific</a>(<a class="tu ref" href="#__xray::Key" title='__xray::Key' data-use='r' data-ref="__xray::Key" data-ref-filename="__xray..Key">Key</a>) == <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="135">135</th><td>    <b>new</b> (<b>reinterpret_cast</b>&lt;<a class="tu type" href="#__xray::(anonymousnamespace)::ThreadLocalData" title='__xray::(anonymous namespace)::ThreadLocalData' data-ref="__xray::(anonymousnamespace)::ThreadLocalData" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData">ThreadLocalData</a> *&gt;(&amp;<a class="local col2 ref" href="#92TLDStorage" title='TLDStorage' data-ref="92TLDStorage" data-ref-filename="92TLDStorage">TLDStorage</a>)) <a class="tu type" href="#__xray::(anonymousnamespace)::ThreadLocalData" title='__xray::(anonymous namespace)::ThreadLocalData' data-ref="__xray::(anonymousnamespace)::ThreadLocalData" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData">ThreadLocalData</a>{};</td></tr>
<tr><th id="136">136</th><td>    <a class="ref fn" href="../../../../include/pthread.h.html#pthread_setspecific" title='pthread_setspecific' data-ref="pthread_setspecific" data-ref-filename="pthread_setspecific">pthread_setspecific</a>(<a class="tu ref" href="#__xray::Key" title='__xray::Key' data-use='r' data-ref="__xray::Key" data-ref-filename="__xray..Key">Key</a>, &amp;<a class="local col2 ref" href="#92TLDStorage" title='TLDStorage' data-ref="92TLDStorage" data-ref-filename="92TLDStorage">TLDStorage</a>);</td></tr>
<tr><th id="137">137</th><td>  }</td></tr>
<tr><th id="138">138</th><td></td></tr>
<tr><th id="139">139</th><td>  <b>return</b> *<b>reinterpret_cast</b>&lt;<a class="tu type" href="#__xray::(anonymousnamespace)::ThreadLocalData" title='__xray::(anonymous namespace)::ThreadLocalData' data-ref="__xray::(anonymousnamespace)::ThreadLocalData" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData">ThreadLocalData</a> *&gt;(&amp;<a class="local col2 ref" href="#92TLDStorage" title='TLDStorage' data-ref="92TLDStorage" data-ref-filename="92TLDStorage">TLDStorage</a>);</td></tr>
<tr><th id="140">140</th><td>}</td></tr>
<tr><th id="141">141</th><td></td></tr>
<tr><th id="142">142</th><td><em>static</em> <a class="type" href="../../include/xray/xray_records.h.html#__xray::XRayFileHeader" title='__xray::XRayFileHeader' data-ref="__xray::XRayFileHeader" data-ref-filename="__xray..XRayFileHeader">XRayFileHeader</a> &amp;<dfn class="tu decl def fn" id="__xray::fdrCommonHeaderInfo" title='__xray::fdrCommonHeaderInfo' data-type='__xray::XRayFileHeader &amp; __xray::fdrCommonHeaderInfo()' data-ref="__xray::fdrCommonHeaderInfo" data-ref-filename="__xray..fdrCommonHeaderInfo">fdrCommonHeaderInfo</dfn>() {</td></tr>
<tr><th id="143">143</th><td>  <em>static</em> <span class="namespace">std::</span><span class='type' title='std::aligned_storage' data-ref="std::aligned_storage" data-ref-filename="std..aligned_storage">aligned_storage</span>&lt;<b>sizeof</b>(<a class="type" href="../../include/xray/xray_records.h.html#__xray::XRayFileHeader" title='__xray::XRayFileHeader' data-ref="__xray::XRayFileHeader" data-ref-filename="__xray..XRayFileHeader">XRayFileHeader</a>)&gt;::<span class='type' title='std::aligned_storage::type' data-ref="std::aligned_storage::type" data-ref-filename="std..aligned_storage..type">type</span> <span class='ref fn fake' title='std::aligned_storage&lt;32, 16&gt;::type::type' data-ref="_ZNSt15aligned_storageILm32ELm16EE4typeC1Ev" data-ref-filename="_ZNSt15aligned_storageILm32ELm16EE4typeC1Ev"></span><dfn class="local col3 decl" id="93HStorage" title='HStorage' data-type='std::aligned_storage&lt;sizeof(XRayFileHeader)&gt;::type' data-ref="93HStorage" data-ref-filename="93HStorage">HStorage</dfn>;</td></tr>
<tr><th id="144">144</th><td>  <em>static</em> <a class="typedef" href="../../../../include/bits/pthreadtypes.h.html#pthread_once_t" title='pthread_once_t' data-type='int' data-ref="pthread_once_t" data-ref-filename="pthread_once_t">pthread_once_t</a> <dfn class="local col4 decl" id="94OnceInit" title='OnceInit' data-type='pthread_once_t' data-ref="94OnceInit" data-ref-filename="94OnceInit">OnceInit</dfn> = <a class="macro" href="../../../../include/pthread.h.html#182" title="0" data-ref="_M/PTHREAD_ONCE_INIT">PTHREAD_ONCE_INIT</a>;</td></tr>
<tr><th id="145">145</th><td>  <em>static</em> <em>bool</em> <dfn class="local col5 decl" id="95TSCSupported" title='TSCSupported' data-type='bool' data-ref="95TSCSupported" data-ref-filename="95TSCSupported">TSCSupported</dfn> = <b>true</b>;</td></tr>
<tr><th id="146">146</th><td>  <em>static</em> <a class="typedef" href="../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col6 decl" id="96CycleFrequency" title='CycleFrequency' data-type='uint64_t' data-ref="96CycleFrequency" data-ref-filename="96CycleFrequency">CycleFrequency</dfn> = <a class="ref" href="xray_tsc.h.html#__xray::NanosecondsPerSecond" title='__xray::NanosecondsPerSecond' data-ref="__xray::NanosecondsPerSecond" data-ref-filename="__xray..NanosecondsPerSecond">NanosecondsPerSecond</a>;</td></tr>
<tr><th id="147">147</th><td>  <a class="ref fn" href="../../../../include/pthread.h.html#pthread_once" title='pthread_once' data-ref="pthread_once" data-ref-filename="pthread_once">pthread_once</a>(</td></tr>
<tr><th id="148">148</th><td>      &amp;<a class="local col4 ref" href="#94OnceInit" title='OnceInit' data-ref="94OnceInit" data-ref-filename="94OnceInit">OnceInit</a>, +<a class="tu ref fn fake" href="#148" title='__xray::fdrCommonHeaderInfo()::(anonymous class)::operator void (*)()' data-use='c' data-ref="__xray::fdrCommonHeaderInfo()::(anonymousclass)::operatorvoid(*)()" data-ref-filename="__xray..fdrCommonHeaderInfo()..(anonymousclass)..operatorvoid(*)()"></a>[] {</td></tr>
<tr><th id="149">149</th><td>        <a class="type" href="../../include/xray/xray_records.h.html#__xray::XRayFileHeader" title='__xray::XRayFileHeader' data-ref="__xray::XRayFileHeader" data-ref-filename="__xray..XRayFileHeader">XRayFileHeader</a> &amp;<dfn class="local col7 decl" id="97H" title='H' data-type='__xray::XRayFileHeader &amp;' data-ref="97H" data-ref-filename="97H">H</dfn> = <b>reinterpret_cast</b>&lt;<a class="type" href="../../include/xray/xray_records.h.html#__xray::XRayFileHeader" title='__xray::XRayFileHeader' data-ref="__xray::XRayFileHeader" data-ref-filename="__xray..XRayFileHeader">XRayFileHeader</a> &amp;&gt;(<a class="local col3 ref" href="#93HStorage" title='HStorage' data-ref="93HStorage" data-ref-filename="93HStorage">HStorage</a>);</td></tr>
<tr><th id="150">150</th><td>        <i>// Version 2 of the log writes the extents of the buffer, instead of</i></td></tr>
<tr><th id="151">151</th><td><i>        // relying on an end-of-buffer record.</i></td></tr>
<tr><th id="152">152</th><td><i>        // Version 3 includes PID metadata record.</i></td></tr>
<tr><th id="153">153</th><td><i>        // Version 4 includes CPU data in the custom event records.</i></td></tr>
<tr><th id="154">154</th><td><i>        // Version 5 uses relative deltas for custom and typed event records,</i></td></tr>
<tr><th id="155">155</th><td><i>        // and removes the CPU data in custom event records (similar to how</i></td></tr>
<tr><th id="156">156</th><td><i>        // function records use deltas instead of full TSCs and rely on other</i></td></tr>
<tr><th id="157">157</th><td><i>        // metadata records for TSC wraparound and CPU migration).</i></td></tr>
<tr><th id="158">158</th><td>        <a class="local col7 ref" href="#97H" title='H' data-ref="97H" data-ref-filename="97H">H</a>.<a class="ref field" href="../../include/xray/xray_records.h.html#__xray::XRayFileHeader::Version" title='__xray::XRayFileHeader::Version' data-ref="__xray::XRayFileHeader::Version" data-ref-filename="__xray..XRayFileHeader..Version">Version</a> = <var>5</var>;</td></tr>
<tr><th id="159">159</th><td>        <a class="local col7 ref" href="#97H" title='H' data-ref="97H" data-ref-filename="97H">H</a>.<a class="ref field" href="../../include/xray/xray_records.h.html#__xray::XRayFileHeader::Type" title='__xray::XRayFileHeader::Type' data-ref="__xray::XRayFileHeader::Type" data-ref-filename="__xray..XRayFileHeader..Type">Type</a> = <a class="type" href="../../include/xray/xray_records.h.html#__xray::FileTypes" title='__xray::FileTypes' data-ref="__xray::FileTypes" data-ref-filename="__xray..FileTypes">FileTypes</a>::<a class="enum" href="../../include/xray/xray_records.h.html#__xray::FDR_LOG" title='__xray::FDR_LOG' data-ref="__xray::FDR_LOG" data-ref-filename="__xray..FDR_LOG">FDR_LOG</a>;</td></tr>
<tr><th id="160">160</th><td></td></tr>
<tr><th id="161">161</th><td>        <i>// Test for required CPU features and cache the cycle frequency</i></td></tr>
<tr><th id="162">162</th><td>        <a class="local col5 ref" href="#95TSCSupported" title='TSCSupported' data-ref="95TSCSupported" data-ref-filename="95TSCSupported">TSCSupported</a> = <a class="ref fn" href="xray_x86_64.inc.html#__xray::probeRequiredCPUFeatures" title='__xray::probeRequiredCPUFeatures' data-ref="__xray::probeRequiredCPUFeatures" data-ref-filename="__xray..probeRequiredCPUFeatures">probeRequiredCPUFeatures</a>();</td></tr>
<tr><th id="163">163</th><td>        <b>if</b> (<a class="local col5 ref" href="#95TSCSupported" title='TSCSupported' data-ref="95TSCSupported" data-ref-filename="95TSCSupported">TSCSupported</a>)</td></tr>
<tr><th id="164">164</th><td>          <a class="local col6 ref" href="#96CycleFrequency" title='CycleFrequency' data-ref="96CycleFrequency" data-ref-filename="96CycleFrequency">CycleFrequency</a> = <a class="ref fn" href="xray_x86_64.inc.html#__xray::getTSCFrequency" title='__xray::getTSCFrequency' data-ref="__xray::getTSCFrequency" data-ref-filename="__xray..getTSCFrequency">getTSCFrequency</a>();</td></tr>
<tr><th id="165">165</th><td>        <a class="local col7 ref" href="#97H" title='H' data-ref="97H" data-ref-filename="97H">H</a>.<a class="ref field" href="../../include/xray/xray_records.h.html#__xray::XRayFileHeader::CycleFrequency" title='__xray::XRayFileHeader::CycleFrequency' data-ref="__xray::XRayFileHeader::CycleFrequency" data-ref-filename="__xray..XRayFileHeader..CycleFrequency">CycleFrequency</a> = <a class="local col6 ref" href="#96CycleFrequency" title='CycleFrequency' data-ref="96CycleFrequency" data-ref-filename="96CycleFrequency">CycleFrequency</a>;</td></tr>
<tr><th id="166">166</th><td></td></tr>
<tr><th id="167">167</th><td>        <i>// FIXME: Actually check whether we have 'constant_tsc' and</i></td></tr>
<tr><th id="168">168</th><td><i>        // 'nonstop_tsc' before setting the values in the header.</i></td></tr>
<tr><th id="169">169</th><td>        <a class="local col7 ref" href="#97H" title='H' data-ref="97H" data-ref-filename="97H">H</a>.<a class="ref field" href="../../include/xray/xray_records.h.html#__xray::XRayFileHeader::ConstantTSC" title='__xray::XRayFileHeader::ConstantTSC' data-ref="__xray::XRayFileHeader::ConstantTSC" data-ref-filename="__xray..XRayFileHeader..ConstantTSC">ConstantTSC</a> = <var>1</var>;</td></tr>
<tr><th id="170">170</th><td>        <a class="local col7 ref" href="#97H" title='H' data-ref="97H" data-ref-filename="97H">H</a>.<a class="ref field" href="../../include/xray/xray_records.h.html#__xray::XRayFileHeader::NonstopTSC" title='__xray::XRayFileHeader::NonstopTSC' data-ref="__xray::XRayFileHeader::NonstopTSC" data-ref-filename="__xray..XRayFileHeader..NonstopTSC">NonstopTSC</a> = <var>1</var>;</td></tr>
<tr><th id="171">171</th><td>      });</td></tr>
<tr><th id="172">172</th><td>  <b>return</b> <b>reinterpret_cast</b>&lt;<a class="type" href="../../include/xray/xray_records.h.html#__xray::XRayFileHeader" title='__xray::XRayFileHeader' data-ref="__xray::XRayFileHeader" data-ref-filename="__xray..XRayFileHeader">XRayFileHeader</a> &amp;&gt;(<a class="local col3 ref" href="#93HStorage" title='HStorage' data-ref="93HStorage" data-ref-filename="93HStorage">HStorage</a>);</td></tr>
<tr><th id="173">173</th><td>}</td></tr>
<tr><th id="174">174</th><td></td></tr>
<tr><th id="175">175</th><td><i>// This is the iterator implementation, which knows how to handle FDR-mode</i></td></tr>
<tr><th id="176">176</th><td><i>// specific buffers. This is used as an implementation of the iterator function</i></td></tr>
<tr><th id="177">177</th><td><i>// needed by __xray_set_buffer_iterator(...). It maintains a global state of the</i></td></tr>
<tr><th id="178">178</th><td><i>// buffer iteration for the currently installed FDR mode buffers. In particular:</i></td></tr>
<tr><th id="179">179</th><td><i>//</i></td></tr>
<tr><th id="180">180</th><td><i>//   - If the argument represents the initial state of XRayBuffer ({nullptr, 0})</i></td></tr>
<tr><th id="181">181</th><td><i>//     then the iterator returns the header information.</i></td></tr>
<tr><th id="182">182</th><td><i>//   - If the argument represents the header information ({address of header</i></td></tr>
<tr><th id="183">183</th><td><i>//     info, size of the header info}) then it returns the first FDR buffer's</i></td></tr>
<tr><th id="184">184</th><td><i>//     address and extents.</i></td></tr>
<tr><th id="185">185</th><td><i>//   - It will keep returning the next buffer and extents as there are more</i></td></tr>
<tr><th id="186">186</th><td><i>//     buffers to process. When the input represents the last buffer, it will</i></td></tr>
<tr><th id="187">187</th><td><i>//     return the initial state to signal completion ({nullptr, 0}).</i></td></tr>
<tr><th id="188">188</th><td><i>//</i></td></tr>
<tr><th id="189">189</th><td><i>// See xray/xray_log_interface.h for more details on the requirements for the</i></td></tr>
<tr><th id="190">190</th><td><i>// implementations of __xray_set_buffer_iterator(...) and</i></td></tr>
<tr><th id="191">191</th><td><i>// __xray_log_process_buffers(...).</i></td></tr>
<tr><th id="192">192</th><td><a class="type" href="../../include/xray/xray_log_interface.h.html#XRayBuffer" title='XRayBuffer' data-ref="XRayBuffer" data-ref-filename="XRayBuffer">XRayBuffer</a> <dfn class="decl def fn" id="__xray::fdrIterator" title='__xray::fdrIterator' data-ref="__xray::fdrIterator" data-ref-filename="__xray..fdrIterator">fdrIterator</dfn>(<em>const</em> <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayBuffer" title='XRayBuffer' data-ref="XRayBuffer" data-ref-filename="XRayBuffer">XRayBuffer</a> <dfn class="local col8 decl" id="98B" title='B' data-type='const XRayBuffer' data-ref="98B" data-ref-filename="98B">B</dfn>) {</td></tr>
<tr><th id="193">193</th><td>  <a class="macro" href="../sanitizer_common/sanitizer_internal_defs.h.html#316" title="" data-ref="_M/DCHECK">DCHECK</a>(internal_strcmp(__xray_log_get_current_mode(), <q>"xray-fdr"</q>) == <var>0</var>);</td></tr>
<tr><th id="194">194</th><td>  <a class="macro" href="../sanitizer_common/sanitizer_internal_defs.h.html#316" title="" data-ref="_M/DCHECK">DCHECK</a>(BQ-&gt;finalizing());</td></tr>
<tr><th id="195">195</th><td></td></tr>
<tr><th id="196">196</th><td>  <b>if</b> (<a class="tu ref" href="#__xray::BQ" title='__xray::BQ' data-use='r' data-ref="__xray::BQ" data-ref-filename="__xray..BQ">BQ</a> == <b>nullptr</b> || !<a class="tu ref" href="#__xray::BQ" title='__xray::BQ' data-use='r' data-ref="__xray::BQ" data-ref-filename="__xray..BQ">BQ</a>-&gt;<a class="ref fn" href="xray_buffer_queue.h.html#__xray::BufferQueue::finalizing" title='__xray::BufferQueue::finalizing' data-ref="__xray::BufferQueue::finalizing" data-ref-filename="__xray..BufferQueue..finalizing">finalizing</a>()) {</td></tr>
<tr><th id="197">197</th><td>    <b>if</b> (<a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Verbosity" title='__sanitizer::Verbosity' data-ref="__sanitizer::Verbosity" data-ref-filename="__sanitizer..Verbosity">Verbosity</a>())</td></tr>
<tr><th id="198">198</th><td>      <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Report" title='__sanitizer::Report' data-ref="__sanitizer::Report" data-ref-filename="__sanitizer..Report">Report</a>(</td></tr>
<tr><th id="199">199</th><td>          <q>"XRay FDR: Failed global buffer queue is null or not finalizing!\n"</q>);</td></tr>
<tr><th id="200">200</th><td>    <b>return</b> {<b>nullptr</b>, <var>0</var>};</td></tr>
<tr><th id="201">201</th><td>  }</td></tr>
<tr><th id="202">202</th><td></td></tr>
<tr><th id="203">203</th><td>  <i>// We use a global scratch-pad for the header information, which only gets</i></td></tr>
<tr><th id="204">204</th><td><i>  // initialized the first time this function is called. We'll update one part</i></td></tr>
<tr><th id="205">205</th><td><i>  // of this information with some relevant data (in particular the number of</i></td></tr>
<tr><th id="206">206</th><td><i>  // buffers to expect).</i></td></tr>
<tr><th id="207">207</th><td>  <em>static</em> <span class="namespace">std::</span><span class='type' title='std::aligned_storage' data-ref="std::aligned_storage" data-ref-filename="std..aligned_storage">aligned_storage</span>&lt;<b>sizeof</b>(<a class="type" href="../../include/xray/xray_records.h.html#__xray::XRayFileHeader" title='__xray::XRayFileHeader' data-ref="__xray::XRayFileHeader" data-ref-filename="__xray..XRayFileHeader">XRayFileHeader</a>)&gt;::<span class='type' title='std::aligned_storage::type' data-ref="std::aligned_storage::type" data-ref-filename="std..aligned_storage..type">type</span> <span class='ref fn fake' title='std::aligned_storage&lt;32, 16&gt;::type::type' data-ref="_ZNSt15aligned_storageILm32ELm16EE4typeC1Ev" data-ref-filename="_ZNSt15aligned_storageILm32ELm16EE4typeC1Ev"></span><dfn class="local col9 decl" id="99HeaderStorage" title='HeaderStorage' data-type='std::aligned_storage&lt;sizeof(XRayFileHeader)&gt;::type' data-ref="99HeaderStorage" data-ref-filename="99HeaderStorage">HeaderStorage</dfn>;</td></tr>
<tr><th id="208">208</th><td>  <em>static</em> <a class="typedef" href="../../../../include/bits/pthreadtypes.h.html#pthread_once_t" title='pthread_once_t' data-type='int' data-ref="pthread_once_t" data-ref-filename="pthread_once_t">pthread_once_t</a> <dfn class="local col0 decl" id="100HeaderOnce" title='HeaderOnce' data-type='pthread_once_t' data-ref="100HeaderOnce" data-ref-filename="100HeaderOnce">HeaderOnce</dfn> = <a class="macro" href="../../../../include/pthread.h.html#182" title="0" data-ref="_M/PTHREAD_ONCE_INIT">PTHREAD_ONCE_INIT</a>;</td></tr>
<tr><th id="209">209</th><td>  <a class="ref fn" href="../../../../include/pthread.h.html#pthread_once" title='pthread_once' data-ref="pthread_once" data-ref-filename="pthread_once">pthread_once</a>(</td></tr>
<tr><th id="210">210</th><td>      &amp;<a class="local col0 ref" href="#100HeaderOnce" title='HeaderOnce' data-ref="100HeaderOnce" data-ref-filename="100HeaderOnce">HeaderOnce</a>, +<a class="tu ref fn fake" href="#210" title='__xray::fdrIterator(const XRayBuffer)::(anonymous class)::operator void (*)()' data-use='c' data-ref="__xray::fdrIterator(constXRayBuffer)::(anonymousclass)::operatorvoid(*)()" data-ref-filename="__xray..fdrIterator(constXRayBuffer)..(anonymousclass)..operatorvoid(*)()"></a>[] {</td></tr>
<tr><th id="211">211</th><td>        <b>reinterpret_cast</b>&lt;<a class="type" href="../../include/xray/xray_records.h.html#__xray::XRayFileHeader" title='__xray::XRayFileHeader' data-ref="__xray::XRayFileHeader" data-ref-filename="__xray..XRayFileHeader">XRayFileHeader</a> &amp;&gt;(<a class="local col9 ref" href="#99HeaderStorage" title='HeaderStorage' data-ref="99HeaderStorage" data-ref-filename="99HeaderStorage">HeaderStorage</a>) <a class="ref fn" href="../../include/xray/xray_records.h.html#38" title='__xray::XRayFileHeader::operator=' data-ref="__xray::XRayFileHeader::operator=" data-ref-filename="__xray..XRayFileHeader..operator=">=</a></td></tr>
<tr><th id="212">212</th><td>            <a class="tu ref fn" href="#__xray::fdrCommonHeaderInfo" title='__xray::fdrCommonHeaderInfo' data-use='c' data-ref="__xray::fdrCommonHeaderInfo" data-ref-filename="__xray..fdrCommonHeaderInfo">fdrCommonHeaderInfo</a>();</td></tr>
<tr><th id="213">213</th><td>      });</td></tr>
<tr><th id="214">214</th><td></td></tr>
<tr><th id="215">215</th><td>  <i>// We use a convenience alias for code referring to Header from here on out.</i></td></tr>
<tr><th id="216">216</th><td>  <em>auto</em> &amp;<dfn class="local col1 decl" id="101Header" title='Header' data-type='__xray::XRayFileHeader &amp;' data-ref="101Header" data-ref-filename="101Header">Header</dfn> = <b>reinterpret_cast</b>&lt;<a class="type" href="../../include/xray/xray_records.h.html#__xray::XRayFileHeader" title='__xray::XRayFileHeader' data-ref="__xray::XRayFileHeader" data-ref-filename="__xray..XRayFileHeader">XRayFileHeader</a> &amp;&gt;(<a class="local col9 ref" href="#99HeaderStorage" title='HeaderStorage' data-ref="99HeaderStorage" data-ref-filename="99HeaderStorage">HeaderStorage</a>);</td></tr>
<tr><th id="217">217</th><td>  <b>if</b> (<a class="local col8 ref" href="#98B" title='B' data-ref="98B" data-ref-filename="98B">B</a>.<a class="ref field" href="../../include/xray/xray_log_interface.h.html#XRayBuffer::Data" title='XRayBuffer::Data' data-ref="XRayBuffer::Data" data-ref-filename="XRayBuffer..Data">Data</a> == <b>nullptr</b> &amp;&amp; <a class="local col8 ref" href="#98B" title='B' data-ref="98B" data-ref-filename="98B">B</a>.<a class="ref field" href="../../include/xray/xray_log_interface.h.html#XRayBuffer::Size" title='XRayBuffer::Size' data-ref="XRayBuffer::Size" data-ref-filename="XRayBuffer..Size">Size</a> == <var>0</var>) {</td></tr>
<tr><th id="218">218</th><td>    <a class="local col1 ref" href="#101Header" title='Header' data-ref="101Header" data-ref-filename="101Header">Header</a>.<a class="ref field" href="../../include/xray/xray_records.h.html#__xray::XRayFileHeader::(anonymous)::FdrData" title='__xray::XRayFileHeader::(anonymous union)::FdrData' data-ref="__xray::XRayFileHeader::(anonymous)::FdrData" data-ref-filename="__xray..XRayFileHeader..(anonymous)..FdrData">FdrData</a> <a class="ref fn" href="../../include/xray/xray_records.h.html#29" title='__xray::FdrAdditionalHeaderData::operator=' data-ref="__xray::FdrAdditionalHeaderData::operator=" data-ref-filename="__xray..FdrAdditionalHeaderData..operator=">=</a> <a class="type" href="../../include/xray/xray_records.h.html#__xray::FdrAdditionalHeaderData" title='__xray::FdrAdditionalHeaderData' data-ref="__xray::FdrAdditionalHeaderData" data-ref-filename="__xray..FdrAdditionalHeaderData">FdrAdditionalHeaderData</a>{<a class="tu ref" href="#__xray::BQ" title='__xray::BQ' data-use='r' data-ref="__xray::BQ" data-ref-filename="__xray..BQ">BQ</a>-&gt;<a class="ref fn" href="xray_buffer_queue.h.html#__xray::BufferQueue::ConfiguredBufferSize" title='__xray::BufferQueue::ConfiguredBufferSize' data-ref="__xray::BufferQueue::ConfiguredBufferSize" data-ref-filename="__xray..BufferQueue..ConfiguredBufferSize">ConfiguredBufferSize</a>()};</td></tr>
<tr><th id="219">219</th><td>    <b>return</b> <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayBuffer" title='XRayBuffer' data-ref="XRayBuffer" data-ref-filename="XRayBuffer">XRayBuffer</a>{<b>static_cast</b>&lt;<em>void</em> *&gt;(&amp;<a class="local col1 ref" href="#101Header" title='Header' data-ref="101Header" data-ref-filename="101Header">Header</a>), <b>sizeof</b>(<a class="local col1 ref" href="#101Header" title='Header' data-ref="101Header" data-ref-filename="101Header">Header</a>)};</td></tr>
<tr><th id="220">220</th><td>  }</td></tr>
<tr><th id="221">221</th><td></td></tr>
<tr><th id="222">222</th><td>  <em>static</em> <a class="type" href="xray_buffer_queue.h.html#__xray::BufferQueue" title='__xray::BufferQueue' data-ref="__xray::BufferQueue" data-ref-filename="__xray..BufferQueue">BufferQueue</a>::<a class="typedef" href="xray_buffer_queue.h.html#__xray::BufferQueue::const_iterator" title='__xray::BufferQueue::const_iterator' data-type='Iterator&lt;const __xray::BufferQueue::Buffer&gt;' data-ref="__xray::BufferQueue::const_iterator" data-ref-filename="__xray..BufferQueue..const_iterator">const_iterator</a> <dfn class="local col2 decl" id="102It" title='It' data-type='BufferQueue::const_iterator' data-ref="102It" data-ref-filename="102It">It</dfn><a class="ref fn" href="xray_buffer_queue.h.html#__xray::BufferQueue::Iterator::Iterator{T}" title='__xray::BufferQueue::Iterator::Iterator&lt;T&gt;' data-ref="__xray::BufferQueue::Iterator::Iterator{T}" data-ref-filename="__xray..BufferQueue..Iterator..Iterator{T}">{</a>};</td></tr>
<tr><th id="223">223</th><td>  <em>static</em> <a class="type" href="xray_buffer_queue.h.html#__xray::BufferQueue" title='__xray::BufferQueue' data-ref="__xray::BufferQueue" data-ref-filename="__xray..BufferQueue">BufferQueue</a>::<a class="typedef" href="xray_buffer_queue.h.html#__xray::BufferQueue::const_iterator" title='__xray::BufferQueue::const_iterator' data-type='Iterator&lt;const __xray::BufferQueue::Buffer&gt;' data-ref="__xray::BufferQueue::const_iterator" data-ref-filename="__xray..BufferQueue..const_iterator">const_iterator</a> <dfn class="local col3 decl" id="103End" title='End' data-type='BufferQueue::const_iterator' data-ref="103End" data-ref-filename="103End">End</dfn><a class="ref fn" href="xray_buffer_queue.h.html#__xray::BufferQueue::Iterator::Iterator{T}" title='__xray::BufferQueue::Iterator::Iterator&lt;T&gt;' data-ref="__xray::BufferQueue::Iterator::Iterator{T}" data-ref-filename="__xray..BufferQueue..Iterator..Iterator{T}">{</a>};</td></tr>
<tr><th id="224">224</th><td>  <em>static</em> <a class="typedef" href="../../../../include/bits/stdint-uintn.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a> *<dfn class="local col4 decl" id="104CurrentBuffer" title='CurrentBuffer' data-type='uint8_t *' data-ref="104CurrentBuffer" data-ref-filename="104CurrentBuffer">CurrentBuffer</dfn>{<b>nullptr</b>};</td></tr>
<tr><th id="225">225</th><td>  <em>static</em> <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</span> <dfn class="local col5 decl" id="105SerializedBufferSize" title='SerializedBufferSize' data-type='size_t' data-ref="105SerializedBufferSize" data-ref-filename="105SerializedBufferSize">SerializedBufferSize</dfn> = <var>0</var>;</td></tr>
<tr><th id="226">226</th><td>  <b>if</b> (<a class="local col8 ref" href="#98B" title='B' data-ref="98B" data-ref-filename="98B">B</a>.<a class="ref field" href="../../include/xray/xray_log_interface.h.html#XRayBuffer::Data" title='XRayBuffer::Data' data-ref="XRayBuffer::Data" data-ref-filename="XRayBuffer..Data">Data</a> == <b>static_cast</b>&lt;<em>void</em> *&gt;(&amp;<a class="local col1 ref" href="#101Header" title='Header' data-ref="101Header" data-ref-filename="101Header">Header</a>) &amp;&amp; <a class="local col8 ref" href="#98B" title='B' data-ref="98B" data-ref-filename="98B">B</a>.<a class="ref field" href="../../include/xray/xray_log_interface.h.html#XRayBuffer::Size" title='XRayBuffer::Size' data-ref="XRayBuffer::Size" data-ref-filename="XRayBuffer..Size">Size</a> == <b>sizeof</b>(<a class="local col1 ref" href="#101Header" title='Header' data-ref="101Header" data-ref-filename="101Header">Header</a>)) {</td></tr>
<tr><th id="227">227</th><td>    <i>// From this point on, we provide raw access to the raw buffer we're getting</i></td></tr>
<tr><th id="228">228</th><td><i>    // from the BufferQueue. We're relying on the iterators from the current</i></td></tr>
<tr><th id="229">229</th><td><i>    // Buffer queue.</i></td></tr>
<tr><th id="230">230</th><td>    <a class="local col2 ref" href="#102It" title='It' data-ref="102It" data-ref-filename="102It">It</a> <a class="ref fn" href="xray_buffer_queue.h.html#__xray::BufferQueue::Iterator::operator=" title='__xray::BufferQueue::Iterator::operator=' data-ref="__xray::BufferQueue::Iterator::operator=" data-ref-filename="__xray..BufferQueue..Iterator..operator=">=</a> <a class="tu ref" href="#__xray::BQ" title='__xray::BQ' data-use='r' data-ref="__xray::BQ" data-ref-filename="__xray..BQ">BQ</a>-&gt;<a class="ref fn" href="xray_buffer_queue.h.html#__xray::BufferQueue::cbegin" title='__xray::BufferQueue::cbegin' data-ref="__xray::BufferQueue::cbegin" data-ref-filename="__xray..BufferQueue..cbegin">cbegin</a>();</td></tr>
<tr><th id="231">231</th><td>    <a class="local col3 ref" href="#103End" title='End' data-ref="103End" data-ref-filename="103End">End</a> <a class="ref fn" href="xray_buffer_queue.h.html#__xray::BufferQueue::Iterator::operator=" title='__xray::BufferQueue::Iterator::operator=' data-ref="__xray::BufferQueue::Iterator::operator=" data-ref-filename="__xray..BufferQueue..Iterator..operator=">=</a> <a class="tu ref" href="#__xray::BQ" title='__xray::BQ' data-use='r' data-ref="__xray::BQ" data-ref-filename="__xray..BQ">BQ</a>-&gt;<a class="ref fn" href="xray_buffer_queue.h.html#__xray::BufferQueue::cend" title='__xray::BufferQueue::cend' data-ref="__xray::BufferQueue::cend" data-ref-filename="__xray..BufferQueue..cend">cend</a>();</td></tr>
<tr><th id="232">232</th><td>  }</td></tr>
<tr><th id="233">233</th><td></td></tr>
<tr><th id="234">234</th><td>  <b>if</b> (<a class="local col4 ref" href="#104CurrentBuffer" title='CurrentBuffer' data-ref="104CurrentBuffer" data-ref-filename="104CurrentBuffer">CurrentBuffer</a> != <b>nullptr</b>) {</td></tr>
<tr><th id="235">235</th><td>    <a class="ref fn" href="xray_allocator.h.html#__xray::deallocateBuffer" title='__xray::deallocateBuffer' data-ref="__xray::deallocateBuffer" data-ref-filename="__xray..deallocateBuffer">deallocateBuffer</a>(<a class="local col4 ref" href="#104CurrentBuffer" title='CurrentBuffer' data-ref="104CurrentBuffer" data-ref-filename="104CurrentBuffer">CurrentBuffer</a>, <a class="local col5 ref" href="#105SerializedBufferSize" title='SerializedBufferSize' data-ref="105SerializedBufferSize" data-ref-filename="105SerializedBufferSize">SerializedBufferSize</a>);</td></tr>
<tr><th id="236">236</th><td>    <a class="local col4 ref" href="#104CurrentBuffer" title='CurrentBuffer' data-ref="104CurrentBuffer" data-ref-filename="104CurrentBuffer">CurrentBuffer</a> = <b>nullptr</b>;</td></tr>
<tr><th id="237">237</th><td>  }</td></tr>
<tr><th id="238">238</th><td></td></tr>
<tr><th id="239">239</th><td>  <b>if</b> (<a class="local col2 ref" href="#102It" title='It' data-ref="102It" data-ref-filename="102It">It</a> <a class="ref fn" href="xray_buffer_queue.h.html#__xray::operator==" title='__xray::operator==' data-ref="__xray::operator==" data-ref-filename="__xray..operator==">==</a> <a class="local col3 ref" href="#103End" title='End' data-ref="103End" data-ref-filename="103End">End</a>)</td></tr>
<tr><th id="240">240</th><td>    <b>return</b> {<b>nullptr</b>, <var>0</var>};</td></tr>
<tr><th id="241">241</th><td></td></tr>
<tr><th id="242">242</th><td>  <i>// Set up the current buffer to contain the extents like we would when writing</i></td></tr>
<tr><th id="243">243</th><td><i>  // out to disk. The difference here would be that we still write "empty"</i></td></tr>
<tr><th id="244">244</th><td><i>  // buffers, or at least go through the iterators faithfully to let the</i></td></tr>
<tr><th id="245">245</th><td><i>  // handlers see the empty buffers in the queue.</i></td></tr>
<tr><th id="246">246</th><td><i>  //</i></td></tr>
<tr><th id="247">247</th><td><i>  // We need this atomic fence here to ensure that writes happening to the</i></td></tr>
<tr><th id="248">248</th><td><i>  // buffer have been committed before we load the extents atomically. Because</i></td></tr>
<tr><th id="249">249</th><td><i>  // the buffer is not explicitly synchronised across threads, we rely on the</i></td></tr>
<tr><th id="250">250</th><td><i>  // fence ordering to ensure that writes we expect to have been completed</i></td></tr>
<tr><th id="251">251</th><td><i>  // before the fence are fully committed before we read the extents.</i></td></tr>
<tr><th id="252">252</th><td>  <a class="ref fn" href="../sanitizer_common/sanitizer_atomic_clang.h.html#__sanitizer::atomic_thread_fence" title='__sanitizer::atomic_thread_fence' data-ref="__sanitizer::atomic_thread_fence" data-ref-filename="__sanitizer..atomic_thread_fence">atomic_thread_fence</a>(<a class="enum" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::memory_order_acquire" title='__sanitizer::memory_order_acquire' data-ref="__sanitizer::memory_order_acquire" data-ref-filename="__sanitizer..memory_order_acquire">memory_order_acquire</a>);</td></tr>
<tr><th id="253">253</th><td>  <em>auto</em> <dfn class="local col6 decl" id="106BufferSize" title='BufferSize' data-type='unsigned long long' data-ref="106BufferSize" data-ref-filename="106BufferSize">BufferSize</dfn> = <a class="ref fn" href="../sanitizer_common/sanitizer_atomic_clang_x86.h.html#__sanitizer::atomic_load" title='__sanitizer::atomic_load' data-ref="__sanitizer::atomic_load" data-ref-filename="__sanitizer..atomic_load">atomic_load</a>(<a class="local col2 ref" href="#102It" title='It' data-ref="102It" data-ref-filename="102It">It</a><a class="ref fn" href="xray_buffer_queue.h.html#__xray::BufferQueue::Iterator::operator-}" title='__xray::BufferQueue::Iterator::operator-&gt;' data-ref="__xray::BufferQueue::Iterator::operator-}" data-ref-filename="__xray..BufferQueue..Iterator..operator-}">-&gt;</a><a class="ref field" href="xray_buffer_queue.h.html#__xray::BufferQueue::Buffer::Extents" title='__xray::BufferQueue::Buffer::Extents' data-ref="__xray::BufferQueue::Buffer::Extents" data-ref-filename="__xray..BufferQueue..Buffer..Extents">Extents</a>, <a class="enum" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::memory_order_acquire" title='__sanitizer::memory_order_acquire' data-ref="__sanitizer::memory_order_acquire" data-ref-filename="__sanitizer..memory_order_acquire">memory_order_acquire</a>);</td></tr>
<tr><th id="254">254</th><td>  <a class="local col5 ref" href="#105SerializedBufferSize" title='SerializedBufferSize' data-ref="105SerializedBufferSize" data-ref-filename="105SerializedBufferSize">SerializedBufferSize</a> = <a class="local col6 ref" href="#106BufferSize" title='BufferSize' data-ref="106BufferSize" data-ref-filename="106BufferSize">BufferSize</a> + <b>sizeof</b>(<a class="type" href="xray_fdr_log_records.h.html#__xray::MetadataRecord" title='__xray::MetadataRecord' data-ref="__xray::MetadataRecord" data-ref-filename="__xray..MetadataRecord">MetadataRecord</a>);</td></tr>
<tr><th id="255">255</th><td>  <a class="local col4 ref" href="#104CurrentBuffer" title='CurrentBuffer' data-ref="104CurrentBuffer" data-ref-filename="104CurrentBuffer">CurrentBuffer</a> = <a class="ref fn" href="xray_allocator.h.html#__xray::allocateBuffer" title='__xray::allocateBuffer' data-ref="__xray::allocateBuffer" data-ref-filename="__xray..allocateBuffer">allocateBuffer</a>(<a class="local col5 ref" href="#105SerializedBufferSize" title='SerializedBufferSize' data-ref="105SerializedBufferSize" data-ref-filename="105SerializedBufferSize">SerializedBufferSize</a>);</td></tr>
<tr><th id="256">256</th><td>  <b>if</b> (<a class="local col4 ref" href="#104CurrentBuffer" title='CurrentBuffer' data-ref="104CurrentBuffer" data-ref-filename="104CurrentBuffer">CurrentBuffer</a> == <b>nullptr</b>)</td></tr>
<tr><th id="257">257</th><td>    <b>return</b> {<b>nullptr</b>, <var>0</var>};</td></tr>
<tr><th id="258">258</th><td></td></tr>
<tr><th id="259">259</th><td>  <i>// Write out the extents as a Metadata Record into the CurrentBuffer.</i></td></tr>
<tr><th id="260">260</th><td>  <a class="type" href="xray_fdr_log_records.h.html#__xray::MetadataRecord" title='__xray::MetadataRecord' data-ref="__xray::MetadataRecord" data-ref-filename="__xray..MetadataRecord">MetadataRecord</a> <a class="ref fn fake" href="xray_fdr_log_records.h.html#22" title='__xray::MetadataRecord::MetadataRecord' data-ref="__xray::MetadataRecord::MetadataRecord" data-ref-filename="__xray..MetadataRecord..MetadataRecord"></a><dfn class="local col7 decl" id="107ExtentsRecord" title='ExtentsRecord' data-type='__xray::MetadataRecord' data-ref="107ExtentsRecord" data-ref-filename="107ExtentsRecord">ExtentsRecord</dfn>;</td></tr>
<tr><th id="261">261</th><td>  <a class="local col7 ref" href="#107ExtentsRecord" title='ExtentsRecord' data-ref="107ExtentsRecord" data-ref-filename="107ExtentsRecord">ExtentsRecord</a>.<a class="ref field" href="xray_fdr_log_records.h.html#__xray::MetadataRecord::Type" title='__xray::MetadataRecord::Type' data-ref="__xray::MetadataRecord::Type" data-ref-filename="__xray..MetadataRecord..Type">Type</a> = <a class="typedef" href="../../../../include/bits/stdint-uintn.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a>(<a class="type" href="xray_fdr_log_records.h.html#__xray::RecordType" title='__xray::RecordType' data-ref="__xray::RecordType" data-ref-filename="__xray..RecordType">RecordType</a>::<a class="enum" href="xray_fdr_log_records.h.html#__xray::RecordType::Metadata" title='__xray::RecordType::Metadata' data-ref="__xray::RecordType::Metadata" data-ref-filename="__xray..RecordType..Metadata">Metadata</a>);</td></tr>
<tr><th id="262">262</th><td>  <a class="local col7 ref" href="#107ExtentsRecord" title='ExtentsRecord' data-ref="107ExtentsRecord" data-ref-filename="107ExtentsRecord">ExtentsRecord</a>.<a class="ref field" href="xray_fdr_log_records.h.html#__xray::MetadataRecord::RecordKind" title='__xray::MetadataRecord::RecordKind' data-ref="__xray::MetadataRecord::RecordKind" data-ref-filename="__xray..MetadataRecord..RecordKind">RecordKind</a> =</td></tr>
<tr><th id="263">263</th><td>      <a class="typedef" href="../../../../include/bits/stdint-uintn.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a>(<a class="type" href="xray_fdr_log_records.h.html#__xray::MetadataRecord" title='__xray::MetadataRecord' data-ref="__xray::MetadataRecord" data-ref-filename="__xray..MetadataRecord">MetadataRecord</a>::<a class="type" href="xray_fdr_log_records.h.html#__xray::MetadataRecord::RecordKinds" title='__xray::MetadataRecord::RecordKinds' data-ref="__xray::MetadataRecord::RecordKinds" data-ref-filename="__xray..MetadataRecord..RecordKinds">RecordKinds</a>::<a class="enum" href="xray_fdr_log_records.h.html#__xray::MetadataRecord::RecordKinds::BufferExtents" title='__xray::MetadataRecord::RecordKinds::BufferExtents' data-ref="__xray::MetadataRecord::RecordKinds::BufferExtents" data-ref-filename="__xray..MetadataRecord..RecordKinds..BufferExtents">BufferExtents</a>);</td></tr>
<tr><th id="264">264</th><td>  <a class="ref fn" href="../sanitizer_common/sanitizer_libc.h.html#__sanitizer::internal_memcpy" title='__sanitizer::internal_memcpy' data-ref="__sanitizer::internal_memcpy" data-ref-filename="__sanitizer..internal_memcpy">internal_memcpy</a>(<a class="local col7 ref" href="#107ExtentsRecord" title='ExtentsRecord' data-ref="107ExtentsRecord" data-ref-filename="107ExtentsRecord">ExtentsRecord</a>.<a class="ref field" href="xray_fdr_log_records.h.html#__xray::MetadataRecord::Data" title='__xray::MetadataRecord::Data' data-ref="__xray::MetadataRecord::Data" data-ref-filename="__xray..MetadataRecord..Data">Data</a>, &amp;<a class="local col6 ref" href="#106BufferSize" title='BufferSize' data-ref="106BufferSize" data-ref-filename="106BufferSize">BufferSize</a>, <b>sizeof</b>(<a class="local col6 ref" href="#106BufferSize" title='BufferSize' data-ref="106BufferSize" data-ref-filename="106BufferSize">BufferSize</a>));</td></tr>
<tr><th id="265">265</th><td>  <em>auto</em> <dfn class="local col8 decl" id="108AfterExtents" title='AfterExtents' data-type='char *' data-ref="108AfterExtents" data-ref-filename="108AfterExtents">AfterExtents</dfn> =</td></tr>
<tr><th id="266">266</th><td>      <b>static_cast</b>&lt;<em>char</em> *&gt;(<a class="ref fn" href="../sanitizer_common/sanitizer_libc.h.html#__sanitizer::internal_memcpy" title='__sanitizer::internal_memcpy' data-ref="__sanitizer::internal_memcpy" data-ref-filename="__sanitizer..internal_memcpy">internal_memcpy</a>(<a class="local col4 ref" href="#104CurrentBuffer" title='CurrentBuffer' data-ref="104CurrentBuffer" data-ref-filename="104CurrentBuffer">CurrentBuffer</a>, &amp;<a class="local col7 ref" href="#107ExtentsRecord" title='ExtentsRecord' data-ref="107ExtentsRecord" data-ref-filename="107ExtentsRecord">ExtentsRecord</a>,</td></tr>
<tr><th id="267">267</th><td>                                          <b>sizeof</b>(<a class="type" href="xray_fdr_log_records.h.html#__xray::MetadataRecord" title='__xray::MetadataRecord' data-ref="__xray::MetadataRecord" data-ref-filename="__xray..MetadataRecord">MetadataRecord</a>))) +</td></tr>
<tr><th id="268">268</th><td>      <b>sizeof</b>(<a class="type" href="xray_fdr_log_records.h.html#__xray::MetadataRecord" title='__xray::MetadataRecord' data-ref="__xray::MetadataRecord" data-ref-filename="__xray..MetadataRecord">MetadataRecord</a>);</td></tr>
<tr><th id="269">269</th><td>  <a class="ref fn" href="../sanitizer_common/sanitizer_libc.h.html#__sanitizer::internal_memcpy" title='__sanitizer::internal_memcpy' data-ref="__sanitizer::internal_memcpy" data-ref-filename="__sanitizer..internal_memcpy">internal_memcpy</a>(<a class="local col8 ref" href="#108AfterExtents" title='AfterExtents' data-ref="108AfterExtents" data-ref-filename="108AfterExtents">AfterExtents</a>, <a class="local col2 ref" href="#102It" title='It' data-ref="102It" data-ref-filename="102It">It</a><a class="ref fn" href="xray_buffer_queue.h.html#__xray::BufferQueue::Iterator::operator-}" title='__xray::BufferQueue::Iterator::operator-&gt;' data-ref="__xray::BufferQueue::Iterator::operator-}" data-ref-filename="__xray..BufferQueue..Iterator..operator-}">-&gt;</a><a class="ref field" href="xray_buffer_queue.h.html#__xray::BufferQueue::Buffer::Data" title='__xray::BufferQueue::Buffer::Data' data-ref="__xray::BufferQueue::Buffer::Data" data-ref-filename="__xray..BufferQueue..Buffer..Data">Data</a>, <a class="local col6 ref" href="#106BufferSize" title='BufferSize' data-ref="106BufferSize" data-ref-filename="106BufferSize">BufferSize</a>);</td></tr>
<tr><th id="270">270</th><td></td></tr>
<tr><th id="271">271</th><td>  <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayBuffer" title='XRayBuffer' data-ref="XRayBuffer" data-ref-filename="XRayBuffer">XRayBuffer</a> <a class="ref fn fake" href="../../include/xray/xray_log_interface.h.html#310" title='XRayBuffer::XRayBuffer' data-ref="_ZN10XRayBufferC1Ev" data-ref-filename="_ZN10XRayBufferC1Ev"></a><dfn class="local col9 decl" id="109Result" title='Result' data-type='XRayBuffer' data-ref="109Result" data-ref-filename="109Result">Result</dfn>;</td></tr>
<tr><th id="272">272</th><td>  <a class="local col9 ref" href="#109Result" title='Result' data-ref="109Result" data-ref-filename="109Result">Result</a>.<a class="ref field" href="../../include/xray/xray_log_interface.h.html#XRayBuffer::Data" title='XRayBuffer::Data' data-ref="XRayBuffer::Data" data-ref-filename="XRayBuffer..Data">Data</a> = <a class="local col4 ref" href="#104CurrentBuffer" title='CurrentBuffer' data-ref="104CurrentBuffer" data-ref-filename="104CurrentBuffer">CurrentBuffer</a>;</td></tr>
<tr><th id="273">273</th><td>  <a class="local col9 ref" href="#109Result" title='Result' data-ref="109Result" data-ref-filename="109Result">Result</a>.<a class="ref field" href="../../include/xray/xray_log_interface.h.html#XRayBuffer::Size" title='XRayBuffer::Size' data-ref="XRayBuffer::Size" data-ref-filename="XRayBuffer..Size">Size</a> = <a class="local col5 ref" href="#105SerializedBufferSize" title='SerializedBufferSize' data-ref="105SerializedBufferSize" data-ref-filename="105SerializedBufferSize">SerializedBufferSize</a>;</td></tr>
<tr><th id="274">274</th><td>  <a class="ref fn" href="xray_buffer_queue.h.html#__xray::BufferQueue::Iterator::operator++" title='__xray::BufferQueue::Iterator::operator++' data-ref="__xray::BufferQueue::Iterator::operator++" data-ref-filename="__xray..BufferQueue..Iterator..operator++">++</a><a class="local col2 ref" href="#102It" title='It' data-ref="102It" data-ref-filename="102It">It</a>;</td></tr>
<tr><th id="275">275</th><td>  <b>return</b> <a class="local col9 ref" href="#109Result" title='Result' data-ref="109Result" data-ref-filename="109Result">Result</a>;</td></tr>
<tr><th id="276">276</th><td>}</td></tr>
<tr><th id="277">277</th><td></td></tr>
<tr><th id="278">278</th><td><i>// Must finalize before flushing.</i></td></tr>
<tr><th id="279">279</th><td><a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogFlushStatus" title='XRayLogFlushStatus' data-ref="XRayLogFlushStatus" data-ref-filename="XRayLogFlushStatus">XRayLogFlushStatus</a> <dfn class="decl def fn" id="__xray::fdrLoggingFlush" title='__xray::fdrLoggingFlush' data-ref="__xray::fdrLoggingFlush" data-ref-filename="__xray..fdrLoggingFlush">fdrLoggingFlush</dfn>() <a class="macro" href="xray_defs.h.html#18" title="" data-ref="_M/XRAY_NEVER_INSTRUMENT">XRAY_NEVER_INSTRUMENT</a> {</td></tr>
<tr><th id="280">280</th><td>  <b>if</b> (<a class="ref fn" href="../sanitizer_common/sanitizer_atomic_clang_x86.h.html#__sanitizer::atomic_load" title='__sanitizer::atomic_load' data-ref="__sanitizer::atomic_load" data-ref-filename="__sanitizer..atomic_load">atomic_load</a>(&amp;<a class="tu ref" href="#__xray::LoggingStatus" title='__xray::LoggingStatus' data-use='a' data-ref="__xray::LoggingStatus" data-ref-filename="__xray..LoggingStatus">LoggingStatus</a>, <a class="enum" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::memory_order_acquire" title='__sanitizer::memory_order_acquire' data-ref="__sanitizer::memory_order_acquire" data-ref-filename="__sanitizer..memory_order_acquire">memory_order_acquire</a>) !=</td></tr>
<tr><th id="281">281</th><td>      <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogInitStatus" title='XRayLogInitStatus' data-ref="XRayLogInitStatus" data-ref-filename="XRayLogInitStatus">XRayLogInitStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_FINALIZED" title='XRAY_LOG_FINALIZED' data-ref="XRAY_LOG_FINALIZED" data-ref-filename="XRAY_LOG_FINALIZED">XRAY_LOG_FINALIZED</a>) {</td></tr>
<tr><th id="282">282</th><td>    <b>if</b> (<a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Verbosity" title='__sanitizer::Verbosity' data-ref="__sanitizer::Verbosity" data-ref-filename="__sanitizer..Verbosity">Verbosity</a>())</td></tr>
<tr><th id="283">283</th><td>      <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Report" title='__sanitizer::Report' data-ref="__sanitizer::Report" data-ref-filename="__sanitizer..Report">Report</a>(<q>"Not flushing log, implementation is not finalized.\n"</q>);</td></tr>
<tr><th id="284">284</th><td>    <b>return</b> <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogFlushStatus" title='XRayLogFlushStatus' data-ref="XRayLogFlushStatus" data-ref-filename="XRayLogFlushStatus">XRayLogFlushStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_NOT_FLUSHING" title='XRAY_LOG_NOT_FLUSHING' data-ref="XRAY_LOG_NOT_FLUSHING" data-ref-filename="XRAY_LOG_NOT_FLUSHING">XRAY_LOG_NOT_FLUSHING</a>;</td></tr>
<tr><th id="285">285</th><td>  }</td></tr>
<tr><th id="286">286</th><td></td></tr>
<tr><th id="287">287</th><td>  <a class="typedef" href="../sanitizer_common/sanitizer_internal_defs.h.html#__sanitizer::s32" title='__sanitizer::s32' data-type='int' data-ref="__sanitizer::s32" data-ref-filename="__sanitizer..s32">s32</a> <dfn class="local col0 decl" id="110Result" title='Result' data-type='__sanitizer::s32' data-ref="110Result" data-ref-filename="110Result">Result</dfn> = <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogFlushStatus" title='XRayLogFlushStatus' data-ref="XRayLogFlushStatus" data-ref-filename="XRayLogFlushStatus">XRayLogFlushStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_NOT_FLUSHING" title='XRAY_LOG_NOT_FLUSHING' data-ref="XRAY_LOG_NOT_FLUSHING" data-ref-filename="XRAY_LOG_NOT_FLUSHING">XRAY_LOG_NOT_FLUSHING</a>;</td></tr>
<tr><th id="288">288</th><td>  <b>if</b> (!<a class="ref fn" href="../sanitizer_common/sanitizer_atomic_clang.h.html#__sanitizer::atomic_compare_exchange_strong" title='__sanitizer::atomic_compare_exchange_strong' data-ref="__sanitizer::atomic_compare_exchange_strong" data-ref-filename="__sanitizer..atomic_compare_exchange_strong">atomic_compare_exchange_strong</a>(&amp;<a class="tu ref" href="#__xray::LogFlushStatus" title='__xray::LogFlushStatus' data-use='a' data-ref="__xray::LogFlushStatus" data-ref-filename="__xray..LogFlushStatus">LogFlushStatus</a>, &amp;<a class="local col0 ref" href="#110Result" title='Result' data-ref="110Result" data-ref-filename="110Result">Result</a>,</td></tr>
<tr><th id="289">289</th><td>                                      <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogFlushStatus" title='XRayLogFlushStatus' data-ref="XRayLogFlushStatus" data-ref-filename="XRayLogFlushStatus">XRayLogFlushStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_FLUSHING" title='XRAY_LOG_FLUSHING' data-ref="XRAY_LOG_FLUSHING" data-ref-filename="XRAY_LOG_FLUSHING">XRAY_LOG_FLUSHING</a>,</td></tr>
<tr><th id="290">290</th><td>                                      <a class="enum" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::memory_order_release" title='__sanitizer::memory_order_release' data-ref="__sanitizer::memory_order_release" data-ref-filename="__sanitizer..memory_order_release">memory_order_release</a>)) {</td></tr>
<tr><th id="291">291</th><td>    <b>if</b> (<a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Verbosity" title='__sanitizer::Verbosity' data-ref="__sanitizer::Verbosity" data-ref-filename="__sanitizer..Verbosity">Verbosity</a>())</td></tr>
<tr><th id="292">292</th><td>      <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Report" title='__sanitizer::Report' data-ref="__sanitizer::Report" data-ref-filename="__sanitizer..Report">Report</a>(<q>"Not flushing log, implementation is still finalizing.\n"</q>);</td></tr>
<tr><th id="293">293</th><td>    <b>return</b> <b>static_cast</b>&lt;<a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogFlushStatus" title='XRayLogFlushStatus' data-ref="XRayLogFlushStatus" data-ref-filename="XRayLogFlushStatus">XRayLogFlushStatus</a>&gt;(<a class="local col0 ref" href="#110Result" title='Result' data-ref="110Result" data-ref-filename="110Result">Result</a>);</td></tr>
<tr><th id="294">294</th><td>  }</td></tr>
<tr><th id="295">295</th><td></td></tr>
<tr><th id="296">296</th><td>  <b>if</b> (<a class="tu ref" href="#__xray::BQ" title='__xray::BQ' data-use='r' data-ref="__xray::BQ" data-ref-filename="__xray..BQ">BQ</a> == <b>nullptr</b>) {</td></tr>
<tr><th id="297">297</th><td>    <b>if</b> (<a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Verbosity" title='__sanitizer::Verbosity' data-ref="__sanitizer::Verbosity" data-ref-filename="__sanitizer..Verbosity">Verbosity</a>())</td></tr>
<tr><th id="298">298</th><td>      <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Report" title='__sanitizer::Report' data-ref="__sanitizer::Report" data-ref-filename="__sanitizer..Report">Report</a>(<q>"Cannot flush when global buffer queue is null.\n"</q>);</td></tr>
<tr><th id="299">299</th><td>    <b>return</b> <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogFlushStatus" title='XRayLogFlushStatus' data-ref="XRayLogFlushStatus" data-ref-filename="XRayLogFlushStatus">XRayLogFlushStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_NOT_FLUSHING" title='XRAY_LOG_NOT_FLUSHING' data-ref="XRAY_LOG_NOT_FLUSHING" data-ref-filename="XRAY_LOG_NOT_FLUSHING">XRAY_LOG_NOT_FLUSHING</a>;</td></tr>
<tr><th id="300">300</th><td>  }</td></tr>
<tr><th id="301">301</th><td></td></tr>
<tr><th id="302">302</th><td>  <i>// We wait a number of milliseconds to allow threads to see that we've</i></td></tr>
<tr><th id="303">303</th><td><i>  // finalised before attempting to flush the log.</i></td></tr>
<tr><th id="304">304</th><td>  <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::SleepForMillis" title='__sanitizer::SleepForMillis' data-ref="__sanitizer::SleepForMillis" data-ref-filename="__sanitizer..SleepForMillis">SleepForMillis</a>(<a class="ref fn" href="xray_fdr_flags.h.html#__xray::fdrFlags" title='__xray::fdrFlags' data-ref="__xray::fdrFlags" data-ref-filename="__xray..fdrFlags">fdrFlags</a>()-&gt;<a class="ref field" href="xray_fdr_flags.inc.html#20" title='__xray::FDRFlags::grace_period_ms' data-ref="__xray::FDRFlags::grace_period_ms" data-ref-filename="__xray..FDRFlags..grace_period_ms">grace_period_ms</a>);</td></tr>
<tr><th id="305">305</th><td></td></tr>
<tr><th id="306">306</th><td>  <i>// At this point, we're going to uninstall the iterator implementation, before</i></td></tr>
<tr><th id="307">307</th><td><i>  // we decide to do anything further with the global buffer queue.</i></td></tr>
<tr><th id="308">308</th><td>  <a class="ref fn" href="../../include/xray/xray_log_interface.h.html#__xray_log_remove_buffer_iterator" title='__xray_log_remove_buffer_iterator' data-ref="__xray_log_remove_buffer_iterator" data-ref-filename="__xray_log_remove_buffer_iterator">__xray_log_remove_buffer_iterator</a>();</td></tr>
<tr><th id="309">309</th><td></td></tr>
<tr><th id="310">310</th><td>  <i>// Once flushed, we should set the global status of the logging implementation</i></td></tr>
<tr><th id="311">311</th><td><i>  // to "uninitialized" to allow for FDR-logging multiple runs.</i></td></tr>
<tr><th id="312">312</th><td>  <em>auto</em> <dfn class="local col1 decl" id="111ResetToUnitialized" title='ResetToUnitialized' data-type='__sanitizer::RunOnDestruction&lt;(lambda at /fast/tmp/llvm-proj-12/compiler-rt/lib/xray/xray_fdr_logging.cpp:312:43)&gt;' data-ref="111ResetToUnitialized" data-ref-filename="111ResetToUnitialized">ResetToUnitialized</dfn> = <a class="tu ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::at_scope_exit" title='__sanitizer::at_scope_exit' data-use='c' data-ref="__sanitizer::at_scope_exit" data-ref-filename="__sanitizer..at_scope_exit">at_scope_exit</a>([] {</td></tr>
<tr><th id="313">313</th><td>    <a class="ref fn" href="../sanitizer_common/sanitizer_atomic_clang_x86.h.html#__sanitizer::atomic_store" title='__sanitizer::atomic_store' data-ref="__sanitizer::atomic_store" data-ref-filename="__sanitizer..atomic_store">atomic_store</a>(&amp;<a class="tu ref" href="#__xray::LoggingStatus" title='__xray::LoggingStatus' data-use='a' data-ref="__xray::LoggingStatus" data-ref-filename="__xray..LoggingStatus">LoggingStatus</a>, <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogInitStatus" title='XRayLogInitStatus' data-ref="XRayLogInitStatus" data-ref-filename="XRayLogInitStatus">XRayLogInitStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_UNINITIALIZED" title='XRAY_LOG_UNINITIALIZED' data-ref="XRAY_LOG_UNINITIALIZED" data-ref-filename="XRAY_LOG_UNINITIALIZED">XRAY_LOG_UNINITIALIZED</a>,</td></tr>
<tr><th id="314">314</th><td>                 <a class="enum" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::memory_order_release" title='__sanitizer::memory_order_release' data-ref="__sanitizer::memory_order_release" data-ref-filename="__sanitizer..memory_order_release">memory_order_release</a>);</td></tr>
<tr><th id="315">315</th><td>  });</td></tr>
<tr><th id="316">316</th><td></td></tr>
<tr><th id="317">317</th><td>  <em>auto</em> <dfn class="local col2 decl" id="112CleanupBuffers" title='CleanupBuffers' data-type='__sanitizer::RunOnDestruction&lt;(lambda at /fast/tmp/llvm-proj-12/compiler-rt/lib/xray/xray_fdr_logging.cpp:317:39)&gt;' data-ref="112CleanupBuffers" data-ref-filename="112CleanupBuffers">CleanupBuffers</dfn> = <a class="tu ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::at_scope_exit" title='__sanitizer::at_scope_exit' data-use='c' data-ref="__sanitizer::at_scope_exit" data-ref-filename="__sanitizer..at_scope_exit">at_scope_exit</a>([] {</td></tr>
<tr><th id="318">318</th><td>    <em>auto</em> &amp;<dfn class="local col3 decl" id="113TLD" title='TLD' data-type='__xray::(anonymous namespace)::ThreadLocalData &amp;' data-ref="113TLD" data-ref-filename="113TLD">TLD</dfn> = <a class="tu ref fn" href="#__xray::getThreadLocalData" title='__xray::getThreadLocalData' data-use='c' data-ref="__xray::getThreadLocalData" data-ref-filename="__xray..getThreadLocalData">getThreadLocalData</a>();</td></tr>
<tr><th id="319">319</th><td>    <b>if</b> (<a class="local col3 ref" href="#113TLD" title='TLD' data-ref="113TLD" data-ref-filename="113TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Controller" title='__xray::(anonymous namespace)::ThreadLocalData::Controller' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Controller" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Controller">Controller</a> != <b>nullptr</b>)</td></tr>
<tr><th id="320">320</th><td>      <a class="local col3 ref" href="#113TLD" title='TLD' data-ref="113TLD" data-ref-filename="113TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Controller" title='__xray::(anonymous namespace)::ThreadLocalData::Controller' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Controller" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Controller">Controller</a>-&gt;<a class="ref fn" href="xray_fdr_controller.h.html#__xray::FDRController::flush" title='__xray::FDRController::flush' data-ref="__xray::FDRController::flush" data-ref-filename="__xray..FDRController..flush">flush</a>();</td></tr>
<tr><th id="321">321</th><td>  });</td></tr>
<tr><th id="322">322</th><td></td></tr>
<tr><th id="323">323</th><td>  <b>if</b> (<a class="ref fn" href="xray_fdr_flags.h.html#__xray::fdrFlags" title='__xray::fdrFlags' data-ref="__xray::fdrFlags" data-ref-filename="__xray..fdrFlags">fdrFlags</a>()-&gt;<a class="ref field" href="xray_fdr_flags.inc.html#27" title='__xray::FDRFlags::no_file_flush' data-ref="__xray::FDRFlags::no_file_flush" data-ref-filename="__xray..FDRFlags..no_file_flush">no_file_flush</a>) {</td></tr>
<tr><th id="324">324</th><td>    <b>if</b> (<a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Verbosity" title='__sanitizer::Verbosity' data-ref="__sanitizer::Verbosity" data-ref-filename="__sanitizer..Verbosity">Verbosity</a>())</td></tr>
<tr><th id="325">325</th><td>      <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Report" title='__sanitizer::Report' data-ref="__sanitizer::Report" data-ref-filename="__sanitizer..Report">Report</a>(<q>"XRay FDR: Not flushing to file, 'no_file_flush=true'.\n"</q>);</td></tr>
<tr><th id="326">326</th><td></td></tr>
<tr><th id="327">327</th><td>    <a class="ref fn" href="../sanitizer_common/sanitizer_atomic_clang_x86.h.html#__sanitizer::atomic_store" title='__sanitizer::atomic_store' data-ref="__sanitizer::atomic_store" data-ref-filename="__sanitizer..atomic_store">atomic_store</a>(&amp;<a class="tu ref" href="#__xray::LogFlushStatus" title='__xray::LogFlushStatus' data-use='a' data-ref="__xray::LogFlushStatus" data-ref-filename="__xray..LogFlushStatus">LogFlushStatus</a>, <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogFlushStatus" title='XRayLogFlushStatus' data-ref="XRayLogFlushStatus" data-ref-filename="XRayLogFlushStatus">XRayLogFlushStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_FLUSHED" title='XRAY_LOG_FLUSHED' data-ref="XRAY_LOG_FLUSHED" data-ref-filename="XRAY_LOG_FLUSHED">XRAY_LOG_FLUSHED</a>,</td></tr>
<tr><th id="328">328</th><td>                 <a class="enum" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::memory_order_release" title='__sanitizer::memory_order_release' data-ref="__sanitizer::memory_order_release" data-ref-filename="__sanitizer..memory_order_release">memory_order_release</a>);</td></tr>
<tr><th id="329">329</th><td>    <b>return</b> <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogFlushStatus" title='XRayLogFlushStatus' data-ref="XRayLogFlushStatus" data-ref-filename="XRayLogFlushStatus">XRayLogFlushStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_FLUSHED" title='XRAY_LOG_FLUSHED' data-ref="XRAY_LOG_FLUSHED" data-ref-filename="XRAY_LOG_FLUSHED">XRAY_LOG_FLUSHED</a>;</td></tr>
<tr><th id="330">330</th><td>  }</td></tr>
<tr><th id="331">331</th><td></td></tr>
<tr><th id="332">332</th><td>  <i>// We write out the file in the following format:</i></td></tr>
<tr><th id="333">333</th><td><i>  //</i></td></tr>
<tr><th id="334">334</th><td><i>  //   1) We write down the XRay file header with version 1, type FDR_LOG.</i></td></tr>
<tr><th id="335">335</th><td><i>  //   2) Then we use the 'apply' member of the BufferQueue that's live, to</i></td></tr>
<tr><th id="336">336</th><td><i>  //      ensure that at this point in time we write down the buffers that have</i></td></tr>
<tr><th id="337">337</th><td><i>  //      been released (and marked "used") -- we dump the full buffer for now</i></td></tr>
<tr><th id="338">338</th><td><i>  //      (fixed-sized) and let the tools reading the buffers deal with the data</i></td></tr>
<tr><th id="339">339</th><td><i>  //      afterwards.</i></td></tr>
<tr><th id="340">340</th><td><i>  //</i></td></tr>
<tr><th id="341">341</th><td>  <a class="type" href="xray_utils.h.html#__xray::LogWriter" title='__xray::LogWriter' data-ref="__xray::LogWriter" data-ref-filename="__xray..LogWriter">LogWriter</a> *<dfn class="local col4 decl" id="114LW" title='LW' data-type='__xray::LogWriter *' data-ref="114LW" data-ref-filename="114LW">LW</dfn> = <a class="type" href="xray_utils.h.html#__xray::LogWriter" title='__xray::LogWriter' data-ref="__xray::LogWriter" data-ref-filename="__xray..LogWriter">LogWriter</a>::<a class="ref fn" href="xray_utils.h.html#__xray::LogWriter::Open" title='__xray::LogWriter::Open' data-ref="__xray::LogWriter::Open" data-ref-filename="__xray..LogWriter..Open">Open</a>();</td></tr>
<tr><th id="342">342</th><td>  <b>if</b> (<a class="local col4 ref" href="#114LW" title='LW' data-ref="114LW" data-ref-filename="114LW">LW</a> == <b>nullptr</b>) {</td></tr>
<tr><th id="343">343</th><td>    <em>auto</em> <dfn class="local col5 decl" id="115Result" title='Result' data-type='XRayLogFlushStatus' data-ref="115Result" data-ref-filename="115Result">Result</dfn> = <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogFlushStatus" title='XRayLogFlushStatus' data-ref="XRayLogFlushStatus" data-ref-filename="XRayLogFlushStatus">XRayLogFlushStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_NOT_FLUSHING" title='XRAY_LOG_NOT_FLUSHING' data-ref="XRAY_LOG_NOT_FLUSHING" data-ref-filename="XRAY_LOG_NOT_FLUSHING">XRAY_LOG_NOT_FLUSHING</a>;</td></tr>
<tr><th id="344">344</th><td>    <a class="ref fn" href="../sanitizer_common/sanitizer_atomic_clang_x86.h.html#__sanitizer::atomic_store" title='__sanitizer::atomic_store' data-ref="__sanitizer::atomic_store" data-ref-filename="__sanitizer..atomic_store">atomic_store</a>(&amp;<a class="tu ref" href="#__xray::LogFlushStatus" title='__xray::LogFlushStatus' data-use='a' data-ref="__xray::LogFlushStatus" data-ref-filename="__xray..LogFlushStatus">LogFlushStatus</a>, <a class="local col5 ref" href="#115Result" title='Result' data-ref="115Result" data-ref-filename="115Result">Result</a>, <a class="enum" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::memory_order_release" title='__sanitizer::memory_order_release' data-ref="__sanitizer::memory_order_release" data-ref-filename="__sanitizer..memory_order_release">memory_order_release</a>);</td></tr>
<tr><th id="345">345</th><td>    <b>return</b> <a class="local col5 ref" href="#115Result" title='Result' data-ref="115Result" data-ref-filename="115Result">Result</a>;</td></tr>
<tr><th id="346">346</th><td>  }</td></tr>
<tr><th id="347">347</th><td></td></tr>
<tr><th id="348">348</th><td>  <a class="type" href="../../include/xray/xray_records.h.html#__xray::XRayFileHeader" title='__xray::XRayFileHeader' data-ref="__xray::XRayFileHeader" data-ref-filename="__xray..XRayFileHeader">XRayFileHeader</a> <dfn class="local col6 decl" id="116Header" title='Header' data-type='__xray::XRayFileHeader' data-ref="116Header" data-ref-filename="116Header">Header</dfn> = <a class="ref fn fake" href="../../include/xray/xray_records.h.html#38" title='__xray::XRayFileHeader::XRayFileHeader' data-ref="__xray::XRayFileHeader::XRayFileHeader" data-ref-filename="__xray..XRayFileHeader..XRayFileHeader"></a><a class="tu ref fn" href="#__xray::fdrCommonHeaderInfo" title='__xray::fdrCommonHeaderInfo' data-use='c' data-ref="__xray::fdrCommonHeaderInfo" data-ref-filename="__xray..fdrCommonHeaderInfo">fdrCommonHeaderInfo</a>();</td></tr>
<tr><th id="349">349</th><td>  <a class="local col6 ref" href="#116Header" title='Header' data-ref="116Header" data-ref-filename="116Header">Header</a>.<a class="ref field" href="../../include/xray/xray_records.h.html#__xray::XRayFileHeader::(anonymous)::FdrData" title='__xray::XRayFileHeader::(anonymous union)::FdrData' data-ref="__xray::XRayFileHeader::(anonymous)::FdrData" data-ref-filename="__xray..XRayFileHeader..(anonymous)..FdrData">FdrData</a> <a class="ref fn" href="../../include/xray/xray_records.h.html#29" title='__xray::FdrAdditionalHeaderData::operator=' data-ref="__xray::FdrAdditionalHeaderData::operator=" data-ref-filename="__xray..FdrAdditionalHeaderData..operator=">=</a> <a class="type" href="../../include/xray/xray_records.h.html#__xray::FdrAdditionalHeaderData" title='__xray::FdrAdditionalHeaderData' data-ref="__xray::FdrAdditionalHeaderData" data-ref-filename="__xray..FdrAdditionalHeaderData">FdrAdditionalHeaderData</a>{<a class="tu ref" href="#__xray::BQ" title='__xray::BQ' data-use='r' data-ref="__xray::BQ" data-ref-filename="__xray..BQ">BQ</a>-&gt;<a class="ref fn" href="xray_buffer_queue.h.html#__xray::BufferQueue::ConfiguredBufferSize" title='__xray::BufferQueue::ConfiguredBufferSize' data-ref="__xray::BufferQueue::ConfiguredBufferSize" data-ref-filename="__xray..BufferQueue..ConfiguredBufferSize">ConfiguredBufferSize</a>()};</td></tr>
<tr><th id="350">350</th><td>  <a class="local col4 ref" href="#114LW" title='LW' data-ref="114LW" data-ref-filename="114LW">LW</a>-&gt;<a class="ref fn" href="xray_utils.h.html#__xray::LogWriter::WriteAll" title='__xray::LogWriter::WriteAll' data-ref="__xray::LogWriter::WriteAll" data-ref-filename="__xray..LogWriter..WriteAll">WriteAll</a>(<b>reinterpret_cast</b>&lt;<em>char</em> *&gt;(&amp;<a class="local col6 ref" href="#116Header" title='Header' data-ref="116Header" data-ref-filename="116Header">Header</a>),</td></tr>
<tr><th id="351">351</th><td>               <b>reinterpret_cast</b>&lt;<em>char</em> *&gt;(&amp;<a class="local col6 ref" href="#116Header" title='Header' data-ref="116Header" data-ref-filename="116Header">Header</a>) + <b>sizeof</b>(<a class="local col6 ref" href="#116Header" title='Header' data-ref="116Header" data-ref-filename="116Header">Header</a>));</td></tr>
<tr><th id="352">352</th><td></td></tr>
<tr><th id="353">353</th><td>  <i>// Release the current thread's buffer before we attempt to write out all the</i></td></tr>
<tr><th id="354">354</th><td><i>  // buffers. This ensures that in case we had only a single thread going, that</i></td></tr>
<tr><th id="355">355</th><td><i>  // we are able to capture the data nonetheless.</i></td></tr>
<tr><th id="356">356</th><td>  <em>auto</em> &amp;<dfn class="local col7 decl" id="117TLD" title='TLD' data-type='__xray::(anonymous namespace)::ThreadLocalData &amp;' data-ref="117TLD" data-ref-filename="117TLD">TLD</dfn> = <a class="tu ref fn" href="#__xray::getThreadLocalData" title='__xray::getThreadLocalData' data-use='c' data-ref="__xray::getThreadLocalData" data-ref-filename="__xray..getThreadLocalData">getThreadLocalData</a>();</td></tr>
<tr><th id="357">357</th><td>  <b>if</b> (<a class="local col7 ref" href="#117TLD" title='TLD' data-ref="117TLD" data-ref-filename="117TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Controller" title='__xray::(anonymous namespace)::ThreadLocalData::Controller' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Controller" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Controller">Controller</a> != <b>nullptr</b>)</td></tr>
<tr><th id="358">358</th><td>    <a class="local col7 ref" href="#117TLD" title='TLD' data-ref="117TLD" data-ref-filename="117TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Controller" title='__xray::(anonymous namespace)::ThreadLocalData::Controller' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Controller" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Controller">Controller</a>-&gt;<a class="ref fn" href="xray_fdr_controller.h.html#__xray::FDRController::flush" title='__xray::FDRController::flush' data-ref="__xray::FDRController::flush" data-ref-filename="__xray..FDRController..flush">flush</a>();</td></tr>
<tr><th id="359">359</th><td></td></tr>
<tr><th id="360">360</th><td>  <a class="tu ref" href="#__xray::BQ" title='__xray::BQ' data-use='r' data-ref="__xray::BQ" data-ref-filename="__xray..BQ">BQ</a>-&gt;<a class="tu ref fn" href="xray_buffer_queue.h.html#__xray::BufferQueue::apply" title='__xray::BufferQueue::apply' data-use='c' data-ref="__xray::BufferQueue::apply" data-ref-filename="__xray..BufferQueue..apply">apply</a>([&amp;](<em>const</em> <a class="type" href="xray_buffer_queue.h.html#__xray::BufferQueue" title='__xray::BufferQueue' data-ref="__xray::BufferQueue" data-ref-filename="__xray..BufferQueue">BufferQueue</a>::<a class="type" href="xray_buffer_queue.h.html#__xray::BufferQueue::Buffer" title='__xray::BufferQueue::Buffer' data-ref="__xray::BufferQueue::Buffer" data-ref-filename="__xray..BufferQueue..Buffer">Buffer</a> &amp;<dfn class="local col8 decl" id="118B" title='B' data-type='const BufferQueue::Buffer &amp;' data-ref="118B" data-ref-filename="118B">B</dfn>) {</td></tr>
<tr><th id="361">361</th><td>    <i>// Starting at version 2 of the FDR logging implementation, we only write</i></td></tr>
<tr><th id="362">362</th><td><i>    // the records identified by the extents of the buffer. We use the Extents</i></td></tr>
<tr><th id="363">363</th><td><i>    // from the Buffer and write that out as the first record in the buffer.  We</i></td></tr>
<tr><th id="364">364</th><td><i>    // still use a Metadata record, but fill in the extents instead for the</i></td></tr>
<tr><th id="365">365</th><td><i>    // data.</i></td></tr>
<tr><th id="366">366</th><td>    <a class="type" href="xray_fdr_log_records.h.html#__xray::MetadataRecord" title='__xray::MetadataRecord' data-ref="__xray::MetadataRecord" data-ref-filename="__xray..MetadataRecord">MetadataRecord</a> <a class="ref fn fake" href="xray_fdr_log_records.h.html#22" title='__xray::MetadataRecord::MetadataRecord' data-ref="__xray::MetadataRecord::MetadataRecord" data-ref-filename="__xray..MetadataRecord..MetadataRecord"></a><dfn class="local col9 decl" id="119ExtentsRecord" title='ExtentsRecord' data-type='__xray::MetadataRecord' data-ref="119ExtentsRecord" data-ref-filename="119ExtentsRecord">ExtentsRecord</dfn>;</td></tr>
<tr><th id="367">367</th><td>    <em>auto</em> <dfn class="local col0 decl" id="120BufferExtents" title='BufferExtents' data-type='unsigned long long' data-ref="120BufferExtents" data-ref-filename="120BufferExtents">BufferExtents</dfn> = <a class="ref fn" href="../sanitizer_common/sanitizer_atomic_clang_x86.h.html#__sanitizer::atomic_load" title='__sanitizer::atomic_load' data-ref="__sanitizer::atomic_load" data-ref-filename="__sanitizer..atomic_load">atomic_load</a>(<a class="local col8 ref" href="#118B" title='B' data-ref="118B" data-ref-filename="118B">B</a>.<a class="ref field" href="xray_buffer_queue.h.html#__xray::BufferQueue::Buffer::Extents" title='__xray::BufferQueue::Buffer::Extents' data-ref="__xray::BufferQueue::Buffer::Extents" data-ref-filename="__xray..BufferQueue..Buffer..Extents">Extents</a>, <a class="enum" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::memory_order_acquire" title='__sanitizer::memory_order_acquire' data-ref="__sanitizer::memory_order_acquire" data-ref-filename="__sanitizer..memory_order_acquire">memory_order_acquire</a>);</td></tr>
<tr><th id="368">368</th><td>    <a class="macro" href="../sanitizer_common/sanitizer_internal_defs.h.html#316" title="" data-ref="_M/DCHECK">DCHECK</a>(BufferExtents &lt;= B.Size);</td></tr>
<tr><th id="369">369</th><td>    <a class="local col9 ref" href="#119ExtentsRecord" title='ExtentsRecord' data-ref="119ExtentsRecord" data-ref-filename="119ExtentsRecord">ExtentsRecord</a>.<a class="ref field" href="xray_fdr_log_records.h.html#__xray::MetadataRecord::Type" title='__xray::MetadataRecord::Type' data-ref="__xray::MetadataRecord::Type" data-ref-filename="__xray..MetadataRecord..Type">Type</a> = <a class="typedef" href="../../../../include/bits/stdint-uintn.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a>(<a class="type" href="xray_fdr_log_records.h.html#__xray::RecordType" title='__xray::RecordType' data-ref="__xray::RecordType" data-ref-filename="__xray..RecordType">RecordType</a>::<a class="enum" href="xray_fdr_log_records.h.html#__xray::RecordType::Metadata" title='__xray::RecordType::Metadata' data-ref="__xray::RecordType::Metadata" data-ref-filename="__xray..RecordType..Metadata">Metadata</a>);</td></tr>
<tr><th id="370">370</th><td>    <a class="local col9 ref" href="#119ExtentsRecord" title='ExtentsRecord' data-ref="119ExtentsRecord" data-ref-filename="119ExtentsRecord">ExtentsRecord</a>.<a class="ref field" href="xray_fdr_log_records.h.html#__xray::MetadataRecord::RecordKind" title='__xray::MetadataRecord::RecordKind' data-ref="__xray::MetadataRecord::RecordKind" data-ref-filename="__xray..MetadataRecord..RecordKind">RecordKind</a> =</td></tr>
<tr><th id="371">371</th><td>        <a class="typedef" href="../../../../include/bits/stdint-uintn.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a>(<a class="type" href="xray_fdr_log_records.h.html#__xray::MetadataRecord" title='__xray::MetadataRecord' data-ref="__xray::MetadataRecord" data-ref-filename="__xray..MetadataRecord">MetadataRecord</a>::<a class="type" href="xray_fdr_log_records.h.html#__xray::MetadataRecord::RecordKinds" title='__xray::MetadataRecord::RecordKinds' data-ref="__xray::MetadataRecord::RecordKinds" data-ref-filename="__xray..MetadataRecord..RecordKinds">RecordKinds</a>::<a class="enum" href="xray_fdr_log_records.h.html#__xray::MetadataRecord::RecordKinds::BufferExtents" title='__xray::MetadataRecord::RecordKinds::BufferExtents' data-ref="__xray::MetadataRecord::RecordKinds::BufferExtents" data-ref-filename="__xray..MetadataRecord..RecordKinds..BufferExtents">BufferExtents</a>);</td></tr>
<tr><th id="372">372</th><td>    <a class="ref fn" href="../sanitizer_common/sanitizer_libc.h.html#__sanitizer::internal_memcpy" title='__sanitizer::internal_memcpy' data-ref="__sanitizer::internal_memcpy" data-ref-filename="__sanitizer..internal_memcpy">internal_memcpy</a>(<a class="local col9 ref" href="#119ExtentsRecord" title='ExtentsRecord' data-ref="119ExtentsRecord" data-ref-filename="119ExtentsRecord">ExtentsRecord</a>.<a class="ref field" href="xray_fdr_log_records.h.html#__xray::MetadataRecord::Data" title='__xray::MetadataRecord::Data' data-ref="__xray::MetadataRecord::Data" data-ref-filename="__xray..MetadataRecord..Data">Data</a>, &amp;<a class="local col0 ref" href="#120BufferExtents" title='BufferExtents' data-ref="120BufferExtents" data-ref-filename="120BufferExtents">BufferExtents</a>, <b>sizeof</b>(<a class="local col0 ref" href="#120BufferExtents" title='BufferExtents' data-ref="120BufferExtents" data-ref-filename="120BufferExtents">BufferExtents</a>));</td></tr>
<tr><th id="373">373</th><td>    <b>if</b> (<a class="local col0 ref" href="#120BufferExtents" title='BufferExtents' data-ref="120BufferExtents" data-ref-filename="120BufferExtents">BufferExtents</a> &gt; <var>0</var>) {</td></tr>
<tr><th id="374">374</th><td>      <a class="local col4 ref" href="#114LW" title='LW' data-ref="114LW" data-ref-filename="114LW">LW</a>-&gt;<a class="ref fn" href="xray_utils.h.html#__xray::LogWriter::WriteAll" title='__xray::LogWriter::WriteAll' data-ref="__xray::LogWriter::WriteAll" data-ref-filename="__xray..LogWriter..WriteAll">WriteAll</a>(<b>reinterpret_cast</b>&lt;<em>char</em> *&gt;(&amp;<a class="local col9 ref" href="#119ExtentsRecord" title='ExtentsRecord' data-ref="119ExtentsRecord" data-ref-filename="119ExtentsRecord">ExtentsRecord</a>),</td></tr>
<tr><th id="375">375</th><td>                   <b>reinterpret_cast</b>&lt;<em>char</em> *&gt;(&amp;<a class="local col9 ref" href="#119ExtentsRecord" title='ExtentsRecord' data-ref="119ExtentsRecord" data-ref-filename="119ExtentsRecord">ExtentsRecord</a>) +</td></tr>
<tr><th id="376">376</th><td>                       <b>sizeof</b>(<a class="type" href="xray_fdr_log_records.h.html#__xray::MetadataRecord" title='__xray::MetadataRecord' data-ref="__xray::MetadataRecord" data-ref-filename="__xray..MetadataRecord">MetadataRecord</a>));</td></tr>
<tr><th id="377">377</th><td>      <a class="local col4 ref" href="#114LW" title='LW' data-ref="114LW" data-ref-filename="114LW">LW</a>-&gt;<a class="ref fn" href="xray_utils.h.html#__xray::LogWriter::WriteAll" title='__xray::LogWriter::WriteAll' data-ref="__xray::LogWriter::WriteAll" data-ref-filename="__xray..LogWriter..WriteAll">WriteAll</a>(<b>reinterpret_cast</b>&lt;<em>char</em> *&gt;(<a class="local col8 ref" href="#118B" title='B' data-ref="118B" data-ref-filename="118B">B</a>.<a class="ref field" href="xray_buffer_queue.h.html#__xray::BufferQueue::Buffer::Data" title='__xray::BufferQueue::Buffer::Data' data-ref="__xray::BufferQueue::Buffer::Data" data-ref-filename="__xray..BufferQueue..Buffer..Data">Data</a>),</td></tr>
<tr><th id="378">378</th><td>                   <b>reinterpret_cast</b>&lt;<em>char</em> *&gt;(<a class="local col8 ref" href="#118B" title='B' data-ref="118B" data-ref-filename="118B">B</a>.<a class="ref field" href="xray_buffer_queue.h.html#__xray::BufferQueue::Buffer::Data" title='__xray::BufferQueue::Buffer::Data' data-ref="__xray::BufferQueue::Buffer::Data" data-ref-filename="__xray..BufferQueue..Buffer..Data">Data</a>) + <a class="local col0 ref" href="#120BufferExtents" title='BufferExtents' data-ref="120BufferExtents" data-ref-filename="120BufferExtents">BufferExtents</a>);</td></tr>
<tr><th id="379">379</th><td>    }</td></tr>
<tr><th id="380">380</th><td>  });</td></tr>
<tr><th id="381">381</th><td></td></tr>
<tr><th id="382">382</th><td>  <a class="ref fn" href="../sanitizer_common/sanitizer_atomic_clang_x86.h.html#__sanitizer::atomic_store" title='__sanitizer::atomic_store' data-ref="__sanitizer::atomic_store" data-ref-filename="__sanitizer..atomic_store">atomic_store</a>(&amp;<a class="tu ref" href="#__xray::LogFlushStatus" title='__xray::LogFlushStatus' data-use='a' data-ref="__xray::LogFlushStatus" data-ref-filename="__xray..LogFlushStatus">LogFlushStatus</a>, <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogFlushStatus" title='XRayLogFlushStatus' data-ref="XRayLogFlushStatus" data-ref-filename="XRayLogFlushStatus">XRayLogFlushStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_FLUSHED" title='XRAY_LOG_FLUSHED' data-ref="XRAY_LOG_FLUSHED" data-ref-filename="XRAY_LOG_FLUSHED">XRAY_LOG_FLUSHED</a>,</td></tr>
<tr><th id="383">383</th><td>               <a class="enum" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::memory_order_release" title='__sanitizer::memory_order_release' data-ref="__sanitizer::memory_order_release" data-ref-filename="__sanitizer..memory_order_release">memory_order_release</a>);</td></tr>
<tr><th id="384">384</th><td>  <b>return</b> <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogFlushStatus" title='XRayLogFlushStatus' data-ref="XRayLogFlushStatus" data-ref-filename="XRayLogFlushStatus">XRayLogFlushStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_FLUSHED" title='XRAY_LOG_FLUSHED' data-ref="XRAY_LOG_FLUSHED" data-ref-filename="XRAY_LOG_FLUSHED">XRAY_LOG_FLUSHED</a>;</td></tr>
<tr><th id="385">385</th><td>}</td></tr>
<tr><th id="386">386</th><td></td></tr>
<tr><th id="387">387</th><td><a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogInitStatus" title='XRayLogInitStatus' data-ref="XRayLogInitStatus" data-ref-filename="XRayLogInitStatus">XRayLogInitStatus</a> <dfn class="decl def fn" id="__xray::fdrLoggingFinalize" title='__xray::fdrLoggingFinalize' data-ref="__xray::fdrLoggingFinalize" data-ref-filename="__xray..fdrLoggingFinalize">fdrLoggingFinalize</dfn>() <a class="macro" href="xray_defs.h.html#18" title="" data-ref="_M/XRAY_NEVER_INSTRUMENT">XRAY_NEVER_INSTRUMENT</a> {</td></tr>
<tr><th id="388">388</th><td>  <a class="typedef" href="../sanitizer_common/sanitizer_internal_defs.h.html#__sanitizer::s32" title='__sanitizer::s32' data-type='int' data-ref="__sanitizer::s32" data-ref-filename="__sanitizer..s32">s32</a> <dfn class="local col1 decl" id="121CurrentStatus" title='CurrentStatus' data-type='__sanitizer::s32' data-ref="121CurrentStatus" data-ref-filename="121CurrentStatus">CurrentStatus</dfn> = <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogInitStatus" title='XRayLogInitStatus' data-ref="XRayLogInitStatus" data-ref-filename="XRayLogInitStatus">XRayLogInitStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_INITIALIZED" title='XRAY_LOG_INITIALIZED' data-ref="XRAY_LOG_INITIALIZED" data-ref-filename="XRAY_LOG_INITIALIZED">XRAY_LOG_INITIALIZED</a>;</td></tr>
<tr><th id="389">389</th><td>  <b>if</b> (!<a class="ref fn" href="../sanitizer_common/sanitizer_atomic_clang.h.html#__sanitizer::atomic_compare_exchange_strong" title='__sanitizer::atomic_compare_exchange_strong' data-ref="__sanitizer::atomic_compare_exchange_strong" data-ref-filename="__sanitizer..atomic_compare_exchange_strong">atomic_compare_exchange_strong</a>(&amp;<a class="tu ref" href="#__xray::LoggingStatus" title='__xray::LoggingStatus' data-use='a' data-ref="__xray::LoggingStatus" data-ref-filename="__xray..LoggingStatus">LoggingStatus</a>, &amp;<a class="local col1 ref" href="#121CurrentStatus" title='CurrentStatus' data-ref="121CurrentStatus" data-ref-filename="121CurrentStatus">CurrentStatus</a>,</td></tr>
<tr><th id="390">390</th><td>                                      <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogInitStatus" title='XRayLogInitStatus' data-ref="XRayLogInitStatus" data-ref-filename="XRayLogInitStatus">XRayLogInitStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_FINALIZING" title='XRAY_LOG_FINALIZING' data-ref="XRAY_LOG_FINALIZING" data-ref-filename="XRAY_LOG_FINALIZING">XRAY_LOG_FINALIZING</a>,</td></tr>
<tr><th id="391">391</th><td>                                      <a class="enum" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::memory_order_release" title='__sanitizer::memory_order_release' data-ref="__sanitizer::memory_order_release" data-ref-filename="__sanitizer..memory_order_release">memory_order_release</a>)) {</td></tr>
<tr><th id="392">392</th><td>    <b>if</b> (<a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Verbosity" title='__sanitizer::Verbosity' data-ref="__sanitizer::Verbosity" data-ref-filename="__sanitizer..Verbosity">Verbosity</a>())</td></tr>
<tr><th id="393">393</th><td>      <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Report" title='__sanitizer::Report' data-ref="__sanitizer::Report" data-ref-filename="__sanitizer..Report">Report</a>(<q>"Cannot finalize log, implementation not initialized.\n"</q>);</td></tr>
<tr><th id="394">394</th><td>    <b>return</b> <b>static_cast</b>&lt;<a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogInitStatus" title='XRayLogInitStatus' data-ref="XRayLogInitStatus" data-ref-filename="XRayLogInitStatus">XRayLogInitStatus</a>&gt;(<a class="local col1 ref" href="#121CurrentStatus" title='CurrentStatus' data-ref="121CurrentStatus" data-ref-filename="121CurrentStatus">CurrentStatus</a>);</td></tr>
<tr><th id="395">395</th><td>  }</td></tr>
<tr><th id="396">396</th><td></td></tr>
<tr><th id="397">397</th><td>  <i>// Do special things to make the log finalize itself, and not allow any more</i></td></tr>
<tr><th id="398">398</th><td><i>  // operations to be performed until re-initialized.</i></td></tr>
<tr><th id="399">399</th><td>  <b>if</b> (<a class="tu ref" href="#__xray::BQ" title='__xray::BQ' data-use='r' data-ref="__xray::BQ" data-ref-filename="__xray..BQ">BQ</a> == <b>nullptr</b>) {</td></tr>
<tr><th id="400">400</th><td>    <b>if</b> (<a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Verbosity" title='__sanitizer::Verbosity' data-ref="__sanitizer::Verbosity" data-ref-filename="__sanitizer..Verbosity">Verbosity</a>())</td></tr>
<tr><th id="401">401</th><td>      <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Report" title='__sanitizer::Report' data-ref="__sanitizer::Report" data-ref-filename="__sanitizer..Report">Report</a>(<q>"Attempting to finalize an uninitialized global buffer!\n"</q>);</td></tr>
<tr><th id="402">402</th><td>  } <b>else</b> {</td></tr>
<tr><th id="403">403</th><td>    <a class="tu ref" href="#__xray::BQ" title='__xray::BQ' data-use='r' data-ref="__xray::BQ" data-ref-filename="__xray..BQ">BQ</a>-&gt;<a class="ref fn" href="xray_buffer_queue.h.html#__xray::BufferQueue::finalize" title='__xray::BufferQueue::finalize' data-ref="__xray::BufferQueue::finalize" data-ref-filename="__xray..BufferQueue..finalize">finalize</a>();</td></tr>
<tr><th id="404">404</th><td>  }</td></tr>
<tr><th id="405">405</th><td></td></tr>
<tr><th id="406">406</th><td>  <a class="ref fn" href="../sanitizer_common/sanitizer_atomic_clang_x86.h.html#__sanitizer::atomic_store" title='__sanitizer::atomic_store' data-ref="__sanitizer::atomic_store" data-ref-filename="__sanitizer..atomic_store">atomic_store</a>(&amp;<a class="tu ref" href="#__xray::LoggingStatus" title='__xray::LoggingStatus' data-use='a' data-ref="__xray::LoggingStatus" data-ref-filename="__xray..LoggingStatus">LoggingStatus</a>, <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogInitStatus" title='XRayLogInitStatus' data-ref="XRayLogInitStatus" data-ref-filename="XRayLogInitStatus">XRayLogInitStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_FINALIZED" title='XRAY_LOG_FINALIZED' data-ref="XRAY_LOG_FINALIZED" data-ref-filename="XRAY_LOG_FINALIZED">XRAY_LOG_FINALIZED</a>,</td></tr>
<tr><th id="407">407</th><td>               <a class="enum" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::memory_order_release" title='__sanitizer::memory_order_release' data-ref="__sanitizer::memory_order_release" data-ref-filename="__sanitizer..memory_order_release">memory_order_release</a>);</td></tr>
<tr><th id="408">408</th><td>  <b>return</b> <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogInitStatus" title='XRayLogInitStatus' data-ref="XRayLogInitStatus" data-ref-filename="XRayLogInitStatus">XRayLogInitStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_FINALIZED" title='XRAY_LOG_FINALIZED' data-ref="XRAY_LOG_FINALIZED" data-ref-filename="XRAY_LOG_FINALIZED">XRAY_LOG_FINALIZED</a>;</td></tr>
<tr><th id="409">409</th><td>}</td></tr>
<tr><th id="410">410</th><td></td></tr>
<tr><th id="411">411</th><td><b>struct</b> <dfn class="type def" id="__xray::TSCAndCPU" title='__xray::TSCAndCPU' data-ref="__xray::TSCAndCPU" data-ref-filename="__xray..TSCAndCPU">TSCAndCPU</dfn> {</td></tr>
<tr><th id="412">412</th><td>  <a class="typedef" href="../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="tu decl field" id="__xray::TSCAndCPU::TSC" title='__xray::TSCAndCPU::TSC' data-type='uint64_t' data-ref="__xray::TSCAndCPU::TSC" data-ref-filename="__xray..TSCAndCPU..TSC">TSC</dfn> = <var>0</var>;</td></tr>
<tr><th id="413">413</th><td>  <em>unsigned</em> <em>char</em> <dfn class="tu decl field" id="__xray::TSCAndCPU::CPU" title='__xray::TSCAndCPU::CPU' data-type='unsigned char' data-ref="__xray::TSCAndCPU::CPU" data-ref-filename="__xray..TSCAndCPU..CPU">CPU</dfn> = <var>0</var>;</td></tr>
<tr><th id="414">414</th><td>};</td></tr>
<tr><th id="415">415</th><td></td></tr>
<tr><th id="416">416</th><td><em>static</em> <a class="type" href="#__xray::TSCAndCPU" title='__xray::TSCAndCPU' data-ref="__xray::TSCAndCPU" data-ref-filename="__xray..TSCAndCPU">TSCAndCPU</a> <dfn class="tu decl def fn" id="__xray::getTimestamp" title='__xray::getTimestamp' data-type='__xray::TSCAndCPU __xray::getTimestamp()' data-ref="__xray::getTimestamp" data-ref-filename="__xray..getTimestamp">getTimestamp</dfn>() <a class="macro" href="xray_defs.h.html#18" title="" data-ref="_M/XRAY_NEVER_INSTRUMENT">XRAY_NEVER_INSTRUMENT</a> {</td></tr>
<tr><th id="417">417</th><td>  <i>// We want to get the TSC as early as possible, so that we can check whether</i></td></tr>
<tr><th id="418">418</th><td><i>  // we've seen this CPU before. We also do it before we load anything else,</i></td></tr>
<tr><th id="419">419</th><td><i>  // to allow for forward progress with the scheduling.</i></td></tr>
<tr><th id="420">420</th><td>  <a class="type" href="#__xray::TSCAndCPU" title='__xray::TSCAndCPU' data-ref="__xray::TSCAndCPU" data-ref-filename="__xray..TSCAndCPU">TSCAndCPU</a> <a class="tu ref fn fake" href="#411" title='__xray::TSCAndCPU::TSCAndCPU' data-use='c' data-ref="__xray::TSCAndCPU::TSCAndCPU" data-ref-filename="__xray..TSCAndCPU..TSCAndCPU"></a><dfn class="local col2 decl" id="122Result" title='Result' data-type='__xray::TSCAndCPU' data-ref="122Result" data-ref-filename="122Result">Result</dfn>;</td></tr>
<tr><th id="421">421</th><td></td></tr>
<tr><th id="422">422</th><td>  <i>// Test once for required CPU features</i></td></tr>
<tr><th id="423">423</th><td>  <em>static</em> <a class="typedef" href="../../../../include/bits/pthreadtypes.h.html#pthread_once_t" title='pthread_once_t' data-type='int' data-ref="pthread_once_t" data-ref-filename="pthread_once_t">pthread_once_t</a> <dfn class="local col3 decl" id="123OnceProbe" title='OnceProbe' data-type='pthread_once_t' data-ref="123OnceProbe" data-ref-filename="123OnceProbe">OnceProbe</dfn> = <a class="macro" href="../../../../include/pthread.h.html#182" title="0" data-ref="_M/PTHREAD_ONCE_INIT">PTHREAD_ONCE_INIT</a>;</td></tr>
<tr><th id="424">424</th><td>  <em>static</em> <em>bool</em> <dfn class="local col4 decl" id="124TSCSupported" title='TSCSupported' data-type='bool' data-ref="124TSCSupported" data-ref-filename="124TSCSupported">TSCSupported</dfn> = <b>true</b>;</td></tr>
<tr><th id="425">425</th><td>  <a class="ref fn" href="../../../../include/pthread.h.html#pthread_once" title='pthread_once' data-ref="pthread_once" data-ref-filename="pthread_once">pthread_once</a>(</td></tr>
<tr><th id="426">426</th><td>      &amp;<a class="local col3 ref" href="#123OnceProbe" title='OnceProbe' data-ref="123OnceProbe" data-ref-filename="123OnceProbe">OnceProbe</a>, +<a class="tu ref fn fake" href="#426" title='__xray::getTimestamp()::(anonymous class)::operator void (*)()' data-use='c' data-ref="__xray::getTimestamp()::(anonymousclass)::operatorvoid(*)()" data-ref-filename="__xray..getTimestamp()..(anonymousclass)..operatorvoid(*)()"></a>[] { <a class="local col4 ref" href="#124TSCSupported" title='TSCSupported' data-ref="124TSCSupported" data-ref-filename="124TSCSupported">TSCSupported</a> = <a class="ref fn" href="xray_x86_64.inc.html#__xray::probeRequiredCPUFeatures" title='__xray::probeRequiredCPUFeatures' data-ref="__xray::probeRequiredCPUFeatures" data-ref-filename="__xray..probeRequiredCPUFeatures">probeRequiredCPUFeatures</a>(); });</td></tr>
<tr><th id="427">427</th><td></td></tr>
<tr><th id="428">428</th><td>  <b>if</b> (<a class="local col4 ref" href="#124TSCSupported" title='TSCSupported' data-ref="124TSCSupported" data-ref-filename="124TSCSupported">TSCSupported</a>) {</td></tr>
<tr><th id="429">429</th><td>    <a class="local col2 ref" href="#122Result" title='Result' data-ref="122Result" data-ref-filename="122Result">Result</a>.<a class="tu ref field" href="#__xray::TSCAndCPU::TSC" title='__xray::TSCAndCPU::TSC' data-use='w' data-ref="__xray::TSCAndCPU::TSC" data-ref-filename="__xray..TSCAndCPU..TSC">TSC</a> = <span class="namespace">__xray::</span><a class="ref fn" href="xray_x86_64.inc.html#__xray::readTSC" title='__xray::readTSC' data-ref="__xray::readTSC" data-ref-filename="__xray..readTSC">readTSC</a>(<span class='refarg'><a class="local col2 ref" href="#122Result" title='Result' data-ref="122Result" data-ref-filename="122Result">Result</a>.<a class="tu ref field" href="#__xray::TSCAndCPU::CPU" title='__xray::TSCAndCPU::CPU' data-use='a' data-ref="__xray::TSCAndCPU::CPU" data-ref-filename="__xray..TSCAndCPU..CPU">CPU</a></span>);</td></tr>
<tr><th id="430">430</th><td>  } <b>else</b> {</td></tr>
<tr><th id="431">431</th><td>    <i>// FIXME: This code needs refactoring as it appears in multiple locations</i></td></tr>
<tr><th id="432">432</th><td>    <a class="type" href="../../../../include/bits/types/struct_timespec.h.html#timespec" title='timespec' data-ref="timespec" data-ref-filename="timespec">timespec</a> <a class="ref fn fake" href="../../../../include/bits/types/struct_timespec.h.html#10" title='timespec::timespec' data-ref="_ZN8timespecC1Ev" data-ref-filename="_ZN8timespecC1Ev"></a><dfn class="local col5 decl" id="125TS" title='TS' data-type='timespec' data-ref="125TS" data-ref-filename="125TS">TS</dfn>;</td></tr>
<tr><th id="433">433</th><td>    <em>int</em> <dfn class="local col6 decl" id="126result" title='result' data-type='int' data-ref="126result" data-ref-filename="126result">result</dfn> = <a class="ref fn" href="../../../../include/time.h.html#clock_gettime" title='clock_gettime' data-ref="clock_gettime" data-ref-filename="clock_gettime">clock_gettime</a>(<a class="macro" href="../../../../include/bits/time.h.html#46" title="0" data-ref="_M/CLOCK_REALTIME">CLOCK_REALTIME</a>, &amp;<a class="local col5 ref" href="#125TS" title='TS' data-ref="125TS" data-ref-filename="125TS">TS</a>);</td></tr>
<tr><th id="434">434</th><td>    <b>if</b> (<a class="local col6 ref" href="#126result" title='result' data-ref="126result" data-ref-filename="126result">result</a> != <var>0</var>) {</td></tr>
<tr><th id="435">435</th><td>      <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Report" title='__sanitizer::Report' data-ref="__sanitizer::Report" data-ref-filename="__sanitizer..Report">Report</a>(<q>"clock_gettime(2) return %d, errno=%d"</q>, <a class="local col6 ref" href="#126result" title='result' data-ref="126result" data-ref-filename="126result">result</a>, <em>int</em>(<a class="macro" href="../../../../include/errno.h.html#38" title="(*__errno_location ())" data-ref="_M/errno">errno</a>));</td></tr>
<tr><th id="436">436</th><td>      <a class="local col5 ref" href="#125TS" title='TS' data-ref="125TS" data-ref-filename="125TS">TS</a> <a class="ref fn" href="../../../../include/bits/types/struct_timespec.h.html#10" title='timespec::operator=' data-ref="_ZN8timespecaSEOS_" data-ref-filename="_ZN8timespecaSEOS_">=</a> {<var>0</var>, <var>0</var>};</td></tr>
<tr><th id="437">437</th><td>    }</td></tr>
<tr><th id="438">438</th><td>    <a class="local col2 ref" href="#122Result" title='Result' data-ref="122Result" data-ref-filename="122Result">Result</a>.<a class="tu ref field" href="#__xray::TSCAndCPU::CPU" title='__xray::TSCAndCPU::CPU' data-use='w' data-ref="__xray::TSCAndCPU::CPU" data-ref-filename="__xray..TSCAndCPU..CPU">CPU</a> = <var>0</var>;</td></tr>
<tr><th id="439">439</th><td>    <a class="local col2 ref" href="#122Result" title='Result' data-ref="122Result" data-ref-filename="122Result">Result</a>.<a class="tu ref field" href="#__xray::TSCAndCPU::TSC" title='__xray::TSCAndCPU::TSC' data-use='w' data-ref="__xray::TSCAndCPU::TSC" data-ref-filename="__xray..TSCAndCPU..TSC">TSC</a> = <a class="local col5 ref" href="#125TS" title='TS' data-ref="125TS" data-ref-filename="125TS">TS</a>.<a class="ref field" href="../../../../include/bits/types/struct_timespec.h.html#timespec::tv_sec" title='timespec::tv_sec' data-ref="timespec::tv_sec" data-ref-filename="timespec..tv_sec">tv_sec</a> * <span class="namespace">__xray::</span><a class="ref" href="xray_tsc.h.html#__xray::NanosecondsPerSecond" title='__xray::NanosecondsPerSecond' data-ref="__xray::NanosecondsPerSecond" data-ref-filename="__xray..NanosecondsPerSecond">NanosecondsPerSecond</a> + <a class="local col5 ref" href="#125TS" title='TS' data-ref="125TS" data-ref-filename="125TS">TS</a>.<a class="ref field" href="../../../../include/bits/types/struct_timespec.h.html#timespec::tv_nsec" title='timespec::tv_nsec' data-ref="timespec::tv_nsec" data-ref-filename="timespec..tv_nsec">tv_nsec</a>;</td></tr>
<tr><th id="440">440</th><td>  }</td></tr>
<tr><th id="441">441</th><td>  <b>return</b> <a class="local col2 ref" href="#122Result" title='Result' data-ref="122Result" data-ref-filename="122Result">Result</a>;</td></tr>
<tr><th id="442">442</th><td>}</td></tr>
<tr><th id="443">443</th><td></td></tr>
<tr><th id="444">444</th><td><b>thread_local</b> <a class="type" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::atomic_uint8_t" title='__sanitizer::atomic_uint8_t' data-ref="__sanitizer::atomic_uint8_t" data-ref-filename="__sanitizer..atomic_uint8_t">atomic_uint8_t</a> <dfn class="decl def" id="__xray::Running" title='__xray::Running' data-ref="__xray::Running" data-ref-filename="__xray..Running">Running</dfn>{<var>0</var>};</td></tr>
<tr><th id="445">445</th><td></td></tr>
<tr><th id="446">446</th><td><em>static</em> <em>bool</em> <dfn class="tu decl def fn" id="__xray::setupTLD" title='__xray::setupTLD' data-type='bool __xray::setupTLD(__xray::(anonymous namespace)::ThreadLocalData &amp; TLD)' data-ref="__xray::setupTLD" data-ref-filename="__xray..setupTLD">setupTLD</dfn>(<a class="tu type" href="#__xray::(anonymousnamespace)::ThreadLocalData" title='__xray::(anonymous namespace)::ThreadLocalData' data-ref="__xray::(anonymousnamespace)::ThreadLocalData" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData">ThreadLocalData</a> &amp;<dfn class="local col7 decl" id="127TLD" title='TLD' data-type='__xray::(anonymous namespace)::ThreadLocalData &amp;' data-ref="127TLD" data-ref-filename="127TLD">TLD</dfn>) <a class="macro" href="xray_defs.h.html#18" title="" data-ref="_M/XRAY_NEVER_INSTRUMENT">XRAY_NEVER_INSTRUMENT</a> {</td></tr>
<tr><th id="447">447</th><td>  <i>// Check if we're finalizing, before proceeding.</i></td></tr>
<tr><th id="448">448</th><td>  {</td></tr>
<tr><th id="449">449</th><td>    <em>auto</em> <dfn class="local col8 decl" id="128Status" title='Status' data-type='int' data-ref="128Status" data-ref-filename="128Status">Status</dfn> = <a class="ref fn" href="../sanitizer_common/sanitizer_atomic_clang_x86.h.html#__sanitizer::atomic_load" title='__sanitizer::atomic_load' data-ref="__sanitizer::atomic_load" data-ref-filename="__sanitizer..atomic_load">atomic_load</a>(&amp;<a class="tu ref" href="#__xray::LoggingStatus" title='__xray::LoggingStatus' data-use='a' data-ref="__xray::LoggingStatus" data-ref-filename="__xray..LoggingStatus">LoggingStatus</a>, <a class="enum" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::memory_order_acquire" title='__sanitizer::memory_order_acquire' data-ref="__sanitizer::memory_order_acquire" data-ref-filename="__sanitizer..memory_order_acquire">memory_order_acquire</a>);</td></tr>
<tr><th id="450">450</th><td>    <b>if</b> (<a class="local col8 ref" href="#128Status" title='Status' data-ref="128Status" data-ref-filename="128Status">Status</a> == <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogInitStatus" title='XRayLogInitStatus' data-ref="XRayLogInitStatus" data-ref-filename="XRayLogInitStatus">XRayLogInitStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_FINALIZING" title='XRAY_LOG_FINALIZING' data-ref="XRAY_LOG_FINALIZING" data-ref-filename="XRAY_LOG_FINALIZING">XRAY_LOG_FINALIZING</a> ||</td></tr>
<tr><th id="451">451</th><td>        <a class="local col8 ref" href="#128Status" title='Status' data-ref="128Status" data-ref-filename="128Status">Status</a> == <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogInitStatus" title='XRayLogInitStatus' data-ref="XRayLogInitStatus" data-ref-filename="XRayLogInitStatus">XRayLogInitStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_FINALIZED" title='XRAY_LOG_FINALIZED' data-ref="XRAY_LOG_FINALIZED" data-ref-filename="XRAY_LOG_FINALIZED">XRAY_LOG_FINALIZED</a>) {</td></tr>
<tr><th id="452">452</th><td>      <b>if</b> (<a class="local col7 ref" href="#127TLD" title='TLD' data-ref="127TLD" data-ref-filename="127TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Controller" title='__xray::(anonymous namespace)::ThreadLocalData::Controller' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Controller" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Controller">Controller</a> != <b>nullptr</b>) {</td></tr>
<tr><th id="453">453</th><td>        <a class="local col7 ref" href="#127TLD" title='TLD' data-ref="127TLD" data-ref-filename="127TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Controller" title='__xray::(anonymous namespace)::ThreadLocalData::Controller' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Controller" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Controller">Controller</a>-&gt;<a class="ref fn" href="xray_fdr_controller.h.html#__xray::FDRController::flush" title='__xray::FDRController::flush' data-ref="__xray::FDRController::flush" data-ref-filename="__xray..FDRController..flush">flush</a>();</td></tr>
<tr><th id="454">454</th><td>        <a class="local col7 ref" href="#127TLD" title='TLD' data-ref="127TLD" data-ref-filename="127TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Controller" title='__xray::(anonymous namespace)::ThreadLocalData::Controller' data-use='w' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Controller" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Controller">Controller</a> = <b>nullptr</b>;</td></tr>
<tr><th id="455">455</th><td>      }</td></tr>
<tr><th id="456">456</th><td>      <b>return</b> <b>false</b>;</td></tr>
<tr><th id="457">457</th><td>    }</td></tr>
<tr><th id="458">458</th><td>  }</td></tr>
<tr><th id="459">459</th><td></td></tr>
<tr><th id="460">460</th><td>  <b>if</b> (<a class="macro" href="../sanitizer_common/sanitizer_internal_defs.h.html#229" title="__builtin_expect(!!(TLD.Controller == nullptr), 0)" data-ref="_M/UNLIKELY">UNLIKELY</a>(<a class="local col7 ref" href="#127TLD" title='TLD' data-ref="127TLD" data-ref-filename="127TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Controller" title='__xray::(anonymous namespace)::ThreadLocalData::Controller' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Controller" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Controller">Controller</a> == <b>nullptr</b>)) {</td></tr>
<tr><th id="461">461</th><td>    <i>// Set up the TLD buffer queue.</i></td></tr>
<tr><th id="462">462</th><td>    <b>if</b> (<a class="macro" href="../sanitizer_common/sanitizer_internal_defs.h.html#229" title="__builtin_expect(!!(BQ == nullptr), 0)" data-ref="_M/UNLIKELY">UNLIKELY</a>(<a class="tu ref" href="#__xray::BQ" title='__xray::BQ' data-use='r' data-ref="__xray::BQ" data-ref-filename="__xray..BQ">BQ</a> == <b>nullptr</b>))</td></tr>
<tr><th id="463">463</th><td>      <b>return</b> <b>false</b>;</td></tr>
<tr><th id="464">464</th><td>    <a class="local col7 ref" href="#127TLD" title='TLD' data-ref="127TLD" data-ref-filename="127TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::BQ" title='__xray::(anonymous namespace)::ThreadLocalData::BQ' data-use='w' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::BQ" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..BQ">BQ</a> = <a class="tu ref" href="#__xray::BQ" title='__xray::BQ' data-use='r' data-ref="__xray::BQ" data-ref-filename="__xray..BQ">BQ</a>;</td></tr>
<tr><th id="465">465</th><td></td></tr>
<tr><th id="466">466</th><td>    <i>// Check that we have a valid buffer.</i></td></tr>
<tr><th id="467">467</th><td>    <b>if</b> (<a class="local col7 ref" href="#127TLD" title='TLD' data-ref="127TLD" data-ref-filename="127TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Buffer" title='__xray::(anonymous namespace)::ThreadLocalData::Buffer' data-use='m' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Buffer" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Buffer">Buffer</a>.<a class="ref field" href="xray_buffer_queue.h.html#__xray::BufferQueue::Buffer::Generation" title='__xray::BufferQueue::Buffer::Generation' data-ref="__xray::BufferQueue::Buffer::Generation" data-ref-filename="__xray..BufferQueue..Buffer..Generation">Generation</a> != <a class="tu ref" href="#__xray::BQ" title='__xray::BQ' data-use='r' data-ref="__xray::BQ" data-ref-filename="__xray..BQ">BQ</a>-&gt;<a class="ref fn" href="xray_buffer_queue.h.html#__xray::BufferQueue::generation" title='__xray::BufferQueue::generation' data-ref="__xray::BufferQueue::generation" data-ref-filename="__xray..BufferQueue..generation">generation</a>() &amp;&amp;</td></tr>
<tr><th id="468">468</th><td>        <a class="local col7 ref" href="#127TLD" title='TLD' data-ref="127TLD" data-ref-filename="127TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::BQ" title='__xray::(anonymous namespace)::ThreadLocalData::BQ' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::BQ" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..BQ">BQ</a>-&gt;<a class="ref fn" href="xray_buffer_queue.h.html#__xray::BufferQueue::releaseBuffer" title='__xray::BufferQueue::releaseBuffer' data-ref="__xray::BufferQueue::releaseBuffer" data-ref-filename="__xray..BufferQueue..releaseBuffer">releaseBuffer</a>(<span class='refarg'><a class="local col7 ref" href="#127TLD" title='TLD' data-ref="127TLD" data-ref-filename="127TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Buffer" title='__xray::(anonymous namespace)::ThreadLocalData::Buffer' data-use='a' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Buffer" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Buffer">Buffer</a></span>) != <a class="type" href="xray_buffer_queue.h.html#__xray::BufferQueue" title='__xray::BufferQueue' data-ref="__xray::BufferQueue" data-ref-filename="__xray..BufferQueue">BufferQueue</a>::<a class="type" href="xray_buffer_queue.h.html#__xray::BufferQueue::ErrorCode" title='__xray::BufferQueue::ErrorCode' data-ref="__xray::BufferQueue::ErrorCode" data-ref-filename="__xray..BufferQueue..ErrorCode">ErrorCode</a>::<a class="enum" href="xray_buffer_queue.h.html#__xray::BufferQueue::ErrorCode::Ok" title='__xray::BufferQueue::ErrorCode::Ok' data-ref="__xray::BufferQueue::ErrorCode::Ok" data-ref-filename="__xray..BufferQueue..ErrorCode..Ok">Ok</a>)</td></tr>
<tr><th id="469">469</th><td>      <b>return</b> <b>false</b>;</td></tr>
<tr><th id="470">470</th><td></td></tr>
<tr><th id="471">471</th><td>    <i>// Set up a buffer, before setting up the log writer. Bail out on failure.</i></td></tr>
<tr><th id="472">472</th><td>    <b>if</b> (<a class="local col7 ref" href="#127TLD" title='TLD' data-ref="127TLD" data-ref-filename="127TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::BQ" title='__xray::(anonymous namespace)::ThreadLocalData::BQ' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::BQ" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..BQ">BQ</a>-&gt;<a class="ref fn" href="xray_buffer_queue.h.html#__xray::BufferQueue::getBuffer" title='__xray::BufferQueue::getBuffer' data-ref="__xray::BufferQueue::getBuffer" data-ref-filename="__xray..BufferQueue..getBuffer">getBuffer</a>(<span class='refarg'><a class="local col7 ref" href="#127TLD" title='TLD' data-ref="127TLD" data-ref-filename="127TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Buffer" title='__xray::(anonymous namespace)::ThreadLocalData::Buffer' data-use='a' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Buffer" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Buffer">Buffer</a></span>) != <a class="type" href="xray_buffer_queue.h.html#__xray::BufferQueue" title='__xray::BufferQueue' data-ref="__xray::BufferQueue" data-ref-filename="__xray..BufferQueue">BufferQueue</a>::<a class="type" href="xray_buffer_queue.h.html#__xray::BufferQueue::ErrorCode" title='__xray::BufferQueue::ErrorCode' data-ref="__xray::BufferQueue::ErrorCode" data-ref-filename="__xray..BufferQueue..ErrorCode">ErrorCode</a>::<a class="enum" href="xray_buffer_queue.h.html#__xray::BufferQueue::ErrorCode::Ok" title='__xray::BufferQueue::ErrorCode::Ok' data-ref="__xray::BufferQueue::ErrorCode::Ok" data-ref-filename="__xray..BufferQueue..ErrorCode..Ok">Ok</a>)</td></tr>
<tr><th id="473">473</th><td>      <b>return</b> <b>false</b>;</td></tr>
<tr><th id="474">474</th><td></td></tr>
<tr><th id="475">475</th><td>    <i>// Set up the Log Writer for this thread.</i></td></tr>
<tr><th id="476">476</th><td>    <b>if</b> (<a class="macro" href="../sanitizer_common/sanitizer_internal_defs.h.html#229" title="__builtin_expect(!!(TLD.Writer == nullptr), 0)" data-ref="_M/UNLIKELY">UNLIKELY</a>(<a class="local col7 ref" href="#127TLD" title='TLD' data-ref="127TLD" data-ref-filename="127TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Writer" title='__xray::(anonymous namespace)::ThreadLocalData::Writer' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Writer" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Writer">Writer</a> == <b>nullptr</b>)) {</td></tr>
<tr><th id="477">477</th><td>      <em>auto</em> *<dfn class="local col9 decl" id="129LWStorage" title='LWStorage' data-type='__xray::FDRLogWriter *' data-ref="129LWStorage" data-ref-filename="129LWStorage">LWStorage</dfn> = <b>reinterpret_cast</b>&lt;<a class="type" href="xray_fdr_log_writer.h.html#__xray::FDRLogWriter" title='__xray::FDRLogWriter' data-ref="__xray::FDRLogWriter" data-ref-filename="__xray..FDRLogWriter">FDRLogWriter</a> *&gt;(&amp;<a class="local col7 ref" href="#127TLD" title='TLD' data-ref="127TLD" data-ref-filename="127TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::LWStorage" title='__xray::(anonymous namespace)::ThreadLocalData::LWStorage' data-use='a' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::LWStorage" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..LWStorage">LWStorage</a>);</td></tr>
<tr><th id="478">478</th><td>      <b>new</b> (<a class="local col9 ref" href="#129LWStorage" title='LWStorage' data-ref="129LWStorage" data-ref-filename="129LWStorage">LWStorage</a>) <a class="type" href="xray_fdr_log_writer.h.html#__xray::FDRLogWriter" title='__xray::FDRLogWriter' data-ref="__xray::FDRLogWriter" data-ref-filename="__xray..FDRLogWriter">FDRLogWriter</a><a class="ref fn" href="xray_fdr_log_writer.h.html#__xray::FDRLogWriter::FDRLogWriter" title='__xray::FDRLogWriter::FDRLogWriter' data-ref="__xray::FDRLogWriter::FDRLogWriter" data-ref-filename="__xray..FDRLogWriter..FDRLogWriter">(</a><a class="local col7 ref" href="#127TLD" title='TLD' data-ref="127TLD" data-ref-filename="127TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Buffer" title='__xray::(anonymous namespace)::ThreadLocalData::Buffer' data-use='a' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Buffer" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Buffer">Buffer</a>);</td></tr>
<tr><th id="479">479</th><td>      <a class="local col7 ref" href="#127TLD" title='TLD' data-ref="127TLD" data-ref-filename="127TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Writer" title='__xray::(anonymous namespace)::ThreadLocalData::Writer' data-use='w' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Writer" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Writer">Writer</a> = <a class="local col9 ref" href="#129LWStorage" title='LWStorage' data-ref="129LWStorage" data-ref-filename="129LWStorage">LWStorage</a>;</td></tr>
<tr><th id="480">480</th><td>    } <b>else</b> {</td></tr>
<tr><th id="481">481</th><td>      <a class="local col7 ref" href="#127TLD" title='TLD' data-ref="127TLD" data-ref-filename="127TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Writer" title='__xray::(anonymous namespace)::ThreadLocalData::Writer' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Writer" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Writer">Writer</a>-&gt;<a class="ref fn" href="xray_fdr_log_writer.h.html#__xray::FDRLogWriter::resetRecord" title='__xray::FDRLogWriter::resetRecord' data-ref="__xray::FDRLogWriter::resetRecord" data-ref-filename="__xray..FDRLogWriter..resetRecord">resetRecord</a>();</td></tr>
<tr><th id="482">482</th><td>    }</td></tr>
<tr><th id="483">483</th><td></td></tr>
<tr><th id="484">484</th><td>    <em>auto</em> *<dfn class="local col0 decl" id="130CStorage" title='CStorage' data-type='__xray::FDRController&lt;5&gt; *' data-ref="130CStorage" data-ref-filename="130CStorage">CStorage</dfn> = <b>reinterpret_cast</b>&lt;<a class="type" href="xray_fdr_controller.h.html#__xray::FDRController" title='__xray::FDRController' data-ref="__xray::FDRController" data-ref-filename="__xray..FDRController">FDRController</a>&lt;&gt; *&gt;(&amp;<a class="local col7 ref" href="#127TLD" title='TLD' data-ref="127TLD" data-ref-filename="127TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::CStorage" title='__xray::(anonymous namespace)::ThreadLocalData::CStorage' data-use='a' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::CStorage" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..CStorage">CStorage</a>);</td></tr>
<tr><th id="485">485</th><td>    <b>new</b> (<a class="local col0 ref" href="#130CStorage" title='CStorage' data-ref="130CStorage" data-ref-filename="130CStorage">CStorage</a>)</td></tr>
<tr><th id="486">486</th><td>        <a class="type" href="xray_fdr_controller.h.html#__xray::FDRController" title='__xray::FDRController' data-ref="__xray::FDRController" data-ref-filename="__xray..FDRController">FDRController</a>&lt;&gt;<a class="ref fn" href="xray_fdr_controller.h.html#__xray::FDRController::FDRController{Version}" title='__xray::FDRController::FDRController&lt;Version&gt;' data-ref="__xray::FDRController::FDRController{Version}" data-ref-filename="__xray..FDRController..FDRController{Version}">(</a><a class="local col7 ref" href="#127TLD" title='TLD' data-ref="127TLD" data-ref-filename="127TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::BQ" title='__xray::(anonymous namespace)::ThreadLocalData::BQ' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::BQ" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..BQ">BQ</a>, <a class="local col7 ref" href="#127TLD" title='TLD' data-ref="127TLD" data-ref-filename="127TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Buffer" title='__xray::(anonymous namespace)::ThreadLocalData::Buffer' data-use='a' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Buffer" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Buffer">Buffer</a>, *<a class="local col7 ref" href="#127TLD" title='TLD' data-ref="127TLD" data-ref-filename="127TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Writer" title='__xray::(anonymous namespace)::ThreadLocalData::Writer' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Writer" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Writer">Writer</a>, <a class="ref fn" href="../../../../include/time.h.html#clock_gettime" title='clock_gettime' data-ref="clock_gettime" data-ref-filename="clock_gettime">clock_gettime</a>,</td></tr>
<tr><th id="487">487</th><td>                        <a class="ref fn" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::atomic_load_relaxed" title='__sanitizer::atomic_load_relaxed' data-ref="__sanitizer::atomic_load_relaxed" data-ref-filename="__sanitizer..atomic_load_relaxed">atomic_load_relaxed</a>(&amp;<a class="tu ref" href="#__xray::ThresholdTicks" title='__xray::ThresholdTicks' data-use='a' data-ref="__xray::ThresholdTicks" data-ref-filename="__xray..ThresholdTicks">ThresholdTicks</a>));</td></tr>
<tr><th id="488">488</th><td>    <a class="local col7 ref" href="#127TLD" title='TLD' data-ref="127TLD" data-ref-filename="127TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Controller" title='__xray::(anonymous namespace)::ThreadLocalData::Controller' data-use='w' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Controller" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Controller">Controller</a> = <a class="local col0 ref" href="#130CStorage" title='CStorage' data-ref="130CStorage" data-ref-filename="130CStorage">CStorage</a>;</td></tr>
<tr><th id="489">489</th><td>  }</td></tr>
<tr><th id="490">490</th><td></td></tr>
<tr><th id="491">491</th><td>  <a class="macro" href="../sanitizer_common/sanitizer_internal_defs.h.html#318" title="" data-ref="_M/DCHECK_NE">DCHECK_NE</a>(TLD.Controller, <b>nullptr</b>);</td></tr>
<tr><th id="492">492</th><td>  <b>return</b> <b>true</b>;</td></tr>
<tr><th id="493">493</th><td>}</td></tr>
<tr><th id="494">494</th><td></td></tr>
<tr><th id="495">495</th><td><em>void</em> <dfn class="decl def fn" id="__xray::fdrLoggingHandleArg0" title='__xray::fdrLoggingHandleArg0' data-ref="__xray::fdrLoggingHandleArg0" data-ref-filename="__xray..fdrLoggingHandleArg0">fdrLoggingHandleArg0</dfn>(<a class="typedef" href="../../../../include/bits/stdint-intn.h.html#int32_t" title='int32_t' data-type='__int32_t' data-ref="int32_t" data-ref-filename="int32_t">int32_t</a> <dfn class="local col1 decl" id="131FuncId" title='FuncId' data-type='int32_t' data-ref="131FuncId" data-ref-filename="131FuncId">FuncId</dfn>,</td></tr>
<tr><th id="496">496</th><td>                          <a class="type" href="../../include/xray/xray_interface.h.html#XRayEntryType" title='XRayEntryType' data-ref="XRayEntryType" data-ref-filename="XRayEntryType">XRayEntryType</a> <dfn class="local col2 decl" id="132Entry" title='Entry' data-type='XRayEntryType' data-ref="132Entry" data-ref-filename="132Entry">Entry</dfn>) <a class="macro" href="xray_defs.h.html#18" title="" data-ref="_M/XRAY_NEVER_INSTRUMENT">XRAY_NEVER_INSTRUMENT</a> {</td></tr>
<tr><th id="497">497</th><td>  <em>auto</em> <dfn class="local col3 decl" id="133TC" title='TC' data-type='__xray::TSCAndCPU' data-ref="133TC" data-ref-filename="133TC">TC</dfn> = <a class="tu ref fn" href="#__xray::getTimestamp" title='__xray::getTimestamp' data-use='c' data-ref="__xray::getTimestamp" data-ref-filename="__xray..getTimestamp">getTimestamp</a>();</td></tr>
<tr><th id="498">498</th><td>  <em>auto</em> &amp;<dfn class="local col4 decl" id="134TSC" title='TSC' data-type='unsigned long &amp;' data-ref="134TSC" data-ref-filename="134TSC">TSC</dfn> = <a class="local col3 ref" href="#133TC" title='TC' data-ref="133TC" data-ref-filename="133TC">TC</a>.<a class="tu ref field" href="#__xray::TSCAndCPU::TSC" title='__xray::TSCAndCPU::TSC' data-use='a' data-ref="__xray::TSCAndCPU::TSC" data-ref-filename="__xray..TSCAndCPU..TSC">TSC</a>;</td></tr>
<tr><th id="499">499</th><td>  <em>auto</em> &amp;<dfn class="local col5 decl" id="135CPU" title='CPU' data-type='unsigned char &amp;' data-ref="135CPU" data-ref-filename="135CPU">CPU</dfn> = <a class="local col3 ref" href="#133TC" title='TC' data-ref="133TC" data-ref-filename="133TC">TC</a>.<a class="tu ref field" href="#__xray::TSCAndCPU::CPU" title='__xray::TSCAndCPU::CPU' data-use='a' data-ref="__xray::TSCAndCPU::CPU" data-ref-filename="__xray..TSCAndCPU..CPU">CPU</a>;</td></tr>
<tr><th id="500">500</th><td>  <a class="type" href="xray_recursion_guard.h.html#__xray::RecursionGuard" title='__xray::RecursionGuard' data-ref="__xray::RecursionGuard" data-ref-filename="__xray..RecursionGuard">RecursionGuard</a> <dfn class="local col6 decl" id="136Guard" title='Guard' data-type='__xray::RecursionGuard' data-ref="136Guard" data-ref-filename="136Guard">Guard</dfn><a class="ref fn" href="xray_recursion_guard.h.html#__xray::RecursionGuard::RecursionGuard" title='__xray::RecursionGuard::RecursionGuard' data-ref="__xray::RecursionGuard::RecursionGuard" data-ref-filename="__xray..RecursionGuard..RecursionGuard">{</a><a class="ref" href="#__xray::Running" title='__xray::Running' data-ref="__xray::Running" data-ref-filename="__xray..Running">Running</a>};</td></tr>
<tr><th id="501">501</th><td>  <b>if</b> (!<a class="ref fn fake" href="xray_recursion_guard.h.html#__xray::RecursionGuard::operatorbool" title='__xray::RecursionGuard::operator bool' data-ref="__xray::RecursionGuard::operatorbool" data-ref-filename="__xray..RecursionGuard..operatorbool"></a><a class="local col6 ref" href="#136Guard" title='Guard' data-ref="136Guard" data-ref-filename="136Guard">Guard</a>)</td></tr>
<tr><th id="502">502</th><td>    <b>return</b>;</td></tr>
<tr><th id="503">503</th><td></td></tr>
<tr><th id="504">504</th><td>  <em>auto</em> &amp;<dfn class="local col7 decl" id="137TLD" title='TLD' data-type='__xray::(anonymous namespace)::ThreadLocalData &amp;' data-ref="137TLD" data-ref-filename="137TLD">TLD</dfn> = <a class="tu ref fn" href="#__xray::getThreadLocalData" title='__xray::getThreadLocalData' data-use='c' data-ref="__xray::getThreadLocalData" data-ref-filename="__xray..getThreadLocalData">getThreadLocalData</a>();</td></tr>
<tr><th id="505">505</th><td>  <b>if</b> (!<a class="tu ref fn" href="#__xray::setupTLD" title='__xray::setupTLD' data-use='c' data-ref="__xray::setupTLD" data-ref-filename="__xray..setupTLD">setupTLD</a>(<span class='refarg'><a class="local col7 ref" href="#137TLD" title='TLD' data-ref="137TLD" data-ref-filename="137TLD">TLD</a></span>))</td></tr>
<tr><th id="506">506</th><td>    <b>return</b>;</td></tr>
<tr><th id="507">507</th><td></td></tr>
<tr><th id="508">508</th><td>  <b>switch</b> (<a class="local col2 ref" href="#132Entry" title='Entry' data-ref="132Entry" data-ref-filename="132Entry">Entry</a>) {</td></tr>
<tr><th id="509">509</th><td>  <b>case</b> <a class="type" href="../../include/xray/xray_interface.h.html#XRayEntryType" title='XRayEntryType' data-ref="XRayEntryType" data-ref-filename="XRayEntryType">XRayEntryType</a>::<a class="enum" href="../../include/xray/xray_interface.h.html#ENTRY" title='ENTRY' data-ref="ENTRY" data-ref-filename="ENTRY">ENTRY</a>:</td></tr>
<tr><th id="510">510</th><td>  <b>case</b> <a class="type" href="../../include/xray/xray_interface.h.html#XRayEntryType" title='XRayEntryType' data-ref="XRayEntryType" data-ref-filename="XRayEntryType">XRayEntryType</a>::<a class="enum" href="../../include/xray/xray_interface.h.html#LOG_ARGS_ENTRY" title='LOG_ARGS_ENTRY' data-ref="LOG_ARGS_ENTRY" data-ref-filename="LOG_ARGS_ENTRY">LOG_ARGS_ENTRY</a>:</td></tr>
<tr><th id="511">511</th><td>    <a class="local col7 ref" href="#137TLD" title='TLD' data-ref="137TLD" data-ref-filename="137TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Controller" title='__xray::(anonymous namespace)::ThreadLocalData::Controller' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Controller" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Controller">Controller</a>-&gt;<a class="ref fn" href="xray_fdr_controller.h.html#__xray::FDRController::functionEnter" title='__xray::FDRController::functionEnter' data-ref="__xray::FDRController::functionEnter" data-ref-filename="__xray..FDRController..functionEnter">functionEnter</a>(<a class="local col1 ref" href="#131FuncId" title='FuncId' data-ref="131FuncId" data-ref-filename="131FuncId">FuncId</a>, <a class="local col4 ref" href="#134TSC" title='TSC' data-ref="134TSC" data-ref-filename="134TSC">TSC</a>, <a class="local col5 ref" href="#135CPU" title='CPU' data-ref="135CPU" data-ref-filename="135CPU">CPU</a>);</td></tr>
<tr><th id="512">512</th><td>    <b>return</b>;</td></tr>
<tr><th id="513">513</th><td>  <b>case</b> <a class="type" href="../../include/xray/xray_interface.h.html#XRayEntryType" title='XRayEntryType' data-ref="XRayEntryType" data-ref-filename="XRayEntryType">XRayEntryType</a>::<a class="enum" href="../../include/xray/xray_interface.h.html#EXIT" title='EXIT' data-ref="EXIT" data-ref-filename="EXIT">EXIT</a>:</td></tr>
<tr><th id="514">514</th><td>    <a class="local col7 ref" href="#137TLD" title='TLD' data-ref="137TLD" data-ref-filename="137TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Controller" title='__xray::(anonymous namespace)::ThreadLocalData::Controller' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Controller" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Controller">Controller</a>-&gt;<a class="ref fn" href="xray_fdr_controller.h.html#__xray::FDRController::functionExit" title='__xray::FDRController::functionExit' data-ref="__xray::FDRController::functionExit" data-ref-filename="__xray..FDRController..functionExit">functionExit</a>(<a class="local col1 ref" href="#131FuncId" title='FuncId' data-ref="131FuncId" data-ref-filename="131FuncId">FuncId</a>, <a class="local col4 ref" href="#134TSC" title='TSC' data-ref="134TSC" data-ref-filename="134TSC">TSC</a>, <a class="local col5 ref" href="#135CPU" title='CPU' data-ref="135CPU" data-ref-filename="135CPU">CPU</a>);</td></tr>
<tr><th id="515">515</th><td>    <b>return</b>;</td></tr>
<tr><th id="516">516</th><td>  <b>case</b> <a class="type" href="../../include/xray/xray_interface.h.html#XRayEntryType" title='XRayEntryType' data-ref="XRayEntryType" data-ref-filename="XRayEntryType">XRayEntryType</a>::<a class="enum" href="../../include/xray/xray_interface.h.html#TAIL" title='TAIL' data-ref="TAIL" data-ref-filename="TAIL">TAIL</a>:</td></tr>
<tr><th id="517">517</th><td>    <a class="local col7 ref" href="#137TLD" title='TLD' data-ref="137TLD" data-ref-filename="137TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Controller" title='__xray::(anonymous namespace)::ThreadLocalData::Controller' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Controller" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Controller">Controller</a>-&gt;<a class="ref fn" href="xray_fdr_controller.h.html#__xray::FDRController::functionTailExit" title='__xray::FDRController::functionTailExit' data-ref="__xray::FDRController::functionTailExit" data-ref-filename="__xray..FDRController..functionTailExit">functionTailExit</a>(<a class="local col1 ref" href="#131FuncId" title='FuncId' data-ref="131FuncId" data-ref-filename="131FuncId">FuncId</a>, <a class="local col4 ref" href="#134TSC" title='TSC' data-ref="134TSC" data-ref-filename="134TSC">TSC</a>, <a class="local col5 ref" href="#135CPU" title='CPU' data-ref="135CPU" data-ref-filename="135CPU">CPU</a>);</td></tr>
<tr><th id="518">518</th><td>    <b>return</b>;</td></tr>
<tr><th id="519">519</th><td>  <b>case</b> <a class="type" href="../../include/xray/xray_interface.h.html#XRayEntryType" title='XRayEntryType' data-ref="XRayEntryType" data-ref-filename="XRayEntryType">XRayEntryType</a>::<a class="enum" href="../../include/xray/xray_interface.h.html#CUSTOM_EVENT" title='CUSTOM_EVENT' data-ref="CUSTOM_EVENT" data-ref-filename="CUSTOM_EVENT">CUSTOM_EVENT</a>:</td></tr>
<tr><th id="520">520</th><td>  <b>case</b> <a class="type" href="../../include/xray/xray_interface.h.html#XRayEntryType" title='XRayEntryType' data-ref="XRayEntryType" data-ref-filename="XRayEntryType">XRayEntryType</a>::<a class="enum" href="../../include/xray/xray_interface.h.html#TYPED_EVENT" title='TYPED_EVENT' data-ref="TYPED_EVENT" data-ref-filename="TYPED_EVENT">TYPED_EVENT</a>:</td></tr>
<tr><th id="521">521</th><td>    <b>break</b>;</td></tr>
<tr><th id="522">522</th><td>  }</td></tr>
<tr><th id="523">523</th><td>}</td></tr>
<tr><th id="524">524</th><td></td></tr>
<tr><th id="525">525</th><td><em>void</em> <dfn class="decl def fn" id="__xray::fdrLoggingHandleArg1" title='__xray::fdrLoggingHandleArg1' data-ref="__xray::fdrLoggingHandleArg1" data-ref-filename="__xray..fdrLoggingHandleArg1">fdrLoggingHandleArg1</dfn>(<a class="typedef" href="../../../../include/bits/stdint-intn.h.html#int32_t" title='int32_t' data-type='__int32_t' data-ref="int32_t" data-ref-filename="int32_t">int32_t</a> <dfn class="local col8 decl" id="138FuncId" title='FuncId' data-type='int32_t' data-ref="138FuncId" data-ref-filename="138FuncId">FuncId</dfn>, <a class="type" href="../../include/xray/xray_interface.h.html#XRayEntryType" title='XRayEntryType' data-ref="XRayEntryType" data-ref-filename="XRayEntryType">XRayEntryType</a> <dfn class="local col9 decl" id="139Entry" title='Entry' data-type='XRayEntryType' data-ref="139Entry" data-ref-filename="139Entry">Entry</dfn>,</td></tr>
<tr><th id="526">526</th><td>                          <a class="typedef" href="../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col0 decl" id="140Arg" title='Arg' data-type='uint64_t' data-ref="140Arg" data-ref-filename="140Arg">Arg</dfn>) <a class="macro" href="xray_defs.h.html#18" title="" data-ref="_M/XRAY_NEVER_INSTRUMENT">XRAY_NEVER_INSTRUMENT</a> {</td></tr>
<tr><th id="527">527</th><td>  <em>auto</em> <dfn class="local col1 decl" id="141TC" title='TC' data-type='__xray::TSCAndCPU' data-ref="141TC" data-ref-filename="141TC">TC</dfn> = <a class="tu ref fn" href="#__xray::getTimestamp" title='__xray::getTimestamp' data-use='c' data-ref="__xray::getTimestamp" data-ref-filename="__xray..getTimestamp">getTimestamp</a>();</td></tr>
<tr><th id="528">528</th><td>  <em>auto</em> &amp;<dfn class="local col2 decl" id="142TSC" title='TSC' data-type='unsigned long &amp;' data-ref="142TSC" data-ref-filename="142TSC">TSC</dfn> = <a class="local col1 ref" href="#141TC" title='TC' data-ref="141TC" data-ref-filename="141TC">TC</a>.<a class="tu ref field" href="#__xray::TSCAndCPU::TSC" title='__xray::TSCAndCPU::TSC' data-use='a' data-ref="__xray::TSCAndCPU::TSC" data-ref-filename="__xray..TSCAndCPU..TSC">TSC</a>;</td></tr>
<tr><th id="529">529</th><td>  <em>auto</em> &amp;<dfn class="local col3 decl" id="143CPU" title='CPU' data-type='unsigned char &amp;' data-ref="143CPU" data-ref-filename="143CPU">CPU</dfn> = <a class="local col1 ref" href="#141TC" title='TC' data-ref="141TC" data-ref-filename="141TC">TC</a>.<a class="tu ref field" href="#__xray::TSCAndCPU::CPU" title='__xray::TSCAndCPU::CPU' data-use='a' data-ref="__xray::TSCAndCPU::CPU" data-ref-filename="__xray..TSCAndCPU..CPU">CPU</a>;</td></tr>
<tr><th id="530">530</th><td>  <a class="type" href="xray_recursion_guard.h.html#__xray::RecursionGuard" title='__xray::RecursionGuard' data-ref="__xray::RecursionGuard" data-ref-filename="__xray..RecursionGuard">RecursionGuard</a> <dfn class="local col4 decl" id="144Guard" title='Guard' data-type='__xray::RecursionGuard' data-ref="144Guard" data-ref-filename="144Guard">Guard</dfn><a class="ref fn" href="xray_recursion_guard.h.html#__xray::RecursionGuard::RecursionGuard" title='__xray::RecursionGuard::RecursionGuard' data-ref="__xray::RecursionGuard::RecursionGuard" data-ref-filename="__xray..RecursionGuard..RecursionGuard">{</a><a class="ref" href="#__xray::Running" title='__xray::Running' data-ref="__xray::Running" data-ref-filename="__xray..Running">Running</a>};</td></tr>
<tr><th id="531">531</th><td>  <b>if</b> (!<a class="ref fn fake" href="xray_recursion_guard.h.html#__xray::RecursionGuard::operatorbool" title='__xray::RecursionGuard::operator bool' data-ref="__xray::RecursionGuard::operatorbool" data-ref-filename="__xray..RecursionGuard..operatorbool"></a><a class="local col4 ref" href="#144Guard" title='Guard' data-ref="144Guard" data-ref-filename="144Guard">Guard</a>)</td></tr>
<tr><th id="532">532</th><td>    <b>return</b>;</td></tr>
<tr><th id="533">533</th><td></td></tr>
<tr><th id="534">534</th><td>  <em>auto</em> &amp;<dfn class="local col5 decl" id="145TLD" title='TLD' data-type='__xray::(anonymous namespace)::ThreadLocalData &amp;' data-ref="145TLD" data-ref-filename="145TLD">TLD</dfn> = <a class="tu ref fn" href="#__xray::getThreadLocalData" title='__xray::getThreadLocalData' data-use='c' data-ref="__xray::getThreadLocalData" data-ref-filename="__xray..getThreadLocalData">getThreadLocalData</a>();</td></tr>
<tr><th id="535">535</th><td>  <b>if</b> (!<a class="tu ref fn" href="#__xray::setupTLD" title='__xray::setupTLD' data-use='c' data-ref="__xray::setupTLD" data-ref-filename="__xray..setupTLD">setupTLD</a>(<span class='refarg'><a class="local col5 ref" href="#145TLD" title='TLD' data-ref="145TLD" data-ref-filename="145TLD">TLD</a></span>))</td></tr>
<tr><th id="536">536</th><td>    <b>return</b>;</td></tr>
<tr><th id="537">537</th><td></td></tr>
<tr><th id="538">538</th><td>  <b>switch</b> (<a class="local col9 ref" href="#139Entry" title='Entry' data-ref="139Entry" data-ref-filename="139Entry">Entry</a>) {</td></tr>
<tr><th id="539">539</th><td>  <b>case</b> <a class="type" href="../../include/xray/xray_interface.h.html#XRayEntryType" title='XRayEntryType' data-ref="XRayEntryType" data-ref-filename="XRayEntryType">XRayEntryType</a>::<a class="enum" href="../../include/xray/xray_interface.h.html#ENTRY" title='ENTRY' data-ref="ENTRY" data-ref-filename="ENTRY">ENTRY</a>:</td></tr>
<tr><th id="540">540</th><td>  <b>case</b> <a class="type" href="../../include/xray/xray_interface.h.html#XRayEntryType" title='XRayEntryType' data-ref="XRayEntryType" data-ref-filename="XRayEntryType">XRayEntryType</a>::<a class="enum" href="../../include/xray/xray_interface.h.html#LOG_ARGS_ENTRY" title='LOG_ARGS_ENTRY' data-ref="LOG_ARGS_ENTRY" data-ref-filename="LOG_ARGS_ENTRY">LOG_ARGS_ENTRY</a>:</td></tr>
<tr><th id="541">541</th><td>    <a class="local col5 ref" href="#145TLD" title='TLD' data-ref="145TLD" data-ref-filename="145TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Controller" title='__xray::(anonymous namespace)::ThreadLocalData::Controller' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Controller" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Controller">Controller</a>-&gt;<a class="ref fn" href="xray_fdr_controller.h.html#__xray::FDRController::functionEnterArg" title='__xray::FDRController::functionEnterArg' data-ref="__xray::FDRController::functionEnterArg" data-ref-filename="__xray..FDRController..functionEnterArg">functionEnterArg</a>(<a class="local col8 ref" href="#138FuncId" title='FuncId' data-ref="138FuncId" data-ref-filename="138FuncId">FuncId</a>, <a class="local col2 ref" href="#142TSC" title='TSC' data-ref="142TSC" data-ref-filename="142TSC">TSC</a>, <a class="local col3 ref" href="#143CPU" title='CPU' data-ref="143CPU" data-ref-filename="143CPU">CPU</a>, <a class="local col0 ref" href="#140Arg" title='Arg' data-ref="140Arg" data-ref-filename="140Arg">Arg</a>);</td></tr>
<tr><th id="542">542</th><td>    <b>return</b>;</td></tr>
<tr><th id="543">543</th><td>  <b>case</b> <a class="type" href="../../include/xray/xray_interface.h.html#XRayEntryType" title='XRayEntryType' data-ref="XRayEntryType" data-ref-filename="XRayEntryType">XRayEntryType</a>::<a class="enum" href="../../include/xray/xray_interface.h.html#EXIT" title='EXIT' data-ref="EXIT" data-ref-filename="EXIT">EXIT</a>:</td></tr>
<tr><th id="544">544</th><td>    <a class="local col5 ref" href="#145TLD" title='TLD' data-ref="145TLD" data-ref-filename="145TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Controller" title='__xray::(anonymous namespace)::ThreadLocalData::Controller' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Controller" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Controller">Controller</a>-&gt;<a class="ref fn" href="xray_fdr_controller.h.html#__xray::FDRController::functionExit" title='__xray::FDRController::functionExit' data-ref="__xray::FDRController::functionExit" data-ref-filename="__xray..FDRController..functionExit">functionExit</a>(<a class="local col8 ref" href="#138FuncId" title='FuncId' data-ref="138FuncId" data-ref-filename="138FuncId">FuncId</a>, <a class="local col2 ref" href="#142TSC" title='TSC' data-ref="142TSC" data-ref-filename="142TSC">TSC</a>, <a class="local col3 ref" href="#143CPU" title='CPU' data-ref="143CPU" data-ref-filename="143CPU">CPU</a>);</td></tr>
<tr><th id="545">545</th><td>    <b>return</b>;</td></tr>
<tr><th id="546">546</th><td>  <b>case</b> <a class="type" href="../../include/xray/xray_interface.h.html#XRayEntryType" title='XRayEntryType' data-ref="XRayEntryType" data-ref-filename="XRayEntryType">XRayEntryType</a>::<a class="enum" href="../../include/xray/xray_interface.h.html#TAIL" title='TAIL' data-ref="TAIL" data-ref-filename="TAIL">TAIL</a>:</td></tr>
<tr><th id="547">547</th><td>    <a class="local col5 ref" href="#145TLD" title='TLD' data-ref="145TLD" data-ref-filename="145TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Controller" title='__xray::(anonymous namespace)::ThreadLocalData::Controller' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Controller" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Controller">Controller</a>-&gt;<a class="ref fn" href="xray_fdr_controller.h.html#__xray::FDRController::functionTailExit" title='__xray::FDRController::functionTailExit' data-ref="__xray::FDRController::functionTailExit" data-ref-filename="__xray..FDRController..functionTailExit">functionTailExit</a>(<a class="local col8 ref" href="#138FuncId" title='FuncId' data-ref="138FuncId" data-ref-filename="138FuncId">FuncId</a>, <a class="local col2 ref" href="#142TSC" title='TSC' data-ref="142TSC" data-ref-filename="142TSC">TSC</a>, <a class="local col3 ref" href="#143CPU" title='CPU' data-ref="143CPU" data-ref-filename="143CPU">CPU</a>);</td></tr>
<tr><th id="548">548</th><td>    <b>return</b>;</td></tr>
<tr><th id="549">549</th><td>  <b>case</b> <a class="type" href="../../include/xray/xray_interface.h.html#XRayEntryType" title='XRayEntryType' data-ref="XRayEntryType" data-ref-filename="XRayEntryType">XRayEntryType</a>::<a class="enum" href="../../include/xray/xray_interface.h.html#CUSTOM_EVENT" title='CUSTOM_EVENT' data-ref="CUSTOM_EVENT" data-ref-filename="CUSTOM_EVENT">CUSTOM_EVENT</a>:</td></tr>
<tr><th id="550">550</th><td>  <b>case</b> <a class="type" href="../../include/xray/xray_interface.h.html#XRayEntryType" title='XRayEntryType' data-ref="XRayEntryType" data-ref-filename="XRayEntryType">XRayEntryType</a>::<a class="enum" href="../../include/xray/xray_interface.h.html#TYPED_EVENT" title='TYPED_EVENT' data-ref="TYPED_EVENT" data-ref-filename="TYPED_EVENT">TYPED_EVENT</a>:</td></tr>
<tr><th id="551">551</th><td>    <b>break</b>;</td></tr>
<tr><th id="552">552</th><td>  }</td></tr>
<tr><th id="553">553</th><td>}</td></tr>
<tr><th id="554">554</th><td></td></tr>
<tr><th id="555">555</th><td><em>void</em> <dfn class="decl def fn" id="__xray::fdrLoggingHandleCustomEvent" title='__xray::fdrLoggingHandleCustomEvent' data-ref="__xray::fdrLoggingHandleCustomEvent" data-ref-filename="__xray..fdrLoggingHandleCustomEvent">fdrLoggingHandleCustomEvent</dfn>(<em>void</em> *<dfn class="local col6 decl" id="146Event" title='Event' data-type='void *' data-ref="146Event" data-ref-filename="146Event">Event</dfn>,</td></tr>
<tr><th id="556">556</th><td>                                 <span class="namespace">std::</span><span class='typedef' title='std::size_t' data-type='unsigned long' data-ref="std::size_t" data-ref-filename="std..size_t">size_t</span> <dfn class="local col7 decl" id="147EventSize" title='EventSize' data-type='std::size_t' data-ref="147EventSize" data-ref-filename="147EventSize">EventSize</dfn>) <a class="macro" href="xray_defs.h.html#18" title="" data-ref="_M/XRAY_NEVER_INSTRUMENT">XRAY_NEVER_INSTRUMENT</a> {</td></tr>
<tr><th id="557">557</th><td>  <em>auto</em> <dfn class="local col8 decl" id="148TC" title='TC' data-type='__xray::TSCAndCPU' data-ref="148TC" data-ref-filename="148TC">TC</dfn> = <a class="tu ref fn" href="#__xray::getTimestamp" title='__xray::getTimestamp' data-use='c' data-ref="__xray::getTimestamp" data-ref-filename="__xray..getTimestamp">getTimestamp</a>();</td></tr>
<tr><th id="558">558</th><td>  <em>auto</em> &amp;<dfn class="local col9 decl" id="149TSC" title='TSC' data-type='unsigned long &amp;' data-ref="149TSC" data-ref-filename="149TSC">TSC</dfn> = <a class="local col8 ref" href="#148TC" title='TC' data-ref="148TC" data-ref-filename="148TC">TC</a>.<a class="tu ref field" href="#__xray::TSCAndCPU::TSC" title='__xray::TSCAndCPU::TSC' data-use='a' data-ref="__xray::TSCAndCPU::TSC" data-ref-filename="__xray..TSCAndCPU..TSC">TSC</a>;</td></tr>
<tr><th id="559">559</th><td>  <em>auto</em> &amp;<dfn class="local col0 decl" id="150CPU" title='CPU' data-type='unsigned char &amp;' data-ref="150CPU" data-ref-filename="150CPU">CPU</dfn> = <a class="local col8 ref" href="#148TC" title='TC' data-ref="148TC" data-ref-filename="148TC">TC</a>.<a class="tu ref field" href="#__xray::TSCAndCPU::CPU" title='__xray::TSCAndCPU::CPU' data-use='a' data-ref="__xray::TSCAndCPU::CPU" data-ref-filename="__xray..TSCAndCPU..CPU">CPU</a>;</td></tr>
<tr><th id="560">560</th><td>  <a class="type" href="xray_recursion_guard.h.html#__xray::RecursionGuard" title='__xray::RecursionGuard' data-ref="__xray::RecursionGuard" data-ref-filename="__xray..RecursionGuard">RecursionGuard</a> <dfn class="local col1 decl" id="151Guard" title='Guard' data-type='__xray::RecursionGuard' data-ref="151Guard" data-ref-filename="151Guard">Guard</dfn><a class="ref fn" href="xray_recursion_guard.h.html#__xray::RecursionGuard::RecursionGuard" title='__xray::RecursionGuard::RecursionGuard' data-ref="__xray::RecursionGuard::RecursionGuard" data-ref-filename="__xray..RecursionGuard..RecursionGuard">{</a><a class="ref" href="#__xray::Running" title='__xray::Running' data-ref="__xray::Running" data-ref-filename="__xray..Running">Running</a>};</td></tr>
<tr><th id="561">561</th><td>  <b>if</b> (!<a class="ref fn fake" href="xray_recursion_guard.h.html#__xray::RecursionGuard::operatorbool" title='__xray::RecursionGuard::operator bool' data-ref="__xray::RecursionGuard::operatorbool" data-ref-filename="__xray..RecursionGuard..operatorbool"></a><a class="local col1 ref" href="#151Guard" title='Guard' data-ref="151Guard" data-ref-filename="151Guard">Guard</a>)</td></tr>
<tr><th id="562">562</th><td>    <b>return</b>;</td></tr>
<tr><th id="563">563</th><td></td></tr>
<tr><th id="564">564</th><td>  <i>// Complain when we ever get at least one custom event that's larger than what</i></td></tr>
<tr><th id="565">565</th><td><i>  // we can possibly support.</i></td></tr>
<tr><th id="566">566</th><td>  <b>if</b> (<a class="local col7 ref" href="#147EventSize" title='EventSize' data-ref="147EventSize" data-ref-filename="147EventSize">EventSize</a> &gt;</td></tr>
<tr><th id="567">567</th><td>      <b>static_cast</b>&lt;<span class="namespace">std::</span><span class='typedef' title='std::size_t' data-type='unsigned long' data-ref="std::size_t" data-ref-filename="std..size_t">size_t</span>&gt;(<span class="namespace">std::</span><span class='type' title='std::numeric_limits' data-ref="std::numeric_limits" data-ref-filename="std..numeric_limits">numeric_limits</span>&lt;<a class="typedef" href="../../../../include/bits/stdint-intn.h.html#int32_t" title='int32_t' data-type='__int32_t' data-ref="int32_t" data-ref-filename="int32_t">int32_t</a>&gt;::<span class='ref fn' title='std::numeric_limits&lt;int&gt;::max' data-ref="_ZNSt14numeric_limitsIiE3maxEv" data-ref-filename="_ZNSt14numeric_limitsIiE3maxEv">max</span>())) {</td></tr>
<tr><th id="568">568</th><td>    <em>static</em> <a class="typedef" href="../../../../include/bits/pthreadtypes.h.html#pthread_once_t" title='pthread_once_t' data-type='int' data-ref="pthread_once_t" data-ref-filename="pthread_once_t">pthread_once_t</a> <dfn class="local col2 decl" id="152Once" title='Once' data-type='pthread_once_t' data-ref="152Once" data-ref-filename="152Once">Once</dfn> = <a class="macro" href="../../../../include/pthread.h.html#182" title="0" data-ref="_M/PTHREAD_ONCE_INIT">PTHREAD_ONCE_INIT</a>;</td></tr>
<tr><th id="569">569</th><td>    <a class="ref fn" href="../../../../include/pthread.h.html#pthread_once" title='pthread_once' data-ref="pthread_once" data-ref-filename="pthread_once">pthread_once</a>(</td></tr>
<tr><th id="570">570</th><td>        &amp;<a class="local col2 ref" href="#152Once" title='Once' data-ref="152Once" data-ref-filename="152Once">Once</a>, +<a class="tu ref fn fake" href="#570" title='__xray::fdrLoggingHandleCustomEvent(void *, std::size_t)::(anonymous class)::operator void (*)()' data-use='c' data-ref="__xray::fdrLoggingHandleCustomEvent(void*,std::size_t)::(anonymousclass)::operatorvoid(*)()" data-ref-filename="__xray..fdrLoggingHandleCustomEvent(void*,std..size_t)..(anonymousclass)..operatorvoid(*)()"></a>[] {</td></tr>
<tr><th id="571">571</th><td>          <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Report" title='__sanitizer::Report' data-ref="__sanitizer::Report" data-ref-filename="__sanitizer..Report">Report</a>(<q>"Custom event size too large; truncating to %d.\n"</q>,</td></tr>
<tr><th id="572">572</th><td>                 <span class="namespace">std::</span><span class='type' title='std::numeric_limits' data-ref="std::numeric_limits" data-ref-filename="std..numeric_limits">numeric_limits</span>&lt;<a class="typedef" href="../../../../include/bits/stdint-intn.h.html#int32_t" title='int32_t' data-type='__int32_t' data-ref="int32_t" data-ref-filename="int32_t">int32_t</a>&gt;::<span class='ref fn' title='std::numeric_limits&lt;int&gt;::max' data-ref="_ZNSt14numeric_limitsIiE3maxEv" data-ref-filename="_ZNSt14numeric_limitsIiE3maxEv">max</span>());</td></tr>
<tr><th id="573">573</th><td>        });</td></tr>
<tr><th id="574">574</th><td>  }</td></tr>
<tr><th id="575">575</th><td></td></tr>
<tr><th id="576">576</th><td>  <em>auto</em> &amp;<dfn class="local col3 decl" id="153TLD" title='TLD' data-type='__xray::(anonymous namespace)::ThreadLocalData &amp;' data-ref="153TLD" data-ref-filename="153TLD">TLD</dfn> = <a class="tu ref fn" href="#__xray::getThreadLocalData" title='__xray::getThreadLocalData' data-use='c' data-ref="__xray::getThreadLocalData" data-ref-filename="__xray..getThreadLocalData">getThreadLocalData</a>();</td></tr>
<tr><th id="577">577</th><td>  <b>if</b> (!<a class="tu ref fn" href="#__xray::setupTLD" title='__xray::setupTLD' data-use='c' data-ref="__xray::setupTLD" data-ref-filename="__xray..setupTLD">setupTLD</a>(<span class='refarg'><a class="local col3 ref" href="#153TLD" title='TLD' data-ref="153TLD" data-ref-filename="153TLD">TLD</a></span>))</td></tr>
<tr><th id="578">578</th><td>    <b>return</b>;</td></tr>
<tr><th id="579">579</th><td></td></tr>
<tr><th id="580">580</th><td>  <a class="typedef" href="../../../../include/bits/stdint-intn.h.html#int32_t" title='int32_t' data-type='__int32_t' data-ref="int32_t" data-ref-filename="int32_t">int32_t</a> <dfn class="local col4 decl" id="154ReducedEventSize" title='ReducedEventSize' data-type='int32_t' data-ref="154ReducedEventSize" data-ref-filename="154ReducedEventSize">ReducedEventSize</dfn> = <b>static_cast</b>&lt;<a class="typedef" href="../../../../include/bits/stdint-intn.h.html#int32_t" title='int32_t' data-type='__int32_t' data-ref="int32_t" data-ref-filename="int32_t">int32_t</a>&gt;(<a class="local col7 ref" href="#147EventSize" title='EventSize' data-ref="147EventSize" data-ref-filename="147EventSize">EventSize</a>);</td></tr>
<tr><th id="581">581</th><td>  <a class="local col3 ref" href="#153TLD" title='TLD' data-ref="153TLD" data-ref-filename="153TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Controller" title='__xray::(anonymous namespace)::ThreadLocalData::Controller' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Controller" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Controller">Controller</a>-&gt;<a class="ref fn" href="xray_fdr_controller.h.html#__xray::FDRController::customEvent" title='__xray::FDRController::customEvent' data-ref="__xray::FDRController::customEvent" data-ref-filename="__xray..FDRController..customEvent">customEvent</a>(<a class="local col9 ref" href="#149TSC" title='TSC' data-ref="149TSC" data-ref-filename="149TSC">TSC</a>, <a class="local col0 ref" href="#150CPU" title='CPU' data-ref="150CPU" data-ref-filename="150CPU">CPU</a>, <a class="local col6 ref" href="#146Event" title='Event' data-ref="146Event" data-ref-filename="146Event">Event</a>, <a class="local col4 ref" href="#154ReducedEventSize" title='ReducedEventSize' data-ref="154ReducedEventSize" data-ref-filename="154ReducedEventSize">ReducedEventSize</a>);</td></tr>
<tr><th id="582">582</th><td>}</td></tr>
<tr><th id="583">583</th><td></td></tr>
<tr><th id="584">584</th><td><em>void</em> <dfn class="decl def fn" id="__xray::fdrLoggingHandleTypedEvent" title='__xray::fdrLoggingHandleTypedEvent' data-ref="__xray::fdrLoggingHandleTypedEvent" data-ref-filename="__xray..fdrLoggingHandleTypedEvent">fdrLoggingHandleTypedEvent</dfn>(</td></tr>
<tr><th id="585">585</th><td>    <a class="typedef" href="../../../../include/bits/stdint-uintn.h.html#uint16_t" title='uint16_t' data-type='__uint16_t' data-ref="uint16_t" data-ref-filename="uint16_t">uint16_t</a> <dfn class="local col5 decl" id="155EventType" title='EventType' data-type='uint16_t' data-ref="155EventType" data-ref-filename="155EventType">EventType</dfn>, <em>const</em> <em>void</em> *<dfn class="local col6 decl" id="156Event" title='Event' data-type='const void *' data-ref="156Event" data-ref-filename="156Event">Event</dfn>,</td></tr>
<tr><th id="586">586</th><td>    <span class="namespace">std::</span><span class='typedef' title='std::size_t' data-type='unsigned long' data-ref="std::size_t" data-ref-filename="std..size_t">size_t</span> <dfn class="local col7 decl" id="157EventSize" title='EventSize' data-type='std::size_t' data-ref="157EventSize" data-ref-filename="157EventSize">EventSize</dfn>) <b>noexcept</b> <a class="macro" href="xray_defs.h.html#18" title="" data-ref="_M/XRAY_NEVER_INSTRUMENT">XRAY_NEVER_INSTRUMENT</a> {</td></tr>
<tr><th id="587">587</th><td>  <em>auto</em> <dfn class="local col8 decl" id="158TC" title='TC' data-type='__xray::TSCAndCPU' data-ref="158TC" data-ref-filename="158TC">TC</dfn> = <a class="tu ref fn" href="#__xray::getTimestamp" title='__xray::getTimestamp' data-use='c' data-ref="__xray::getTimestamp" data-ref-filename="__xray..getTimestamp">getTimestamp</a>();</td></tr>
<tr><th id="588">588</th><td>  <em>auto</em> &amp;<dfn class="local col9 decl" id="159TSC" title='TSC' data-type='unsigned long &amp;' data-ref="159TSC" data-ref-filename="159TSC">TSC</dfn> = <a class="local col8 ref" href="#158TC" title='TC' data-ref="158TC" data-ref-filename="158TC">TC</a>.<a class="tu ref field" href="#__xray::TSCAndCPU::TSC" title='__xray::TSCAndCPU::TSC' data-use='a' data-ref="__xray::TSCAndCPU::TSC" data-ref-filename="__xray..TSCAndCPU..TSC">TSC</a>;</td></tr>
<tr><th id="589">589</th><td>  <em>auto</em> &amp;<dfn class="local col0 decl" id="160CPU" title='CPU' data-type='unsigned char &amp;' data-ref="160CPU" data-ref-filename="160CPU">CPU</dfn> = <a class="local col8 ref" href="#158TC" title='TC' data-ref="158TC" data-ref-filename="158TC">TC</a>.<a class="tu ref field" href="#__xray::TSCAndCPU::CPU" title='__xray::TSCAndCPU::CPU' data-use='a' data-ref="__xray::TSCAndCPU::CPU" data-ref-filename="__xray..TSCAndCPU..CPU">CPU</a>;</td></tr>
<tr><th id="590">590</th><td>  <a class="type" href="xray_recursion_guard.h.html#__xray::RecursionGuard" title='__xray::RecursionGuard' data-ref="__xray::RecursionGuard" data-ref-filename="__xray..RecursionGuard">RecursionGuard</a> <dfn class="local col1 decl" id="161Guard" title='Guard' data-type='__xray::RecursionGuard' data-ref="161Guard" data-ref-filename="161Guard">Guard</dfn><a class="ref fn" href="xray_recursion_guard.h.html#__xray::RecursionGuard::RecursionGuard" title='__xray::RecursionGuard::RecursionGuard' data-ref="__xray::RecursionGuard::RecursionGuard" data-ref-filename="__xray..RecursionGuard..RecursionGuard">{</a><a class="ref" href="#__xray::Running" title='__xray::Running' data-ref="__xray::Running" data-ref-filename="__xray..Running">Running</a>};</td></tr>
<tr><th id="591">591</th><td>  <b>if</b> (!<a class="ref fn fake" href="xray_recursion_guard.h.html#__xray::RecursionGuard::operatorbool" title='__xray::RecursionGuard::operator bool' data-ref="__xray::RecursionGuard::operatorbool" data-ref-filename="__xray..RecursionGuard..operatorbool"></a><a class="local col1 ref" href="#161Guard" title='Guard' data-ref="161Guard" data-ref-filename="161Guard">Guard</a>)</td></tr>
<tr><th id="592">592</th><td>    <b>return</b>;</td></tr>
<tr><th id="593">593</th><td></td></tr>
<tr><th id="594">594</th><td>  <i>// Complain when we ever get at least one typed event that's larger than what</i></td></tr>
<tr><th id="595">595</th><td><i>  // we can possibly support.</i></td></tr>
<tr><th id="596">596</th><td>  <b>if</b> (<a class="local col7 ref" href="#157EventSize" title='EventSize' data-ref="157EventSize" data-ref-filename="157EventSize">EventSize</a> &gt;</td></tr>
<tr><th id="597">597</th><td>      <b>static_cast</b>&lt;<span class="namespace">std::</span><span class='typedef' title='std::size_t' data-type='unsigned long' data-ref="std::size_t" data-ref-filename="std..size_t">size_t</span>&gt;(<span class="namespace">std::</span><span class='type' title='std::numeric_limits' data-ref="std::numeric_limits" data-ref-filename="std..numeric_limits">numeric_limits</span>&lt;<a class="typedef" href="../../../../include/bits/stdint-intn.h.html#int32_t" title='int32_t' data-type='__int32_t' data-ref="int32_t" data-ref-filename="int32_t">int32_t</a>&gt;::<span class='ref fn' title='std::numeric_limits&lt;int&gt;::max' data-ref="_ZNSt14numeric_limitsIiE3maxEv" data-ref-filename="_ZNSt14numeric_limitsIiE3maxEv">max</span>())) {</td></tr>
<tr><th id="598">598</th><td>    <em>static</em> <a class="typedef" href="../../../../include/bits/pthreadtypes.h.html#pthread_once_t" title='pthread_once_t' data-type='int' data-ref="pthread_once_t" data-ref-filename="pthread_once_t">pthread_once_t</a> <dfn class="local col2 decl" id="162Once" title='Once' data-type='pthread_once_t' data-ref="162Once" data-ref-filename="162Once">Once</dfn> = <a class="macro" href="../../../../include/pthread.h.html#182" title="0" data-ref="_M/PTHREAD_ONCE_INIT">PTHREAD_ONCE_INIT</a>;</td></tr>
<tr><th id="599">599</th><td>    <a class="ref fn" href="../../../../include/pthread.h.html#pthread_once" title='pthread_once' data-ref="pthread_once" data-ref-filename="pthread_once">pthread_once</a>(</td></tr>
<tr><th id="600">600</th><td>        &amp;<a class="local col2 ref" href="#162Once" title='Once' data-ref="162Once" data-ref-filename="162Once">Once</a>, +<a class="tu ref fn fake" href="#600" title='__xray::fdrLoggingHandleTypedEvent(uint16_t, const void *, std::size_t)::(anonymous class)::operator void (*)()' data-use='c' data-ref="__xray::fdrLoggingHandleTypedEvent(uint16_t,constvoid*,std::size_t)::(anonymousclass)::operatorvoid(*)()" data-ref-filename="__xray..fdrLoggingHandleTypedEvent(uint16_t,constvoid*,std..size_t)..(anonymousclass)..operatorvoid(*)()"></a>[] {</td></tr>
<tr><th id="601">601</th><td>          <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Report" title='__sanitizer::Report' data-ref="__sanitizer::Report" data-ref-filename="__sanitizer..Report">Report</a>(<q>"Typed event size too large; truncating to %d.\n"</q>,</td></tr>
<tr><th id="602">602</th><td>                 <span class="namespace">std::</span><span class='type' title='std::numeric_limits' data-ref="std::numeric_limits" data-ref-filename="std..numeric_limits">numeric_limits</span>&lt;<a class="typedef" href="../../../../include/bits/stdint-intn.h.html#int32_t" title='int32_t' data-type='__int32_t' data-ref="int32_t" data-ref-filename="int32_t">int32_t</a>&gt;::<span class='ref fn' title='std::numeric_limits&lt;int&gt;::max' data-ref="_ZNSt14numeric_limitsIiE3maxEv" data-ref-filename="_ZNSt14numeric_limitsIiE3maxEv">max</span>());</td></tr>
<tr><th id="603">603</th><td>        });</td></tr>
<tr><th id="604">604</th><td>  }</td></tr>
<tr><th id="605">605</th><td></td></tr>
<tr><th id="606">606</th><td>  <em>auto</em> &amp;<dfn class="local col3 decl" id="163TLD" title='TLD' data-type='__xray::(anonymous namespace)::ThreadLocalData &amp;' data-ref="163TLD" data-ref-filename="163TLD">TLD</dfn> = <a class="tu ref fn" href="#__xray::getThreadLocalData" title='__xray::getThreadLocalData' data-use='c' data-ref="__xray::getThreadLocalData" data-ref-filename="__xray..getThreadLocalData">getThreadLocalData</a>();</td></tr>
<tr><th id="607">607</th><td>  <b>if</b> (!<a class="tu ref fn" href="#__xray::setupTLD" title='__xray::setupTLD' data-use='c' data-ref="__xray::setupTLD" data-ref-filename="__xray..setupTLD">setupTLD</a>(<span class='refarg'><a class="local col3 ref" href="#163TLD" title='TLD' data-ref="163TLD" data-ref-filename="163TLD">TLD</a></span>))</td></tr>
<tr><th id="608">608</th><td>    <b>return</b>;</td></tr>
<tr><th id="609">609</th><td></td></tr>
<tr><th id="610">610</th><td>  <a class="typedef" href="../../../../include/bits/stdint-intn.h.html#int32_t" title='int32_t' data-type='__int32_t' data-ref="int32_t" data-ref-filename="int32_t">int32_t</a> <dfn class="local col4 decl" id="164ReducedEventSize" title='ReducedEventSize' data-type='int32_t' data-ref="164ReducedEventSize" data-ref-filename="164ReducedEventSize">ReducedEventSize</dfn> = <b>static_cast</b>&lt;<a class="typedef" href="../../../../include/bits/stdint-intn.h.html#int32_t" title='int32_t' data-type='__int32_t' data-ref="int32_t" data-ref-filename="int32_t">int32_t</a>&gt;(<a class="local col7 ref" href="#157EventSize" title='EventSize' data-ref="157EventSize" data-ref-filename="157EventSize">EventSize</a>);</td></tr>
<tr><th id="611">611</th><td>  <a class="local col3 ref" href="#163TLD" title='TLD' data-ref="163TLD" data-ref-filename="163TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Controller" title='__xray::(anonymous namespace)::ThreadLocalData::Controller' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Controller" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Controller">Controller</a>-&gt;<a class="ref fn" href="xray_fdr_controller.h.html#__xray::FDRController::typedEvent" title='__xray::FDRController::typedEvent' data-ref="__xray::FDRController::typedEvent" data-ref-filename="__xray..FDRController..typedEvent">typedEvent</a>(<a class="local col9 ref" href="#159TSC" title='TSC' data-ref="159TSC" data-ref-filename="159TSC">TSC</a>, <a class="local col0 ref" href="#160CPU" title='CPU' data-ref="160CPU" data-ref-filename="160CPU">CPU</a>, <a class="local col5 ref" href="#155EventType" title='EventType' data-ref="155EventType" data-ref-filename="155EventType">EventType</a>, <a class="local col6 ref" href="#156Event" title='Event' data-ref="156Event" data-ref-filename="156Event">Event</a>, <a class="local col4 ref" href="#164ReducedEventSize" title='ReducedEventSize' data-ref="164ReducedEventSize" data-ref-filename="164ReducedEventSize">ReducedEventSize</a>);</td></tr>
<tr><th id="612">612</th><td>}</td></tr>
<tr><th id="613">613</th><td></td></tr>
<tr><th id="614">614</th><td><a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogInitStatus" title='XRayLogInitStatus' data-ref="XRayLogInitStatus" data-ref-filename="XRayLogInitStatus">XRayLogInitStatus</a> <dfn class="decl def fn" id="__xray::fdrLoggingInit" title='__xray::fdrLoggingInit' data-ref="__xray::fdrLoggingInit" data-ref-filename="__xray..fdrLoggingInit">fdrLoggingInit</dfn>(<span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</span>, <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</span>, <em>void</em> *<dfn class="local col5 decl" id="165Options" title='Options' data-type='void *' data-ref="165Options" data-ref-filename="165Options">Options</dfn>,</td></tr>
<tr><th id="615">615</th><td>                                 <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</span> <dfn class="local col6 decl" id="166OptionsSize" title='OptionsSize' data-type='size_t' data-ref="166OptionsSize" data-ref-filename="166OptionsSize">OptionsSize</dfn>) <a class="macro" href="xray_defs.h.html#18" title="" data-ref="_M/XRAY_NEVER_INSTRUMENT">XRAY_NEVER_INSTRUMENT</a> {</td></tr>
<tr><th id="616">616</th><td>  <b>if</b> (<a class="local col5 ref" href="#165Options" title='Options' data-ref="165Options" data-ref-filename="165Options">Options</a> == <b>nullptr</b>)</td></tr>
<tr><th id="617">617</th><td>    <b>return</b> <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogInitStatus" title='XRayLogInitStatus' data-ref="XRayLogInitStatus" data-ref-filename="XRayLogInitStatus">XRayLogInitStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_UNINITIALIZED" title='XRAY_LOG_UNINITIALIZED' data-ref="XRAY_LOG_UNINITIALIZED" data-ref-filename="XRAY_LOG_UNINITIALIZED">XRAY_LOG_UNINITIALIZED</a>;</td></tr>
<tr><th id="618">618</th><td></td></tr>
<tr><th id="619">619</th><td>  <a class="typedef" href="../sanitizer_common/sanitizer_internal_defs.h.html#__sanitizer::s32" title='__sanitizer::s32' data-type='int' data-ref="__sanitizer::s32" data-ref-filename="__sanitizer..s32">s32</a> <dfn class="local col7 decl" id="167CurrentStatus" title='CurrentStatus' data-type='__sanitizer::s32' data-ref="167CurrentStatus" data-ref-filename="167CurrentStatus">CurrentStatus</dfn> = <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogInitStatus" title='XRayLogInitStatus' data-ref="XRayLogInitStatus" data-ref-filename="XRayLogInitStatus">XRayLogInitStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_UNINITIALIZED" title='XRAY_LOG_UNINITIALIZED' data-ref="XRAY_LOG_UNINITIALIZED" data-ref-filename="XRAY_LOG_UNINITIALIZED">XRAY_LOG_UNINITIALIZED</a>;</td></tr>
<tr><th id="620">620</th><td>  <b>if</b> (!<a class="ref fn" href="../sanitizer_common/sanitizer_atomic_clang.h.html#__sanitizer::atomic_compare_exchange_strong" title='__sanitizer::atomic_compare_exchange_strong' data-ref="__sanitizer::atomic_compare_exchange_strong" data-ref-filename="__sanitizer..atomic_compare_exchange_strong">atomic_compare_exchange_strong</a>(&amp;<a class="tu ref" href="#__xray::LoggingStatus" title='__xray::LoggingStatus' data-use='a' data-ref="__xray::LoggingStatus" data-ref-filename="__xray..LoggingStatus">LoggingStatus</a>, &amp;<a class="local col7 ref" href="#167CurrentStatus" title='CurrentStatus' data-ref="167CurrentStatus" data-ref-filename="167CurrentStatus">CurrentStatus</a>,</td></tr>
<tr><th id="621">621</th><td>                                      <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogInitStatus" title='XRayLogInitStatus' data-ref="XRayLogInitStatus" data-ref-filename="XRayLogInitStatus">XRayLogInitStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_INITIALIZING" title='XRAY_LOG_INITIALIZING' data-ref="XRAY_LOG_INITIALIZING" data-ref-filename="XRAY_LOG_INITIALIZING">XRAY_LOG_INITIALIZING</a>,</td></tr>
<tr><th id="622">622</th><td>                                      <a class="enum" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::memory_order_release" title='__sanitizer::memory_order_release' data-ref="__sanitizer::memory_order_release" data-ref-filename="__sanitizer..memory_order_release">memory_order_release</a>)) {</td></tr>
<tr><th id="623">623</th><td>    <b>if</b> (<a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Verbosity" title='__sanitizer::Verbosity' data-ref="__sanitizer::Verbosity" data-ref-filename="__sanitizer..Verbosity">Verbosity</a>())</td></tr>
<tr><th id="624">624</th><td>      <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Report" title='__sanitizer::Report' data-ref="__sanitizer::Report" data-ref-filename="__sanitizer..Report">Report</a>(<q>"Cannot initialize already initialized implementation.\n"</q>);</td></tr>
<tr><th id="625">625</th><td>    <b>return</b> <b>static_cast</b>&lt;<a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogInitStatus" title='XRayLogInitStatus' data-ref="XRayLogInitStatus" data-ref-filename="XRayLogInitStatus">XRayLogInitStatus</a>&gt;(<a class="local col7 ref" href="#167CurrentStatus" title='CurrentStatus' data-ref="167CurrentStatus" data-ref-filename="167CurrentStatus">CurrentStatus</a>);</td></tr>
<tr><th id="626">626</th><td>  }</td></tr>
<tr><th id="627">627</th><td></td></tr>
<tr><th id="628">628</th><td>  <b>if</b> (<a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Verbosity" title='__sanitizer::Verbosity' data-ref="__sanitizer::Verbosity" data-ref-filename="__sanitizer..Verbosity">Verbosity</a>())</td></tr>
<tr><th id="629">629</th><td>    <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Report" title='__sanitizer::Report' data-ref="__sanitizer::Report" data-ref-filename="__sanitizer..Report">Report</a>(<q>"Initializing FDR mode with options: %s\n"</q>,</td></tr>
<tr><th id="630">630</th><td>           <b>static_cast</b>&lt;<em>const</em> <em>char</em> *&gt;(<a class="local col5 ref" href="#165Options" title='Options' data-ref="165Options" data-ref-filename="165Options">Options</a>));</td></tr>
<tr><th id="631">631</th><td></td></tr>
<tr><th id="632">632</th><td>  <i>// TODO: Factor out the flags specific to the FDR mode implementation. For</i></td></tr>
<tr><th id="633">633</th><td><i>  // now, use the global/single definition of the flags, since the FDR mode</i></td></tr>
<tr><th id="634">634</th><td><i>  // flags are already defined there.</i></td></tr>
<tr><th id="635">635</th><td>  <a class="type" href="../sanitizer_common/sanitizer_flag_parser.h.html#__sanitizer::FlagParser" title='__sanitizer::FlagParser' data-ref="__sanitizer::FlagParser" data-ref-filename="__sanitizer..FlagParser">FlagParser</a> <a class="ref fn fake" href="../sanitizer_common/sanitizer_flag_parser.h.html#__sanitizer::FlagParser::FlagParser" title='__sanitizer::FlagParser::FlagParser' data-ref="__sanitizer::FlagParser::FlagParser" data-ref-filename="__sanitizer..FlagParser..FlagParser"></a><dfn class="local col8 decl" id="168FDRParser" title='FDRParser' data-type='__sanitizer::FlagParser' data-ref="168FDRParser" data-ref-filename="168FDRParser">FDRParser</dfn>;</td></tr>
<tr><th id="636">636</th><td>  <a class="type" href="xray_fdr_flags.h.html#__xray::FDRFlags" title='__xray::FDRFlags' data-ref="__xray::FDRFlags" data-ref-filename="__xray..FDRFlags">FDRFlags</a> <a class="ref fn fake" href="xray_fdr_flags.h.html#22" title='__xray::FDRFlags::FDRFlags' data-ref="__xray::FDRFlags::FDRFlags" data-ref-filename="__xray..FDRFlags..FDRFlags"></a><dfn class="local col9 decl" id="169FDRFlags" title='FDRFlags' data-type='__xray::FDRFlags' data-ref="169FDRFlags" data-ref-filename="169FDRFlags">FDRFlags</dfn>;</td></tr>
<tr><th id="637">637</th><td>  <a class="ref fn" href="xray_fdr_flags.h.html#__xray::registerXRayFDRFlags" title='__xray::registerXRayFDRFlags' data-ref="__xray::registerXRayFDRFlags" data-ref-filename="__xray..registerXRayFDRFlags">registerXRayFDRFlags</a>(&amp;<a class="local col8 ref" href="#168FDRParser" title='FDRParser' data-ref="168FDRParser" data-ref-filename="168FDRParser">FDRParser</a>, &amp;<a class="local col9 ref" href="#169FDRFlags" title='FDRFlags' data-ref="169FDRFlags" data-ref-filename="169FDRFlags">FDRFlags</a>);</td></tr>
<tr><th id="638">638</th><td>  <a class="local col9 ref" href="#169FDRFlags" title='FDRFlags' data-ref="169FDRFlags" data-ref-filename="169FDRFlags">FDRFlags</a>.<a class="ref fn" href="xray_fdr_flags.h.html#__xray::FDRFlags::setDefaults" title='__xray::FDRFlags::setDefaults' data-ref="__xray::FDRFlags::setDefaults" data-ref-filename="__xray..FDRFlags..setDefaults">setDefaults</a>();</td></tr>
<tr><th id="639">639</th><td></td></tr>
<tr><th id="640">640</th><td>  <i>// Override first from the general XRAY_DEFAULT_OPTIONS compiler-provided</i></td></tr>
<tr><th id="641">641</th><td><i>  // options until we migrate everyone to use the XRAY_FDR_OPTIONS</i></td></tr>
<tr><th id="642">642</th><td><i>  // compiler-provided options.</i></td></tr>
<tr><th id="643">643</th><td>  <a class="local col8 ref" href="#168FDRParser" title='FDRParser' data-ref="168FDRParser" data-ref-filename="168FDRParser">FDRParser</a>.<a class="ref fn" href="../sanitizer_common/sanitizer_flag_parser.h.html#__sanitizer::FlagParser::ParseString" title='__sanitizer::FlagParser::ParseString' data-ref="__sanitizer::FlagParser::ParseString" data-ref-filename="__sanitizer..FlagParser..ParseString">ParseString</a>(<a class="ref fn" href="xray_flags.h.html#__xray::useCompilerDefinedFlags" title='__xray::useCompilerDefinedFlags' data-ref="__xray::useCompilerDefinedFlags" data-ref-filename="__xray..useCompilerDefinedFlags">useCompilerDefinedFlags</a>());</td></tr>
<tr><th id="644">644</th><td>  <a class="local col8 ref" href="#168FDRParser" title='FDRParser' data-ref="168FDRParser" data-ref-filename="168FDRParser">FDRParser</a>.<a class="ref fn" href="../sanitizer_common/sanitizer_flag_parser.h.html#__sanitizer::FlagParser::ParseString" title='__sanitizer::FlagParser::ParseString' data-ref="__sanitizer::FlagParser::ParseString" data-ref-filename="__sanitizer..FlagParser..ParseString">ParseString</a>(<a class="ref fn" href="xray_fdr_flags.h.html#__xray::useCompilerDefinedFDRFlags" title='__xray::useCompilerDefinedFDRFlags' data-ref="__xray::useCompilerDefinedFDRFlags" data-ref-filename="__xray..useCompilerDefinedFDRFlags">useCompilerDefinedFDRFlags</a>());</td></tr>
<tr><th id="645">645</th><td>  <em>auto</em> *<dfn class="local col0 decl" id="170EnvOpts" title='EnvOpts' data-type='const char *' data-ref="170EnvOpts" data-ref-filename="170EnvOpts">EnvOpts</dfn> = <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::GetEnv" title='__sanitizer::GetEnv' data-ref="__sanitizer::GetEnv" data-ref-filename="__sanitizer..GetEnv">GetEnv</a>(<q>"XRAY_FDR_OPTIONS"</q>);</td></tr>
<tr><th id="646">646</th><td>  <b>if</b> (<a class="local col0 ref" href="#170EnvOpts" title='EnvOpts' data-ref="170EnvOpts" data-ref-filename="170EnvOpts">EnvOpts</a> == <b>nullptr</b>)</td></tr>
<tr><th id="647">647</th><td>    <a class="local col0 ref" href="#170EnvOpts" title='EnvOpts' data-ref="170EnvOpts" data-ref-filename="170EnvOpts">EnvOpts</a> = <q>""</q>;</td></tr>
<tr><th id="648">648</th><td>  <a class="local col8 ref" href="#168FDRParser" title='FDRParser' data-ref="168FDRParser" data-ref-filename="168FDRParser">FDRParser</a>.<a class="ref fn" href="../sanitizer_common/sanitizer_flag_parser.h.html#__sanitizer::FlagParser::ParseString" title='__sanitizer::FlagParser::ParseString' data-ref="__sanitizer::FlagParser::ParseString" data-ref-filename="__sanitizer..FlagParser..ParseString">ParseString</a>(<a class="local col0 ref" href="#170EnvOpts" title='EnvOpts' data-ref="170EnvOpts" data-ref-filename="170EnvOpts">EnvOpts</a>);</td></tr>
<tr><th id="649">649</th><td></td></tr>
<tr><th id="650">650</th><td>  <i>// FIXME: Remove this when we fully remove the deprecated flags.</i></td></tr>
<tr><th id="651">651</th><td>  <b>if</b> (<a class="ref fn" href="../sanitizer_common/sanitizer_libc.h.html#__sanitizer::internal_strlen" title='__sanitizer::internal_strlen' data-ref="__sanitizer::internal_strlen" data-ref-filename="__sanitizer..internal_strlen">internal_strlen</a>(<a class="local col0 ref" href="#170EnvOpts" title='EnvOpts' data-ref="170EnvOpts" data-ref-filename="170EnvOpts">EnvOpts</a>) == <var>0</var>) {</td></tr>
<tr><th id="652">652</th><td>    <a class="local col9 ref" href="#169FDRFlags" title='FDRFlags' data-ref="169FDRFlags" data-ref-filename="169FDRFlags">FDRFlags</a>.<a class="ref field" href="xray_fdr_flags.inc.html#17" title='__xray::FDRFlags::func_duration_threshold_us' data-ref="__xray::FDRFlags::func_duration_threshold_us" data-ref-filename="__xray..FDRFlags..func_duration_threshold_us">func_duration_threshold_us</a> =</td></tr>
<tr><th id="653">653</th><td>        <a class="ref fn" href="xray_flags.h.html#__xray::flags" title='__xray::flags' data-ref="__xray::flags" data-ref-filename="__xray..flags">flags</a>()-&gt;<a class="ref field" href="xray_flags.inc.html#41" title='__xray::Flags::xray_fdr_log_func_duration_threshold_us' data-ref="__xray::Flags::xray_fdr_log_func_duration_threshold_us" data-ref-filename="__xray..Flags..xray_fdr_log_func_duration_threshold_us">xray_fdr_log_func_duration_threshold_us</a>;</td></tr>
<tr><th id="654">654</th><td>    <a class="local col9 ref" href="#169FDRFlags" title='FDRFlags' data-ref="169FDRFlags" data-ref-filename="169FDRFlags">FDRFlags</a>.<a class="ref field" href="xray_fdr_flags.inc.html#20" title='__xray::FDRFlags::grace_period_ms' data-ref="__xray::FDRFlags::grace_period_ms" data-ref-filename="__xray..FDRFlags..grace_period_ms">grace_period_ms</a> = <a class="ref fn" href="xray_flags.h.html#__xray::flags" title='__xray::flags' data-ref="__xray::flags" data-ref-filename="__xray..flags">flags</a>()-&gt;<a class="ref field" href="xray_flags.inc.html#47" title='__xray::Flags::xray_fdr_log_grace_period_ms' data-ref="__xray::Flags::xray_fdr_log_grace_period_ms" data-ref-filename="__xray..Flags..xray_fdr_log_grace_period_ms">xray_fdr_log_grace_period_ms</a>;</td></tr>
<tr><th id="655">655</th><td>  }</td></tr>
<tr><th id="656">656</th><td></td></tr>
<tr><th id="657">657</th><td>  <i>// The provided options should always override the compiler-provided and</i></td></tr>
<tr><th id="658">658</th><td><i>  // environment-variable defined options.</i></td></tr>
<tr><th id="659">659</th><td>  <a class="local col8 ref" href="#168FDRParser" title='FDRParser' data-ref="168FDRParser" data-ref-filename="168FDRParser">FDRParser</a>.<a class="ref fn" href="../sanitizer_common/sanitizer_flag_parser.h.html#__sanitizer::FlagParser::ParseString" title='__sanitizer::FlagParser::ParseString' data-ref="__sanitizer::FlagParser::ParseString" data-ref-filename="__sanitizer..FlagParser..ParseString">ParseString</a>(<b>static_cast</b>&lt;<em>const</em> <em>char</em> *&gt;(<a class="local col5 ref" href="#165Options" title='Options' data-ref="165Options" data-ref-filename="165Options">Options</a>));</td></tr>
<tr><th id="660">660</th><td>  *<a class="ref fn" href="xray_fdr_flags.h.html#__xray::fdrFlags" title='__xray::fdrFlags' data-ref="__xray::fdrFlags" data-ref-filename="__xray..fdrFlags">fdrFlags</a>() <a class="ref fn" href="xray_fdr_flags.h.html#22" title='__xray::FDRFlags::operator=' data-ref="__xray::FDRFlags::operator=" data-ref-filename="__xray..FDRFlags..operator=">=</a> <a class="local col9 ref" href="#169FDRFlags" title='FDRFlags' data-ref="169FDRFlags" data-ref-filename="169FDRFlags">FDRFlags</a>;</td></tr>
<tr><th id="661">661</th><td>  <em>auto</em> <dfn class="local col1 decl" id="171BufferSize" title='BufferSize' data-type='int' data-ref="171BufferSize" data-ref-filename="171BufferSize">BufferSize</dfn> = <a class="local col9 ref" href="#169FDRFlags" title='FDRFlags' data-ref="169FDRFlags" data-ref-filename="169FDRFlags">FDRFlags</a>.<a class="ref field" href="xray_fdr_flags.inc.html#24" title='__xray::FDRFlags::buffer_size' data-ref="__xray::FDRFlags::buffer_size" data-ref-filename="__xray..FDRFlags..buffer_size">buffer_size</a>;</td></tr>
<tr><th id="662">662</th><td>  <em>auto</em> <dfn class="local col2 decl" id="172BufferMax" title='BufferMax' data-type='int' data-ref="172BufferMax" data-ref-filename="172BufferMax">BufferMax</dfn> = <a class="local col9 ref" href="#169FDRFlags" title='FDRFlags' data-ref="169FDRFlags" data-ref-filename="169FDRFlags">FDRFlags</a>.<a class="ref field" href="xray_fdr_flags.inc.html#26" title='__xray::FDRFlags::buffer_max' data-ref="__xray::FDRFlags::buffer_max" data-ref-filename="__xray..FDRFlags..buffer_max">buffer_max</a>;</td></tr>
<tr><th id="663">663</th><td></td></tr>
<tr><th id="664">664</th><td>  <b>if</b> (<a class="tu ref" href="#__xray::BQ" title='__xray::BQ' data-use='r' data-ref="__xray::BQ" data-ref-filename="__xray..BQ">BQ</a> == <b>nullptr</b>) {</td></tr>
<tr><th id="665">665</th><td>    <em>bool</em> <dfn class="local col3 decl" id="173Success" title='Success' data-type='bool' data-ref="173Success" data-ref-filename="173Success">Success</dfn> = <b>false</b>;</td></tr>
<tr><th id="666">666</th><td>    <a class="tu ref" href="#__xray::BQ" title='__xray::BQ' data-use='w' data-ref="__xray::BQ" data-ref-filename="__xray..BQ">BQ</a> = <b>reinterpret_cast</b>&lt;<a class="type" href="xray_buffer_queue.h.html#__xray::BufferQueue" title='__xray::BufferQueue' data-ref="__xray::BufferQueue" data-ref-filename="__xray..BufferQueue">BufferQueue</a> *&gt;(&amp;<a class="tu ref" href="#__xray::BufferQueueStorage" title='__xray::BufferQueueStorage' data-use='a' data-ref="__xray::BufferQueueStorage" data-ref-filename="__xray..BufferQueueStorage">BufferQueueStorage</a>);</td></tr>
<tr><th id="667">667</th><td>    <b>new</b> (<a class="tu ref" href="#__xray::BQ" title='__xray::BQ' data-use='r' data-ref="__xray::BQ" data-ref-filename="__xray..BQ">BQ</a>) <a class="type" href="xray_buffer_queue.h.html#__xray::BufferQueue" title='__xray::BufferQueue' data-ref="__xray::BufferQueue" data-ref-filename="__xray..BufferQueue">BufferQueue</a><a class="ref fn" href="xray_buffer_queue.h.html#__xray::BufferQueue::BufferQueue" title='__xray::BufferQueue::BufferQueue' data-ref="__xray::BufferQueue::BufferQueue" data-ref-filename="__xray..BufferQueue..BufferQueue">(</a><a class="local col1 ref" href="#171BufferSize" title='BufferSize' data-ref="171BufferSize" data-ref-filename="171BufferSize">BufferSize</a>, <a class="local col2 ref" href="#172BufferMax" title='BufferMax' data-ref="172BufferMax" data-ref-filename="172BufferMax">BufferMax</a>, <a class="local col3 ref" href="#173Success" title='Success' data-ref="173Success" data-ref-filename="173Success">Success</a>);</td></tr>
<tr><th id="668">668</th><td>    <b>if</b> (!<a class="local col3 ref" href="#173Success" title='Success' data-ref="173Success" data-ref-filename="173Success">Success</a>) {</td></tr>
<tr><th id="669">669</th><td>      <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Report" title='__sanitizer::Report' data-ref="__sanitizer::Report" data-ref-filename="__sanitizer..Report">Report</a>(<q>"BufferQueue init failed.\n"</q>);</td></tr>
<tr><th id="670">670</th><td>      <b>return</b> <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogInitStatus" title='XRayLogInitStatus' data-ref="XRayLogInitStatus" data-ref-filename="XRayLogInitStatus">XRayLogInitStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_UNINITIALIZED" title='XRAY_LOG_UNINITIALIZED' data-ref="XRAY_LOG_UNINITIALIZED" data-ref-filename="XRAY_LOG_UNINITIALIZED">XRAY_LOG_UNINITIALIZED</a>;</td></tr>
<tr><th id="671">671</th><td>    }</td></tr>
<tr><th id="672">672</th><td>  } <b>else</b> {</td></tr>
<tr><th id="673">673</th><td>    <b>if</b> (<a class="tu ref" href="#__xray::BQ" title='__xray::BQ' data-use='r' data-ref="__xray::BQ" data-ref-filename="__xray..BQ">BQ</a>-&gt;<a class="ref fn" href="xray_buffer_queue.h.html#__xray::BufferQueue::init" title='__xray::BufferQueue::init' data-ref="__xray::BufferQueue::init" data-ref-filename="__xray..BufferQueue..init">init</a>(<a class="local col1 ref" href="#171BufferSize" title='BufferSize' data-ref="171BufferSize" data-ref-filename="171BufferSize">BufferSize</a>, <a class="local col2 ref" href="#172BufferMax" title='BufferMax' data-ref="172BufferMax" data-ref-filename="172BufferMax">BufferMax</a>) != <a class="type" href="xray_buffer_queue.h.html#__xray::BufferQueue" title='__xray::BufferQueue' data-ref="__xray::BufferQueue" data-ref-filename="__xray..BufferQueue">BufferQueue</a>::<a class="type" href="xray_buffer_queue.h.html#__xray::BufferQueue::ErrorCode" title='__xray::BufferQueue::ErrorCode' data-ref="__xray::BufferQueue::ErrorCode" data-ref-filename="__xray..BufferQueue..ErrorCode">ErrorCode</a>::<a class="enum" href="xray_buffer_queue.h.html#__xray::BufferQueue::ErrorCode::Ok" title='__xray::BufferQueue::ErrorCode::Ok' data-ref="__xray::BufferQueue::ErrorCode::Ok" data-ref-filename="__xray..BufferQueue..ErrorCode..Ok">Ok</a>) {</td></tr>
<tr><th id="674">674</th><td>      <b>if</b> (<a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Verbosity" title='__sanitizer::Verbosity' data-ref="__sanitizer::Verbosity" data-ref-filename="__sanitizer..Verbosity">Verbosity</a>())</td></tr>
<tr><th id="675">675</th><td>        <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Report" title='__sanitizer::Report' data-ref="__sanitizer::Report" data-ref-filename="__sanitizer..Report">Report</a>(<q>"Failed to re-initialize global buffer queue. Init failed.\n"</q>);</td></tr>
<tr><th id="676">676</th><td>      <b>return</b> <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogInitStatus" title='XRayLogInitStatus' data-ref="XRayLogInitStatus" data-ref-filename="XRayLogInitStatus">XRayLogInitStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_UNINITIALIZED" title='XRAY_LOG_UNINITIALIZED' data-ref="XRAY_LOG_UNINITIALIZED" data-ref-filename="XRAY_LOG_UNINITIALIZED">XRAY_LOG_UNINITIALIZED</a>;</td></tr>
<tr><th id="677">677</th><td>    }</td></tr>
<tr><th id="678">678</th><td>  }</td></tr>
<tr><th id="679">679</th><td></td></tr>
<tr><th id="680">680</th><td>  <em>static</em> <a class="typedef" href="../../../../include/bits/pthreadtypes.h.html#pthread_once_t" title='pthread_once_t' data-type='int' data-ref="pthread_once_t" data-ref-filename="pthread_once_t">pthread_once_t</a> <dfn class="local col4 decl" id="174OnceInit" title='OnceInit' data-type='pthread_once_t' data-ref="174OnceInit" data-ref-filename="174OnceInit">OnceInit</dfn> = <a class="macro" href="../../../../include/pthread.h.html#182" title="0" data-ref="_M/PTHREAD_ONCE_INIT">PTHREAD_ONCE_INIT</a>;</td></tr>
<tr><th id="681">681</th><td>  <a class="ref fn" href="../../../../include/pthread.h.html#pthread_once" title='pthread_once' data-ref="pthread_once" data-ref-filename="pthread_once">pthread_once</a>(</td></tr>
<tr><th id="682">682</th><td>      &amp;<a class="local col4 ref" href="#174OnceInit" title='OnceInit' data-ref="174OnceInit" data-ref-filename="174OnceInit">OnceInit</a>, +<a class="tu ref fn fake" href="#682" title='__xray::fdrLoggingInit(size_t, size_t, void *, size_t)::(anonymous class)::operator void (*)()' data-use='c' data-ref="__xray::fdrLoggingInit(size_t,size_t,void*,size_t)::(anonymousclass)::operatorvoid(*)()" data-ref-filename="__xray..fdrLoggingInit(size_t,size_t,void*,size_t)..(anonymousclass)..operatorvoid(*)()"></a>[] {</td></tr>
<tr><th id="683">683</th><td>        <a class="ref fn" href="../sanitizer_common/sanitizer_atomic_clang_x86.h.html#__sanitizer::atomic_store" title='__sanitizer::atomic_store' data-ref="__sanitizer::atomic_store" data-ref-filename="__sanitizer..atomic_store">atomic_store</a>(&amp;<a class="tu ref" href="#__xray::TicksPerSec" title='__xray::TicksPerSec' data-use='a' data-ref="__xray::TicksPerSec" data-ref-filename="__xray..TicksPerSec">TicksPerSec</a>,</td></tr>
<tr><th id="684">684</th><td>                     <a class="ref fn" href="xray_x86_64.inc.html#__xray::probeRequiredCPUFeatures" title='__xray::probeRequiredCPUFeatures' data-ref="__xray::probeRequiredCPUFeatures" data-ref-filename="__xray..probeRequiredCPUFeatures">probeRequiredCPUFeatures</a>() ? <a class="ref fn" href="xray_x86_64.inc.html#__xray::getTSCFrequency" title='__xray::getTSCFrequency' data-ref="__xray::getTSCFrequency" data-ref-filename="__xray..getTSCFrequency">getTSCFrequency</a>()</td></tr>
<tr><th id="685">685</th><td>                                                : <span class="namespace">__xray::</span><a class="ref" href="xray_tsc.h.html#__xray::NanosecondsPerSecond" title='__xray::NanosecondsPerSecond' data-ref="__xray::NanosecondsPerSecond" data-ref-filename="__xray..NanosecondsPerSecond">NanosecondsPerSecond</a>,</td></tr>
<tr><th id="686">686</th><td>                     <a class="enum" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::memory_order_release" title='__sanitizer::memory_order_release' data-ref="__sanitizer::memory_order_release" data-ref-filename="__sanitizer..memory_order_release">memory_order_release</a>);</td></tr>
<tr><th id="687">687</th><td>        <a class="ref fn" href="../../../../include/pthread.h.html#pthread_key_create" title='pthread_key_create' data-ref="pthread_key_create" data-ref-filename="pthread_key_create">pthread_key_create</a>(</td></tr>
<tr><th id="688">688</th><td>            &amp;<a class="tu ref" href="#__xray::Key" title='__xray::Key' data-use='a' data-ref="__xray::Key" data-ref-filename="__xray..Key">Key</a>, +<a class="tu ref fn fake" href="#688" title='__xray::fdrLoggingInit(size_t, size_t, void *, size_t)::(anonymous class)::operator()()::(anonymous class)::operator void (*)(void *)' data-use='c' data-ref="__xray::fdrLoggingInit(size_t,size_t,void*,size_t)::(anonymousclass)::operator()()::(anonymousclass)::operatorvoid(*)(void*)" data-ref-filename="__xray..fdrLoggingInit(size_t,size_t,void*,size_t)..(anonymousclass)..operator()()..(anonymousclass)..operatorvoid(*)(void*)"></a>[](<em>void</em> *<dfn class="local col5 decl" id="175TLDPtr" title='TLDPtr' data-type='void *' data-ref="175TLDPtr" data-ref-filename="175TLDPtr">TLDPtr</dfn>) {</td></tr>
<tr><th id="689">689</th><td>              <b>if</b> (<a class="local col5 ref" href="#175TLDPtr" title='TLDPtr' data-ref="175TLDPtr" data-ref-filename="175TLDPtr">TLDPtr</a> == <b>nullptr</b>)</td></tr>
<tr><th id="690">690</th><td>                <b>return</b>;</td></tr>
<tr><th id="691">691</th><td>              <em>auto</em> &amp;<dfn class="local col6 decl" id="176TLD" title='TLD' data-type='__xray::(anonymous namespace)::ThreadLocalData &amp;' data-ref="176TLD" data-ref-filename="176TLD">TLD</dfn> = *<b>reinterpret_cast</b>&lt;<a class="tu type" href="#__xray::(anonymousnamespace)::ThreadLocalData" title='__xray::(anonymous namespace)::ThreadLocalData' data-ref="__xray::(anonymousnamespace)::ThreadLocalData" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData">ThreadLocalData</a> *&gt;(<a class="local col5 ref" href="#175TLDPtr" title='TLDPtr' data-ref="175TLDPtr" data-ref-filename="175TLDPtr">TLDPtr</a>);</td></tr>
<tr><th id="692">692</th><td>              <b>if</b> (<a class="local col6 ref" href="#176TLD" title='TLD' data-ref="176TLD" data-ref-filename="176TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::BQ" title='__xray::(anonymous namespace)::ThreadLocalData::BQ' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::BQ" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..BQ">BQ</a> == <b>nullptr</b>)</td></tr>
<tr><th id="693">693</th><td>                <b>return</b>;</td></tr>
<tr><th id="694">694</th><td>              <b>if</b> (<a class="local col6 ref" href="#176TLD" title='TLD' data-ref="176TLD" data-ref-filename="176TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Buffer" title='__xray::(anonymous namespace)::ThreadLocalData::Buffer' data-use='m' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Buffer" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Buffer">Buffer</a>.<a class="ref field" href="xray_buffer_queue.h.html#__xray::BufferQueue::Buffer::Data" title='__xray::BufferQueue::Buffer::Data' data-ref="__xray::BufferQueue::Buffer::Data" data-ref-filename="__xray..BufferQueue..Buffer..Data">Data</a> == <b>nullptr</b>)</td></tr>
<tr><th id="695">695</th><td>                <b>return</b>;</td></tr>
<tr><th id="696">696</th><td>              <em>auto</em> <dfn class="local col7 decl" id="177EC" title='EC' data-type='__xray::BufferQueue::ErrorCode' data-ref="177EC" data-ref-filename="177EC">EC</dfn> = <a class="local col6 ref" href="#176TLD" title='TLD' data-ref="176TLD" data-ref-filename="176TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::BQ" title='__xray::(anonymous namespace)::ThreadLocalData::BQ' data-use='r' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::BQ" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..BQ">BQ</a>-&gt;<a class="ref fn" href="xray_buffer_queue.h.html#__xray::BufferQueue::releaseBuffer" title='__xray::BufferQueue::releaseBuffer' data-ref="__xray::BufferQueue::releaseBuffer" data-ref-filename="__xray..BufferQueue..releaseBuffer">releaseBuffer</a>(<span class='refarg'><a class="local col6 ref" href="#176TLD" title='TLD' data-ref="176TLD" data-ref-filename="176TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Buffer" title='__xray::(anonymous namespace)::ThreadLocalData::Buffer' data-use='a' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Buffer" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Buffer">Buffer</a></span>);</td></tr>
<tr><th id="697">697</th><td>              <b>if</b> (<a class="local col7 ref" href="#177EC" title='EC' data-ref="177EC" data-ref-filename="177EC">EC</a> != <a class="type" href="xray_buffer_queue.h.html#__xray::BufferQueue" title='__xray::BufferQueue' data-ref="__xray::BufferQueue" data-ref-filename="__xray..BufferQueue">BufferQueue</a>::<a class="type" href="xray_buffer_queue.h.html#__xray::BufferQueue::ErrorCode" title='__xray::BufferQueue::ErrorCode' data-ref="__xray::BufferQueue::ErrorCode" data-ref-filename="__xray..BufferQueue..ErrorCode">ErrorCode</a>::<a class="enum" href="xray_buffer_queue.h.html#__xray::BufferQueue::ErrorCode::Ok" title='__xray::BufferQueue::ErrorCode::Ok' data-ref="__xray::BufferQueue::ErrorCode::Ok" data-ref-filename="__xray..BufferQueue..ErrorCode..Ok">Ok</a>)</td></tr>
<tr><th id="698">698</th><td>                <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Report" title='__sanitizer::Report' data-ref="__sanitizer::Report" data-ref-filename="__sanitizer..Report">Report</a>(<q>"At thread exit, failed to release buffer at %p; "</q></td></tr>
<tr><th id="699">699</th><td>                       <q>"error=%s\n"</q>,</td></tr>
<tr><th id="700">700</th><td>                       <a class="local col6 ref" href="#176TLD" title='TLD' data-ref="176TLD" data-ref-filename="176TLD">TLD</a>.<a class="tu ref field" href="#__xray::(anonymousnamespace)::ThreadLocalData::Buffer" title='__xray::(anonymous namespace)::ThreadLocalData::Buffer' data-use='m' data-ref="__xray::(anonymousnamespace)::ThreadLocalData::Buffer" data-ref-filename="__xray..(anonymousnamespace)..ThreadLocalData..Buffer">Buffer</a>.<a class="ref field" href="xray_buffer_queue.h.html#__xray::BufferQueue::Buffer::Data" title='__xray::BufferQueue::Buffer::Data' data-ref="__xray::BufferQueue::Buffer::Data" data-ref-filename="__xray..BufferQueue..Buffer..Data">Data</a>, <a class="type" href="xray_buffer_queue.h.html#__xray::BufferQueue" title='__xray::BufferQueue' data-ref="__xray::BufferQueue" data-ref-filename="__xray..BufferQueue">BufferQueue</a>::<a class="ref fn" href="xray_buffer_queue.h.html#__xray::BufferQueue::getErrorString" title='__xray::BufferQueue::getErrorString' data-ref="__xray::BufferQueue::getErrorString" data-ref-filename="__xray..BufferQueue..getErrorString">getErrorString</a>(<a class="local col7 ref" href="#177EC" title='EC' data-ref="177EC" data-ref-filename="177EC">EC</a>));</td></tr>
<tr><th id="701">701</th><td>            });</td></tr>
<tr><th id="702">702</th><td>      });</td></tr>
<tr><th id="703">703</th><td></td></tr>
<tr><th id="704">704</th><td>  <a class="ref fn" href="../sanitizer_common/sanitizer_atomic_clang_x86.h.html#__sanitizer::atomic_store" title='__sanitizer::atomic_store' data-ref="__sanitizer::atomic_store" data-ref-filename="__sanitizer..atomic_store">atomic_store</a>(&amp;<a class="tu ref" href="#__xray::ThresholdTicks" title='__xray::ThresholdTicks' data-use='a' data-ref="__xray::ThresholdTicks" data-ref-filename="__xray..ThresholdTicks">ThresholdTicks</a>,</td></tr>
<tr><th id="705">705</th><td>               <a class="ref fn" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::atomic_load_relaxed" title='__sanitizer::atomic_load_relaxed' data-ref="__sanitizer::atomic_load_relaxed" data-ref-filename="__sanitizer..atomic_load_relaxed">atomic_load_relaxed</a>(&amp;<a class="tu ref" href="#__xray::TicksPerSec" title='__xray::TicksPerSec' data-use='a' data-ref="__xray::TicksPerSec" data-ref-filename="__xray..TicksPerSec">TicksPerSec</a>) *</td></tr>
<tr><th id="706">706</th><td>                   <a class="ref fn" href="xray_fdr_flags.h.html#__xray::fdrFlags" title='__xray::fdrFlags' data-ref="__xray::fdrFlags" data-ref-filename="__xray..fdrFlags">fdrFlags</a>()-&gt;<a class="ref field" href="xray_fdr_flags.inc.html#17" title='__xray::FDRFlags::func_duration_threshold_us' data-ref="__xray::FDRFlags::func_duration_threshold_us" data-ref-filename="__xray..FDRFlags..func_duration_threshold_us">func_duration_threshold_us</a> / <var>1000000</var>,</td></tr>
<tr><th id="707">707</th><td>               <a class="enum" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::memory_order_release" title='__sanitizer::memory_order_release' data-ref="__sanitizer::memory_order_release" data-ref-filename="__sanitizer..memory_order_release">memory_order_release</a>);</td></tr>
<tr><th id="708">708</th><td>  <i>// Arg1 handler should go in first to avoid concurrent code accidentally</i></td></tr>
<tr><th id="709">709</th><td><i>  // falling back to arg0 when it should have ran arg1.</i></td></tr>
<tr><th id="710">710</th><td>  <a class="ref fn" href="../../include/xray/xray_interface.h.html#__xray_set_handler_arg1" title='__xray_set_handler_arg1' data-ref="__xray_set_handler_arg1" data-ref-filename="__xray_set_handler_arg1">__xray_set_handler_arg1</a>(<a class="ref fn" href="#__xray::fdrLoggingHandleArg1" title='__xray::fdrLoggingHandleArg1' data-ref="__xray::fdrLoggingHandleArg1" data-ref-filename="__xray..fdrLoggingHandleArg1">fdrLoggingHandleArg1</a>);</td></tr>
<tr><th id="711">711</th><td>  <i>// Install the actual handleArg0 handler after initialising the buffers.</i></td></tr>
<tr><th id="712">712</th><td>  <a class="ref fn" href="../../include/xray/xray_interface.h.html#__xray_set_handler" title='__xray_set_handler' data-ref="__xray_set_handler" data-ref-filename="__xray_set_handler">__xray_set_handler</a>(<a class="ref fn" href="#__xray::fdrLoggingHandleArg0" title='__xray::fdrLoggingHandleArg0' data-ref="__xray::fdrLoggingHandleArg0" data-ref-filename="__xray..fdrLoggingHandleArg0">fdrLoggingHandleArg0</a>);</td></tr>
<tr><th id="713">713</th><td>  <a class="ref fn" href="../../include/xray/xray_interface.h.html#__xray_set_customevent_handler" title='__xray_set_customevent_handler' data-ref="__xray_set_customevent_handler" data-ref-filename="__xray_set_customevent_handler">__xray_set_customevent_handler</a>(<a class="ref fn" href="#__xray::fdrLoggingHandleCustomEvent" title='__xray::fdrLoggingHandleCustomEvent' data-ref="__xray::fdrLoggingHandleCustomEvent" data-ref-filename="__xray..fdrLoggingHandleCustomEvent">fdrLoggingHandleCustomEvent</a>);</td></tr>
<tr><th id="714">714</th><td>  <a class="ref fn" href="../../include/xray/xray_interface.h.html#__xray_set_typedevent_handler" title='__xray_set_typedevent_handler' data-ref="__xray_set_typedevent_handler" data-ref-filename="__xray_set_typedevent_handler">__xray_set_typedevent_handler</a>(<a class="ref fn" href="#__xray::fdrLoggingHandleTypedEvent" title='__xray::fdrLoggingHandleTypedEvent' data-ref="__xray::fdrLoggingHandleTypedEvent" data-ref-filename="__xray..fdrLoggingHandleTypedEvent">fdrLoggingHandleTypedEvent</a>);</td></tr>
<tr><th id="715">715</th><td></td></tr>
<tr><th id="716">716</th><td>  <i>// Install the buffer iterator implementation.</i></td></tr>
<tr><th id="717">717</th><td>  <a class="ref fn" href="../../include/xray/xray_log_interface.h.html#__xray_log_set_buffer_iterator" title='__xray_log_set_buffer_iterator' data-ref="__xray_log_set_buffer_iterator" data-ref-filename="__xray_log_set_buffer_iterator">__xray_log_set_buffer_iterator</a>(<a class="ref fn" href="#__xray::fdrIterator" title='__xray::fdrIterator' data-ref="__xray::fdrIterator" data-ref-filename="__xray..fdrIterator">fdrIterator</a>);</td></tr>
<tr><th id="718">718</th><td></td></tr>
<tr><th id="719">719</th><td>  <a class="ref fn" href="../sanitizer_common/sanitizer_atomic_clang_x86.h.html#__sanitizer::atomic_store" title='__sanitizer::atomic_store' data-ref="__sanitizer::atomic_store" data-ref-filename="__sanitizer..atomic_store">atomic_store</a>(&amp;<a class="tu ref" href="#__xray::LoggingStatus" title='__xray::LoggingStatus' data-use='a' data-ref="__xray::LoggingStatus" data-ref-filename="__xray..LoggingStatus">LoggingStatus</a>, <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogInitStatus" title='XRayLogInitStatus' data-ref="XRayLogInitStatus" data-ref-filename="XRayLogInitStatus">XRayLogInitStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_INITIALIZED" title='XRAY_LOG_INITIALIZED' data-ref="XRAY_LOG_INITIALIZED" data-ref-filename="XRAY_LOG_INITIALIZED">XRAY_LOG_INITIALIZED</a>,</td></tr>
<tr><th id="720">720</th><td>               <a class="enum" href="../sanitizer_common/sanitizer_atomic.h.html#__sanitizer::memory_order_release" title='__sanitizer::memory_order_release' data-ref="__sanitizer::memory_order_release" data-ref-filename="__sanitizer..memory_order_release">memory_order_release</a>);</td></tr>
<tr><th id="721">721</th><td></td></tr>
<tr><th id="722">722</th><td>  <b>if</b> (<a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Verbosity" title='__sanitizer::Verbosity' data-ref="__sanitizer::Verbosity" data-ref-filename="__sanitizer..Verbosity">Verbosity</a>())</td></tr>
<tr><th id="723">723</th><td>    <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Report" title='__sanitizer::Report' data-ref="__sanitizer::Report" data-ref-filename="__sanitizer..Report">Report</a>(<q>"XRay FDR init successful.\n"</q>);</td></tr>
<tr><th id="724">724</th><td>  <b>return</b> <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogInitStatus" title='XRayLogInitStatus' data-ref="XRayLogInitStatus" data-ref-filename="XRayLogInitStatus">XRayLogInitStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_LOG_INITIALIZED" title='XRAY_LOG_INITIALIZED' data-ref="XRAY_LOG_INITIALIZED" data-ref-filename="XRAY_LOG_INITIALIZED">XRAY_LOG_INITIALIZED</a>;</td></tr>
<tr><th id="725">725</th><td>}</td></tr>
<tr><th id="726">726</th><td></td></tr>
<tr><th id="727">727</th><td><em>bool</em> <dfn class="decl def fn" id="__xray::fdrLogDynamicInitializer" title='__xray::fdrLogDynamicInitializer' data-ref="__xray::fdrLogDynamicInitializer" data-ref-filename="__xray..fdrLogDynamicInitializer">fdrLogDynamicInitializer</dfn>() <a class="macro" href="xray_defs.h.html#18" title="" data-ref="_M/XRAY_NEVER_INSTRUMENT">XRAY_NEVER_INSTRUMENT</a> {</td></tr>
<tr><th id="728">728</th><td>  <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogImpl" title='XRayLogImpl' data-ref="XRayLogImpl" data-ref-filename="XRayLogImpl">XRayLogImpl</a> <dfn class="local col8 decl" id="178Impl" title='Impl' data-type='XRayLogImpl' data-ref="178Impl" data-ref-filename="178Impl">Impl</dfn>{</td></tr>
<tr><th id="729">729</th><td>      <a class="ref fn" href="#__xray::fdrLoggingInit" title='__xray::fdrLoggingInit' data-ref="__xray::fdrLoggingInit" data-ref-filename="__xray..fdrLoggingInit">fdrLoggingInit</a>,</td></tr>
<tr><th id="730">730</th><td>      <a class="ref fn" href="#__xray::fdrLoggingFinalize" title='__xray::fdrLoggingFinalize' data-ref="__xray::fdrLoggingFinalize" data-ref-filename="__xray..fdrLoggingFinalize">fdrLoggingFinalize</a>,</td></tr>
<tr><th id="731">731</th><td>      <a class="ref fn" href="#__xray::fdrLoggingHandleArg0" title='__xray::fdrLoggingHandleArg0' data-ref="__xray::fdrLoggingHandleArg0" data-ref-filename="__xray..fdrLoggingHandleArg0">fdrLoggingHandleArg0</a>,</td></tr>
<tr><th id="732">732</th><td>      <a class="ref fn" href="#__xray::fdrLoggingFlush" title='__xray::fdrLoggingFlush' data-ref="__xray::fdrLoggingFlush" data-ref-filename="__xray..fdrLoggingFlush">fdrLoggingFlush</a>,</td></tr>
<tr><th id="733">733</th><td>  };</td></tr>
<tr><th id="734">734</th><td>  <em>auto</em> <dfn class="local col9 decl" id="179RegistrationResult" title='RegistrationResult' data-type='XRayLogRegisterStatus' data-ref="179RegistrationResult" data-ref-filename="179RegistrationResult">RegistrationResult</dfn> = <a class="ref fn" href="../../include/xray/xray_log_interface.h.html#__xray_log_register_mode" title='__xray_log_register_mode' data-ref="__xray_log_register_mode" data-ref-filename="__xray_log_register_mode">__xray_log_register_mode</a>(<q>"xray-fdr"</q>, <a class="ref fn fake" href="../../include/xray/xray_log_interface.h.html#156" title='XRayLogImpl::XRayLogImpl' data-ref="_ZN11XRayLogImplC1ERKS_" data-ref-filename="_ZN11XRayLogImplC1ERKS_"></a><a class="local col8 ref" href="#178Impl" title='Impl' data-ref="178Impl" data-ref-filename="178Impl">Impl</a>);</td></tr>
<tr><th id="735">735</th><td>  <b>if</b> (<a class="local col9 ref" href="#179RegistrationResult" title='RegistrationResult' data-ref="179RegistrationResult" data-ref-filename="179RegistrationResult">RegistrationResult</a> != <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogRegisterStatus" title='XRayLogRegisterStatus' data-ref="XRayLogRegisterStatus" data-ref-filename="XRayLogRegisterStatus">XRayLogRegisterStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_REGISTRATION_OK" title='XRAY_REGISTRATION_OK' data-ref="XRAY_REGISTRATION_OK" data-ref-filename="XRAY_REGISTRATION_OK">XRAY_REGISTRATION_OK</a> &amp;&amp;</td></tr>
<tr><th id="736">736</th><td>      <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Verbosity" title='__sanitizer::Verbosity' data-ref="__sanitizer::Verbosity" data-ref-filename="__sanitizer..Verbosity">Verbosity</a>()) {</td></tr>
<tr><th id="737">737</th><td>    <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Report" title='__sanitizer::Report' data-ref="__sanitizer::Report" data-ref-filename="__sanitizer..Report">Report</a>(<q>"Cannot register XRay FDR mode to 'xray-fdr'; error = %d\n"</q>,</td></tr>
<tr><th id="738">738</th><td>           <a class="local col9 ref" href="#179RegistrationResult" title='RegistrationResult' data-ref="179RegistrationResult" data-ref-filename="179RegistrationResult">RegistrationResult</a>);</td></tr>
<tr><th id="739">739</th><td>    <b>return</b> <b>false</b>;</td></tr>
<tr><th id="740">740</th><td>  }</td></tr>
<tr><th id="741">741</th><td></td></tr>
<tr><th id="742">742</th><td>  <b>if</b> (<a class="ref fn" href="xray_flags.h.html#__xray::flags" title='__xray::flags' data-ref="__xray::flags" data-ref-filename="__xray..flags">flags</a>()-&gt;<a class="ref field" href="xray_flags.inc.html#39" title='__xray::Flags::xray_fdr_log' data-ref="__xray::Flags::xray_fdr_log" data-ref-filename="__xray..Flags..xray_fdr_log">xray_fdr_log</a> ||</td></tr>
<tr><th id="743">743</th><td>      !<a class="ref fn" href="../sanitizer_common/sanitizer_libc.h.html#__sanitizer::internal_strcmp" title='__sanitizer::internal_strcmp' data-ref="__sanitizer::internal_strcmp" data-ref-filename="__sanitizer..internal_strcmp">internal_strcmp</a>(<a class="ref fn" href="xray_flags.h.html#__xray::flags" title='__xray::flags' data-ref="__xray::flags" data-ref-filename="__xray..flags">flags</a>()-&gt;<a class="ref field" href="xray_flags.inc.html#20" title='__xray::Flags::xray_mode' data-ref="__xray::Flags::xray_mode" data-ref-filename="__xray..Flags..xray_mode">xray_mode</a>, <q>"xray-fdr"</q>)) {</td></tr>
<tr><th id="744">744</th><td>    <em>auto</em> <dfn class="local col0 decl" id="180SelectResult" title='SelectResult' data-type='XRayLogRegisterStatus' data-ref="180SelectResult" data-ref-filename="180SelectResult">SelectResult</dfn> = <a class="ref fn" href="../../include/xray/xray_log_interface.h.html#__xray_log_select_mode" title='__xray_log_select_mode' data-ref="__xray_log_select_mode" data-ref-filename="__xray_log_select_mode">__xray_log_select_mode</a>(<q>"xray-fdr"</q>);</td></tr>
<tr><th id="745">745</th><td>    <b>if</b> (<a class="local col0 ref" href="#180SelectResult" title='SelectResult' data-ref="180SelectResult" data-ref-filename="180SelectResult">SelectResult</a> != <a class="type" href="../../include/xray/xray_log_interface.h.html#XRayLogRegisterStatus" title='XRayLogRegisterStatus' data-ref="XRayLogRegisterStatus" data-ref-filename="XRayLogRegisterStatus">XRayLogRegisterStatus</a>::<a class="enum" href="../../include/xray/xray_log_interface.h.html#XRAY_REGISTRATION_OK" title='XRAY_REGISTRATION_OK' data-ref="XRAY_REGISTRATION_OK" data-ref-filename="XRAY_REGISTRATION_OK">XRAY_REGISTRATION_OK</a> &amp;&amp;</td></tr>
<tr><th id="746">746</th><td>        <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Verbosity" title='__sanitizer::Verbosity' data-ref="__sanitizer::Verbosity" data-ref-filename="__sanitizer..Verbosity">Verbosity</a>()) {</td></tr>
<tr><th id="747">747</th><td>      <a class="ref fn" href="../sanitizer_common/sanitizer_common.h.html#__sanitizer::Report" title='__sanitizer::Report' data-ref="__sanitizer::Report" data-ref-filename="__sanitizer..Report">Report</a>(<q>"Cannot select XRay FDR mode as 'xray-fdr'; error = %d\n"</q>,</td></tr>
<tr><th id="748">748</th><td>             <a class="local col0 ref" href="#180SelectResult" title='SelectResult' data-ref="180SelectResult" data-ref-filename="180SelectResult">SelectResult</a>);</td></tr>
<tr><th id="749">749</th><td>      <b>return</b> <b>false</b>;</td></tr>
<tr><th id="750">750</th><td>    }</td></tr>
<tr><th id="751">751</th><td>  }</td></tr>
<tr><th id="752">752</th><td>  <b>return</b> <b>true</b>;</td></tr>
<tr><th id="753">753</th><td>}</td></tr>
<tr><th id="754">754</th><td></td></tr>
<tr><th id="755">755</th><td>} <i>// namespace __xray</i></td></tr>
<tr><th id="756">756</th><td></td></tr>
<tr><th id="757">757</th><td><em>static</em> <em>auto</em> <a class="macro" href="../sanitizer_common/sanitizer_internal_defs.h.html#240" title="__attribute__((unused))" data-ref="_M/UNUSED">UNUSED</a> <dfn class="tu decl def" id="Unused" title='Unused' data-type='bool' data-ref="Unused" data-ref-filename="Unused">Unused</dfn> = <span class="namespace">__xray::</span><a class="ref fn" href="#__xray::fdrLogDynamicInitializer" title='__xray::fdrLogDynamicInitializer' data-ref="__xray::fdrLogDynamicInitializer" data-ref-filename="__xray..fdrLogDynamicInitializer">fdrLogDynamicInitializer</a>();</td></tr>
<tr><th id="758">758</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2021-Jul-01</em> from project llvm revision <em>12</em>