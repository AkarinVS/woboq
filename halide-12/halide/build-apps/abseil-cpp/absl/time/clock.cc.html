<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>clock.cc source code [halide/build-apps/abseil-cpp/absl/time/clock.cc] - Woboq Code Browser</title>
<meta name="woboq:interestingDefinitions" content="absl::lts_2020_02_25::TimeSample,absl::lts_2020_02_25::TimeSampleAtomic,absl::lts_2020_02_25::time_internal::UnscaledCycleClockWrapperForGetCurrentTime "/>
<link rel="stylesheet" href="../../../../.././data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../../.././data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../../.././data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../../.././data/jquery/jquery-ui.min.js"></script>
<script>var file = 'halide/build-apps/abseil-cpp/absl/time/clock.cc'; var root_path = '../../../../..'; var data_path = '../../../../.././data'; var ecma_script_api_version = 2;</script>
<script src='../../../../.././data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../../../..'>halide</a>/<a href='../../..'>build-apps</a>/<a href='../..'>abseil-cpp</a>/<a href='..'>absl</a>/<a href='./'>time</a>/<a href='clock.cc.html'>clock.cc</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>// Copyright 2017 The Abseil Authors.</i></td></tr>
<tr><th id="2">2</th><td><i>//</i></td></tr>
<tr><th id="3">3</th><td><i>// Licensed under the Apache License, Version 2.0 (the "License");</i></td></tr>
<tr><th id="4">4</th><td><i>// you may not use this file except in compliance with the License.</i></td></tr>
<tr><th id="5">5</th><td><i>// You may obtain a copy of the License at</i></td></tr>
<tr><th id="6">6</th><td><i>//</i></td></tr>
<tr><th id="7">7</th><td><i>//      <a href="https://www.apache.org/licenses/LICENSE-2.0">https://www.apache.org/licenses/LICENSE-2.0</a></i></td></tr>
<tr><th id="8">8</th><td><i>//</i></td></tr>
<tr><th id="9">9</th><td><i>// Unless required by applicable law or agreed to in writing, software</i></td></tr>
<tr><th id="10">10</th><td><i>// distributed under the License is distributed on an "AS IS" BASIS,</i></td></tr>
<tr><th id="11">11</th><td><i>// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</i></td></tr>
<tr><th id="12">12</th><td><i>// See the License for the specific language governing permissions and</i></td></tr>
<tr><th id="13">13</th><td><i>// limitations under the License.</i></td></tr>
<tr><th id="14">14</th><td></td></tr>
<tr><th id="15">15</th><td><u>#include <a href="clock.h.html">"absl/time/clock.h"</a></u></td></tr>
<tr><th id="16">16</th><td></td></tr>
<tr><th id="17">17</th><td><u>#include <a href="../base/attributes.h.html">"absl/base/attributes.h"</a></u></td></tr>
<tr><th id="18">18</th><td></td></tr>
<tr><th id="19">19</th><td><u>#<span data-ppcond="19">ifdef</span> <span class="macro" data-ref="_M/_WIN32">_WIN32</span></u></td></tr>
<tr><th id="20">20</th><td><u>#include &lt;windows.h&gt;</u></td></tr>
<tr><th id="21">21</th><td><u>#<span data-ppcond="19">endif</span></u></td></tr>
<tr><th id="22">22</th><td></td></tr>
<tr><th id="23">23</th><td><u>#include &lt;algorithm&gt;</u></td></tr>
<tr><th id="24">24</th><td><u>#include &lt;atomic&gt;</u></td></tr>
<tr><th id="25">25</th><td><u>#include &lt;cerrno&gt;</u></td></tr>
<tr><th id="26">26</th><td><u>#include &lt;cstdint&gt;</u></td></tr>
<tr><th id="27">27</th><td><u>#include &lt;ctime&gt;</u></td></tr>
<tr><th id="28">28</th><td><u>#include &lt;limits&gt;</u></td></tr>
<tr><th id="29">29</th><td></td></tr>
<tr><th id="30">30</th><td><u>#include <a href="../base/internal/spinlock.h.html">"absl/base/internal/spinlock.h"</a></u></td></tr>
<tr><th id="31">31</th><td><u>#include <a href="../base/internal/unscaledcycleclock.h.html">"absl/base/internal/unscaledcycleclock.h"</a></u></td></tr>
<tr><th id="32">32</th><td><u>#include <a href="../base/macros.h.html">"absl/base/macros.h"</a></u></td></tr>
<tr><th id="33">33</th><td><u>#include <a href="../base/port.h.html">"absl/base/port.h"</a></u></td></tr>
<tr><th id="34">34</th><td><u>#include <a href="../base/thread_annotations.h.html">"absl/base/thread_annotations.h"</a></u></td></tr>
<tr><th id="35">35</th><td></td></tr>
<tr><th id="36">36</th><td><b>namespace</b> <span class="namespace">absl</span> {</td></tr>
<tr><th id="37">37</th><td><a class="macro" href="../base/config.h.html#125" title="inline namespace lts_2020_02_25 {" data-ref="_M/ABSL_NAMESPACE_BEGIN">ABSL_NAMESPACE_BEGIN</a></td></tr>
<tr><th id="38">38</th><td><a class="type" href="time.h.html#absl::lts_2020_02_25::Time" title='absl::lts_2020_02_25::Time' data-ref="absl::lts_2020_02_25::Time" data-ref-filename="absl..lts_2020_02_25..Time">Time</a> <dfn class="decl def fn" id="_ZN4absl14lts_2020_02_253NowEv" title='absl::lts_2020_02_25::Now' data-ref="_ZN4absl14lts_2020_02_253NowEv" data-ref-filename="_ZN4absl14lts_2020_02_253NowEv">Now</dfn>() {</td></tr>
<tr><th id="39">39</th><td>  <i>// TODO(bww): Get a timespec instead so we don't have to divide.</i></td></tr>
<tr><th id="40">40</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-intn.h.html#int64_t" title='int64_t' data-type='__int64_t' data-ref="int64_t" data-ref-filename="int64_t">int64_t</a> <dfn class="local col1 decl" id="1n" title='n' data-type='int64_t' data-ref="1n" data-ref-filename="1n">n</dfn> = <span class="namespace">absl::</span><a class="ref fn" href="#_ZN4absl14lts_2020_02_2519GetCurrentTimeNanosEv" title='absl::lts_2020_02_25::GetCurrentTimeNanos' data-ref="_ZN4absl14lts_2020_02_2519GetCurrentTimeNanosEv" data-ref-filename="_ZN4absl14lts_2020_02_2519GetCurrentTimeNanosEv">GetCurrentTimeNanos</a>();</td></tr>
<tr><th id="41">41</th><td>  <b>if</b> (<a class="local col1 ref" href="#1n" title='n' data-ref="1n" data-ref-filename="1n">n</a> &gt;= <var>0</var>) {</td></tr>
<tr><th id="42">42</th><td>    <b>return</b> <span class="namespace">time_internal::</span><a class="ref fn" href="time.h.html#_ZN4absl14lts_2020_02_2513time_internal16FromUnixDurationENS0_8DurationE" title='absl::lts_2020_02_25::time_internal::FromUnixDuration' data-ref="_ZN4absl14lts_2020_02_2513time_internal16FromUnixDurationENS0_8DurationE" data-ref-filename="_ZN4absl14lts_2020_02_2513time_internal16FromUnixDurationENS0_8DurationE">FromUnixDuration</a>(</td></tr>
<tr><th id="43">43</th><td>        <span class="namespace">time_internal::</span><a class="ref fn" href="time.h.html#_ZN4absl14lts_2020_02_2513time_internal12MakeDurationEll" title='absl::lts_2020_02_25::time_internal::MakeDuration' data-ref="_ZN4absl14lts_2020_02_2513time_internal12MakeDurationEll" data-ref-filename="_ZN4absl14lts_2020_02_2513time_internal12MakeDurationEll">MakeDuration</a>(<a class="local col1 ref" href="#1n" title='n' data-ref="1n" data-ref-filename="1n">n</a> / <var>1000000000</var>, <a class="local col1 ref" href="#1n" title='n' data-ref="1n" data-ref-filename="1n">n</a> % <var>1000000000</var> * <var>4</var>));</td></tr>
<tr><th id="44">44</th><td>  }</td></tr>
<tr><th id="45">45</th><td>  <b>return</b> <span class="namespace">time_internal::</span><a class="ref fn" href="time.h.html#_ZN4absl14lts_2020_02_2513time_internal16FromUnixDurationENS0_8DurationE" title='absl::lts_2020_02_25::time_internal::FromUnixDuration' data-ref="_ZN4absl14lts_2020_02_2513time_internal16FromUnixDurationENS0_8DurationE" data-ref-filename="_ZN4absl14lts_2020_02_2513time_internal16FromUnixDurationENS0_8DurationE">FromUnixDuration</a>(<span class="namespace">absl::</span><a class="ref fn" href="time.h.html#_ZN4absl14lts_2020_02_2511NanosecondsEl" title='absl::lts_2020_02_25::Nanoseconds' data-ref="_ZN4absl14lts_2020_02_2511NanosecondsEl" data-ref-filename="_ZN4absl14lts_2020_02_2511NanosecondsEl">Nanoseconds</a>(<a class="local col1 ref" href="#1n" title='n' data-ref="1n" data-ref-filename="1n">n</a>));</td></tr>
<tr><th id="46">46</th><td>}</td></tr>
<tr><th id="47">47</th><td><a class="macro" href="../base/config.h.html#127" title="}" data-ref="_M/ABSL_NAMESPACE_END">ABSL_NAMESPACE_END</a></td></tr>
<tr><th id="48">48</th><td>}  <i>// namespace absl</i></td></tr>
<tr><th id="49">49</th><td></td></tr>
<tr><th id="50">50</th><td><i>// Decide if we should use the fast GetCurrentTimeNanos() algorithm</i></td></tr>
<tr><th id="51">51</th><td><i>// based on the cyclecounter, otherwise just get the time directly</i></td></tr>
<tr><th id="52">52</th><td><i>// from the OS on every call. This can be chosen at compile-time via</i></td></tr>
<tr><th id="53">53</th><td><i>// -DABSL_USE_CYCLECLOCK_FOR_GET_CURRENT_TIME_NANOS=[0|1]</i></td></tr>
<tr><th id="54">54</th><td><u>#<span data-ppcond="54">ifndef</span> <span class="macro" data-ref="_M/ABSL_USE_CYCLECLOCK_FOR_GET_CURRENT_TIME_NANOS">ABSL_USE_CYCLECLOCK_FOR_GET_CURRENT_TIME_NANOS</span></u></td></tr>
<tr><th id="55">55</th><td><u>#<span data-ppcond="55">if</span> <a class="macro" href="../base/internal/unscaledcycleclock.h.html#74" title="(1 &amp;&amp; 1)" data-ref="_M/ABSL_USE_UNSCALED_CYCLECLOCK">ABSL_USE_UNSCALED_CYCLECLOCK</a></u></td></tr>
<tr><th id="56">56</th><td><u>#define <dfn class="macro" id="_M/ABSL_USE_CYCLECLOCK_FOR_GET_CURRENT_TIME_NANOS" data-ref="_M/ABSL_USE_CYCLECLOCK_FOR_GET_CURRENT_TIME_NANOS">ABSL_USE_CYCLECLOCK_FOR_GET_CURRENT_TIME_NANOS</dfn> 1</u></td></tr>
<tr><th id="57">57</th><td><u>#<span data-ppcond="55">else</span></u></td></tr>
<tr><th id="58">58</th><td><u>#define ABSL_USE_CYCLECLOCK_FOR_GET_CURRENT_TIME_NANOS 0</u></td></tr>
<tr><th id="59">59</th><td><u>#<span data-ppcond="55">endif</span></u></td></tr>
<tr><th id="60">60</th><td><u>#<span data-ppcond="54">endif</span></u></td></tr>
<tr><th id="61">61</th><td></td></tr>
<tr><th id="62">62</th><td><u>#<span data-ppcond="62">if</span> defined(<span class="macro" data-ref="_M/__APPLE__">__APPLE__</span>) || defined(<span class="macro" data-ref="_M/_WIN32">_WIN32</span>)</u></td></tr>
<tr><th id="63">63</th><td><u>#include "absl/time/internal/get_current_time_chrono.inc"</u></td></tr>
<tr><th id="64">64</th><td><u>#<span data-ppcond="62">else</span></u></td></tr>
<tr><th id="65">65</th><td><u>#include <a href="internal/get_current_time_posix.inc.html">"absl/time/internal/get_current_time_posix.inc"</a></u></td></tr>
<tr><th id="66">66</th><td><u>#<span data-ppcond="62">endif</span></u></td></tr>
<tr><th id="67">67</th><td></td></tr>
<tr><th id="68">68</th><td><i>// Allows override by test.</i></td></tr>
<tr><th id="69">69</th><td><u>#<span data-ppcond="69">ifndef</span> <span class="macro" data-ref="_M/GET_CURRENT_TIME_NANOS_FROM_SYSTEM">GET_CURRENT_TIME_NANOS_FROM_SYSTEM</span></u></td></tr>
<tr><th id="70">70</th><td><u>#define <dfn class="macro" id="_M/GET_CURRENT_TIME_NANOS_FROM_SYSTEM" data-ref="_M/GET_CURRENT_TIME_NANOS_FROM_SYSTEM">GET_CURRENT_TIME_NANOS_FROM_SYSTEM</dfn>() \</u></td></tr>
<tr><th id="71">71</th><td><u>  ::absl::time_internal::<a class="ref fn" href="internal/get_current_time_posix.inc.html#_ZN4absl14lts_2020_02_2513time_internalL29GetCurrentTimeNanosFromSystemEv" title='absl::lts_2020_02_25::time_internal::GetCurrentTimeNanosFromSystem' data-ref="_ZN4absl14lts_2020_02_2513time_internalL29GetCurrentTimeNanosFromSystemEv" data-ref-filename="_ZN4absl14lts_2020_02_2513time_internalL29GetCurrentTimeNanosFromSystemEv">GetCurrentTimeNanosFromSystem</a>()</u></td></tr>
<tr><th id="72">72</th><td><u>#<span data-ppcond="69">endif</span></u></td></tr>
<tr><th id="73">73</th><td></td></tr>
<tr><th id="74">74</th><td><u>#<span data-ppcond="74">if</span> !<a class="macro" href="#56" title="1" data-ref="_M/ABSL_USE_CYCLECLOCK_FOR_GET_CURRENT_TIME_NANOS">ABSL_USE_CYCLECLOCK_FOR_GET_CURRENT_TIME_NANOS</a></u></td></tr>
<tr><th id="75">75</th><td><b>namespace</b> absl {</td></tr>
<tr><th id="76">76</th><td>ABSL_NAMESPACE_BEGIN</td></tr>
<tr><th id="77">77</th><td>int64_t GetCurrentTimeNanos() {</td></tr>
<tr><th id="78">78</th><td>  <b>return</b> GET_CURRENT_TIME_NANOS_FROM_SYSTEM();</td></tr>
<tr><th id="79">79</th><td>}</td></tr>
<tr><th id="80">80</th><td>ABSL_NAMESPACE_END</td></tr>
<tr><th id="81">81</th><td>}  <i>// namespace absl</i></td></tr>
<tr><th id="82">82</th><td><u>#<span data-ppcond="74">else</span>  // Use the cyclecounter-based implementation below.</u></td></tr>
<tr><th id="83">83</th><td></td></tr>
<tr><th id="84">84</th><td><i>// Allows override by test.</i></td></tr>
<tr><th id="85">85</th><td><u>#<span data-ppcond="85">ifndef</span> <span class="macro" data-ref="_M/GET_CURRENT_TIME_NANOS_CYCLECLOCK_NOW">GET_CURRENT_TIME_NANOS_CYCLECLOCK_NOW</span></u></td></tr>
<tr><th id="86">86</th><td><u>#define <dfn class="macro" id="_M/GET_CURRENT_TIME_NANOS_CYCLECLOCK_NOW" data-ref="_M/GET_CURRENT_TIME_NANOS_CYCLECLOCK_NOW">GET_CURRENT_TIME_NANOS_CYCLECLOCK_NOW</dfn>() \</u></td></tr>
<tr><th id="87">87</th><td><u>  ::absl::time_internal::<a class="type" href="#absl::lts_2020_02_25::time_internal::UnscaledCycleClockWrapperForGetCurrentTime" title='absl::lts_2020_02_25::time_internal::UnscaledCycleClockWrapperForGetCurrentTime' data-ref="absl::lts_2020_02_25::time_internal::UnscaledCycleClockWrapperForGetCurrentTime" data-ref-filename="absl..lts_2020_02_25..time_internal..UnscaledCycleClockWrapperForGetCurrentTime">UnscaledCycleClockWrapperForGetCurrentTime</a>::<a class="ref fn" href="#_ZN4absl14lts_2020_02_2513time_internal42UnscaledCycleClockWrapperForGetCurrentTime3NowEv" title='absl::lts_2020_02_25::time_internal::UnscaledCycleClockWrapperForGetCurrentTime::Now' data-ref="_ZN4absl14lts_2020_02_2513time_internal42UnscaledCycleClockWrapperForGetCurrentTime3NowEv" data-ref-filename="_ZN4absl14lts_2020_02_2513time_internal42UnscaledCycleClockWrapperForGetCurrentTime3NowEv">Now</a>()</u></td></tr>
<tr><th id="88">88</th><td><u>#<span data-ppcond="85">endif</span></u></td></tr>
<tr><th id="89">89</th><td></td></tr>
<tr><th id="90">90</th><td><i  data-doc="stats_initializations">// The following counters are used only by the test code.</i></td></tr>
<tr><th id="91">91</th><td><em>static</em> <a class="typedef" href="../../../../../include/bits/stdint-intn.h.html#int64_t" title='int64_t' data-type='__int64_t' data-ref="int64_t" data-ref-filename="int64_t">int64_t</a> <dfn class="tu decl def" id="stats_initializations" title='stats_initializations' data-type='int64_t' data-ref="stats_initializations" data-ref-filename="stats_initializations">stats_initializations</dfn>;</td></tr>
<tr><th id="92">92</th><td><em>static</em> <a class="typedef" href="../../../../../include/bits/stdint-intn.h.html#int64_t" title='int64_t' data-type='__int64_t' data-ref="int64_t" data-ref-filename="int64_t">int64_t</a> <dfn class="tu decl def" id="stats_reinitializations" title='stats_reinitializations' data-type='int64_t' data-ref="stats_reinitializations" data-ref-filename="stats_reinitializations">stats_reinitializations</dfn>;</td></tr>
<tr><th id="93">93</th><td><em>static</em> <a class="typedef" href="../../../../../include/bits/stdint-intn.h.html#int64_t" title='int64_t' data-type='__int64_t' data-ref="int64_t" data-ref-filename="int64_t">int64_t</a> <dfn class="tu decl def" id="stats_calibrations" title='stats_calibrations' data-type='int64_t' data-ref="stats_calibrations" data-ref-filename="stats_calibrations">stats_calibrations</dfn>;</td></tr>
<tr><th id="94">94</th><td><em>static</em> <a class="typedef" href="../../../../../include/bits/stdint-intn.h.html#int64_t" title='int64_t' data-type='__int64_t' data-ref="int64_t" data-ref-filename="int64_t">int64_t</a> <dfn class="tu decl def" id="stats_slow_paths" title='stats_slow_paths' data-type='int64_t' data-ref="stats_slow_paths" data-ref-filename="stats_slow_paths">stats_slow_paths</dfn>;</td></tr>
<tr><th id="95">95</th><td><em>static</em> <a class="typedef" href="../../../../../include/bits/stdint-intn.h.html#int64_t" title='int64_t' data-type='__int64_t' data-ref="int64_t" data-ref-filename="int64_t">int64_t</a> <dfn class="tu decl def" id="stats_fast_slow_paths" title='stats_fast_slow_paths' data-type='int64_t' data-ref="stats_fast_slow_paths" data-ref-filename="stats_fast_slow_paths">stats_fast_slow_paths</dfn>;</td></tr>
<tr><th id="96">96</th><td></td></tr>
<tr><th id="97">97</th><td><b>namespace</b> <span class="namespace">absl</span> {</td></tr>
<tr><th id="98">98</th><td><a class="macro" href="../base/config.h.html#125" title="inline namespace lts_2020_02_25 {" data-ref="_M/ABSL_NAMESPACE_BEGIN">ABSL_NAMESPACE_BEGIN</a></td></tr>
<tr><th id="99">99</th><td><b>namespace</b> <span class="namespace">time_internal</span> {</td></tr>
<tr><th id="100">100</th><td><i>// This is a friend wrapper around UnscaledCycleClock::Now()</i></td></tr>
<tr><th id="101">101</th><td><i>// (needed to access UnscaledCycleClock).</i></td></tr>
<tr><th id="102">102</th><td><b>class</b> <dfn class="type def" id="absl::lts_2020_02_25::time_internal::UnscaledCycleClockWrapperForGetCurrentTime" title='absl::lts_2020_02_25::time_internal::UnscaledCycleClockWrapperForGetCurrentTime' data-ref="absl::lts_2020_02_25::time_internal::UnscaledCycleClockWrapperForGetCurrentTime" data-ref-filename="absl..lts_2020_02_25..time_internal..UnscaledCycleClockWrapperForGetCurrentTime">UnscaledCycleClockWrapperForGetCurrentTime</dfn> {</td></tr>
<tr><th id="103">103</th><td> <b>public</b>:</td></tr>
<tr><th id="104">104</th><td>  <em>static</em> <a class="typedef" href="../../../../../include/bits/stdint-intn.h.html#int64_t" title='int64_t' data-type='__int64_t' data-ref="int64_t" data-ref-filename="int64_t">int64_t</a> <dfn class="decl def fn" id="_ZN4absl14lts_2020_02_2513time_internal42UnscaledCycleClockWrapperForGetCurrentTime3NowEv" title='absl::lts_2020_02_25::time_internal::UnscaledCycleClockWrapperForGetCurrentTime::Now' data-ref="_ZN4absl14lts_2020_02_2513time_internal42UnscaledCycleClockWrapperForGetCurrentTime3NowEv" data-ref-filename="_ZN4absl14lts_2020_02_2513time_internal42UnscaledCycleClockWrapperForGetCurrentTime3NowEv">Now</dfn>() { <b>return</b> <span class="namespace">base_internal::</span><a class="type" href="../base/internal/unscaledcycleclock.h.html#absl::lts_2020_02_25::base_internal::UnscaledCycleClock" title='absl::lts_2020_02_25::base_internal::UnscaledCycleClock' data-ref="absl::lts_2020_02_25::base_internal::UnscaledCycleClock" data-ref-filename="absl..lts_2020_02_25..base_internal..UnscaledCycleClock">UnscaledCycleClock</a>::<a class="ref fn" href="../base/internal/unscaledcycleclock.h.html#_ZN4absl14lts_2020_02_2513base_internal18UnscaledCycleClock3NowEv" title='absl::lts_2020_02_25::base_internal::UnscaledCycleClock::Now' data-ref="_ZN4absl14lts_2020_02_2513base_internal18UnscaledCycleClock3NowEv" data-ref-filename="_ZN4absl14lts_2020_02_2513base_internal18UnscaledCycleClock3NowEv">Now</a>(); }</td></tr>
<tr><th id="105">105</th><td>};</td></tr>
<tr><th id="106">106</th><td>}  <i>// namespace time_internal</i></td></tr>
<tr><th id="107">107</th><td></td></tr>
<tr><th id="108">108</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L29GetCurrentTimeNanosFromKernelEmPm">// uint64_t is used in this module to provide an extra bit in multiplications</i></td></tr>
<tr><th id="109">109</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L29GetCurrentTimeNanosFromKernelEmPm"></i></td></tr>
<tr><th id="110">110</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L29GetCurrentTimeNanosFromKernelEmPm">// Return the time in ns as told by the kernel interface.  Place in *cycleclock</i></td></tr>
<tr><th id="111">111</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L29GetCurrentTimeNanosFromKernelEmPm">// the value of the cycleclock at about the time of the syscall.</i></td></tr>
<tr><th id="112">112</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L29GetCurrentTimeNanosFromKernelEmPm">// This call represents the time base that this module synchronizes to.</i></td></tr>
<tr><th id="113">113</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L29GetCurrentTimeNanosFromKernelEmPm">// Ensures that *cycleclock does not step back by up to (1 &lt;&lt; 16) from</i></td></tr>
<tr><th id="114">114</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L29GetCurrentTimeNanosFromKernelEmPm">// last_cycleclock, to discard small backward counter steps.  (Larger steps are</i></td></tr>
<tr><th id="115">115</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L29GetCurrentTimeNanosFromKernelEmPm">// assumed to be complete resyncs, which shouldn't happen.  If they do, a full</i></td></tr>
<tr><th id="116">116</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L29GetCurrentTimeNanosFromKernelEmPm">// reinitialization of the outer algorithm should occur.)</i></td></tr>
<tr><th id="117">117</th><td><em>static</em> <a class="typedef" href="../../../../../include/bits/stdint-intn.h.html#int64_t" title='int64_t' data-type='__int64_t' data-ref="int64_t" data-ref-filename="int64_t">int64_t</a> <dfn class="tu decl def fn" id="_ZN4absl14lts_2020_02_25L29GetCurrentTimeNanosFromKernelEmPm" title='absl::lts_2020_02_25::GetCurrentTimeNanosFromKernel' data-type='int64_t absl::lts_2020_02_25::GetCurrentTimeNanosFromKernel(uint64_t last_cycleclock, uint64_t * cycleclock)' data-ref="_ZN4absl14lts_2020_02_25L29GetCurrentTimeNanosFromKernelEmPm" data-ref-filename="_ZN4absl14lts_2020_02_25L29GetCurrentTimeNanosFromKernelEmPm">GetCurrentTimeNanosFromKernel</dfn>(<a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col4 decl" id="4last_cycleclock" title='last_cycleclock' data-type='uint64_t' data-ref="4last_cycleclock" data-ref-filename="4last_cycleclock">last_cycleclock</dfn>,</td></tr>
<tr><th id="118">118</th><td>                                             <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> *<dfn class="local col5 decl" id="5cycleclock" title='cycleclock' data-type='uint64_t *' data-ref="5cycleclock" data-ref-filename="5cycleclock">cycleclock</dfn>) {</td></tr>
<tr><th id="119">119</th><td>  <i>// We try to read clock values at about the same time as the kernel clock.</i></td></tr>
<tr><th id="120">120</th><td><i>  // This value gets adjusted up or down as estimate of how long that should</i></td></tr>
<tr><th id="121">121</th><td><i>  // take, so we can reject attempts that take unusually long.</i></td></tr>
<tr><th id="122">122</th><td>  <em>static</em> <span class="namespace">std::</span><span class='type' title='std::atomic' data-ref="std::atomic" data-ref-filename="std..atomic">atomic</span>&lt;<a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a>&gt; <dfn class="local col6 decl" id="6approx_syscall_time_in_cycles" title='approx_syscall_time_in_cycles' data-type='std::atomic&lt;uint64_t&gt;' data-ref="6approx_syscall_time_in_cycles" data-ref-filename="6approx_syscall_time_in_cycles">approx_syscall_time_in_cycles</dfn><span class='ref fn' title='std::atomic&lt;unsigned long&gt;::atomic' data-ref="_ZNSt6atomicImEC1Em" data-ref-filename="_ZNSt6atomicImEC1Em">{</span><var>10</var> * <var>1000</var>};</td></tr>
<tr><th id="123">123</th><td></td></tr>
<tr><th id="124">124</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col7 decl" id="7local_approx_syscall_time_in_cycles" title='local_approx_syscall_time_in_cycles' data-type='uint64_t' data-ref="7local_approx_syscall_time_in_cycles" data-ref-filename="7local_approx_syscall_time_in_cycles">local_approx_syscall_time_in_cycles</dfn> =  <i>// local copy</i></td></tr>
<tr><th id="125">125</th><td>      <a class="local col6 ref" href="#6approx_syscall_time_in_cycles" title='approx_syscall_time_in_cycles' data-ref="6approx_syscall_time_in_cycles" data-ref-filename="6approx_syscall_time_in_cycles">approx_syscall_time_in_cycles</a>.<span class='ref fn' title='std::__atomic_base::load' data-ref="_ZNKSt13__atomic_base4loadESt12memory_order" data-ref-filename="_ZNKSt13__atomic_base4loadESt12memory_order">load</span>(<span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="126">126</th><td></td></tr>
<tr><th id="127">127</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-intn.h.html#int64_t" title='int64_t' data-type='__int64_t' data-ref="int64_t" data-ref-filename="int64_t">int64_t</a> <dfn class="local col8 decl" id="8current_time_nanos_from_system" title='current_time_nanos_from_system' data-type='int64_t' data-ref="8current_time_nanos_from_system" data-ref-filename="8current_time_nanos_from_system">current_time_nanos_from_system</dfn>;</td></tr>
<tr><th id="128">128</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col9 decl" id="9before_cycles" title='before_cycles' data-type='uint64_t' data-ref="9before_cycles" data-ref-filename="9before_cycles">before_cycles</dfn>;</td></tr>
<tr><th id="129">129</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col0 decl" id="10after_cycles" title='after_cycles' data-type='uint64_t' data-ref="10after_cycles" data-ref-filename="10after_cycles">after_cycles</dfn>;</td></tr>
<tr><th id="130">130</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col1 decl" id="11elapsed_cycles" title='elapsed_cycles' data-type='uint64_t' data-ref="11elapsed_cycles" data-ref-filename="11elapsed_cycles">elapsed_cycles</dfn>;</td></tr>
<tr><th id="131">131</th><td>  <em>int</em> <dfn class="local col2 decl" id="12loops" title='loops' data-type='int' data-ref="12loops" data-ref-filename="12loops">loops</dfn> = <var>0</var>;</td></tr>
<tr><th id="132">132</th><td>  <b>do</b> {</td></tr>
<tr><th id="133">133</th><td>    <a class="local col9 ref" href="#9before_cycles" title='before_cycles' data-ref="9before_cycles" data-ref-filename="9before_cycles">before_cycles</a> = <a class="macro" href="#86" title="::absl::time_internal::UnscaledCycleClockWrapperForGetCurrentTime::Now()" data-ref="_M/GET_CURRENT_TIME_NANOS_CYCLECLOCK_NOW">GET_CURRENT_TIME_NANOS_CYCLECLOCK_NOW</a>();</td></tr>
<tr><th id="134">134</th><td>    <a class="local col8 ref" href="#8current_time_nanos_from_system" title='current_time_nanos_from_system' data-ref="8current_time_nanos_from_system" data-ref-filename="8current_time_nanos_from_system">current_time_nanos_from_system</a> = <a class="macro" href="#70" title="::absl::time_internal::GetCurrentTimeNanosFromSystem()" data-ref="_M/GET_CURRENT_TIME_NANOS_FROM_SYSTEM">GET_CURRENT_TIME_NANOS_FROM_SYSTEM</a>();</td></tr>
<tr><th id="135">135</th><td>    <a class="local col0 ref" href="#10after_cycles" title='after_cycles' data-ref="10after_cycles" data-ref-filename="10after_cycles">after_cycles</a> = <a class="macro" href="#86" title="::absl::time_internal::UnscaledCycleClockWrapperForGetCurrentTime::Now()" data-ref="_M/GET_CURRENT_TIME_NANOS_CYCLECLOCK_NOW">GET_CURRENT_TIME_NANOS_CYCLECLOCK_NOW</a>();</td></tr>
<tr><th id="136">136</th><td>    <i>// elapsed_cycles is unsigned, so is large on overflow</i></td></tr>
<tr><th id="137">137</th><td>    <a class="local col1 ref" href="#11elapsed_cycles" title='elapsed_cycles' data-ref="11elapsed_cycles" data-ref-filename="11elapsed_cycles">elapsed_cycles</a> = <a class="local col0 ref" href="#10after_cycles" title='after_cycles' data-ref="10after_cycles" data-ref-filename="10after_cycles">after_cycles</a> - <a class="local col9 ref" href="#9before_cycles" title='before_cycles' data-ref="9before_cycles" data-ref-filename="9before_cycles">before_cycles</a>;</td></tr>
<tr><th id="138">138</th><td>    <b>if</b> (<a class="local col1 ref" href="#11elapsed_cycles" title='elapsed_cycles' data-ref="11elapsed_cycles" data-ref-filename="11elapsed_cycles">elapsed_cycles</a> &gt;= <a class="local col7 ref" href="#7local_approx_syscall_time_in_cycles" title='local_approx_syscall_time_in_cycles' data-ref="7local_approx_syscall_time_in_cycles" data-ref-filename="7local_approx_syscall_time_in_cycles">local_approx_syscall_time_in_cycles</a> &amp;&amp;</td></tr>
<tr><th id="139">139</th><td>        ++<a class="local col2 ref" href="#12loops" title='loops' data-ref="12loops" data-ref-filename="12loops">loops</a> == <var>20</var>) {  <i>// clock changed frequencies?  Back off.</i></td></tr>
<tr><th id="140">140</th><td>      <a class="local col2 ref" href="#12loops" title='loops' data-ref="12loops" data-ref-filename="12loops">loops</a> = <var>0</var>;</td></tr>
<tr><th id="141">141</th><td>      <b>if</b> (<a class="local col7 ref" href="#7local_approx_syscall_time_in_cycles" title='local_approx_syscall_time_in_cycles' data-ref="7local_approx_syscall_time_in_cycles" data-ref-filename="7local_approx_syscall_time_in_cycles">local_approx_syscall_time_in_cycles</a> &lt; <var>1000</var> * <var>1000</var>) {</td></tr>
<tr><th id="142">142</th><td>        <a class="local col7 ref" href="#7local_approx_syscall_time_in_cycles" title='local_approx_syscall_time_in_cycles' data-ref="7local_approx_syscall_time_in_cycles" data-ref-filename="7local_approx_syscall_time_in_cycles">local_approx_syscall_time_in_cycles</a> =</td></tr>
<tr><th id="143">143</th><td>            (<a class="local col7 ref" href="#7local_approx_syscall_time_in_cycles" title='local_approx_syscall_time_in_cycles' data-ref="7local_approx_syscall_time_in_cycles" data-ref-filename="7local_approx_syscall_time_in_cycles">local_approx_syscall_time_in_cycles</a> + <var>1</var>) &lt;&lt; <var>1</var>;</td></tr>
<tr><th id="144">144</th><td>      }</td></tr>
<tr><th id="145">145</th><td>      <a class="local col6 ref" href="#6approx_syscall_time_in_cycles" title='approx_syscall_time_in_cycles' data-ref="6approx_syscall_time_in_cycles" data-ref-filename="6approx_syscall_time_in_cycles">approx_syscall_time_in_cycles</a>.<span class='ref fn' title='std::__atomic_base::store' data-ref="_ZNSt13__atomic_base5storeET_St12memory_order" data-ref-filename="_ZNSt13__atomic_base5storeET_St12memory_order">store</span>(</td></tr>
<tr><th id="146">146</th><td>          <a class="local col7 ref" href="#7local_approx_syscall_time_in_cycles" title='local_approx_syscall_time_in_cycles' data-ref="7local_approx_syscall_time_in_cycles" data-ref-filename="7local_approx_syscall_time_in_cycles">local_approx_syscall_time_in_cycles</a>,</td></tr>
<tr><th id="147">147</th><td>          <span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="148">148</th><td>    }</td></tr>
<tr><th id="149">149</th><td>  } <b>while</b> (<a class="local col1 ref" href="#11elapsed_cycles" title='elapsed_cycles' data-ref="11elapsed_cycles" data-ref-filename="11elapsed_cycles">elapsed_cycles</a> &gt;= <a class="local col7 ref" href="#7local_approx_syscall_time_in_cycles" title='local_approx_syscall_time_in_cycles' data-ref="7local_approx_syscall_time_in_cycles" data-ref-filename="7local_approx_syscall_time_in_cycles">local_approx_syscall_time_in_cycles</a> ||</td></tr>
<tr><th id="150">150</th><td>           <a class="local col4 ref" href="#4last_cycleclock" title='last_cycleclock' data-ref="4last_cycleclock" data-ref-filename="4last_cycleclock">last_cycleclock</a> - <a class="local col0 ref" href="#10after_cycles" title='after_cycles' data-ref="10after_cycles" data-ref-filename="10after_cycles">after_cycles</a> &lt; (<b>static_cast</b>&lt;<a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a>&gt;(<var>1</var>) &lt;&lt; <var>16</var>));</td></tr>
<tr><th id="151">151</th><td></td></tr>
<tr><th id="152">152</th><td>  <i>// Number of times in a row we've seen a kernel time call take substantially</i></td></tr>
<tr><th id="153">153</th><td><i>  // less than approx_syscall_time_in_cycles.</i></td></tr>
<tr><th id="154">154</th><td>  <em>static</em> <span class="namespace">std::</span><span class='type' title='std::atomic' data-ref="std::atomic" data-ref-filename="std..atomic">atomic</span>&lt;<a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a>&gt; <dfn class="local col3 decl" id="13seen_smaller" title='seen_smaller' data-type='std::atomic&lt;uint32_t&gt;' data-ref="13seen_smaller" data-ref-filename="13seen_smaller">seen_smaller</dfn><span class='ref fn' title='std::atomic&lt;unsigned int&gt;::atomic' data-ref="_ZNSt6atomicIjEC1Ej" data-ref-filename="_ZNSt6atomicIjEC1Ej">{</span> <var>0</var> };</td></tr>
<tr><th id="155">155</th><td></td></tr>
<tr><th id="156">156</th><td>  <i>// Adjust approx_syscall_time_in_cycles to be within a factor of 2</i></td></tr>
<tr><th id="157">157</th><td><i>  // of the typical time to execute one iteration of the loop above.</i></td></tr>
<tr><th id="158">158</th><td>  <b>if</b> ((<a class="local col7 ref" href="#7local_approx_syscall_time_in_cycles" title='local_approx_syscall_time_in_cycles' data-ref="7local_approx_syscall_time_in_cycles" data-ref-filename="7local_approx_syscall_time_in_cycles">local_approx_syscall_time_in_cycles</a> &gt;&gt; <var>1</var>) &lt; <a class="local col1 ref" href="#11elapsed_cycles" title='elapsed_cycles' data-ref="11elapsed_cycles" data-ref-filename="11elapsed_cycles">elapsed_cycles</a>) {</td></tr>
<tr><th id="159">159</th><td>    <i>// measured time is no smaller than half current approximation</i></td></tr>
<tr><th id="160">160</th><td>    <a class="local col3 ref" href="#13seen_smaller" title='seen_smaller' data-ref="13seen_smaller" data-ref-filename="13seen_smaller">seen_smaller</a>.<span class='ref fn' title='std::__atomic_base::store' data-ref="_ZNSt13__atomic_base5storeET_St12memory_order" data-ref-filename="_ZNSt13__atomic_base5storeET_St12memory_order">store</span>(<var>0</var>, <span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="161">161</th><td>  } <b>else</b> <b>if</b> (<a class="local col3 ref" href="#13seen_smaller" title='seen_smaller' data-ref="13seen_smaller" data-ref-filename="13seen_smaller">seen_smaller</a>.<span class='ref fn' title='std::__atomic_base::fetch_add' data-ref="_ZNSt13__atomic_base9fetch_addET_St12memory_order" data-ref-filename="_ZNSt13__atomic_base9fetch_addET_St12memory_order">fetch_add</span>(<var>1</var>, <span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>) &gt;= <var>3</var>) {</td></tr>
<tr><th id="162">162</th><td>    <i>// smaller delays several times in a row; reduce approximation by 12.5%</i></td></tr>
<tr><th id="163">163</th><td>    <em>const</em> <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col4 decl" id="14new_approximation" title='new_approximation' data-type='const uint64_t' data-ref="14new_approximation" data-ref-filename="14new_approximation">new_approximation</dfn> =</td></tr>
<tr><th id="164">164</th><td>        <a class="local col7 ref" href="#7local_approx_syscall_time_in_cycles" title='local_approx_syscall_time_in_cycles' data-ref="7local_approx_syscall_time_in_cycles" data-ref-filename="7local_approx_syscall_time_in_cycles">local_approx_syscall_time_in_cycles</a> -</td></tr>
<tr><th id="165">165</th><td>        (<a class="local col7 ref" href="#7local_approx_syscall_time_in_cycles" title='local_approx_syscall_time_in_cycles' data-ref="7local_approx_syscall_time_in_cycles" data-ref-filename="7local_approx_syscall_time_in_cycles">local_approx_syscall_time_in_cycles</a> &gt;&gt; <var>3</var>);</td></tr>
<tr><th id="166">166</th><td>    <a class="local col6 ref" href="#6approx_syscall_time_in_cycles" title='approx_syscall_time_in_cycles' data-ref="6approx_syscall_time_in_cycles" data-ref-filename="6approx_syscall_time_in_cycles">approx_syscall_time_in_cycles</a>.<span class='ref fn' title='std::__atomic_base::store' data-ref="_ZNSt13__atomic_base5storeET_St12memory_order" data-ref-filename="_ZNSt13__atomic_base5storeET_St12memory_order">store</span>(<a class="local col4 ref" href="#14new_approximation" title='new_approximation' data-ref="14new_approximation" data-ref-filename="14new_approximation">new_approximation</a>,</td></tr>
<tr><th id="167">167</th><td>                                        <span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="168">168</th><td>    <a class="local col3 ref" href="#13seen_smaller" title='seen_smaller' data-ref="13seen_smaller" data-ref-filename="13seen_smaller">seen_smaller</a>.<span class='ref fn' title='std::__atomic_base::store' data-ref="_ZNSt13__atomic_base5storeET_St12memory_order" data-ref-filename="_ZNSt13__atomic_base5storeET_St12memory_order">store</span>(<var>0</var>, <span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="169">169</th><td>  }</td></tr>
<tr><th id="170">170</th><td></td></tr>
<tr><th id="171">171</th><td>  *<a class="local col5 ref" href="#5cycleclock" title='cycleclock' data-ref="5cycleclock" data-ref-filename="5cycleclock">cycleclock</a> = <a class="local col0 ref" href="#10after_cycles" title='after_cycles' data-ref="10after_cycles" data-ref-filename="10after_cycles">after_cycles</a>;</td></tr>
<tr><th id="172">172</th><td>  <b>return</b> <a class="local col8 ref" href="#8current_time_nanos_from_system" title='current_time_nanos_from_system' data-ref="8current_time_nanos_from_system" data-ref-filename="8current_time_nanos_from_system">current_time_nanos_from_system</a>;</td></tr>
<tr><th id="173">173</th><td>}</td></tr>
<tr><th id="174">174</th><td></td></tr>
<tr><th id="175">175</th><td></td></tr>
<tr><th id="176">176</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L10SeqAcquireEPSt6atomicImE">// ---------------------------------------------------------------------</i></td></tr>
<tr><th id="177">177</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L10SeqAcquireEPSt6atomicImE">// An implementation of reader-write locks that use no atomic ops in the read</i></td></tr>
<tr><th id="178">178</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L10SeqAcquireEPSt6atomicImE">// case.  This is a generalization of Lamport's method for reading a multiword</i></td></tr>
<tr><th id="179">179</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L10SeqAcquireEPSt6atomicImE">// clock.  Increment a word on each write acquisition, using the low-order bit</i></td></tr>
<tr><th id="180">180</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L10SeqAcquireEPSt6atomicImE">// as a spinlock; the word is the high word of the "clock".  Readers read the</i></td></tr>
<tr><th id="181">181</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L10SeqAcquireEPSt6atomicImE">// high word, then all other data, then the high word again, and repeat the</i></td></tr>
<tr><th id="182">182</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L10SeqAcquireEPSt6atomicImE">// read if the reads of the high words yields different answers, or an odd</i></td></tr>
<tr><th id="183">183</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L10SeqAcquireEPSt6atomicImE">// value (either case suggests possible interference from a writer).</i></td></tr>
<tr><th id="184">184</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L10SeqAcquireEPSt6atomicImE">// Here we use a spinlock to ensure only one writer at a time, rather than</i></td></tr>
<tr><th id="185">185</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L10SeqAcquireEPSt6atomicImE">// spinning on the bottom bit of the word to benefit from SpinLock</i></td></tr>
<tr><th id="186">186</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L10SeqAcquireEPSt6atomicImE">// spin-delay tuning.</i></td></tr>
<tr><th id="187">187</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L10SeqAcquireEPSt6atomicImE"></i></td></tr>
<tr><th id="188">188</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L10SeqAcquireEPSt6atomicImE">// Acquire seqlock (*seq) and return the value to be written to unlock.</i></td></tr>
<tr><th id="189">189</th><td><em>static</em> <b>inline</b> <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="tu decl def fn" id="_ZN4absl14lts_2020_02_25L10SeqAcquireEPSt6atomicImE" title='absl::lts_2020_02_25::SeqAcquire' data-type='uint64_t absl::lts_2020_02_25::SeqAcquire(std::atomic&lt;uint64_t&gt; * seq)' data-ref="_ZN4absl14lts_2020_02_25L10SeqAcquireEPSt6atomicImE" data-ref-filename="_ZN4absl14lts_2020_02_25L10SeqAcquireEPSt6atomicImE">SeqAcquire</dfn>(<span class="namespace">std::</span><span class='type' title='std::atomic' data-ref="std::atomic" data-ref-filename="std..atomic">atomic</span>&lt;<a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a>&gt; *<dfn class="local col5 decl" id="15seq" title='seq' data-type='std::atomic&lt;uint64_t&gt; *' data-ref="15seq" data-ref-filename="15seq">seq</dfn>) {</td></tr>
<tr><th id="190">190</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col6 decl" id="16x" title='x' data-type='uint64_t' data-ref="16x" data-ref-filename="16x">x</dfn> = <a class="local col5 ref" href="#15seq" title='seq' data-ref="15seq" data-ref-filename="15seq">seq</a>-&gt;<span class='ref fn' title='std::__atomic_base::fetch_add' data-ref="_ZNSt13__atomic_base9fetch_addET_St12memory_order" data-ref-filename="_ZNSt13__atomic_base9fetch_addET_St12memory_order">fetch_add</span>(<var>1</var>, <span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="191">191</th><td></td></tr>
<tr><th id="192">192</th><td>  <i>// We put a release fence between update to *seq and writes to shared data.</i></td></tr>
<tr><th id="193">193</th><td><i>  // Thus all stores to shared data are effectively release operations and</i></td></tr>
<tr><th id="194">194</th><td><i>  // update to *seq above cannot be re-ordered past any of them.  Note that</i></td></tr>
<tr><th id="195">195</th><td><i>  // this barrier is not for the fetch_add above.  A release barrier for the</i></td></tr>
<tr><th id="196">196</th><td><i>  // fetch_add would be before it, not after.</i></td></tr>
<tr><th id="197">197</th><td>  <span class="namespace">std::</span><span class='ref fn' title='std::atomic_thread_fence' data-ref="_ZSt19atomic_thread_fenceSt12memory_order" data-ref-filename="_ZSt19atomic_thread_fenceSt12memory_order">atomic_thread_fence</span>(<span class="namespace">std::</span><span class='enum' title='std::memory_order_release' data-ref="std::memory_order_release" data-ref-filename="std..memory_order_release">memory_order_release</span>);</td></tr>
<tr><th id="198">198</th><td></td></tr>
<tr><th id="199">199</th><td>  <b>return</b> <a class="local col6 ref" href="#16x" title='x' data-ref="16x" data-ref-filename="16x">x</a> + <var>2</var>;   <i>// original word plus 2</i></td></tr>
<tr><th id="200">200</th><td>}</td></tr>
<tr><th id="201">201</th><td></td></tr>
<tr><th id="202">202</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L10SeqReleaseEPSt6atomicImEm">// Release seqlock (*seq) by writing x to it---a value previously returned by</i></td></tr>
<tr><th id="203">203</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L10SeqReleaseEPSt6atomicImEm">// SeqAcquire.</i></td></tr>
<tr><th id="204">204</th><td><em>static</em> <b>inline</b> <em>void</em> <dfn class="tu decl def fn" id="_ZN4absl14lts_2020_02_25L10SeqReleaseEPSt6atomicImEm" title='absl::lts_2020_02_25::SeqRelease' data-type='void absl::lts_2020_02_25::SeqRelease(std::atomic&lt;uint64_t&gt; * seq, uint64_t x)' data-ref="_ZN4absl14lts_2020_02_25L10SeqReleaseEPSt6atomicImEm" data-ref-filename="_ZN4absl14lts_2020_02_25L10SeqReleaseEPSt6atomicImEm">SeqRelease</dfn>(<span class="namespace">std::</span><span class='type' title='std::atomic' data-ref="std::atomic" data-ref-filename="std..atomic">atomic</span>&lt;<a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a>&gt; *<dfn class="local col7 decl" id="17seq" title='seq' data-type='std::atomic&lt;uint64_t&gt; *' data-ref="17seq" data-ref-filename="17seq">seq</dfn>, <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col8 decl" id="18x" title='x' data-type='uint64_t' data-ref="18x" data-ref-filename="18x">x</dfn>) {</td></tr>
<tr><th id="205">205</th><td>  <i>// The unlock store to *seq must have release ordering so that all</i></td></tr>
<tr><th id="206">206</th><td><i>  // updates to shared data must finish before this store.</i></td></tr>
<tr><th id="207">207</th><td>  <a class="local col7 ref" href="#17seq" title='seq' data-ref="17seq" data-ref-filename="17seq">seq</a>-&gt;<span class='ref fn' title='std::__atomic_base::store' data-ref="_ZNSt13__atomic_base5storeET_St12memory_order" data-ref-filename="_ZNSt13__atomic_base5storeET_St12memory_order">store</span>(<a class="local col8 ref" href="#18x" title='x' data-ref="18x" data-ref-filename="18x">x</a>, <span class="namespace">std::</span><span class='enum' title='std::memory_order_release' data-ref="std::memory_order_release" data-ref-filename="std..memory_order_release">memory_order_release</span>);  <i>// release lock for readers</i></td></tr>
<tr><th id="208">208</th><td>}</td></tr>
<tr><th id="209">209</th><td></td></tr>
<tr><th id="210">210</th><td><i>// ---------------------------------------------------------------------</i></td></tr>
<tr><th id="211">211</th><td><i></i></td></tr>
<tr><th id="212">212</th><td><i>// "nsscaled" is unit of time equal to a (2**kScale)th of a nanosecond.</i></td></tr>
<tr><th id="213">213</th><td><b>enum</b> { <dfn class="enum" id="absl::lts_2020_02_25::kScale" title='absl::lts_2020_02_25::kScale' data-ref="absl::lts_2020_02_25::kScale" data-ref-filename="absl..lts_2020_02_25..kScale">kScale</dfn> = <var>30</var> };</td></tr>
<tr><th id="214">214</th><td></td></tr>
<tr><th id="215">215</th><td><i  data-doc="absl::lts_2020_02_25::kMinNSBetweenSamples">// The minimum interval between samples of the time base.</i></td></tr>
<tr><th id="216">216</th><td><i  data-doc="absl::lts_2020_02_25::kMinNSBetweenSamples">// We pick enough time to amortize the cost of the sample,</i></td></tr>
<tr><th id="217">217</th><td><i  data-doc="absl::lts_2020_02_25::kMinNSBetweenSamples">// to get a reasonably accurate cycle counter rate reading,</i></td></tr>
<tr><th id="218">218</th><td><i  data-doc="absl::lts_2020_02_25::kMinNSBetweenSamples">// and not so much that calculations will overflow 64-bits.</i></td></tr>
<tr><th id="219">219</th><td><em>static</em> <em>const</em> <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="tu decl def" id="absl::lts_2020_02_25::kMinNSBetweenSamples" title='absl::lts_2020_02_25::kMinNSBetweenSamples' data-type='const uint64_t' data-ref="absl::lts_2020_02_25::kMinNSBetweenSamples" data-ref-filename="absl..lts_2020_02_25..kMinNSBetweenSamples">kMinNSBetweenSamples</dfn> = <var>2000</var> &lt;&lt; <var>20</var>;</td></tr>
<tr><th id="220">220</th><td></td></tr>
<tr><th id="221">221</th><td><i>// We require that kMinNSBetweenSamples shifted by kScale</i></td></tr>
<tr><th id="222">222</th><td><i>// have at least a bit left over for 64-bit calculations.</i></td></tr>
<tr><th id="223">223</th><td><b>static_assert</b>(((<a class="tu ref" href="#absl::lts_2020_02_25::kMinNSBetweenSamples" title='absl::lts_2020_02_25::kMinNSBetweenSamples' data-use='r' data-ref="absl::lts_2020_02_25::kMinNSBetweenSamples" data-ref-filename="absl..lts_2020_02_25..kMinNSBetweenSamples">kMinNSBetweenSamples</a> &lt;&lt; (<a class="enum" href="#absl::lts_2020_02_25::kScale" title='absl::lts_2020_02_25::kScale' data-ref="absl::lts_2020_02_25::kScale" data-ref-filename="absl..lts_2020_02_25..kScale">kScale</a> + <var>1</var>)) &gt;&gt; (<a class="enum" href="#absl::lts_2020_02_25::kScale" title='absl::lts_2020_02_25::kScale' data-ref="absl::lts_2020_02_25::kScale" data-ref-filename="absl..lts_2020_02_25..kScale">kScale</a> + <var>1</var>)) ==</td></tr>
<tr><th id="224">224</th><td>               <a class="tu ref" href="#absl::lts_2020_02_25::kMinNSBetweenSamples" title='absl::lts_2020_02_25::kMinNSBetweenSamples' data-use='r' data-ref="absl::lts_2020_02_25::kMinNSBetweenSamples" data-ref-filename="absl..lts_2020_02_25..kMinNSBetweenSamples">kMinNSBetweenSamples</a>,</td></tr>
<tr><th id="225">225</th><td>               <q>"cannot represent kMaxBetweenSamplesNSScaled"</q>);</td></tr>
<tr><th id="226">226</th><td></td></tr>
<tr><th id="227">227</th><td><i  data-doc="absl::lts_2020_02_25::lock">// A reader-writer lock protecting the static locations below.</i></td></tr>
<tr><th id="228">228</th><td><i  data-doc="absl::lts_2020_02_25::lock">// See SeqAcquire() and SeqRelease() above.</i></td></tr>
<tr><th id="229">229</th><td><em>static</em> <span class="namespace">absl::base_internal::</span><a class="type" href="../base/internal/spinlock.h.html#absl::lts_2020_02_25::base_internal::SpinLock" title='absl::lts_2020_02_25::base_internal::SpinLock' data-ref="absl::lts_2020_02_25::base_internal::SpinLock" data-ref-filename="absl..lts_2020_02_25..base_internal..SpinLock">SpinLock</a> <dfn class="tu decl def" id="absl::lts_2020_02_25::lock" title='absl::lts_2020_02_25::lock' data-type='absl::base_internal::SpinLock' data-ref="absl::lts_2020_02_25::lock" data-ref-filename="absl..lts_2020_02_25..lock">lock</dfn><a class="ref fn" href="../base/internal/spinlock.h.html#_ZN4absl14lts_2020_02_2513base_internal8SpinLockC1ENS1_17LinkerInitializedE" title='absl::lts_2020_02_25::base_internal::SpinLock::SpinLock' data-ref="_ZN4absl14lts_2020_02_2513base_internal8SpinLockC1ENS1_17LinkerInitializedE" data-ref-filename="_ZN4absl14lts_2020_02_2513base_internal8SpinLockC1ENS1_17LinkerInitializedE">(</a></td></tr>
<tr><th id="230">230</th><td>    <span class="namespace">absl::base_internal::</span><a class="enum" href="../base/macros.h.html#absl::lts_2020_02_25::base_internal::kLinkerInitialized" title='absl::lts_2020_02_25::base_internal::kLinkerInitialized' data-ref="absl::lts_2020_02_25::base_internal::kLinkerInitialized" data-ref-filename="absl..lts_2020_02_25..base_internal..kLinkerInitialized">kLinkerInitialized</a>);</td></tr>
<tr><th id="231">231</th><td><em>static</em> <span class="namespace">std::</span><span class='type' title='std::atomic' data-ref="std::atomic" data-ref-filename="std..atomic">atomic</span>&lt;<a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a>&gt; <dfn class="tu decl def" id="absl::lts_2020_02_25::seq" title='absl::lts_2020_02_25::seq' data-type='std::atomic&lt;uint64_t&gt;' data-ref="absl::lts_2020_02_25::seq" data-ref-filename="absl..lts_2020_02_25..seq">seq</dfn><span class='ref fn' title='std::atomic&lt;unsigned long&gt;::atomic' data-ref="_ZNSt6atomicImEC1Em" data-ref-filename="_ZNSt6atomicImEC1Em">(</span><var>0</var>);</td></tr>
<tr><th id="232">232</th><td></td></tr>
<tr><th id="233">233</th><td><i>// data from a sample of the kernel's time value</i></td></tr>
<tr><th id="234">234</th><td><b>struct</b> <dfn class="type def" id="absl::lts_2020_02_25::TimeSampleAtomic" title='absl::lts_2020_02_25::TimeSampleAtomic' data-ref="absl::lts_2020_02_25::TimeSampleAtomic" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic">TimeSampleAtomic</dfn> {</td></tr>
<tr><th id="235">235</th><td>  <span class="namespace">std::</span><span class='type' title='std::atomic' data-ref="std::atomic" data-ref-filename="std..atomic">atomic</span>&lt;<a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a>&gt; <dfn class="tu decl field" id="absl::lts_2020_02_25::TimeSampleAtomic::raw_ns" title='absl::lts_2020_02_25::TimeSampleAtomic::raw_ns' data-type='std::atomic&lt;uint64_t&gt;' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::raw_ns" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..raw_ns">raw_ns</dfn>;              <i  data-doc="absl::lts_2020_02_25::TimeSampleAtomic::raw_ns">// raw kernel time</i></td></tr>
<tr><th id="236">236</th><td>  <span class="namespace">std::</span><span class='type' title='std::atomic' data-ref="std::atomic" data-ref-filename="std..atomic">atomic</span>&lt;<a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a>&gt; <dfn class="tu decl field" id="absl::lts_2020_02_25::TimeSampleAtomic::base_ns" title='absl::lts_2020_02_25::TimeSampleAtomic::base_ns' data-type='std::atomic&lt;uint64_t&gt;' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::base_ns" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..base_ns">base_ns</dfn>;             <i  data-doc="absl::lts_2020_02_25::TimeSampleAtomic::base_ns">// our estimate of time</i></td></tr>
<tr><th id="237">237</th><td>  <span class="namespace">std::</span><span class='type' title='std::atomic' data-ref="std::atomic" data-ref-filename="std..atomic">atomic</span>&lt;<a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a>&gt; <dfn class="tu decl field" id="absl::lts_2020_02_25::TimeSampleAtomic::base_cycles" title='absl::lts_2020_02_25::TimeSampleAtomic::base_cycles' data-type='std::atomic&lt;uint64_t&gt;' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::base_cycles" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..base_cycles">base_cycles</dfn>;         <i  data-doc="absl::lts_2020_02_25::TimeSampleAtomic::base_cycles">// cycle counter reading</i></td></tr>
<tr><th id="238">238</th><td>  <span class="namespace">std::</span><span class='type' title='std::atomic' data-ref="std::atomic" data-ref-filename="std..atomic">atomic</span>&lt;<a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a>&gt; <dfn class="tu decl field" id="absl::lts_2020_02_25::TimeSampleAtomic::nsscaled_per_cycle" title='absl::lts_2020_02_25::TimeSampleAtomic::nsscaled_per_cycle' data-type='std::atomic&lt;uint64_t&gt;' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::nsscaled_per_cycle" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..nsscaled_per_cycle">nsscaled_per_cycle</dfn>;  <i  data-doc="absl::lts_2020_02_25::TimeSampleAtomic::nsscaled_per_cycle">// cycle period</i></td></tr>
<tr><th id="239">239</th><td>  <i  data-doc="absl::lts_2020_02_25::TimeSampleAtomic::min_cycles_per_sample">// cycles before we'll sample again (a scaled reciprocal of the period,</i></td></tr>
<tr><th id="240">240</th><td><i  data-doc="absl::lts_2020_02_25::TimeSampleAtomic::min_cycles_per_sample">  // to avoid a division on the fast path).</i></td></tr>
<tr><th id="241">241</th><td>  <span class="namespace">std::</span><span class='type' title='std::atomic' data-ref="std::atomic" data-ref-filename="std..atomic">atomic</span>&lt;<a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a>&gt; <dfn class="tu decl field" id="absl::lts_2020_02_25::TimeSampleAtomic::min_cycles_per_sample" title='absl::lts_2020_02_25::TimeSampleAtomic::min_cycles_per_sample' data-type='std::atomic&lt;uint64_t&gt;' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::min_cycles_per_sample" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..min_cycles_per_sample">min_cycles_per_sample</dfn>;</td></tr>
<tr><th id="242">242</th><td>};</td></tr>
<tr><th id="243">243</th><td><i>// Same again, but with non-atomic types</i></td></tr>
<tr><th id="244">244</th><td><b>struct</b> <dfn class="type def" id="absl::lts_2020_02_25::TimeSample" title='absl::lts_2020_02_25::TimeSample' data-ref="absl::lts_2020_02_25::TimeSample" data-ref-filename="absl..lts_2020_02_25..TimeSample">TimeSample</dfn> {</td></tr>
<tr><th id="245">245</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="tu decl field" id="absl::lts_2020_02_25::TimeSample::raw_ns" title='absl::lts_2020_02_25::TimeSample::raw_ns' data-type='uint64_t' data-ref="absl::lts_2020_02_25::TimeSample::raw_ns" data-ref-filename="absl..lts_2020_02_25..TimeSample..raw_ns">raw_ns</dfn>;                 <i  data-doc="absl::lts_2020_02_25::TimeSample::raw_ns">// raw kernel time</i></td></tr>
<tr><th id="246">246</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="tu decl field" id="absl::lts_2020_02_25::TimeSample::base_ns" title='absl::lts_2020_02_25::TimeSample::base_ns' data-type='uint64_t' data-ref="absl::lts_2020_02_25::TimeSample::base_ns" data-ref-filename="absl..lts_2020_02_25..TimeSample..base_ns">base_ns</dfn>;                <i  data-doc="absl::lts_2020_02_25::TimeSample::base_ns">// our estimate of time</i></td></tr>
<tr><th id="247">247</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="tu decl field" id="absl::lts_2020_02_25::TimeSample::base_cycles" title='absl::lts_2020_02_25::TimeSample::base_cycles' data-type='uint64_t' data-ref="absl::lts_2020_02_25::TimeSample::base_cycles" data-ref-filename="absl..lts_2020_02_25..TimeSample..base_cycles">base_cycles</dfn>;            <i  data-doc="absl::lts_2020_02_25::TimeSample::base_cycles">// cycle counter reading</i></td></tr>
<tr><th id="248">248</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="tu decl field" id="absl::lts_2020_02_25::TimeSample::nsscaled_per_cycle" title='absl::lts_2020_02_25::TimeSample::nsscaled_per_cycle' data-type='uint64_t' data-ref="absl::lts_2020_02_25::TimeSample::nsscaled_per_cycle" data-ref-filename="absl..lts_2020_02_25..TimeSample..nsscaled_per_cycle">nsscaled_per_cycle</dfn>;     <i  data-doc="absl::lts_2020_02_25::TimeSample::nsscaled_per_cycle">// cycle period</i></td></tr>
<tr><th id="249">249</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="tu decl field" id="absl::lts_2020_02_25::TimeSample::min_cycles_per_sample" title='absl::lts_2020_02_25::TimeSample::min_cycles_per_sample' data-type='uint64_t' data-ref="absl::lts_2020_02_25::TimeSample::min_cycles_per_sample" data-ref-filename="absl..lts_2020_02_25..TimeSample..min_cycles_per_sample">min_cycles_per_sample</dfn>;  <i  data-doc="absl::lts_2020_02_25::TimeSample::min_cycles_per_sample">// approx cycles before next sample</i></td></tr>
<tr><th id="250">250</th><td>};</td></tr>
<tr><th id="251">251</th><td></td></tr>
<tr><th id="252">252</th><td><em>static</em> <b>struct</b> <a class="type" href="#absl::lts_2020_02_25::TimeSampleAtomic" title='absl::lts_2020_02_25::TimeSampleAtomic' data-ref="absl::lts_2020_02_25::TimeSampleAtomic" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic">TimeSampleAtomic</a> <a class="tu ref fn fake" href="#234" title='absl::lts_2020_02_25::TimeSampleAtomic::TimeSampleAtomic' data-use='c' data-ref="_ZN4absl14lts_2020_02_2516TimeSampleAtomicC1Ev" data-ref-filename="_ZN4absl14lts_2020_02_2516TimeSampleAtomicC1Ev"></a><dfn class="tu decl def" id="absl::lts_2020_02_25::last_sample" title='absl::lts_2020_02_25::last_sample' data-type='struct TimeSampleAtomic' data-ref="absl::lts_2020_02_25::last_sample" data-ref-filename="absl..lts_2020_02_25..last_sample">last_sample</dfn>;   <i  data-doc="absl::lts_2020_02_25::last_sample">// the last sample; under seq</i></td></tr>
<tr><th id="253">253</th><td></td></tr>
<tr><th id="254">254</th><td><em>static</em> <a class="typedef" href="../../../../../include/bits/stdint-intn.h.html#int64_t" title='int64_t' data-type='__int64_t' data-ref="int64_t" data-ref-filename="int64_t">int64_t</a> <a class="tu decl fn" href="#_ZN4absl14lts_2020_02_25L27GetCurrentTimeNanosSlowPathEv" title='absl::lts_2020_02_25::GetCurrentTimeNanosSlowPath' data-type='int64_t absl::lts_2020_02_25::GetCurrentTimeNanosSlowPath()' data-ref="_ZN4absl14lts_2020_02_25L27GetCurrentTimeNanosSlowPathEv" data-ref-filename="_ZN4absl14lts_2020_02_25L27GetCurrentTimeNanosSlowPathEv">GetCurrentTimeNanosSlowPath</a>() <a class="macro" href="../base/attributes.h.html#471" title="__attribute__((cold))" data-ref="_M/ABSL_ATTRIBUTE_COLD">ABSL_ATTRIBUTE_COLD</a>;</td></tr>
<tr><th id="255">255</th><td></td></tr>
<tr><th id="256">256</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L20ReadTimeSampleAtomicEPKNS0_16TimeSampleAtomicEPNS0_10TimeSampleE">// Read the contents of *atomic into *sample.</i></td></tr>
<tr><th id="257">257</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L20ReadTimeSampleAtomicEPKNS0_16TimeSampleAtomicEPNS0_10TimeSampleE">// Each field is read atomically, but to maintain atomicity between fields,</i></td></tr>
<tr><th id="258">258</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L20ReadTimeSampleAtomicEPKNS0_16TimeSampleAtomicEPNS0_10TimeSampleE">// the access must be done under a lock.</i></td></tr>
<tr><th id="259">259</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="_ZN4absl14lts_2020_02_25L20ReadTimeSampleAtomicEPKNS0_16TimeSampleAtomicEPNS0_10TimeSampleE" title='absl::lts_2020_02_25::ReadTimeSampleAtomic' data-type='void absl::lts_2020_02_25::ReadTimeSampleAtomic(const struct TimeSampleAtomic * atomic, struct TimeSample * sample)' data-ref="_ZN4absl14lts_2020_02_25L20ReadTimeSampleAtomicEPKNS0_16TimeSampleAtomicEPNS0_10TimeSampleE" data-ref-filename="_ZN4absl14lts_2020_02_25L20ReadTimeSampleAtomicEPKNS0_16TimeSampleAtomicEPNS0_10TimeSampleE">ReadTimeSampleAtomic</dfn>(<em>const</em> <b>struct</b> <a class="type" href="#absl::lts_2020_02_25::TimeSampleAtomic" title='absl::lts_2020_02_25::TimeSampleAtomic' data-ref="absl::lts_2020_02_25::TimeSampleAtomic" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic">TimeSampleAtomic</a> *<dfn class="local col9 decl" id="19atomic" title='atomic' data-type='const struct TimeSampleAtomic *' data-ref="19atomic" data-ref-filename="19atomic">atomic</dfn>,</td></tr>
<tr><th id="260">260</th><td>                                 <b>struct</b> <a class="type" href="#absl::lts_2020_02_25::TimeSample" title='absl::lts_2020_02_25::TimeSample' data-ref="absl::lts_2020_02_25::TimeSample" data-ref-filename="absl..lts_2020_02_25..TimeSample">TimeSample</a> *<dfn class="local col0 decl" id="20sample" title='sample' data-type='struct TimeSample *' data-ref="20sample" data-ref-filename="20sample">sample</dfn>) {</td></tr>
<tr><th id="261">261</th><td>  <a class="local col0 ref" href="#20sample" title='sample' data-ref="20sample" data-ref-filename="20sample">sample</a>-&gt;<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSample::base_ns" title='absl::lts_2020_02_25::TimeSample::base_ns' data-use='w' data-ref="absl::lts_2020_02_25::TimeSample::base_ns" data-ref-filename="absl..lts_2020_02_25..TimeSample..base_ns">base_ns</a> = <a class="local col9 ref" href="#19atomic" title='atomic' data-ref="19atomic" data-ref-filename="19atomic">atomic</a>-&gt;<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSampleAtomic::base_ns" title='absl::lts_2020_02_25::TimeSampleAtomic::base_ns' data-use='m' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::base_ns" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..base_ns">base_ns</a>.<span class='ref fn' title='std::__atomic_base::load' data-ref="_ZNKSt13__atomic_base4loadESt12memory_order" data-ref-filename="_ZNKSt13__atomic_base4loadESt12memory_order">load</span>(<span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="262">262</th><td>  <a class="local col0 ref" href="#20sample" title='sample' data-ref="20sample" data-ref-filename="20sample">sample</a>-&gt;<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSample::base_cycles" title='absl::lts_2020_02_25::TimeSample::base_cycles' data-use='w' data-ref="absl::lts_2020_02_25::TimeSample::base_cycles" data-ref-filename="absl..lts_2020_02_25..TimeSample..base_cycles">base_cycles</a> = <a class="local col9 ref" href="#19atomic" title='atomic' data-ref="19atomic" data-ref-filename="19atomic">atomic</a>-&gt;<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSampleAtomic::base_cycles" title='absl::lts_2020_02_25::TimeSampleAtomic::base_cycles' data-use='m' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::base_cycles" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..base_cycles">base_cycles</a>.<span class='ref fn' title='std::__atomic_base::load' data-ref="_ZNKSt13__atomic_base4loadESt12memory_order" data-ref-filename="_ZNKSt13__atomic_base4loadESt12memory_order">load</span>(<span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="263">263</th><td>  <a class="local col0 ref" href="#20sample" title='sample' data-ref="20sample" data-ref-filename="20sample">sample</a>-&gt;<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSample::nsscaled_per_cycle" title='absl::lts_2020_02_25::TimeSample::nsscaled_per_cycle' data-use='w' data-ref="absl::lts_2020_02_25::TimeSample::nsscaled_per_cycle" data-ref-filename="absl..lts_2020_02_25..TimeSample..nsscaled_per_cycle">nsscaled_per_cycle</a> =</td></tr>
<tr><th id="264">264</th><td>      <a class="local col9 ref" href="#19atomic" title='atomic' data-ref="19atomic" data-ref-filename="19atomic">atomic</a>-&gt;<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSampleAtomic::nsscaled_per_cycle" title='absl::lts_2020_02_25::TimeSampleAtomic::nsscaled_per_cycle' data-use='m' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::nsscaled_per_cycle" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..nsscaled_per_cycle">nsscaled_per_cycle</a>.<span class='ref fn' title='std::__atomic_base::load' data-ref="_ZNKSt13__atomic_base4loadESt12memory_order" data-ref-filename="_ZNKSt13__atomic_base4loadESt12memory_order">load</span>(<span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="265">265</th><td>  <a class="local col0 ref" href="#20sample" title='sample' data-ref="20sample" data-ref-filename="20sample">sample</a>-&gt;<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSample::min_cycles_per_sample" title='absl::lts_2020_02_25::TimeSample::min_cycles_per_sample' data-use='w' data-ref="absl::lts_2020_02_25::TimeSample::min_cycles_per_sample" data-ref-filename="absl..lts_2020_02_25..TimeSample..min_cycles_per_sample">min_cycles_per_sample</a> =</td></tr>
<tr><th id="266">266</th><td>      <a class="local col9 ref" href="#19atomic" title='atomic' data-ref="19atomic" data-ref-filename="19atomic">atomic</a>-&gt;<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSampleAtomic::min_cycles_per_sample" title='absl::lts_2020_02_25::TimeSampleAtomic::min_cycles_per_sample' data-use='m' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::min_cycles_per_sample" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..min_cycles_per_sample">min_cycles_per_sample</a>.<span class='ref fn' title='std::__atomic_base::load' data-ref="_ZNKSt13__atomic_base4loadESt12memory_order" data-ref-filename="_ZNKSt13__atomic_base4loadESt12memory_order">load</span>(<span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="267">267</th><td>  <a class="local col0 ref" href="#20sample" title='sample' data-ref="20sample" data-ref-filename="20sample">sample</a>-&gt;<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSample::raw_ns" title='absl::lts_2020_02_25::TimeSample::raw_ns' data-use='w' data-ref="absl::lts_2020_02_25::TimeSample::raw_ns" data-ref-filename="absl..lts_2020_02_25..TimeSample..raw_ns">raw_ns</a> = <a class="local col9 ref" href="#19atomic" title='atomic' data-ref="19atomic" data-ref-filename="19atomic">atomic</a>-&gt;<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSampleAtomic::raw_ns" title='absl::lts_2020_02_25::TimeSampleAtomic::raw_ns' data-use='m' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::raw_ns" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..raw_ns">raw_ns</a>.<span class='ref fn' title='std::__atomic_base::load' data-ref="_ZNKSt13__atomic_base4loadESt12memory_order" data-ref-filename="_ZNKSt13__atomic_base4loadESt12memory_order">load</span>(<span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="268">268</th><td>}</td></tr>
<tr><th id="269">269</th><td></td></tr>
<tr><th id="270">270</th><td><i>// Public routine.</i></td></tr>
<tr><th id="271">271</th><td><i>// Algorithm:  We wish to compute real time from a cycle counter.  In normal</i></td></tr>
<tr><th id="272">272</th><td><i>// operation, we construct a piecewise linear approximation to the kernel time</i></td></tr>
<tr><th id="273">273</th><td><i>// source, using the cycle counter value.  The start of each line segment is at</i></td></tr>
<tr><th id="274">274</th><td><i>// the same point as the end of the last, but may have a different slope (that</i></td></tr>
<tr><th id="275">275</th><td><i>// is, a different idea of the cycle counter frequency).  Every couple of</i></td></tr>
<tr><th id="276">276</th><td><i>// seconds, the kernel time source is sampled and compared with the current</i></td></tr>
<tr><th id="277">277</th><td><i>// approximation.  A new slope is chosen that, if followed for another couple</i></td></tr>
<tr><th id="278">278</th><td><i>// of seconds, will correct the error at the current position.  The information</i></td></tr>
<tr><th id="279">279</th><td><i>// for a sample is in the "last_sample" struct.  The linear approximation is</i></td></tr>
<tr><th id="280">280</th><td><i>//   estimated_time = last_sample.base_ns +</i></td></tr>
<tr><th id="281">281</th><td><i>//     last_sample.ns_per_cycle * (counter_reading - last_sample.base_cycles)</i></td></tr>
<tr><th id="282">282</th><td><i>// (ns_per_cycle is actually stored in different units and scaled, to avoid</i></td></tr>
<tr><th id="283">283</th><td><i>// overflow).  The base_ns of the next linear approximation is the</i></td></tr>
<tr><th id="284">284</th><td><i>// estimated_time using the last approximation; the base_cycles is the cycle</i></td></tr>
<tr><th id="285">285</th><td><i>// counter value at that time; the ns_per_cycle is the number of ns per cycle</i></td></tr>
<tr><th id="286">286</th><td><i>// measured since the last sample, but adjusted so that most of the difference</i></td></tr>
<tr><th id="287">287</th><td><i>// between the estimated_time and the kernel time will be corrected by the</i></td></tr>
<tr><th id="288">288</th><td><i>// estimated time to the next sample.  In normal operation, this algorithm</i></td></tr>
<tr><th id="289">289</th><td><i>// relies on:</i></td></tr>
<tr><th id="290">290</th><td><i>// - the cycle counter and kernel time rates not changing a lot in a few</i></td></tr>
<tr><th id="291">291</th><td><i>//   seconds.</i></td></tr>
<tr><th id="292">292</th><td><i>// - the client calling into the code often compared to a couple of seconds, so</i></td></tr>
<tr><th id="293">293</th><td><i>//   the time to the next correction can be estimated.</i></td></tr>
<tr><th id="294">294</th><td><i>// Any time ns_per_cycle is not known, a major error is detected, or the</i></td></tr>
<tr><th id="295">295</th><td><i>// assumption about frequent calls is violated, the implementation returns the</i></td></tr>
<tr><th id="296">296</th><td><i>// kernel time.  It records sufficient data that a linear approximation can</i></td></tr>
<tr><th id="297">297</th><td><i>// resume a little later.</i></td></tr>
<tr><th id="298">298</th><td></td></tr>
<tr><th id="299">299</th><td><a class="typedef" href="../../../../../include/bits/stdint-intn.h.html#int64_t" title='int64_t' data-type='__int64_t' data-ref="int64_t" data-ref-filename="int64_t">int64_t</a> <dfn class="decl def fn" id="_ZN4absl14lts_2020_02_2519GetCurrentTimeNanosEv" title='absl::lts_2020_02_25::GetCurrentTimeNanos' data-ref="_ZN4absl14lts_2020_02_2519GetCurrentTimeNanosEv" data-ref-filename="_ZN4absl14lts_2020_02_2519GetCurrentTimeNanosEv">GetCurrentTimeNanos</dfn>() {</td></tr>
<tr><th id="300">300</th><td>  <i>// read the data from the "last_sample" struct (but don't need raw_ns yet)</i></td></tr>
<tr><th id="301">301</th><td><i>  // The reads of "seq" and test of the values emulate a reader lock.</i></td></tr>
<tr><th id="302">302</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col1 decl" id="21base_ns" title='base_ns' data-type='uint64_t' data-ref="21base_ns" data-ref-filename="21base_ns">base_ns</dfn>;</td></tr>
<tr><th id="303">303</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col2 decl" id="22base_cycles" title='base_cycles' data-type='uint64_t' data-ref="22base_cycles" data-ref-filename="22base_cycles">base_cycles</dfn>;</td></tr>
<tr><th id="304">304</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col3 decl" id="23nsscaled_per_cycle" title='nsscaled_per_cycle' data-type='uint64_t' data-ref="23nsscaled_per_cycle" data-ref-filename="23nsscaled_per_cycle">nsscaled_per_cycle</dfn>;</td></tr>
<tr><th id="305">305</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col4 decl" id="24min_cycles_per_sample" title='min_cycles_per_sample' data-type='uint64_t' data-ref="24min_cycles_per_sample" data-ref-filename="24min_cycles_per_sample">min_cycles_per_sample</dfn>;</td></tr>
<tr><th id="306">306</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col5 decl" id="25seq_read0" title='seq_read0' data-type='uint64_t' data-ref="25seq_read0" data-ref-filename="25seq_read0">seq_read0</dfn>;</td></tr>
<tr><th id="307">307</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col6 decl" id="26seq_read1" title='seq_read1' data-type='uint64_t' data-ref="26seq_read1" data-ref-filename="26seq_read1">seq_read1</dfn>;</td></tr>
<tr><th id="308">308</th><td></td></tr>
<tr><th id="309">309</th><td>  <i>// If we have enough information to interpolate, the value returned will be</i></td></tr>
<tr><th id="310">310</th><td><i>  // derived from this cycleclock-derived time estimate.  On some platforms</i></td></tr>
<tr><th id="311">311</th><td><i>  // (POWER) the function to retrieve this value has enough complexity to</i></td></tr>
<tr><th id="312">312</th><td><i>  // contribute to register pressure - reading it early before initializing</i></td></tr>
<tr><th id="313">313</th><td><i>  // the other pieces of the calculation minimizes spill/restore instructions,</i></td></tr>
<tr><th id="314">314</th><td><i>  // minimizing icache cost.</i></td></tr>
<tr><th id="315">315</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col7 decl" id="27now_cycles" title='now_cycles' data-type='uint64_t' data-ref="27now_cycles" data-ref-filename="27now_cycles">now_cycles</dfn> = <a class="macro" href="#86" title="::absl::time_internal::UnscaledCycleClockWrapperForGetCurrentTime::Now()" data-ref="_M/GET_CURRENT_TIME_NANOS_CYCLECLOCK_NOW">GET_CURRENT_TIME_NANOS_CYCLECLOCK_NOW</a>();</td></tr>
<tr><th id="316">316</th><td></td></tr>
<tr><th id="317">317</th><td>  <i>// Acquire pairs with the barrier in SeqRelease - if this load sees that</i></td></tr>
<tr><th id="318">318</th><td><i>  // store, the shared-data reads necessarily see that SeqRelease's updates</i></td></tr>
<tr><th id="319">319</th><td><i>  // to the same shared data.</i></td></tr>
<tr><th id="320">320</th><td>  <a class="local col5 ref" href="#25seq_read0" title='seq_read0' data-ref="25seq_read0" data-ref-filename="25seq_read0">seq_read0</a> = <a class="tu ref" href="#absl::lts_2020_02_25::seq" title='absl::lts_2020_02_25::seq' data-use='m' data-ref="absl::lts_2020_02_25::seq" data-ref-filename="absl..lts_2020_02_25..seq">seq</a>.<span class='ref fn' title='std::__atomic_base::load' data-ref="_ZNKSt13__atomic_base4loadESt12memory_order" data-ref-filename="_ZNKSt13__atomic_base4loadESt12memory_order">load</span>(<span class="namespace">std::</span><span class='enum' title='std::memory_order_acquire' data-ref="std::memory_order_acquire" data-ref-filename="std..memory_order_acquire">memory_order_acquire</span>);</td></tr>
<tr><th id="321">321</th><td></td></tr>
<tr><th id="322">322</th><td>  <a class="local col1 ref" href="#21base_ns" title='base_ns' data-ref="21base_ns" data-ref-filename="21base_ns">base_ns</a> = <a class="tu ref" href="#absl::lts_2020_02_25::last_sample" title='absl::lts_2020_02_25::last_sample' data-use='m' data-ref="absl::lts_2020_02_25::last_sample" data-ref-filename="absl..lts_2020_02_25..last_sample">last_sample</a>.<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSampleAtomic::base_ns" title='absl::lts_2020_02_25::TimeSampleAtomic::base_ns' data-use='m' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::base_ns" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..base_ns">base_ns</a>.<span class='ref fn' title='std::__atomic_base::load' data-ref="_ZNKSt13__atomic_base4loadESt12memory_order" data-ref-filename="_ZNKSt13__atomic_base4loadESt12memory_order">load</span>(<span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="323">323</th><td>  <a class="local col2 ref" href="#22base_cycles" title='base_cycles' data-ref="22base_cycles" data-ref-filename="22base_cycles">base_cycles</a> = <a class="tu ref" href="#absl::lts_2020_02_25::last_sample" title='absl::lts_2020_02_25::last_sample' data-use='m' data-ref="absl::lts_2020_02_25::last_sample" data-ref-filename="absl..lts_2020_02_25..last_sample">last_sample</a>.<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSampleAtomic::base_cycles" title='absl::lts_2020_02_25::TimeSampleAtomic::base_cycles' data-use='m' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::base_cycles" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..base_cycles">base_cycles</a>.<span class='ref fn' title='std::__atomic_base::load' data-ref="_ZNKSt13__atomic_base4loadESt12memory_order" data-ref-filename="_ZNKSt13__atomic_base4loadESt12memory_order">load</span>(<span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="324">324</th><td>  <a class="local col3 ref" href="#23nsscaled_per_cycle" title='nsscaled_per_cycle' data-ref="23nsscaled_per_cycle" data-ref-filename="23nsscaled_per_cycle">nsscaled_per_cycle</a> =</td></tr>
<tr><th id="325">325</th><td>      <a class="tu ref" href="#absl::lts_2020_02_25::last_sample" title='absl::lts_2020_02_25::last_sample' data-use='m' data-ref="absl::lts_2020_02_25::last_sample" data-ref-filename="absl..lts_2020_02_25..last_sample">last_sample</a>.<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSampleAtomic::nsscaled_per_cycle" title='absl::lts_2020_02_25::TimeSampleAtomic::nsscaled_per_cycle' data-use='m' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::nsscaled_per_cycle" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..nsscaled_per_cycle">nsscaled_per_cycle</a>.<span class='ref fn' title='std::__atomic_base::load' data-ref="_ZNKSt13__atomic_base4loadESt12memory_order" data-ref-filename="_ZNKSt13__atomic_base4loadESt12memory_order">load</span>(<span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="326">326</th><td>  <a class="local col4 ref" href="#24min_cycles_per_sample" title='min_cycles_per_sample' data-ref="24min_cycles_per_sample" data-ref-filename="24min_cycles_per_sample">min_cycles_per_sample</a> =</td></tr>
<tr><th id="327">327</th><td>      <a class="tu ref" href="#absl::lts_2020_02_25::last_sample" title='absl::lts_2020_02_25::last_sample' data-use='m' data-ref="absl::lts_2020_02_25::last_sample" data-ref-filename="absl..lts_2020_02_25..last_sample">last_sample</a>.<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSampleAtomic::min_cycles_per_sample" title='absl::lts_2020_02_25::TimeSampleAtomic::min_cycles_per_sample' data-use='m' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::min_cycles_per_sample" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..min_cycles_per_sample">min_cycles_per_sample</a>.<span class='ref fn' title='std::__atomic_base::load' data-ref="_ZNKSt13__atomic_base4loadESt12memory_order" data-ref-filename="_ZNKSt13__atomic_base4loadESt12memory_order">load</span>(<span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="328">328</th><td></td></tr>
<tr><th id="329">329</th><td>  <i>// This acquire fence pairs with the release fence in SeqAcquire.  Since it</i></td></tr>
<tr><th id="330">330</th><td><i>  // is sequenced between reads of shared data and seq_read1, the reads of</i></td></tr>
<tr><th id="331">331</th><td><i>  // shared data are effectively acquiring.</i></td></tr>
<tr><th id="332">332</th><td>  <span class="namespace">std::</span><span class='ref fn' title='std::atomic_thread_fence' data-ref="_ZSt19atomic_thread_fenceSt12memory_order" data-ref-filename="_ZSt19atomic_thread_fenceSt12memory_order">atomic_thread_fence</span>(<span class="namespace">std::</span><span class='enum' title='std::memory_order_acquire' data-ref="std::memory_order_acquire" data-ref-filename="std..memory_order_acquire">memory_order_acquire</span>);</td></tr>
<tr><th id="333">333</th><td></td></tr>
<tr><th id="334">334</th><td>  <i>// The shared-data reads are effectively acquire ordered, and the</i></td></tr>
<tr><th id="335">335</th><td><i>  // shared-data writes are effectively release ordered. Therefore if our</i></td></tr>
<tr><th id="336">336</th><td><i>  // shared-data reads see any of a particular update's shared-data writes,</i></td></tr>
<tr><th id="337">337</th><td><i>  // seq_read1 is guaranteed to see that update's SeqAcquire.</i></td></tr>
<tr><th id="338">338</th><td>  <a class="local col6 ref" href="#26seq_read1" title='seq_read1' data-ref="26seq_read1" data-ref-filename="26seq_read1">seq_read1</a> = <a class="tu ref" href="#absl::lts_2020_02_25::seq" title='absl::lts_2020_02_25::seq' data-use='m' data-ref="absl::lts_2020_02_25::seq" data-ref-filename="absl..lts_2020_02_25..seq">seq</a>.<span class='ref fn' title='std::__atomic_base::load' data-ref="_ZNKSt13__atomic_base4loadESt12memory_order" data-ref-filename="_ZNKSt13__atomic_base4loadESt12memory_order">load</span>(<span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="339">339</th><td></td></tr>
<tr><th id="340">340</th><td>  <i>// Fast path.  Return if min_cycles_per_sample has not yet elapsed since the</i></td></tr>
<tr><th id="341">341</th><td><i>  // last sample, and we read a consistent sample.  The fast path activates</i></td></tr>
<tr><th id="342">342</th><td><i>  // only when min_cycles_per_sample is non-zero, which happens when we get an</i></td></tr>
<tr><th id="343">343</th><td><i>  // estimate for the cycle time.  The predicate will fail if now_cycles &lt;</i></td></tr>
<tr><th id="344">344</th><td><i>  // base_cycles, or if some other thread is in the slow path.</i></td></tr>
<tr><th id="345">345</th><td><i>  //</i></td></tr>
<tr><th id="346">346</th><td><i>  // Since we now read now_cycles before base_ns, it is possible for now_cycles</i></td></tr>
<tr><th id="347">347</th><td><i>  // to be less than base_cycles (if we were interrupted between those loads and</i></td></tr>
<tr><th id="348">348</th><td><i>  // last_sample was updated). This is harmless, because delta_cycles will wrap</i></td></tr>
<tr><th id="349">349</th><td><i>  // and report a time much much bigger than min_cycles_per_sample. In that case</i></td></tr>
<tr><th id="350">350</th><td><i>  // we will take the slow path.</i></td></tr>
<tr><th id="351">351</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col8 decl" id="28delta_cycles" title='delta_cycles' data-type='uint64_t' data-ref="28delta_cycles" data-ref-filename="28delta_cycles">delta_cycles</dfn> = <a class="local col7 ref" href="#27now_cycles" title='now_cycles' data-ref="27now_cycles" data-ref-filename="27now_cycles">now_cycles</a> - <a class="local col2 ref" href="#22base_cycles" title='base_cycles' data-ref="22base_cycles" data-ref-filename="22base_cycles">base_cycles</a>;</td></tr>
<tr><th id="352">352</th><td>  <b>if</b> (<a class="local col5 ref" href="#25seq_read0" title='seq_read0' data-ref="25seq_read0" data-ref-filename="25seq_read0">seq_read0</a> == <a class="local col6 ref" href="#26seq_read1" title='seq_read1' data-ref="26seq_read1" data-ref-filename="26seq_read1">seq_read1</a> &amp;&amp; (<a class="local col5 ref" href="#25seq_read0" title='seq_read0' data-ref="25seq_read0" data-ref-filename="25seq_read0">seq_read0</a> &amp; <var>1</var>) == <var>0</var> &amp;&amp;</td></tr>
<tr><th id="353">353</th><td>      <a class="local col8 ref" href="#28delta_cycles" title='delta_cycles' data-ref="28delta_cycles" data-ref-filename="28delta_cycles">delta_cycles</a> &lt; <a class="local col4 ref" href="#24min_cycles_per_sample" title='min_cycles_per_sample' data-ref="24min_cycles_per_sample" data-ref-filename="24min_cycles_per_sample">min_cycles_per_sample</a>) {</td></tr>
<tr><th id="354">354</th><td>    <b>return</b> <a class="local col1 ref" href="#21base_ns" title='base_ns' data-ref="21base_ns" data-ref-filename="21base_ns">base_ns</a> + ((<a class="local col8 ref" href="#28delta_cycles" title='delta_cycles' data-ref="28delta_cycles" data-ref-filename="28delta_cycles">delta_cycles</a> * <a class="local col3 ref" href="#23nsscaled_per_cycle" title='nsscaled_per_cycle' data-ref="23nsscaled_per_cycle" data-ref-filename="23nsscaled_per_cycle">nsscaled_per_cycle</a>) &gt;&gt; <a class="enum" href="#absl::lts_2020_02_25::kScale" title='absl::lts_2020_02_25::kScale' data-ref="absl::lts_2020_02_25::kScale" data-ref-filename="absl..lts_2020_02_25..kScale">kScale</a>);</td></tr>
<tr><th id="355">355</th><td>  }</td></tr>
<tr><th id="356">356</th><td>  <b>return</b> <a class="tu ref fn" href="#_ZN4absl14lts_2020_02_25L27GetCurrentTimeNanosSlowPathEv" title='absl::lts_2020_02_25::GetCurrentTimeNanosSlowPath' data-use='c' data-ref="_ZN4absl14lts_2020_02_25L27GetCurrentTimeNanosSlowPathEv" data-ref-filename="_ZN4absl14lts_2020_02_25L27GetCurrentTimeNanosSlowPathEv">GetCurrentTimeNanosSlowPath</a>();</td></tr>
<tr><th id="357">357</th><td>}</td></tr>
<tr><th id="358">358</th><td></td></tr>
<tr><th id="359">359</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L18SafeDivideAndScaleEmm">// Return (a &lt;&lt; kScale)/b.</i></td></tr>
<tr><th id="360">360</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L18SafeDivideAndScaleEmm">// Zero is returned if b==0.   Scaling is performed internally to</i></td></tr>
<tr><th id="361">361</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L18SafeDivideAndScaleEmm">// preserve precision without overflow.</i></td></tr>
<tr><th id="362">362</th><td><em>static</em> <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="tu decl def fn" id="_ZN4absl14lts_2020_02_25L18SafeDivideAndScaleEmm" title='absl::lts_2020_02_25::SafeDivideAndScale' data-type='uint64_t absl::lts_2020_02_25::SafeDivideAndScale(uint64_t a, uint64_t b)' data-ref="_ZN4absl14lts_2020_02_25L18SafeDivideAndScaleEmm" data-ref-filename="_ZN4absl14lts_2020_02_25L18SafeDivideAndScaleEmm">SafeDivideAndScale</dfn>(<a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col9 decl" id="29a" title='a' data-type='uint64_t' data-ref="29a" data-ref-filename="29a">a</dfn>, <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col0 decl" id="30b" title='b' data-type='uint64_t' data-ref="30b" data-ref-filename="30b">b</dfn>) {</td></tr>
<tr><th id="363">363</th><td>  <i>// Find maximum safe_shift so that</i></td></tr>
<tr><th id="364">364</th><td><i>  //  0 &lt;= safe_shift &lt;= kScale  and  (a &lt;&lt; safe_shift) does not overflow.</i></td></tr>
<tr><th id="365">365</th><td>  <em>int</em> <dfn class="local col1 decl" id="31safe_shift" title='safe_shift' data-type='int' data-ref="31safe_shift" data-ref-filename="31safe_shift">safe_shift</dfn> = <a class="enum" href="#absl::lts_2020_02_25::kScale" title='absl::lts_2020_02_25::kScale' data-ref="absl::lts_2020_02_25::kScale" data-ref-filename="absl..lts_2020_02_25..kScale">kScale</a>;</td></tr>
<tr><th id="366">366</th><td>  <b>while</b> (((<a class="local col9 ref" href="#29a" title='a' data-ref="29a" data-ref-filename="29a">a</a> &lt;&lt; <a class="local col1 ref" href="#31safe_shift" title='safe_shift' data-ref="31safe_shift" data-ref-filename="31safe_shift">safe_shift</a>) &gt;&gt; <a class="local col1 ref" href="#31safe_shift" title='safe_shift' data-ref="31safe_shift" data-ref-filename="31safe_shift">safe_shift</a>) != <a class="local col9 ref" href="#29a" title='a' data-ref="29a" data-ref-filename="29a">a</a>) {</td></tr>
<tr><th id="367">367</th><td>    <a class="local col1 ref" href="#31safe_shift" title='safe_shift' data-ref="31safe_shift" data-ref-filename="31safe_shift">safe_shift</a>--;</td></tr>
<tr><th id="368">368</th><td>  }</td></tr>
<tr><th id="369">369</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col2 decl" id="32scaled_b" title='scaled_b' data-type='uint64_t' data-ref="32scaled_b" data-ref-filename="32scaled_b">scaled_b</dfn> = <a class="local col0 ref" href="#30b" title='b' data-ref="30b" data-ref-filename="30b">b</a> &gt;&gt; (<a class="enum" href="#absl::lts_2020_02_25::kScale" title='absl::lts_2020_02_25::kScale' data-ref="absl::lts_2020_02_25::kScale" data-ref-filename="absl..lts_2020_02_25..kScale">kScale</a> - <a class="local col1 ref" href="#31safe_shift" title='safe_shift' data-ref="31safe_shift" data-ref-filename="31safe_shift">safe_shift</a>);</td></tr>
<tr><th id="370">370</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col3 decl" id="33quotient" title='quotient' data-type='uint64_t' data-ref="33quotient" data-ref-filename="33quotient">quotient</dfn> = <var>0</var>;</td></tr>
<tr><th id="371">371</th><td>  <b>if</b> (<a class="local col2 ref" href="#32scaled_b" title='scaled_b' data-ref="32scaled_b" data-ref-filename="32scaled_b">scaled_b</a> != <var>0</var>) {</td></tr>
<tr><th id="372">372</th><td>    <a class="local col3 ref" href="#33quotient" title='quotient' data-ref="33quotient" data-ref-filename="33quotient">quotient</a> = (<a class="local col9 ref" href="#29a" title='a' data-ref="29a" data-ref-filename="29a">a</a> &lt;&lt; <a class="local col1 ref" href="#31safe_shift" title='safe_shift' data-ref="31safe_shift" data-ref-filename="31safe_shift">safe_shift</a>) / <a class="local col2 ref" href="#32scaled_b" title='scaled_b' data-ref="32scaled_b" data-ref-filename="32scaled_b">scaled_b</a>;</td></tr>
<tr><th id="373">373</th><td>  }</td></tr>
<tr><th id="374">374</th><td>  <b>return</b> <a class="local col3 ref" href="#33quotient" title='quotient' data-ref="33quotient" data-ref-filename="33quotient">quotient</a>;</td></tr>
<tr><th id="375">375</th><td>}</td></tr>
<tr><th id="376">376</th><td></td></tr>
<tr><th id="377">377</th><td><em>static</em> <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <a class="tu decl fn" href="#_ZN4absl14lts_2020_02_25L16UpdateLastSampleEmmmPKNS0_10TimeSampleE" title='absl::lts_2020_02_25::UpdateLastSample' data-type='uint64_t absl::lts_2020_02_25::UpdateLastSample(uint64_t now_cycles, uint64_t now_ns, uint64_t delta_cycles, const struct TimeSample * sample)' data-ref="_ZN4absl14lts_2020_02_25L16UpdateLastSampleEmmmPKNS0_10TimeSampleE" data-ref-filename="_ZN4absl14lts_2020_02_25L16UpdateLastSampleEmmmPKNS0_10TimeSampleE">UpdateLastSample</a>(</td></tr>
<tr><th id="378">378</th><td>    <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col4 decl" id="34now_cycles" title='now_cycles' data-type='uint64_t' data-ref="34now_cycles" data-ref-filename="34now_cycles">now_cycles</dfn>, <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col5 decl" id="35now_ns" title='now_ns' data-type='uint64_t' data-ref="35now_ns" data-ref-filename="35now_ns">now_ns</dfn>, <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col6 decl" id="36delta_cycles" title='delta_cycles' data-type='uint64_t' data-ref="36delta_cycles" data-ref-filename="36delta_cycles">delta_cycles</dfn>,</td></tr>
<tr><th id="379">379</th><td>    <em>const</em> <b>struct</b> <a class="type" href="#absl::lts_2020_02_25::TimeSample" title='absl::lts_2020_02_25::TimeSample' data-ref="absl::lts_2020_02_25::TimeSample" data-ref-filename="absl..lts_2020_02_25..TimeSample">TimeSample</a> *<dfn class="local col7 decl" id="37sample" title='sample' data-type='const struct TimeSample *' data-ref="37sample" data-ref-filename="37sample">sample</dfn>) <a class="macro" href="../base/attributes.h.html#471" title="__attribute__((cold))" data-ref="_M/ABSL_ATTRIBUTE_COLD">ABSL_ATTRIBUTE_COLD</a>;</td></tr>
<tr><th id="380">380</th><td></td></tr>
<tr><th id="381">381</th><td><i>// The slow path of GetCurrentTimeNanos().  This is taken while gathering</i></td></tr>
<tr><th id="382">382</th><td><i>// initial samples, when enough time has elapsed since the last sample, and if</i></td></tr>
<tr><th id="383">383</th><td><i>// any other thread is writing to last_sample.</i></td></tr>
<tr><th id="384">384</th><td><i>//</i></td></tr>
<tr><th id="385">385</th><td><i>// Manually mark this 'noinline' to minimize stack frame size of the fast</i></td></tr>
<tr><th id="386">386</th><td><i>// path.  Without this, sometimes a compiler may inline this big block of code</i></td></tr>
<tr><th id="387">387</th><td><i>// into the fast path.  That causes lots of register spills and reloads that</i></td></tr>
<tr><th id="388">388</th><td><i>// are unnecessary unless the slow path is taken.</i></td></tr>
<tr><th id="389">389</th><td><i>//</i></td></tr>
<tr><th id="390">390</th><td><i>// TODO(absl-team): Remove this attribute when our compiler is smart enough</i></td></tr>
<tr><th id="391">391</th><td><i>// to do the right thing.</i></td></tr>
<tr><th id="392">392</th><td><a class="macro" href="../base/attributes.h.html#133" title="__attribute__((noinline))" data-ref="_M/ABSL_ATTRIBUTE_NOINLINE">ABSL_ATTRIBUTE_NOINLINE</a></td></tr>
<tr><th id="393">393</th><td><em>static</em> <a class="typedef" href="../../../../../include/bits/stdint-intn.h.html#int64_t" title='int64_t' data-type='__int64_t' data-ref="int64_t" data-ref-filename="int64_t">int64_t</a> <dfn class="decl def fn" id="_ZN4absl14lts_2020_02_25L27GetCurrentTimeNanosSlowPathEv" title='absl::lts_2020_02_25::GetCurrentTimeNanosSlowPath' data-ref="_ZN4absl14lts_2020_02_25L27GetCurrentTimeNanosSlowPathEv" data-ref-filename="_ZN4absl14lts_2020_02_25L27GetCurrentTimeNanosSlowPathEv">GetCurrentTimeNanosSlowPath</dfn>() <a class="macro" href="../base/thread_annotations.h.html#146" title="__attribute__((locks_excluded(lock)))" data-ref="_M/ABSL_LOCKS_EXCLUDED">ABSL_LOCKS_EXCLUDED</a>(<a class="tu ref" href="#absl::lts_2020_02_25::lock" title='absl::lts_2020_02_25::lock' data-ref="absl::lts_2020_02_25::lock" data-ref-filename="absl..lts_2020_02_25..lock">lock</a>) {</td></tr>
<tr><th id="394">394</th><td>  <i>// Serialize access to slow-path.  Fast-path readers are not blocked yet, and</i></td></tr>
<tr><th id="395">395</th><td><i>  // code below must not modify last_sample until the seqlock is acquired.</i></td></tr>
<tr><th id="396">396</th><td>  <a class="tu ref" href="#absl::lts_2020_02_25::lock" title='absl::lts_2020_02_25::lock' data-use='m' data-ref="absl::lts_2020_02_25::lock" data-ref-filename="absl..lts_2020_02_25..lock">lock</a>.<a class="ref fn" href="../base/internal/spinlock.h.html#_ZN4absl14lts_2020_02_2513base_internal8SpinLock4LockEv" title='absl::lts_2020_02_25::base_internal::SpinLock::Lock' data-ref="_ZN4absl14lts_2020_02_2513base_internal8SpinLock4LockEv" data-ref-filename="_ZN4absl14lts_2020_02_2513base_internal8SpinLock4LockEv">Lock</a>();</td></tr>
<tr><th id="397">397</th><td></td></tr>
<tr><th id="398">398</th><td>  <i>// Sample the kernel time base.  This is the definition of</i></td></tr>
<tr><th id="399">399</th><td><i>  // "now" if we take the slow path.</i></td></tr>
<tr><th id="400">400</th><td>  <em>static</em> <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col8 decl" id="38last_now_cycles" title='last_now_cycles' data-type='uint64_t' data-ref="38last_now_cycles" data-ref-filename="38last_now_cycles">last_now_cycles</dfn>;  <i>// protected by lock</i></td></tr>
<tr><th id="401">401</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col9 decl" id="39now_cycles" title='now_cycles' data-type='uint64_t' data-ref="39now_cycles" data-ref-filename="39now_cycles">now_cycles</dfn>;</td></tr>
<tr><th id="402">402</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col0 decl" id="40now_ns" title='now_ns' data-type='uint64_t' data-ref="40now_ns" data-ref-filename="40now_ns">now_ns</dfn> = <a class="tu ref fn" href="#_ZN4absl14lts_2020_02_25L29GetCurrentTimeNanosFromKernelEmPm" title='absl::lts_2020_02_25::GetCurrentTimeNanosFromKernel' data-use='c' data-ref="_ZN4absl14lts_2020_02_25L29GetCurrentTimeNanosFromKernelEmPm" data-ref-filename="_ZN4absl14lts_2020_02_25L29GetCurrentTimeNanosFromKernelEmPm">GetCurrentTimeNanosFromKernel</a>(<a class="local col8 ref" href="#38last_now_cycles" title='last_now_cycles' data-ref="38last_now_cycles" data-ref-filename="38last_now_cycles">last_now_cycles</a>, &amp;<a class="local col9 ref" href="#39now_cycles" title='now_cycles' data-ref="39now_cycles" data-ref-filename="39now_cycles">now_cycles</a>);</td></tr>
<tr><th id="403">403</th><td>  <a class="local col8 ref" href="#38last_now_cycles" title='last_now_cycles' data-ref="38last_now_cycles" data-ref-filename="38last_now_cycles">last_now_cycles</a> = <a class="local col9 ref" href="#39now_cycles" title='now_cycles' data-ref="39now_cycles" data-ref-filename="39now_cycles">now_cycles</a>;</td></tr>
<tr><th id="404">404</th><td></td></tr>
<tr><th id="405">405</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col1 decl" id="41estimated_base_ns" title='estimated_base_ns' data-type='uint64_t' data-ref="41estimated_base_ns" data-ref-filename="41estimated_base_ns">estimated_base_ns</dfn>;</td></tr>
<tr><th id="406">406</th><td></td></tr>
<tr><th id="407">407</th><td>  <i>// ----------</i></td></tr>
<tr><th id="408">408</th><td><i>  // Read the "last_sample" values again; this time holding the write lock.</i></td></tr>
<tr><th id="409">409</th><td>  <b>struct</b> <a class="type" href="#absl::lts_2020_02_25::TimeSample" title='absl::lts_2020_02_25::TimeSample' data-ref="absl::lts_2020_02_25::TimeSample" data-ref-filename="absl..lts_2020_02_25..TimeSample">TimeSample</a> <a class="tu ref fn fake" href="#244" title='absl::lts_2020_02_25::TimeSample::TimeSample' data-use='c' data-ref="_ZN4absl14lts_2020_02_2510TimeSampleC1Ev" data-ref-filename="_ZN4absl14lts_2020_02_2510TimeSampleC1Ev"></a><dfn class="local col2 decl" id="42sample" title='sample' data-type='struct TimeSample' data-ref="42sample" data-ref-filename="42sample">sample</dfn>;</td></tr>
<tr><th id="410">410</th><td>  <a class="tu ref fn" href="#_ZN4absl14lts_2020_02_25L20ReadTimeSampleAtomicEPKNS0_16TimeSampleAtomicEPNS0_10TimeSampleE" title='absl::lts_2020_02_25::ReadTimeSampleAtomic' data-use='c' data-ref="_ZN4absl14lts_2020_02_25L20ReadTimeSampleAtomicEPKNS0_16TimeSampleAtomicEPNS0_10TimeSampleE" data-ref-filename="_ZN4absl14lts_2020_02_25L20ReadTimeSampleAtomicEPKNS0_16TimeSampleAtomicEPNS0_10TimeSampleE">ReadTimeSampleAtomic</a>(&amp;<a class="tu ref" href="#absl::lts_2020_02_25::last_sample" title='absl::lts_2020_02_25::last_sample' data-use='a' data-ref="absl::lts_2020_02_25::last_sample" data-ref-filename="absl..lts_2020_02_25..last_sample">last_sample</a>, &amp;<a class="local col2 ref" href="#42sample" title='sample' data-ref="42sample" data-ref-filename="42sample">sample</a>);</td></tr>
<tr><th id="411">411</th><td></td></tr>
<tr><th id="412">412</th><td>  <i>// ----------</i></td></tr>
<tr><th id="413">413</th><td><i>  // Try running the fast path again; another thread may have updated the</i></td></tr>
<tr><th id="414">414</th><td><i>  // sample between our run of the fast path and the sample we just read.</i></td></tr>
<tr><th id="415">415</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col3 decl" id="43delta_cycles" title='delta_cycles' data-type='uint64_t' data-ref="43delta_cycles" data-ref-filename="43delta_cycles">delta_cycles</dfn> = <a class="local col9 ref" href="#39now_cycles" title='now_cycles' data-ref="39now_cycles" data-ref-filename="39now_cycles">now_cycles</a> - <a class="local col2 ref" href="#42sample" title='sample' data-ref="42sample" data-ref-filename="42sample">sample</a>.<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSample::base_cycles" title='absl::lts_2020_02_25::TimeSample::base_cycles' data-use='r' data-ref="absl::lts_2020_02_25::TimeSample::base_cycles" data-ref-filename="absl..lts_2020_02_25..TimeSample..base_cycles">base_cycles</a>;</td></tr>
<tr><th id="416">416</th><td>  <b>if</b> (<a class="local col3 ref" href="#43delta_cycles" title='delta_cycles' data-ref="43delta_cycles" data-ref-filename="43delta_cycles">delta_cycles</a> &lt; <a class="local col2 ref" href="#42sample" title='sample' data-ref="42sample" data-ref-filename="42sample">sample</a>.<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSample::min_cycles_per_sample" title='absl::lts_2020_02_25::TimeSample::min_cycles_per_sample' data-use='r' data-ref="absl::lts_2020_02_25::TimeSample::min_cycles_per_sample" data-ref-filename="absl..lts_2020_02_25..TimeSample..min_cycles_per_sample">min_cycles_per_sample</a>) {</td></tr>
<tr><th id="417">417</th><td>    <i>// Another thread updated the sample.  This path does not take the seqlock</i></td></tr>
<tr><th id="418">418</th><td><i>    // so that blocked readers can make progress without blocking new readers.</i></td></tr>
<tr><th id="419">419</th><td>    <a class="local col1 ref" href="#41estimated_base_ns" title='estimated_base_ns' data-ref="41estimated_base_ns" data-ref-filename="41estimated_base_ns">estimated_base_ns</a> = <a class="local col2 ref" href="#42sample" title='sample' data-ref="42sample" data-ref-filename="42sample">sample</a>.<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSample::base_ns" title='absl::lts_2020_02_25::TimeSample::base_ns' data-use='r' data-ref="absl::lts_2020_02_25::TimeSample::base_ns" data-ref-filename="absl..lts_2020_02_25..TimeSample..base_ns">base_ns</a> +</td></tr>
<tr><th id="420">420</th><td>        ((<a class="local col3 ref" href="#43delta_cycles" title='delta_cycles' data-ref="43delta_cycles" data-ref-filename="43delta_cycles">delta_cycles</a> * <a class="local col2 ref" href="#42sample" title='sample' data-ref="42sample" data-ref-filename="42sample">sample</a>.<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSample::nsscaled_per_cycle" title='absl::lts_2020_02_25::TimeSample::nsscaled_per_cycle' data-use='r' data-ref="absl::lts_2020_02_25::TimeSample::nsscaled_per_cycle" data-ref-filename="absl..lts_2020_02_25..TimeSample..nsscaled_per_cycle">nsscaled_per_cycle</a>) &gt;&gt; <a class="enum" href="#absl::lts_2020_02_25::kScale" title='absl::lts_2020_02_25::kScale' data-ref="absl::lts_2020_02_25::kScale" data-ref-filename="absl..lts_2020_02_25..kScale">kScale</a>);</td></tr>
<tr><th id="421">421</th><td>    <a class="tu ref" href="#stats_fast_slow_paths" title='stats_fast_slow_paths' data-use='w' data-ref="stats_fast_slow_paths" data-ref-filename="stats_fast_slow_paths">stats_fast_slow_paths</a>++;</td></tr>
<tr><th id="422">422</th><td>  } <b>else</b> {</td></tr>
<tr><th id="423">423</th><td>    <a class="local col1 ref" href="#41estimated_base_ns" title='estimated_base_ns' data-ref="41estimated_base_ns" data-ref-filename="41estimated_base_ns">estimated_base_ns</a> =</td></tr>
<tr><th id="424">424</th><td>        <a class="tu ref fn" href="#_ZN4absl14lts_2020_02_25L16UpdateLastSampleEmmmPKNS0_10TimeSampleE" title='absl::lts_2020_02_25::UpdateLastSample' data-use='c' data-ref="_ZN4absl14lts_2020_02_25L16UpdateLastSampleEmmmPKNS0_10TimeSampleE" data-ref-filename="_ZN4absl14lts_2020_02_25L16UpdateLastSampleEmmmPKNS0_10TimeSampleE">UpdateLastSample</a>(<a class="local col9 ref" href="#39now_cycles" title='now_cycles' data-ref="39now_cycles" data-ref-filename="39now_cycles">now_cycles</a>, <a class="local col0 ref" href="#40now_ns" title='now_ns' data-ref="40now_ns" data-ref-filename="40now_ns">now_ns</a>, <a class="local col3 ref" href="#43delta_cycles" title='delta_cycles' data-ref="43delta_cycles" data-ref-filename="43delta_cycles">delta_cycles</a>, &amp;<a class="local col2 ref" href="#42sample" title='sample' data-ref="42sample" data-ref-filename="42sample">sample</a>);</td></tr>
<tr><th id="425">425</th><td>  }</td></tr>
<tr><th id="426">426</th><td></td></tr>
<tr><th id="427">427</th><td>  <a class="tu ref" href="#absl::lts_2020_02_25::lock" title='absl::lts_2020_02_25::lock' data-use='m' data-ref="absl::lts_2020_02_25::lock" data-ref-filename="absl..lts_2020_02_25..lock">lock</a>.<a class="ref fn" href="../base/internal/spinlock.h.html#_ZN4absl14lts_2020_02_2513base_internal8SpinLock6UnlockEv" title='absl::lts_2020_02_25::base_internal::SpinLock::Unlock' data-ref="_ZN4absl14lts_2020_02_2513base_internal8SpinLock6UnlockEv" data-ref-filename="_ZN4absl14lts_2020_02_2513base_internal8SpinLock6UnlockEv">Unlock</a>();</td></tr>
<tr><th id="428">428</th><td></td></tr>
<tr><th id="429">429</th><td>  <b>return</b> <a class="local col1 ref" href="#41estimated_base_ns" title='estimated_base_ns' data-ref="41estimated_base_ns" data-ref-filename="41estimated_base_ns">estimated_base_ns</a>;</td></tr>
<tr><th id="430">430</th><td>}</td></tr>
<tr><th id="431">431</th><td></td></tr>
<tr><th id="432">432</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L16UpdateLastSampleEmmmPKNS0_10TimeSampleE">// Main part of the algorithm.  Locks out readers, updates the approximation</i></td></tr>
<tr><th id="433">433</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L16UpdateLastSampleEmmmPKNS0_10TimeSampleE">// using the new sample from the kernel, and stores the result in last_sample</i></td></tr>
<tr><th id="434">434</th><td><i  data-doc="_ZN4absl14lts_2020_02_25L16UpdateLastSampleEmmmPKNS0_10TimeSampleE">// for readers.  Returns the new estimated time.</i></td></tr>
<tr><th id="435">435</th><td><em>static</em> <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="tu decl def fn" id="_ZN4absl14lts_2020_02_25L16UpdateLastSampleEmmmPKNS0_10TimeSampleE" title='absl::lts_2020_02_25::UpdateLastSample' data-type='uint64_t absl::lts_2020_02_25::UpdateLastSample(uint64_t now_cycles, uint64_t now_ns, uint64_t delta_cycles, const struct TimeSample * sample)' data-ref="_ZN4absl14lts_2020_02_25L16UpdateLastSampleEmmmPKNS0_10TimeSampleE" data-ref-filename="_ZN4absl14lts_2020_02_25L16UpdateLastSampleEmmmPKNS0_10TimeSampleE">UpdateLastSample</dfn>(<a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col4 decl" id="44now_cycles" title='now_cycles' data-type='uint64_t' data-ref="44now_cycles" data-ref-filename="44now_cycles">now_cycles</dfn>, <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col5 decl" id="45now_ns" title='now_ns' data-type='uint64_t' data-ref="45now_ns" data-ref-filename="45now_ns">now_ns</dfn>,</td></tr>
<tr><th id="436">436</th><td>                                 <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col6 decl" id="46delta_cycles" title='delta_cycles' data-type='uint64_t' data-ref="46delta_cycles" data-ref-filename="46delta_cycles">delta_cycles</dfn>,</td></tr>
<tr><th id="437">437</th><td>                                 <em>const</em> <b>struct</b> <a class="type" href="#absl::lts_2020_02_25::TimeSample" title='absl::lts_2020_02_25::TimeSample' data-ref="absl::lts_2020_02_25::TimeSample" data-ref-filename="absl..lts_2020_02_25..TimeSample">TimeSample</a> *<dfn class="local col7 decl" id="47sample" title='sample' data-type='const struct TimeSample *' data-ref="47sample" data-ref-filename="47sample">sample</dfn>)</td></tr>
<tr><th id="438">438</th><td>    <a class="macro" href="../base/thread_annotations.h.html#134" title="__attribute__((exclusive_locks_required(lock)))" data-ref="_M/ABSL_EXCLUSIVE_LOCKS_REQUIRED">ABSL_EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="tu ref" href="#absl::lts_2020_02_25::lock" title='absl::lts_2020_02_25::lock' data-ref="absl::lts_2020_02_25::lock" data-ref-filename="absl..lts_2020_02_25..lock">lock</a>) {</td></tr>
<tr><th id="439">439</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col8 decl" id="48estimated_base_ns" title='estimated_base_ns' data-type='uint64_t' data-ref="48estimated_base_ns" data-ref-filename="48estimated_base_ns">estimated_base_ns</dfn> = <a class="local col5 ref" href="#45now_ns" title='now_ns' data-ref="45now_ns" data-ref-filename="45now_ns">now_ns</a>;</td></tr>
<tr><th id="440">440</th><td>  <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col9 decl" id="49lock_value" title='lock_value' data-type='uint64_t' data-ref="49lock_value" data-ref-filename="49lock_value">lock_value</dfn> = <a class="tu ref fn" href="#_ZN4absl14lts_2020_02_25L10SeqAcquireEPSt6atomicImE" title='absl::lts_2020_02_25::SeqAcquire' data-use='c' data-ref="_ZN4absl14lts_2020_02_25L10SeqAcquireEPSt6atomicImE" data-ref-filename="_ZN4absl14lts_2020_02_25L10SeqAcquireEPSt6atomicImE">SeqAcquire</a>(&amp;<a class="tu ref" href="#absl::lts_2020_02_25::seq" title='absl::lts_2020_02_25::seq' data-use='a' data-ref="absl::lts_2020_02_25::seq" data-ref-filename="absl..lts_2020_02_25..seq">seq</a>);  <i>// acquire seqlock to block readers</i></td></tr>
<tr><th id="441">441</th><td></td></tr>
<tr><th id="442">442</th><td>  <i>// The 5s in the next if-statement limits the time for which we will trust</i></td></tr>
<tr><th id="443">443</th><td><i>  // the cycle counter and our last sample to give a reasonable result.</i></td></tr>
<tr><th id="444">444</th><td><i>  // Errors in the rate of the source clock can be multiplied by the ratio</i></td></tr>
<tr><th id="445">445</th><td><i>  // between this limit and kMinNSBetweenSamples.</i></td></tr>
<tr><th id="446">446</th><td>  <b>if</b> (<a class="local col7 ref" href="#47sample" title='sample' data-ref="47sample" data-ref-filename="47sample">sample</a>-&gt;<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSample::raw_ns" title='absl::lts_2020_02_25::TimeSample::raw_ns' data-use='r' data-ref="absl::lts_2020_02_25::TimeSample::raw_ns" data-ref-filename="absl..lts_2020_02_25..TimeSample..raw_ns">raw_ns</a> == <var>0</var> ||  <i>// no recent sample, or clock went backwards</i></td></tr>
<tr><th id="447">447</th><td>      <a class="local col7 ref" href="#47sample" title='sample' data-ref="47sample" data-ref-filename="47sample">sample</a>-&gt;<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSample::raw_ns" title='absl::lts_2020_02_25::TimeSample::raw_ns' data-use='r' data-ref="absl::lts_2020_02_25::TimeSample::raw_ns" data-ref-filename="absl..lts_2020_02_25..TimeSample..raw_ns">raw_ns</a> + <b>static_cast</b>&lt;<a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a>&gt;(<var>5</var>) * <var>1000</var> * <var>1000</var> * <var>1000</var> &lt; <a class="local col5 ref" href="#45now_ns" title='now_ns' data-ref="45now_ns" data-ref-filename="45now_ns">now_ns</a> ||</td></tr>
<tr><th id="448">448</th><td>      <a class="local col5 ref" href="#45now_ns" title='now_ns' data-ref="45now_ns" data-ref-filename="45now_ns">now_ns</a> &lt; <a class="local col7 ref" href="#47sample" title='sample' data-ref="47sample" data-ref-filename="47sample">sample</a>-&gt;<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSample::raw_ns" title='absl::lts_2020_02_25::TimeSample::raw_ns' data-use='r' data-ref="absl::lts_2020_02_25::TimeSample::raw_ns" data-ref-filename="absl..lts_2020_02_25..TimeSample..raw_ns">raw_ns</a> || <a class="local col4 ref" href="#44now_cycles" title='now_cycles' data-ref="44now_cycles" data-ref-filename="44now_cycles">now_cycles</a> &lt; <a class="local col7 ref" href="#47sample" title='sample' data-ref="47sample" data-ref-filename="47sample">sample</a>-&gt;<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSample::base_cycles" title='absl::lts_2020_02_25::TimeSample::base_cycles' data-use='r' data-ref="absl::lts_2020_02_25::TimeSample::base_cycles" data-ref-filename="absl..lts_2020_02_25..TimeSample..base_cycles">base_cycles</a>) {</td></tr>
<tr><th id="449">449</th><td>    <i>// record this sample, and forget any previously known slope.</i></td></tr>
<tr><th id="450">450</th><td>    <a class="tu ref" href="#absl::lts_2020_02_25::last_sample" title='absl::lts_2020_02_25::last_sample' data-use='m' data-ref="absl::lts_2020_02_25::last_sample" data-ref-filename="absl..lts_2020_02_25..last_sample">last_sample</a>.<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSampleAtomic::raw_ns" title='absl::lts_2020_02_25::TimeSampleAtomic::raw_ns' data-use='m' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::raw_ns" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..raw_ns">raw_ns</a>.<span class='ref fn' title='std::__atomic_base::store' data-ref="_ZNSt13__atomic_base5storeET_St12memory_order" data-ref-filename="_ZNSt13__atomic_base5storeET_St12memory_order">store</span>(<a class="local col5 ref" href="#45now_ns" title='now_ns' data-ref="45now_ns" data-ref-filename="45now_ns">now_ns</a>, <span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="451">451</th><td>    <a class="tu ref" href="#absl::lts_2020_02_25::last_sample" title='absl::lts_2020_02_25::last_sample' data-use='m' data-ref="absl::lts_2020_02_25::last_sample" data-ref-filename="absl..lts_2020_02_25..last_sample">last_sample</a>.<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSampleAtomic::base_ns" title='absl::lts_2020_02_25::TimeSampleAtomic::base_ns' data-use='m' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::base_ns" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..base_ns">base_ns</a>.<span class='ref fn' title='std::__atomic_base::store' data-ref="_ZNSt13__atomic_base5storeET_St12memory_order" data-ref-filename="_ZNSt13__atomic_base5storeET_St12memory_order">store</span>(<a class="local col8 ref" href="#48estimated_base_ns" title='estimated_base_ns' data-ref="48estimated_base_ns" data-ref-filename="48estimated_base_ns">estimated_base_ns</a>, <span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="452">452</th><td>    <a class="tu ref" href="#absl::lts_2020_02_25::last_sample" title='absl::lts_2020_02_25::last_sample' data-use='m' data-ref="absl::lts_2020_02_25::last_sample" data-ref-filename="absl..lts_2020_02_25..last_sample">last_sample</a>.<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSampleAtomic::base_cycles" title='absl::lts_2020_02_25::TimeSampleAtomic::base_cycles' data-use='m' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::base_cycles" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..base_cycles">base_cycles</a>.<span class='ref fn' title='std::__atomic_base::store' data-ref="_ZNSt13__atomic_base5storeET_St12memory_order" data-ref-filename="_ZNSt13__atomic_base5storeET_St12memory_order">store</span>(<a class="local col4 ref" href="#44now_cycles" title='now_cycles' data-ref="44now_cycles" data-ref-filename="44now_cycles">now_cycles</a>, <span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="453">453</th><td>    <a class="tu ref" href="#absl::lts_2020_02_25::last_sample" title='absl::lts_2020_02_25::last_sample' data-use='m' data-ref="absl::lts_2020_02_25::last_sample" data-ref-filename="absl..lts_2020_02_25..last_sample">last_sample</a>.<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSampleAtomic::nsscaled_per_cycle" title='absl::lts_2020_02_25::TimeSampleAtomic::nsscaled_per_cycle' data-use='m' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::nsscaled_per_cycle" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..nsscaled_per_cycle">nsscaled_per_cycle</a>.<span class='ref fn' title='std::__atomic_base::store' data-ref="_ZNSt13__atomic_base5storeET_St12memory_order" data-ref-filename="_ZNSt13__atomic_base5storeET_St12memory_order">store</span>(<var>0</var>, <span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="454">454</th><td>    <a class="tu ref" href="#absl::lts_2020_02_25::last_sample" title='absl::lts_2020_02_25::last_sample' data-use='m' data-ref="absl::lts_2020_02_25::last_sample" data-ref-filename="absl..lts_2020_02_25..last_sample">last_sample</a>.<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSampleAtomic::min_cycles_per_sample" title='absl::lts_2020_02_25::TimeSampleAtomic::min_cycles_per_sample' data-use='m' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::min_cycles_per_sample" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..min_cycles_per_sample">min_cycles_per_sample</a>.<span class='ref fn' title='std::__atomic_base::store' data-ref="_ZNSt13__atomic_base5storeET_St12memory_order" data-ref-filename="_ZNSt13__atomic_base5storeET_St12memory_order">store</span>(<var>0</var>, <span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="455">455</th><td>    <a class="tu ref" href="#stats_initializations" title='stats_initializations' data-use='w' data-ref="stats_initializations" data-ref-filename="stats_initializations">stats_initializations</a>++;</td></tr>
<tr><th id="456">456</th><td>  } <b>else</b> <b>if</b> (<a class="local col7 ref" href="#47sample" title='sample' data-ref="47sample" data-ref-filename="47sample">sample</a>-&gt;<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSample::raw_ns" title='absl::lts_2020_02_25::TimeSample::raw_ns' data-use='r' data-ref="absl::lts_2020_02_25::TimeSample::raw_ns" data-ref-filename="absl..lts_2020_02_25..TimeSample..raw_ns">raw_ns</a> + <var>500</var> * <var>1000</var> * <var>1000</var> &lt; <a class="local col5 ref" href="#45now_ns" title='now_ns' data-ref="45now_ns" data-ref-filename="45now_ns">now_ns</a> &amp;&amp;</td></tr>
<tr><th id="457">457</th><td>             <a class="local col7 ref" href="#47sample" title='sample' data-ref="47sample" data-ref-filename="47sample">sample</a>-&gt;<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSample::base_cycles" title='absl::lts_2020_02_25::TimeSample::base_cycles' data-use='r' data-ref="absl::lts_2020_02_25::TimeSample::base_cycles" data-ref-filename="absl..lts_2020_02_25..TimeSample..base_cycles">base_cycles</a> + <var>50</var> &lt; <a class="local col4 ref" href="#44now_cycles" title='now_cycles' data-ref="44now_cycles" data-ref-filename="44now_cycles">now_cycles</a>) {</td></tr>
<tr><th id="458">458</th><td>    <i>// Enough time has passed to compute the cycle time.</i></td></tr>
<tr><th id="459">459</th><td>    <b>if</b> (<a class="local col7 ref" href="#47sample" title='sample' data-ref="47sample" data-ref-filename="47sample">sample</a>-&gt;<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSample::nsscaled_per_cycle" title='absl::lts_2020_02_25::TimeSample::nsscaled_per_cycle' data-use='r' data-ref="absl::lts_2020_02_25::TimeSample::nsscaled_per_cycle" data-ref-filename="absl..lts_2020_02_25..TimeSample..nsscaled_per_cycle">nsscaled_per_cycle</a> != <var>0</var>) {  <i>// Have a cycle time estimate.</i></td></tr>
<tr><th id="460">460</th><td>      <i>// Compute time from counter reading, but avoiding overflow</i></td></tr>
<tr><th id="461">461</th><td><i>      // delta_cycles may be larger than on the fast path.</i></td></tr>
<tr><th id="462">462</th><td>      <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col0 decl" id="50estimated_scaled_ns" title='estimated_scaled_ns' data-type='uint64_t' data-ref="50estimated_scaled_ns" data-ref-filename="50estimated_scaled_ns">estimated_scaled_ns</dfn>;</td></tr>
<tr><th id="463">463</th><td>      <em>int</em> <dfn class="local col1 decl" id="51s" title='s' data-type='int' data-ref="51s" data-ref-filename="51s">s</dfn> = -<var>1</var>;</td></tr>
<tr><th id="464">464</th><td>      <b>do</b> {</td></tr>
<tr><th id="465">465</th><td>        <a class="local col1 ref" href="#51s" title='s' data-ref="51s" data-ref-filename="51s">s</a>++;</td></tr>
<tr><th id="466">466</th><td>        <a class="local col0 ref" href="#50estimated_scaled_ns" title='estimated_scaled_ns' data-ref="50estimated_scaled_ns" data-ref-filename="50estimated_scaled_ns">estimated_scaled_ns</a> = (<a class="local col6 ref" href="#46delta_cycles" title='delta_cycles' data-ref="46delta_cycles" data-ref-filename="46delta_cycles">delta_cycles</a> &gt;&gt; <a class="local col1 ref" href="#51s" title='s' data-ref="51s" data-ref-filename="51s">s</a>) * <a class="local col7 ref" href="#47sample" title='sample' data-ref="47sample" data-ref-filename="47sample">sample</a>-&gt;<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSample::nsscaled_per_cycle" title='absl::lts_2020_02_25::TimeSample::nsscaled_per_cycle' data-use='r' data-ref="absl::lts_2020_02_25::TimeSample::nsscaled_per_cycle" data-ref-filename="absl..lts_2020_02_25..TimeSample..nsscaled_per_cycle">nsscaled_per_cycle</a>;</td></tr>
<tr><th id="467">467</th><td>      } <b>while</b> (<a class="local col0 ref" href="#50estimated_scaled_ns" title='estimated_scaled_ns' data-ref="50estimated_scaled_ns" data-ref-filename="50estimated_scaled_ns">estimated_scaled_ns</a> / <a class="local col7 ref" href="#47sample" title='sample' data-ref="47sample" data-ref-filename="47sample">sample</a>-&gt;<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSample::nsscaled_per_cycle" title='absl::lts_2020_02_25::TimeSample::nsscaled_per_cycle' data-use='r' data-ref="absl::lts_2020_02_25::TimeSample::nsscaled_per_cycle" data-ref-filename="absl..lts_2020_02_25..TimeSample..nsscaled_per_cycle">nsscaled_per_cycle</a> !=</td></tr>
<tr><th id="468">468</th><td>               (<a class="local col6 ref" href="#46delta_cycles" title='delta_cycles' data-ref="46delta_cycles" data-ref-filename="46delta_cycles">delta_cycles</a> &gt;&gt; <a class="local col1 ref" href="#51s" title='s' data-ref="51s" data-ref-filename="51s">s</a>));</td></tr>
<tr><th id="469">469</th><td>      <a class="local col8 ref" href="#48estimated_base_ns" title='estimated_base_ns' data-ref="48estimated_base_ns" data-ref-filename="48estimated_base_ns">estimated_base_ns</a> = <a class="local col7 ref" href="#47sample" title='sample' data-ref="47sample" data-ref-filename="47sample">sample</a>-&gt;<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSample::base_ns" title='absl::lts_2020_02_25::TimeSample::base_ns' data-use='r' data-ref="absl::lts_2020_02_25::TimeSample::base_ns" data-ref-filename="absl..lts_2020_02_25..TimeSample..base_ns">base_ns</a> +</td></tr>
<tr><th id="470">470</th><td>                          (<a class="local col0 ref" href="#50estimated_scaled_ns" title='estimated_scaled_ns' data-ref="50estimated_scaled_ns" data-ref-filename="50estimated_scaled_ns">estimated_scaled_ns</a> &gt;&gt; (<a class="enum" href="#absl::lts_2020_02_25::kScale" title='absl::lts_2020_02_25::kScale' data-ref="absl::lts_2020_02_25::kScale" data-ref-filename="absl..lts_2020_02_25..kScale">kScale</a> - <a class="local col1 ref" href="#51s" title='s' data-ref="51s" data-ref-filename="51s">s</a>));</td></tr>
<tr><th id="471">471</th><td>    }</td></tr>
<tr><th id="472">472</th><td></td></tr>
<tr><th id="473">473</th><td>    <i>// Compute the assumed cycle time kMinNSBetweenSamples ns into the future</i></td></tr>
<tr><th id="474">474</th><td><i>    // assuming the cycle counter rate stays the same as the last interval.</i></td></tr>
<tr><th id="475">475</th><td>    <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col2 decl" id="52ns" title='ns' data-type='uint64_t' data-ref="52ns" data-ref-filename="52ns">ns</dfn> = <a class="local col5 ref" href="#45now_ns" title='now_ns' data-ref="45now_ns" data-ref-filename="45now_ns">now_ns</a> - <a class="local col7 ref" href="#47sample" title='sample' data-ref="47sample" data-ref-filename="47sample">sample</a>-&gt;<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSample::raw_ns" title='absl::lts_2020_02_25::TimeSample::raw_ns' data-use='r' data-ref="absl::lts_2020_02_25::TimeSample::raw_ns" data-ref-filename="absl..lts_2020_02_25..TimeSample..raw_ns">raw_ns</a>;</td></tr>
<tr><th id="476">476</th><td>    <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col3 decl" id="53measured_nsscaled_per_cycle" title='measured_nsscaled_per_cycle' data-type='uint64_t' data-ref="53measured_nsscaled_per_cycle" data-ref-filename="53measured_nsscaled_per_cycle">measured_nsscaled_per_cycle</dfn> = <a class="tu ref fn" href="#_ZN4absl14lts_2020_02_25L18SafeDivideAndScaleEmm" title='absl::lts_2020_02_25::SafeDivideAndScale' data-use='c' data-ref="_ZN4absl14lts_2020_02_25L18SafeDivideAndScaleEmm" data-ref-filename="_ZN4absl14lts_2020_02_25L18SafeDivideAndScaleEmm">SafeDivideAndScale</a>(<a class="local col2 ref" href="#52ns" title='ns' data-ref="52ns" data-ref-filename="52ns">ns</a>, <a class="local col6 ref" href="#46delta_cycles" title='delta_cycles' data-ref="46delta_cycles" data-ref-filename="46delta_cycles">delta_cycles</a>);</td></tr>
<tr><th id="477">477</th><td></td></tr>
<tr><th id="478">478</th><td>    <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col4 decl" id="54assumed_next_sample_delta_cycles" title='assumed_next_sample_delta_cycles' data-type='uint64_t' data-ref="54assumed_next_sample_delta_cycles" data-ref-filename="54assumed_next_sample_delta_cycles">assumed_next_sample_delta_cycles</dfn> =</td></tr>
<tr><th id="479">479</th><td>        <a class="tu ref fn" href="#_ZN4absl14lts_2020_02_25L18SafeDivideAndScaleEmm" title='absl::lts_2020_02_25::SafeDivideAndScale' data-use='c' data-ref="_ZN4absl14lts_2020_02_25L18SafeDivideAndScaleEmm" data-ref-filename="_ZN4absl14lts_2020_02_25L18SafeDivideAndScaleEmm">SafeDivideAndScale</a>(<a class="tu ref" href="#absl::lts_2020_02_25::kMinNSBetweenSamples" title='absl::lts_2020_02_25::kMinNSBetweenSamples' data-use='r' data-ref="absl::lts_2020_02_25::kMinNSBetweenSamples" data-ref-filename="absl..lts_2020_02_25..kMinNSBetweenSamples">kMinNSBetweenSamples</a>, <a class="local col3 ref" href="#53measured_nsscaled_per_cycle" title='measured_nsscaled_per_cycle' data-ref="53measured_nsscaled_per_cycle" data-ref-filename="53measured_nsscaled_per_cycle">measured_nsscaled_per_cycle</a>);</td></tr>
<tr><th id="480">480</th><td></td></tr>
<tr><th id="481">481</th><td>    <a class="typedef" href="../../../../../include/bits/stdint-intn.h.html#int64_t" title='int64_t' data-type='__int64_t' data-ref="int64_t" data-ref-filename="int64_t">int64_t</a> <dfn class="local col5 decl" id="55diff_ns" title='diff_ns' data-type='int64_t' data-ref="55diff_ns" data-ref-filename="55diff_ns">diff_ns</dfn> = <a class="local col5 ref" href="#45now_ns" title='now_ns' data-ref="45now_ns" data-ref-filename="45now_ns">now_ns</a> - <a class="local col8 ref" href="#48estimated_base_ns" title='estimated_base_ns' data-ref="48estimated_base_ns" data-ref-filename="48estimated_base_ns">estimated_base_ns</a>;  <i>// estimate low by this much</i></td></tr>
<tr><th id="482">482</th><td></td></tr>
<tr><th id="483">483</th><td>    <i>// We want to set nsscaled_per_cycle so that our estimate of the ns time</i></td></tr>
<tr><th id="484">484</th><td><i>    // at the assumed cycle time is the assumed ns time.</i></td></tr>
<tr><th id="485">485</th><td><i>    // That is, we want to set nsscaled_per_cycle so:</i></td></tr>
<tr><th id="486">486</th><td><i>    //  kMinNSBetweenSamples + diff_ns  ==</i></td></tr>
<tr><th id="487">487</th><td><i>    //  (assumed_next_sample_delta_cycles * nsscaled_per_cycle) &gt;&gt; kScale</i></td></tr>
<tr><th id="488">488</th><td><i>    // But we wish to damp oscillations, so instead correct only most</i></td></tr>
<tr><th id="489">489</th><td><i>    // of our current error, by solving:</i></td></tr>
<tr><th id="490">490</th><td><i>    //  kMinNSBetweenSamples + diff_ns - (diff_ns / 16) ==</i></td></tr>
<tr><th id="491">491</th><td><i>    //  (assumed_next_sample_delta_cycles * nsscaled_per_cycle) &gt;&gt; kScale</i></td></tr>
<tr><th id="492">492</th><td>    <a class="local col2 ref" href="#52ns" title='ns' data-ref="52ns" data-ref-filename="52ns">ns</a> = <a class="tu ref" href="#absl::lts_2020_02_25::kMinNSBetweenSamples" title='absl::lts_2020_02_25::kMinNSBetweenSamples' data-use='r' data-ref="absl::lts_2020_02_25::kMinNSBetweenSamples" data-ref-filename="absl..lts_2020_02_25..kMinNSBetweenSamples">kMinNSBetweenSamples</a> + <a class="local col5 ref" href="#55diff_ns" title='diff_ns' data-ref="55diff_ns" data-ref-filename="55diff_ns">diff_ns</a> - (<a class="local col5 ref" href="#55diff_ns" title='diff_ns' data-ref="55diff_ns" data-ref-filename="55diff_ns">diff_ns</a> / <var>16</var>);</td></tr>
<tr><th id="493">493</th><td>    <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col6 decl" id="56new_nsscaled_per_cycle" title='new_nsscaled_per_cycle' data-type='uint64_t' data-ref="56new_nsscaled_per_cycle" data-ref-filename="56new_nsscaled_per_cycle">new_nsscaled_per_cycle</dfn> =</td></tr>
<tr><th id="494">494</th><td>        <a class="tu ref fn" href="#_ZN4absl14lts_2020_02_25L18SafeDivideAndScaleEmm" title='absl::lts_2020_02_25::SafeDivideAndScale' data-use='c' data-ref="_ZN4absl14lts_2020_02_25L18SafeDivideAndScaleEmm" data-ref-filename="_ZN4absl14lts_2020_02_25L18SafeDivideAndScaleEmm">SafeDivideAndScale</a>(<a class="local col2 ref" href="#52ns" title='ns' data-ref="52ns" data-ref-filename="52ns">ns</a>, <a class="local col4 ref" href="#54assumed_next_sample_delta_cycles" title='assumed_next_sample_delta_cycles' data-ref="54assumed_next_sample_delta_cycles" data-ref-filename="54assumed_next_sample_delta_cycles">assumed_next_sample_delta_cycles</a>);</td></tr>
<tr><th id="495">495</th><td>    <b>if</b> (<a class="local col6 ref" href="#56new_nsscaled_per_cycle" title='new_nsscaled_per_cycle' data-ref="56new_nsscaled_per_cycle" data-ref-filename="56new_nsscaled_per_cycle">new_nsscaled_per_cycle</a> != <var>0</var> &amp;&amp;</td></tr>
<tr><th id="496">496</th><td>        <a class="local col5 ref" href="#55diff_ns" title='diff_ns' data-ref="55diff_ns" data-ref-filename="55diff_ns">diff_ns</a> &lt; <var>100</var> * <var>1000</var> * <var>1000</var> &amp;&amp; -<a class="local col5 ref" href="#55diff_ns" title='diff_ns' data-ref="55diff_ns" data-ref-filename="55diff_ns">diff_ns</a> &lt; <var>100</var> * <var>1000</var> * <var>1000</var>) {</td></tr>
<tr><th id="497">497</th><td>      <i>// record the cycle time measurement</i></td></tr>
<tr><th id="498">498</th><td>      <a class="tu ref" href="#absl::lts_2020_02_25::last_sample" title='absl::lts_2020_02_25::last_sample' data-use='m' data-ref="absl::lts_2020_02_25::last_sample" data-ref-filename="absl..lts_2020_02_25..last_sample">last_sample</a>.<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSampleAtomic::nsscaled_per_cycle" title='absl::lts_2020_02_25::TimeSampleAtomic::nsscaled_per_cycle' data-use='m' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::nsscaled_per_cycle" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..nsscaled_per_cycle">nsscaled_per_cycle</a>.<span class='ref fn' title='std::__atomic_base::store' data-ref="_ZNSt13__atomic_base5storeET_St12memory_order" data-ref-filename="_ZNSt13__atomic_base5storeET_St12memory_order">store</span>(</td></tr>
<tr><th id="499">499</th><td>          <a class="local col6 ref" href="#56new_nsscaled_per_cycle" title='new_nsscaled_per_cycle' data-ref="56new_nsscaled_per_cycle" data-ref-filename="56new_nsscaled_per_cycle">new_nsscaled_per_cycle</a>, <span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="500">500</th><td>      <a class="typedef" href="../../../../../include/bits/stdint-uintn.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col7 decl" id="57new_min_cycles_per_sample" title='new_min_cycles_per_sample' data-type='uint64_t' data-ref="57new_min_cycles_per_sample" data-ref-filename="57new_min_cycles_per_sample">new_min_cycles_per_sample</dfn> =</td></tr>
<tr><th id="501">501</th><td>          <a class="tu ref fn" href="#_ZN4absl14lts_2020_02_25L18SafeDivideAndScaleEmm" title='absl::lts_2020_02_25::SafeDivideAndScale' data-use='c' data-ref="_ZN4absl14lts_2020_02_25L18SafeDivideAndScaleEmm" data-ref-filename="_ZN4absl14lts_2020_02_25L18SafeDivideAndScaleEmm">SafeDivideAndScale</a>(<a class="tu ref" href="#absl::lts_2020_02_25::kMinNSBetweenSamples" title='absl::lts_2020_02_25::kMinNSBetweenSamples' data-use='r' data-ref="absl::lts_2020_02_25::kMinNSBetweenSamples" data-ref-filename="absl..lts_2020_02_25..kMinNSBetweenSamples">kMinNSBetweenSamples</a>, <a class="local col6 ref" href="#56new_nsscaled_per_cycle" title='new_nsscaled_per_cycle' data-ref="56new_nsscaled_per_cycle" data-ref-filename="56new_nsscaled_per_cycle">new_nsscaled_per_cycle</a>);</td></tr>
<tr><th id="502">502</th><td>      <a class="tu ref" href="#absl::lts_2020_02_25::last_sample" title='absl::lts_2020_02_25::last_sample' data-use='m' data-ref="absl::lts_2020_02_25::last_sample" data-ref-filename="absl..lts_2020_02_25..last_sample">last_sample</a>.<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSampleAtomic::min_cycles_per_sample" title='absl::lts_2020_02_25::TimeSampleAtomic::min_cycles_per_sample' data-use='m' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::min_cycles_per_sample" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..min_cycles_per_sample">min_cycles_per_sample</a>.<span class='ref fn' title='std::__atomic_base::store' data-ref="_ZNSt13__atomic_base5storeET_St12memory_order" data-ref-filename="_ZNSt13__atomic_base5storeET_St12memory_order">store</span>(</td></tr>
<tr><th id="503">503</th><td>          <a class="local col7 ref" href="#57new_min_cycles_per_sample" title='new_min_cycles_per_sample' data-ref="57new_min_cycles_per_sample" data-ref-filename="57new_min_cycles_per_sample">new_min_cycles_per_sample</a>, <span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="504">504</th><td>      <a class="tu ref" href="#stats_calibrations" title='stats_calibrations' data-use='w' data-ref="stats_calibrations" data-ref-filename="stats_calibrations">stats_calibrations</a>++;</td></tr>
<tr><th id="505">505</th><td>    } <b>else</b> {  <i>// something went wrong; forget the slope</i></td></tr>
<tr><th id="506">506</th><td>      <a class="tu ref" href="#absl::lts_2020_02_25::last_sample" title='absl::lts_2020_02_25::last_sample' data-use='m' data-ref="absl::lts_2020_02_25::last_sample" data-ref-filename="absl..lts_2020_02_25..last_sample">last_sample</a>.<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSampleAtomic::nsscaled_per_cycle" title='absl::lts_2020_02_25::TimeSampleAtomic::nsscaled_per_cycle' data-use='m' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::nsscaled_per_cycle" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..nsscaled_per_cycle">nsscaled_per_cycle</a>.<span class='ref fn' title='std::__atomic_base::store' data-ref="_ZNSt13__atomic_base5storeET_St12memory_order" data-ref-filename="_ZNSt13__atomic_base5storeET_St12memory_order">store</span>(<var>0</var>, <span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="507">507</th><td>      <a class="tu ref" href="#absl::lts_2020_02_25::last_sample" title='absl::lts_2020_02_25::last_sample' data-use='m' data-ref="absl::lts_2020_02_25::last_sample" data-ref-filename="absl..lts_2020_02_25..last_sample">last_sample</a>.<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSampleAtomic::min_cycles_per_sample" title='absl::lts_2020_02_25::TimeSampleAtomic::min_cycles_per_sample' data-use='m' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::min_cycles_per_sample" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..min_cycles_per_sample">min_cycles_per_sample</a>.<span class='ref fn' title='std::__atomic_base::store' data-ref="_ZNSt13__atomic_base5storeET_St12memory_order" data-ref-filename="_ZNSt13__atomic_base5storeET_St12memory_order">store</span>(<var>0</var>, <span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="508">508</th><td>      <a class="local col8 ref" href="#48estimated_base_ns" title='estimated_base_ns' data-ref="48estimated_base_ns" data-ref-filename="48estimated_base_ns">estimated_base_ns</a> = <a class="local col5 ref" href="#45now_ns" title='now_ns' data-ref="45now_ns" data-ref-filename="45now_ns">now_ns</a>;</td></tr>
<tr><th id="509">509</th><td>      <a class="tu ref" href="#stats_reinitializations" title='stats_reinitializations' data-use='w' data-ref="stats_reinitializations" data-ref-filename="stats_reinitializations">stats_reinitializations</a>++;</td></tr>
<tr><th id="510">510</th><td>    }</td></tr>
<tr><th id="511">511</th><td>    <a class="tu ref" href="#absl::lts_2020_02_25::last_sample" title='absl::lts_2020_02_25::last_sample' data-use='m' data-ref="absl::lts_2020_02_25::last_sample" data-ref-filename="absl..lts_2020_02_25..last_sample">last_sample</a>.<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSampleAtomic::raw_ns" title='absl::lts_2020_02_25::TimeSampleAtomic::raw_ns' data-use='m' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::raw_ns" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..raw_ns">raw_ns</a>.<span class='ref fn' title='std::__atomic_base::store' data-ref="_ZNSt13__atomic_base5storeET_St12memory_order" data-ref-filename="_ZNSt13__atomic_base5storeET_St12memory_order">store</span>(<a class="local col5 ref" href="#45now_ns" title='now_ns' data-ref="45now_ns" data-ref-filename="45now_ns">now_ns</a>, <span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="512">512</th><td>    <a class="tu ref" href="#absl::lts_2020_02_25::last_sample" title='absl::lts_2020_02_25::last_sample' data-use='m' data-ref="absl::lts_2020_02_25::last_sample" data-ref-filename="absl..lts_2020_02_25..last_sample">last_sample</a>.<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSampleAtomic::base_ns" title='absl::lts_2020_02_25::TimeSampleAtomic::base_ns' data-use='m' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::base_ns" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..base_ns">base_ns</a>.<span class='ref fn' title='std::__atomic_base::store' data-ref="_ZNSt13__atomic_base5storeET_St12memory_order" data-ref-filename="_ZNSt13__atomic_base5storeET_St12memory_order">store</span>(<a class="local col8 ref" href="#48estimated_base_ns" title='estimated_base_ns' data-ref="48estimated_base_ns" data-ref-filename="48estimated_base_ns">estimated_base_ns</a>, <span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="513">513</th><td>    <a class="tu ref" href="#absl::lts_2020_02_25::last_sample" title='absl::lts_2020_02_25::last_sample' data-use='m' data-ref="absl::lts_2020_02_25::last_sample" data-ref-filename="absl..lts_2020_02_25..last_sample">last_sample</a>.<a class="tu ref field" href="#absl::lts_2020_02_25::TimeSampleAtomic::base_cycles" title='absl::lts_2020_02_25::TimeSampleAtomic::base_cycles' data-use='m' data-ref="absl::lts_2020_02_25::TimeSampleAtomic::base_cycles" data-ref-filename="absl..lts_2020_02_25..TimeSampleAtomic..base_cycles">base_cycles</a>.<span class='ref fn' title='std::__atomic_base::store' data-ref="_ZNSt13__atomic_base5storeET_St12memory_order" data-ref-filename="_ZNSt13__atomic_base5storeET_St12memory_order">store</span>(<a class="local col4 ref" href="#44now_cycles" title='now_cycles' data-ref="44now_cycles" data-ref-filename="44now_cycles">now_cycles</a>, <span class="namespace">std::</span><span class='enum' title='std::memory_order_relaxed' data-ref="std::memory_order_relaxed" data-ref-filename="std..memory_order_relaxed">memory_order_relaxed</span>);</td></tr>
<tr><th id="514">514</th><td>  } <b>else</b> {</td></tr>
<tr><th id="515">515</th><td>    <i>// have a sample, but no slope; waiting for enough time for a calibration</i></td></tr>
<tr><th id="516">516</th><td>    <a class="tu ref" href="#stats_slow_paths" title='stats_slow_paths' data-use='w' data-ref="stats_slow_paths" data-ref-filename="stats_slow_paths">stats_slow_paths</a>++;</td></tr>
<tr><th id="517">517</th><td>  }</td></tr>
<tr><th id="518">518</th><td></td></tr>
<tr><th id="519">519</th><td>  <a class="tu ref fn" href="#_ZN4absl14lts_2020_02_25L10SeqReleaseEPSt6atomicImEm" title='absl::lts_2020_02_25::SeqRelease' data-use='c' data-ref="_ZN4absl14lts_2020_02_25L10SeqReleaseEPSt6atomicImEm" data-ref-filename="_ZN4absl14lts_2020_02_25L10SeqReleaseEPSt6atomicImEm">SeqRelease</a>(&amp;<a class="tu ref" href="#absl::lts_2020_02_25::seq" title='absl::lts_2020_02_25::seq' data-use='a' data-ref="absl::lts_2020_02_25::seq" data-ref-filename="absl..lts_2020_02_25..seq">seq</a>, <a class="local col9 ref" href="#49lock_value" title='lock_value' data-ref="49lock_value" data-ref-filename="49lock_value">lock_value</a>);  <i>// release the readers</i></td></tr>
<tr><th id="520">520</th><td></td></tr>
<tr><th id="521">521</th><td>  <b>return</b> <a class="local col8 ref" href="#48estimated_base_ns" title='estimated_base_ns' data-ref="48estimated_base_ns" data-ref-filename="48estimated_base_ns">estimated_base_ns</a>;</td></tr>
<tr><th id="522">522</th><td>}</td></tr>
<tr><th id="523">523</th><td><a class="macro" href="../base/config.h.html#127" title="}" data-ref="_M/ABSL_NAMESPACE_END">ABSL_NAMESPACE_END</a></td></tr>
<tr><th id="524">524</th><td>}  <i>// namespace absl</i></td></tr>
<tr><th id="525">525</th><td><u>#<span data-ppcond="74">endif</span>  // ABSL_USE_CYCLECLOCK_FOR_GET_CURRENT_TIME_NANOS</u></td></tr>
<tr><th id="526">526</th><td></td></tr>
<tr><th id="527">527</th><td><b>namespace</b> <span class="namespace">absl</span> {</td></tr>
<tr><th id="528">528</th><td><a class="macro" href="../base/config.h.html#125" title="inline namespace lts_2020_02_25 {" data-ref="_M/ABSL_NAMESPACE_BEGIN">ABSL_NAMESPACE_BEGIN</a></td></tr>
<tr><th id="529">529</th><td><b>namespace</b> {</td></tr>
<tr><th id="530">530</th><td></td></tr>
<tr><th id="531">531</th><td><i  data-doc="_ZN4absl14lts_2020_02_2512_GLOBAL__N_18MaxSleepEv">// Returns the maximum duration that SleepOnce() can sleep for.</i></td></tr>
<tr><th id="532">532</th><td><b>constexpr</b> <span class="namespace">absl::</span><a class="type" href="time.h.html#absl::lts_2020_02_25::Duration" title='absl::lts_2020_02_25::Duration' data-ref="absl::lts_2020_02_25::Duration" data-ref-filename="absl..lts_2020_02_25..Duration">Duration</a> <dfn class="tu decl def fn" id="_ZN4absl14lts_2020_02_2512_GLOBAL__N_18MaxSleepEv" title='absl::lts_2020_02_25::(anonymous namespace)::MaxSleep' data-type='absl::Duration absl::lts_2020_02_25::(anonymous namespace)::MaxSleep()' data-ref="_ZN4absl14lts_2020_02_2512_GLOBAL__N_18MaxSleepEv" data-ref-filename="_ZN4absl14lts_2020_02_2512_GLOBAL__N_18MaxSleepEv">MaxSleep</dfn>() {</td></tr>
<tr><th id="533">533</th><td><u>#<span data-ppcond="533">ifdef</span> <span class="macro" data-ref="_M/_WIN32">_WIN32</span></u></td></tr>
<tr><th id="534">534</th><td>  <i>// Windows Sleep() takes unsigned long argument in milliseconds.</i></td></tr>
<tr><th id="535">535</th><td>  <b>return</b> absl::Milliseconds(</td></tr>
<tr><th id="536">536</th><td>      std::numeric_limits&lt;<em>unsigned</em> <em>long</em>&gt;::max());  <i>// NOLINT(runtime/int)</i></td></tr>
<tr><th id="537">537</th><td><u>#<span data-ppcond="533">else</span></u></td></tr>
<tr><th id="538">538</th><td>  <b>return</b> <span class="namespace">absl::</span><a class="ref fn" href="time.h.html#_ZN4absl14lts_2020_02_257SecondsEl" title='absl::lts_2020_02_25::Seconds' data-ref="_ZN4absl14lts_2020_02_257SecondsEl" data-ref-filename="_ZN4absl14lts_2020_02_257SecondsEl">Seconds</a>(<span class="namespace">std::</span><span class='type' title='std::numeric_limits' data-ref="std::numeric_limits" data-ref-filename="std..numeric_limits">numeric_limits</span>&lt;<a class="typedef" href="../../../../../include/bits/types/time_t.h.html#time_t" title='time_t' data-type='__time_t' data-ref="time_t" data-ref-filename="time_t">time_t</a>&gt;::<span class='ref fn' title='std::numeric_limits&lt;long&gt;::max' data-ref="_ZNSt14numeric_limitsIlE3maxEv" data-ref-filename="_ZNSt14numeric_limitsIlE3maxEv">max</span>());</td></tr>
<tr><th id="539">539</th><td><u>#<span data-ppcond="533">endif</span></u></td></tr>
<tr><th id="540">540</th><td>}</td></tr>
<tr><th id="541">541</th><td></td></tr>
<tr><th id="542">542</th><td><i  data-doc="_ZN4absl14lts_2020_02_2512_GLOBAL__N_19SleepOnceENS0_8DurationE">// Sleeps for the given duration.</i></td></tr>
<tr><th id="543">543</th><td><i  data-doc="_ZN4absl14lts_2020_02_2512_GLOBAL__N_19SleepOnceENS0_8DurationE">// REQUIRES: to_sleep &lt;= MaxSleep().</i></td></tr>
<tr><th id="544">544</th><td><em>void</em> <dfn class="tu decl def fn" id="_ZN4absl14lts_2020_02_2512_GLOBAL__N_19SleepOnceENS0_8DurationE" title='absl::lts_2020_02_25::(anonymous namespace)::SleepOnce' data-type='void absl::lts_2020_02_25::(anonymous namespace)::SleepOnce(absl::Duration to_sleep)' data-ref="_ZN4absl14lts_2020_02_2512_GLOBAL__N_19SleepOnceENS0_8DurationE" data-ref-filename="_ZN4absl14lts_2020_02_2512_GLOBAL__N_19SleepOnceENS0_8DurationE">SleepOnce</dfn>(<span class="namespace">absl::</span><a class="type" href="time.h.html#absl::lts_2020_02_25::Duration" title='absl::lts_2020_02_25::Duration' data-ref="absl::lts_2020_02_25::Duration" data-ref-filename="absl..lts_2020_02_25..Duration">Duration</a> <dfn class="local col8 decl" id="58to_sleep" title='to_sleep' data-type='absl::Duration' data-ref="58to_sleep" data-ref-filename="58to_sleep">to_sleep</dfn>) {</td></tr>
<tr><th id="545">545</th><td><u>#<span data-ppcond="545">ifdef</span> <span class="macro" data-ref="_M/_WIN32">_WIN32</span></u></td></tr>
<tr><th id="546">546</th><td>  Sleep(to_sleep / absl::Milliseconds(<var>1</var>));</td></tr>
<tr><th id="547">547</th><td><u>#<span data-ppcond="545">else</span></u></td></tr>
<tr><th id="548">548</th><td>  <b>struct</b> <a class="type" href="../../../../../include/bits/types/struct_timespec.h.html#timespec" title='timespec' data-ref="timespec" data-ref-filename="timespec">timespec</a> <dfn class="local col9 decl" id="59sleep_time" title='sleep_time' data-type='struct timespec' data-ref="59sleep_time" data-ref-filename="59sleep_time">sleep_time</dfn> = <span class="namespace">absl::</span><a class="ref fn" href="time.h.html#_ZN4absl14lts_2020_02_2510ToTimespecENS0_8DurationE" title='absl::lts_2020_02_25::ToTimespec' data-ref="_ZN4absl14lts_2020_02_2510ToTimespecENS0_8DurationE" data-ref-filename="_ZN4absl14lts_2020_02_2510ToTimespecENS0_8DurationE">ToTimespec</a>(<a class="ref fn fake" href="time.h.html#_ZN4absl14lts_2020_02_258DurationC1ERKS1_" title='absl::lts_2020_02_25::Duration::Duration' data-ref="_ZN4absl14lts_2020_02_258DurationC1ERKS1_" data-ref-filename="_ZN4absl14lts_2020_02_258DurationC1ERKS1_"></a><a class="local col8 ref" href="#58to_sleep" title='to_sleep' data-ref="58to_sleep" data-ref-filename="58to_sleep">to_sleep</a>);</td></tr>
<tr><th id="549">549</th><td>  <b>while</b> (<a class="ref fn" href="../../../../../include/time.h.html#nanosleep" title='nanosleep' data-ref="nanosleep" data-ref-filename="nanosleep">nanosleep</a>(&amp;<a class="local col9 ref" href="#59sleep_time" title='sleep_time' data-ref="59sleep_time" data-ref-filename="59sleep_time">sleep_time</a>, &amp;<a class="local col9 ref" href="#59sleep_time" title='sleep_time' data-ref="59sleep_time" data-ref-filename="59sleep_time">sleep_time</a>) != <var>0</var> &amp;&amp; <a class="macro" href="../../../../../include/errno.h.html#38" title="(*__errno_location ())" data-ref="_M/errno">errno</a> == <a class="macro" href="../../../../../include/asm-generic/errno-base.h.html#8" title="4" data-ref="_M/EINTR">EINTR</a>) {</td></tr>
<tr><th id="550">550</th><td>    <i>// Ignore signals and wait for the full interval to elapse.</i></td></tr>
<tr><th id="551">551</th><td>  }</td></tr>
<tr><th id="552">552</th><td><u>#<span data-ppcond="545">endif</span></u></td></tr>
<tr><th id="553">553</th><td>}</td></tr>
<tr><th id="554">554</th><td></td></tr>
<tr><th id="555">555</th><td>}  <i>// namespace</i></td></tr>
<tr><th id="556">556</th><td><a class="macro" href="../base/config.h.html#127" title="}" data-ref="_M/ABSL_NAMESPACE_END">ABSL_NAMESPACE_END</a></td></tr>
<tr><th id="557">557</th><td>}  <i>// namespace absl</i></td></tr>
<tr><th id="558">558</th><td></td></tr>
<tr><th id="559">559</th><td><b>extern</b> <q>"C"</q> {</td></tr>
<tr><th id="560">560</th><td></td></tr>
<tr><th id="561">561</th><td><a class="macro" href="../base/attributes.h.html#167" title="__attribute__((weak))" data-ref="_M/ABSL_ATTRIBUTE_WEAK">ABSL_ATTRIBUTE_WEAK</a> <em>void</em> <dfn class="decl def fn" id="AbslInternalSleepFor" title='AbslInternalSleepFor' data-ref="AbslInternalSleepFor" data-ref-filename="AbslInternalSleepFor">AbslInternalSleepFor</dfn>(<span class="namespace">absl::</span><a class="type" href="time.h.html#absl::lts_2020_02_25::Duration" title='absl::lts_2020_02_25::Duration' data-ref="absl::lts_2020_02_25::Duration" data-ref-filename="absl..lts_2020_02_25..Duration">Duration</a> <dfn class="local col0 decl" id="60duration" title='duration' data-type='absl::Duration' data-ref="60duration" data-ref-filename="60duration">duration</dfn>) {</td></tr>
<tr><th id="562">562</th><td>  <b>while</b> (<a class="ref fn fake" href="time.h.html#_ZN4absl14lts_2020_02_258DurationC1ERKS1_" title='absl::lts_2020_02_25::Duration::Duration' data-ref="_ZN4absl14lts_2020_02_258DurationC1ERKS1_" data-ref-filename="_ZN4absl14lts_2020_02_258DurationC1ERKS1_"></a><a class="local col0 ref" href="#60duration" title='duration' data-ref="60duration" data-ref-filename="60duration">duration</a> <a class="ref fn" href="time.h.html#_ZN4absl14lts_2020_02_25gtENS0_8DurationES1_" title='absl::lts_2020_02_25::operator&gt;' data-ref="_ZN4absl14lts_2020_02_25gtENS0_8DurationES1_" data-ref-filename="_ZN4absl14lts_2020_02_25gtENS0_8DurationES1_">&gt;</a> <span class="namespace">absl::</span><a class="ref fn" href="time.h.html#_ZN4absl14lts_2020_02_2512ZeroDurationEv" title='absl::lts_2020_02_25::ZeroDuration' data-ref="_ZN4absl14lts_2020_02_2512ZeroDurationEv" data-ref-filename="_ZN4absl14lts_2020_02_2512ZeroDurationEv">ZeroDuration</a>()) {</td></tr>
<tr><th id="563">563</th><td>    <span class="namespace">absl::</span><a class="type" href="time.h.html#absl::lts_2020_02_25::Duration" title='absl::lts_2020_02_25::Duration' data-ref="absl::lts_2020_02_25::Duration" data-ref-filename="absl..lts_2020_02_25..Duration">Duration</a> <dfn class="local col1 decl" id="61to_sleep" title='to_sleep' data-type='absl::Duration' data-ref="61to_sleep" data-ref-filename="61to_sleep">to_sleep</dfn> = <a class="ref fn fake" href="time.h.html#_ZN4absl14lts_2020_02_258DurationC1ERKS1_" title='absl::lts_2020_02_25::Duration::Duration' data-ref="_ZN4absl14lts_2020_02_258DurationC1ERKS1_" data-ref-filename="_ZN4absl14lts_2020_02_258DurationC1ERKS1_"></a><span class="namespace">std::</span><span class='ref fn' title='std::min' data-ref="_ZSt3minRKT_S1_" data-ref-filename="_ZSt3minRKT_S1_">min</span>(<a class="local col0 ref" href="#60duration" title='duration' data-ref="60duration" data-ref-filename="60duration">duration</a>, <span class="namespace">absl::</span><a class="tu ref fn" href="#_ZN4absl14lts_2020_02_2512_GLOBAL__N_18MaxSleepEv" title='absl::lts_2020_02_25::(anonymous namespace)::MaxSleep' data-use='c' data-ref="_ZN4absl14lts_2020_02_2512_GLOBAL__N_18MaxSleepEv" data-ref-filename="_ZN4absl14lts_2020_02_2512_GLOBAL__N_18MaxSleepEv">MaxSleep</a>());</td></tr>
<tr><th id="564">564</th><td>    <span class="namespace">absl::</span><a class="tu ref fn" href="#_ZN4absl14lts_2020_02_2512_GLOBAL__N_19SleepOnceENS0_8DurationE" title='absl::lts_2020_02_25::(anonymous namespace)::SleepOnce' data-use='c' data-ref="_ZN4absl14lts_2020_02_2512_GLOBAL__N_19SleepOnceENS0_8DurationE" data-ref-filename="_ZN4absl14lts_2020_02_2512_GLOBAL__N_19SleepOnceENS0_8DurationE">SleepOnce</a>(<a class="ref fn fake" href="time.h.html#_ZN4absl14lts_2020_02_258DurationC1ERKS1_" title='absl::lts_2020_02_25::Duration::Duration' data-ref="_ZN4absl14lts_2020_02_258DurationC1ERKS1_" data-ref-filename="_ZN4absl14lts_2020_02_258DurationC1ERKS1_"></a><a class="local col1 ref" href="#61to_sleep" title='to_sleep' data-ref="61to_sleep" data-ref-filename="61to_sleep">to_sleep</a>);</td></tr>
<tr><th id="565">565</th><td>    <a class="local col0 ref" href="#60duration" title='duration' data-ref="60duration" data-ref-filename="60duration">duration</a> <a class="ref fn" href="time.h.html#_ZN4absl14lts_2020_02_258DurationmIES1_" title='absl::lts_2020_02_25::Duration::operator-=' data-ref="_ZN4absl14lts_2020_02_258DurationmIES1_" data-ref-filename="_ZN4absl14lts_2020_02_258DurationmIES1_">-=</a> <a class="ref fn fake" href="time.h.html#_ZN4absl14lts_2020_02_258DurationC1ERKS1_" title='absl::lts_2020_02_25::Duration::Duration' data-ref="_ZN4absl14lts_2020_02_258DurationC1ERKS1_" data-ref-filename="_ZN4absl14lts_2020_02_258DurationC1ERKS1_"></a><a class="local col1 ref" href="#61to_sleep" title='to_sleep' data-ref="61to_sleep" data-ref-filename="61to_sleep">to_sleep</a>;</td></tr>
<tr><th id="566">566</th><td>  }</td></tr>
<tr><th id="567">567</th><td>}</td></tr>
<tr><th id="568">568</th><td></td></tr>
<tr><th id="569">569</th><td>}  <i>// extern "C"</i></td></tr>
<tr><th id="570">570</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2021-Aug-05</em> from project halide revision <em>v12.0.1</em>