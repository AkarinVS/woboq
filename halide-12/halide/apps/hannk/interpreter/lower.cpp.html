<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>lower.cpp source code [halide/apps/hannk/interpreter/lower.cpp] - Woboq Code Browser</title>
<link rel="stylesheet" href="../../../.././data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../.././data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../.././data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../.././data/jquery/jquery-ui.min.js"></script>
<script>var file = 'halide/apps/hannk/interpreter/lower.cpp'; var root_path = '../../../..'; var data_path = '../../../.././data'; var ecma_script_api_version = 2;</script>
<script src='../../../.././data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../../..'>halide</a>/<a href='../..'>apps</a>/<a href='..'>hannk</a>/<a href='./'>interpreter</a>/<a href='lower.cpp.html'>lower.cpp</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><u>#include <a href="lower.h.html">"interpreter/lower.h"</a></u></td></tr>
<tr><th id="2">2</th><td><u>#include <a href="elementwise_program.h.html">"interpreter/elementwise_program.h"</a></u></td></tr>
<tr><th id="3">3</th><td><u>#include <a href="ops.h.html">"interpreter/ops.h"</a></u></td></tr>
<tr><th id="4">4</th><td></td></tr>
<tr><th id="5">5</th><td><b>namespace</b> <span class="namespace">hannk</span> {</td></tr>
<tr><th id="6">6</th><td></td></tr>
<tr><th id="7">7</th><td><i>// Implement an LSTM from its constituent parts. This is extremely specific</i></td></tr>
<tr><th id="8">8</th><td><i>// to TFlite's LSTM op, which according to Benoit Jacob, is deprecated.</i></td></tr>
<tr><th id="9">9</th><td><i>// TODO: We could potentially lower this to individual elementwise ops instead,</i></td></tr>
<tr><th id="10">10</th><td><i>// and remove the 'LstmElementwiseOp' op.</i></td></tr>
<tr><th id="11">11</th><td><a class="typedef" href="model.h.html#hannk::OpPtr" title='hannk::OpPtr' data-type='std::unique_ptr&lt;Op&gt;' data-ref="hannk::OpPtr" data-ref-filename="hannk..OpPtr">OpPtr</a> <dfn class="decl def fn" id="_ZN5hannk17lower_tflite_lstmESt10shared_ptrINS_6TensorEES2_S2_S2_S2_S2_S2_S2_S2_NS_18ActivationFunctionE" title='hannk::lower_tflite_lstm' data-ref="_ZN5hannk17lower_tflite_lstmESt10shared_ptrINS_6TensorEES2_S2_S2_S2_S2_S2_S2_S2_NS_18ActivationFunctionE" data-ref-filename="_ZN5hannk17lower_tflite_lstmESt10shared_ptrINS_6TensorEES2_S2_S2_S2_S2_S2_S2_S2_NS_18ActivationFunctionE">lower_tflite_lstm</dfn>(<a class="typedef" href="model.h.html#hannk::TensorPtr" title='hannk::TensorPtr' data-type='std::shared_ptr&lt;Tensor&gt;' data-ref="hannk::TensorPtr" data-ref-filename="hannk..TensorPtr">TensorPtr</a> <dfn class="local col1 decl" id="1data_input" title='data_input' data-type='hannk::TensorPtr' data-ref="1data_input" data-ref-filename="1data_input">data_input</dfn>, <a class="typedef" href="model.h.html#hannk::TensorPtr" title='hannk::TensorPtr' data-type='std::shared_ptr&lt;Tensor&gt;' data-ref="hannk::TensorPtr" data-ref-filename="hannk..TensorPtr">TensorPtr</a> <dfn class="local col2 decl" id="2prev_activ_input" title='prev_activ_input' data-type='hannk::TensorPtr' data-ref="2prev_activ_input" data-ref-filename="2prev_activ_input">prev_activ_input</dfn>, <a class="typedef" href="model.h.html#hannk::TensorPtr" title='hannk::TensorPtr' data-type='std::shared_ptr&lt;Tensor&gt;' data-ref="hannk::TensorPtr" data-ref-filename="hannk..TensorPtr">TensorPtr</a> <dfn class="local col3 decl" id="3weights_input" title='weights_input' data-type='hannk::TensorPtr' data-ref="3weights_input" data-ref-filename="3weights_input">weights_input</dfn>, <a class="typedef" href="model.h.html#hannk::TensorPtr" title='hannk::TensorPtr' data-type='std::shared_ptr&lt;Tensor&gt;' data-ref="hannk::TensorPtr" data-ref-filename="hannk..TensorPtr">TensorPtr</a> <dfn class="local col4 decl" id="4biases_input" title='biases_input' data-type='hannk::TensorPtr' data-ref="4biases_input" data-ref-filename="4biases_input">biases_input</dfn>, <a class="typedef" href="model.h.html#hannk::TensorPtr" title='hannk::TensorPtr' data-type='std::shared_ptr&lt;Tensor&gt;' data-ref="hannk::TensorPtr" data-ref-filename="hannk..TensorPtr">TensorPtr</a> <dfn class="local col5 decl" id="5prev_state_input" title='prev_state_input' data-type='hannk::TensorPtr' data-ref="5prev_state_input" data-ref-filename="5prev_state_input">prev_state_input</dfn>,</td></tr>
<tr><th id="12">12</th><td>                        <a class="typedef" href="model.h.html#hannk::TensorPtr" title='hannk::TensorPtr' data-type='std::shared_ptr&lt;Tensor&gt;' data-ref="hannk::TensorPtr" data-ref-filename="hannk..TensorPtr">TensorPtr</a> <dfn class="local col6 decl" id="6activ_output" title='activ_output' data-type='hannk::TensorPtr' data-ref="6activ_output" data-ref-filename="6activ_output">activ_output</dfn>, <a class="typedef" href="model.h.html#hannk::TensorPtr" title='hannk::TensorPtr' data-type='std::shared_ptr&lt;Tensor&gt;' data-ref="hannk::TensorPtr" data-ref-filename="hannk..TensorPtr">TensorPtr</a> <dfn class="local col7 decl" id="7state_output" title='state_output' data-type='hannk::TensorPtr' data-ref="7state_output" data-ref-filename="7state_output">state_output</dfn>, <a class="typedef" href="model.h.html#hannk::TensorPtr" title='hannk::TensorPtr' data-type='std::shared_ptr&lt;Tensor&gt;' data-ref="hannk::TensorPtr" data-ref-filename="hannk..TensorPtr">TensorPtr</a> <dfn class="local col8 decl" id="8concat_temp" title='concat_temp' data-type='hannk::TensorPtr' data-ref="8concat_temp" data-ref-filename="8concat_temp">concat_temp</dfn>, <a class="typedef" href="model.h.html#hannk::TensorPtr" title='hannk::TensorPtr' data-type='std::shared_ptr&lt;Tensor&gt;' data-ref="hannk::TensorPtr" data-ref-filename="hannk..TensorPtr">TensorPtr</a> <dfn class="local col9 decl" id="9activ_temp" title='activ_temp' data-type='hannk::TensorPtr' data-ref="9activ_temp" data-ref-filename="9activ_temp">activ_temp</dfn>,</td></tr>
<tr><th id="13">13</th><td>                        <a class="type" href="ops.h.html#hannk::ActivationFunction" title='hannk::ActivationFunction' data-ref="hannk::ActivationFunction" data-ref-filename="hannk..ActivationFunction">ActivationFunction</a> <dfn class="local col0 decl" id="10activation" title='activation' data-type='hannk::ActivationFunction' data-ref="10activation" data-ref-filename="10activation">activation</dfn>) {</td></tr>
<tr><th id="14">14</th><td>    <span class="namespace">std::</span><span class='type' title='std::vector' data-ref="std::vector" data-ref-filename="std..vector">vector</span>&lt;<a class="typedef" href="model.h.html#hannk::TensorPtr" title='hannk::TensorPtr' data-type='std::shared_ptr&lt;Tensor&gt;' data-ref="hannk::TensorPtr" data-ref-filename="hannk..TensorPtr">TensorPtr</a>&gt; <dfn class="local col1 decl" id="11inputs" title='inputs' data-type='std::vector&lt;TensorPtr&gt;' data-ref="11inputs" data-ref-filename="11inputs">inputs</dfn> = <span class='ref fn fake' title='std::vector::vector&lt;_Tp, _Alloc&gt;' data-ref="_ZNSt6vectorC1ESt16initializer_listIT_ERKT0_" data-ref-filename="_ZNSt6vectorC1ESt16initializer_listIT_ERKT0_"></span>{<a class="local col1 ref" href="#1data_input" title='data_input' data-ref="1data_input" data-ref-filename="1data_input">data_input</a>, <a class="local col2 ref" href="#2prev_activ_input" title='prev_activ_input' data-ref="2prev_activ_input" data-ref-filename="2prev_activ_input">prev_activ_input</a>, <a class="local col3 ref" href="#3weights_input" title='weights_input' data-ref="3weights_input" data-ref-filename="3weights_input">weights_input</a>, <a class="local col4 ref" href="#4biases_input" title='biases_input' data-ref="4biases_input" data-ref-filename="4biases_input">biases_input</a>, <a class="local col5 ref" href="#5prev_state_input" title='prev_state_input' data-ref="5prev_state_input" data-ref-filename="5prev_state_input">prev_state_input</a>};</td></tr>
<tr><th id="15">15</th><td>    <span class="namespace">std::</span><span class='type' title='std::vector' data-ref="std::vector" data-ref-filename="std..vector">vector</span>&lt;<a class="typedef" href="model.h.html#hannk::TensorPtr" title='hannk::TensorPtr' data-type='std::shared_ptr&lt;Tensor&gt;' data-ref="hannk::TensorPtr" data-ref-filename="hannk..TensorPtr">TensorPtr</a>&gt; <dfn class="local col2 decl" id="12outputs" title='outputs' data-type='std::vector&lt;TensorPtr&gt;' data-ref="12outputs" data-ref-filename="12outputs">outputs</dfn> = <span class='ref fn fake' title='std::vector::vector&lt;_Tp, _Alloc&gt;' data-ref="_ZNSt6vectorC1ESt16initializer_listIT_ERKT0_" data-ref-filename="_ZNSt6vectorC1ESt16initializer_listIT_ERKT0_"></span>{<a class="local col6 ref" href="#6activ_output" title='activ_output' data-ref="6activ_output" data-ref-filename="6activ_output">activ_output</a>, <a class="local col7 ref" href="#7state_output" title='state_output' data-ref="7state_output" data-ref-filename="7state_output">state_output</a>};</td></tr>
<tr><th id="16">16</th><td></td></tr>
<tr><th id="17">17</th><td>    <span class="namespace">std::</span><span class='type' title='std::vector' data-ref="std::vector" data-ref-filename="std..vector">vector</span>&lt;<a class="typedef" href="model.h.html#hannk::OpPtr" title='hannk::OpPtr' data-type='std::unique_ptr&lt;Op&gt;' data-ref="hannk::OpPtr" data-ref-filename="hannk..OpPtr">OpPtr</a>&gt; <span class='ref fn fake' title='std::vector::vector&lt;_Tp, _Alloc&gt;' data-ref="_ZNSt6vectorC1Ev" data-ref-filename="_ZNSt6vectorC1Ev"></span><dfn class="local col3 decl" id="13ops" title='ops' data-type='std::vector&lt;OpPtr&gt;' data-ref="13ops" data-ref-filename="13ops">ops</dfn>;</td></tr>
<tr><th id="18">18</th><td></td></tr>
<tr><th id="19">19</th><td>    <span class="namespace">std::</span><span class='type' title='std::vector' data-ref="std::vector" data-ref-filename="std..vector">vector</span>&lt;<a class="typedef" href="model.h.html#hannk::TensorPtr" title='hannk::TensorPtr' data-type='std::shared_ptr&lt;Tensor&gt;' data-ref="hannk::TensorPtr" data-ref-filename="hannk..TensorPtr">TensorPtr</a>&gt; <dfn class="local col4 decl" id="14concat_inputs" title='concat_inputs' data-type='std::vector&lt;TensorPtr&gt;' data-ref="14concat_inputs" data-ref-filename="14concat_inputs">concat_inputs</dfn> = <span class='ref fn fake' title='std::vector::vector&lt;_Tp, _Alloc&gt;' data-ref="_ZNSt6vectorC1ESt16initializer_listIT_ERKT0_" data-ref-filename="_ZNSt6vectorC1ESt16initializer_listIT_ERKT0_"></span>{<a class="local col1 ref" href="#1data_input" title='data_input' data-ref="1data_input" data-ref-filename="1data_input">data_input</a>, <a class="local col2 ref" href="#2prev_activ_input" title='prev_activ_input' data-ref="2prev_activ_input" data-ref-filename="2prev_activ_input">prev_activ_input</a>};</td></tr>
<tr><th id="20">20</th><td>    <a class="local col3 ref" href="#13ops" title='ops' data-ref="13ops" data-ref-filename="13ops">ops</a>.<span class='ref fn' title='std::vector::push_back' data-ref="_ZNSt6vector9push_backEOT_" data-ref-filename="_ZNSt6vector9push_backEOT_">push_back</span>(<span class='ref fn fake' title='std::unique_ptr::unique_ptr&lt;_Tp, _Dp&gt;' data-ref="_ZNSt10unique_ptrC1EOSt10unique_ptrITL0__TL0_0_E" data-ref-filename="_ZNSt10unique_ptrC1EOSt10unique_ptrITL0__TL0_0_E"></span><a class="ref fn" href="model.h.html#_ZN5hannk7make_opEDpOT0_" title='hannk::make_op' data-ref="_ZN5hannk7make_opEDpOT0_" data-ref-filename="_ZN5hannk7make_opEDpOT0_">make_op</a>&lt;<a class="type" href="ops.h.html#hannk::ConcatenationOp" title='hannk::ConcatenationOp' data-ref="hannk::ConcatenationOp" data-ref-filename="hannk..ConcatenationOp">ConcatenationOp</a>&gt;(<span class='refarg'><a class="local col4 ref" href="#14concat_inputs" title='concat_inputs' data-ref="14concat_inputs" data-ref-filename="14concat_inputs">concat_inputs</a></span>, <span class='refarg'><a class="local col8 ref" href="#8concat_temp" title='concat_temp' data-ref="8concat_temp" data-ref-filename="8concat_temp">concat_temp</a></span>, <var>0</var>));</td></tr>
<tr><th id="21">21</th><td>    <a class="local col3 ref" href="#13ops" title='ops' data-ref="13ops" data-ref-filename="13ops">ops</a>.<span class='ref fn' title='std::vector::push_back' data-ref="_ZNSt6vector9push_backEOT_" data-ref-filename="_ZNSt6vector9push_backEOT_">push_back</span>(<span class='ref fn fake' title='std::unique_ptr::unique_ptr&lt;_Tp, _Dp&gt;' data-ref="_ZNSt10unique_ptrC1EOSt10unique_ptrITL0__TL0_0_E" data-ref-filename="_ZNSt10unique_ptrC1EOSt10unique_ptrITL0__TL0_0_E"></span><a class="ref fn" href="model.h.html#_ZN5hannk7make_opEDpOT0_" title='hannk::make_op' data-ref="_ZN5hannk7make_opEDpOT0_" data-ref-filename="_ZN5hannk7make_opEDpOT0_">make_op</a>&lt;<a class="type" href="ops.h.html#hannk::FullyConnectedOp" title='hannk::FullyConnectedOp' data-ref="hannk::FullyConnectedOp" data-ref-filename="hannk..FullyConnectedOp">FullyConnectedOp</a>&gt;(<span class='refarg'><a class="local col8 ref" href="#8concat_temp" title='concat_temp' data-ref="8concat_temp" data-ref-filename="8concat_temp">concat_temp</a></span>, <span class='refarg'><a class="local col3 ref" href="#3weights_input" title='weights_input' data-ref="3weights_input" data-ref-filename="3weights_input">weights_input</a></span>, <span class='refarg'><a class="local col4 ref" href="#4biases_input" title='biases_input' data-ref="4biases_input" data-ref-filename="4biases_input">biases_input</a></span>, <span class='refarg'><a class="local col9 ref" href="#9activ_temp" title='activ_temp' data-ref="9activ_temp" data-ref-filename="9activ_temp">activ_temp</a></span>, <span class='refarg'><a class="local col0 ref" href="#10activation" title='activation' data-ref="10activation" data-ref-filename="10activation">activation</a></span>));</td></tr>
<tr><th id="22">22</th><td></td></tr>
<tr><th id="23">23</th><td>    <i>// Split activ_temp into the 4 ops we need.</i></td></tr>
<tr><th id="24">24</th><td>    <a class="typedef" href="interval.h.html#hannk::Box" title='hannk::Box' data-type='SmallVector&lt;hannk::Interval, max_rank&gt;' data-ref="hannk::Box" data-ref-filename="hannk..Box">Box</a> <dfn class="local col5 decl" id="15elementwise_bounds" title='elementwise_bounds' data-type='hannk::Box' data-ref="15elementwise_bounds" data-ref-filename="15elementwise_bounds">elementwise_bounds</dfn> = <a class="local col9 ref" href="#9activ_temp" title='activ_temp' data-ref="9activ_temp" data-ref-filename="9activ_temp">activ_temp</a><span class='ref fn' title='std::__shared_ptr_access::operator-&gt;' data-ref="_ZNKSt19__shared_ptr_accessptEv" data-ref-filename="_ZNKSt19__shared_ptr_accessptEv">-&gt;</span><a class="ref fn" href="model.h.html#_ZNK5hannk6Tensor6boundsEv" title='hannk::Tensor::bounds' data-ref="_ZNK5hannk6Tensor6boundsEv" data-ref-filename="_ZNK5hannk6Tensor6boundsEv">bounds</a>();</td></tr>
<tr><th id="25">25</th><td>    <a class="local col5 ref" href="#15elementwise_bounds" title='elementwise_bounds' data-ref="15elementwise_bounds" data-ref-filename="15elementwise_bounds">elementwise_bounds</a><a class="ref fn" href="interval.h.html#_ZN5hannk11SmallVectorixEm" title='hannk::SmallVector::operator[]' data-ref="_ZN5hannk11SmallVectorixEm" data-ref-filename="_ZN5hannk11SmallVectorixEm">[<var>0</var>]</a>.<a class="ref fn" href="interval.h.html#_ZN5hannk8Interval10set_extentEi" title='hannk::Interval::set_extent' data-ref="_ZN5hannk8Interval10set_extentEi" data-ref-filename="_ZN5hannk8Interval10set_extentEi">set_extent</a>(<a class="local col5 ref" href="#15elementwise_bounds" title='elementwise_bounds' data-ref="15elementwise_bounds" data-ref-filename="15elementwise_bounds">elementwise_bounds</a><a class="ref fn" href="interval.h.html#_ZN5hannk11SmallVectorixEm" title='hannk::SmallVector::operator[]' data-ref="_ZN5hannk11SmallVectorixEm" data-ref-filename="_ZN5hannk11SmallVectorixEm">[<var>0</var>]</a>.<a class="ref fn" href="interval.h.html#_ZNK5hannk8Interval6extentEv" title='hannk::Interval::extent' data-ref="_ZNK5hannk8Interval6extentEv" data-ref-filename="_ZNK5hannk8Interval6extentEv">extent</a>() / <var>4</var>);</td></tr>
<tr><th id="26">26</th><td>    <a class="typedef" href="model.h.html#hannk::TensorPtr" title='hannk::TensorPtr' data-type='std::shared_ptr&lt;Tensor&gt;' data-ref="hannk::TensorPtr" data-ref-filename="hannk..TensorPtr">TensorPtr</a> <dfn class="local col6 decl" id="16input_gate_buf" title='input_gate_buf' data-type='hannk::TensorPtr' data-ref="16input_gate_buf" data-ref-filename="16input_gate_buf">input_gate_buf</dfn> =</td></tr>
<tr><th id="27">27</th><td>        <span class="namespace">std::</span><span class='ref fn' title='std::make_shared' data-ref="_ZSt11make_sharedDpOT0_" data-ref-filename="_ZSt11make_sharedDpOT0_">make_shared</span>&lt;<a class="type" href="model.h.html#hannk::Tensor" title='hannk::Tensor' data-ref="hannk::Tensor" data-ref-filename="hannk..Tensor">Tensor</a>&gt;(<q>"input_gate"</q>, <a class="local col9 ref" href="#9activ_temp" title='activ_temp' data-ref="9activ_temp" data-ref-filename="9activ_temp">activ_temp</a><span class='ref fn' title='std::__shared_ptr_access::operator-&gt;' data-ref="_ZNKSt19__shared_ptr_accessptEv" data-ref-filename="_ZNKSt19__shared_ptr_accessptEv">-&gt;</span><a class="ref fn" href="model.h.html#_ZNK5hannk6Tensor4typeEv" title='hannk::Tensor::type' data-ref="_ZNK5hannk6Tensor4typeEv" data-ref-filename="_ZNK5hannk6Tensor4typeEv">type</a>(), <span class='refarg'><a class="local col5 ref" href="#15elementwise_bounds" title='elementwise_bounds' data-ref="15elementwise_bounds" data-ref-filename="15elementwise_bounds">elementwise_bounds</a></span>, <a class="local col9 ref" href="#9activ_temp" title='activ_temp' data-ref="9activ_temp" data-ref-filename="9activ_temp">activ_temp</a><span class='ref fn' title='std::__shared_ptr_access::operator-&gt;' data-ref="_ZNKSt19__shared_ptr_accessptEv" data-ref-filename="_ZNKSt19__shared_ptr_accessptEv">-&gt;</span><a class="ref fn" href="model.h.html#_ZNK5hannk6Tensor12quantizationEv" title='hannk::Tensor::quantization' data-ref="_ZNK5hannk6Tensor12quantizationEv" data-ref-filename="_ZNK5hannk6Tensor12quantizationEv">quantization</a>());</td></tr>
<tr><th id="28">28</th><td>    <a class="typedef" href="model.h.html#hannk::TensorPtr" title='hannk::TensorPtr' data-type='std::shared_ptr&lt;Tensor&gt;' data-ref="hannk::TensorPtr" data-ref-filename="hannk..TensorPtr">TensorPtr</a> <dfn class="local col7 decl" id="17input_modulation_gate_buf" title='input_modulation_gate_buf' data-type='hannk::TensorPtr' data-ref="17input_modulation_gate_buf" data-ref-filename="17input_modulation_gate_buf">input_modulation_gate_buf</dfn> =</td></tr>
<tr><th id="29">29</th><td>        <span class="namespace">std::</span><span class='ref fn' title='std::make_shared' data-ref="_ZSt11make_sharedDpOT0_" data-ref-filename="_ZSt11make_sharedDpOT0_">make_shared</span>&lt;<a class="type" href="model.h.html#hannk::Tensor" title='hannk::Tensor' data-ref="hannk::Tensor" data-ref-filename="hannk..Tensor">Tensor</a>&gt;(<q>"input_modulation_gate"</q>, <a class="local col9 ref" href="#9activ_temp" title='activ_temp' data-ref="9activ_temp" data-ref-filename="9activ_temp">activ_temp</a><span class='ref fn' title='std::__shared_ptr_access::operator-&gt;' data-ref="_ZNKSt19__shared_ptr_accessptEv" data-ref-filename="_ZNKSt19__shared_ptr_accessptEv">-&gt;</span><a class="ref fn" href="model.h.html#_ZNK5hannk6Tensor4typeEv" title='hannk::Tensor::type' data-ref="_ZNK5hannk6Tensor4typeEv" data-ref-filename="_ZNK5hannk6Tensor4typeEv">type</a>(), <span class='refarg'><a class="local col5 ref" href="#15elementwise_bounds" title='elementwise_bounds' data-ref="15elementwise_bounds" data-ref-filename="15elementwise_bounds">elementwise_bounds</a></span>, <a class="local col9 ref" href="#9activ_temp" title='activ_temp' data-ref="9activ_temp" data-ref-filename="9activ_temp">activ_temp</a><span class='ref fn' title='std::__shared_ptr_access::operator-&gt;' data-ref="_ZNKSt19__shared_ptr_accessptEv" data-ref-filename="_ZNKSt19__shared_ptr_accessptEv">-&gt;</span><a class="ref fn" href="model.h.html#_ZNK5hannk6Tensor12quantizationEv" title='hannk::Tensor::quantization' data-ref="_ZNK5hannk6Tensor12quantizationEv" data-ref-filename="_ZNK5hannk6Tensor12quantizationEv">quantization</a>());</td></tr>
<tr><th id="30">30</th><td>    <a class="typedef" href="model.h.html#hannk::TensorPtr" title='hannk::TensorPtr' data-type='std::shared_ptr&lt;Tensor&gt;' data-ref="hannk::TensorPtr" data-ref-filename="hannk..TensorPtr">TensorPtr</a> <dfn class="local col8 decl" id="18forget_gate_buf" title='forget_gate_buf' data-type='hannk::TensorPtr' data-ref="18forget_gate_buf" data-ref-filename="18forget_gate_buf">forget_gate_buf</dfn> =</td></tr>
<tr><th id="31">31</th><td>        <span class="namespace">std::</span><span class='ref fn' title='std::make_shared' data-ref="_ZSt11make_sharedDpOT0_" data-ref-filename="_ZSt11make_sharedDpOT0_">make_shared</span>&lt;<a class="type" href="model.h.html#hannk::Tensor" title='hannk::Tensor' data-ref="hannk::Tensor" data-ref-filename="hannk..Tensor">Tensor</a>&gt;(<q>"forget_gate"</q>, <a class="local col9 ref" href="#9activ_temp" title='activ_temp' data-ref="9activ_temp" data-ref-filename="9activ_temp">activ_temp</a><span class='ref fn' title='std::__shared_ptr_access::operator-&gt;' data-ref="_ZNKSt19__shared_ptr_accessptEv" data-ref-filename="_ZNKSt19__shared_ptr_accessptEv">-&gt;</span><a class="ref fn" href="model.h.html#_ZNK5hannk6Tensor4typeEv" title='hannk::Tensor::type' data-ref="_ZNK5hannk6Tensor4typeEv" data-ref-filename="_ZNK5hannk6Tensor4typeEv">type</a>(), <span class='refarg'><a class="local col5 ref" href="#15elementwise_bounds" title='elementwise_bounds' data-ref="15elementwise_bounds" data-ref-filename="15elementwise_bounds">elementwise_bounds</a></span>, <a class="local col9 ref" href="#9activ_temp" title='activ_temp' data-ref="9activ_temp" data-ref-filename="9activ_temp">activ_temp</a><span class='ref fn' title='std::__shared_ptr_access::operator-&gt;' data-ref="_ZNKSt19__shared_ptr_accessptEv" data-ref-filename="_ZNKSt19__shared_ptr_accessptEv">-&gt;</span><a class="ref fn" href="model.h.html#_ZNK5hannk6Tensor12quantizationEv" title='hannk::Tensor::quantization' data-ref="_ZNK5hannk6Tensor12quantizationEv" data-ref-filename="_ZNK5hannk6Tensor12quantizationEv">quantization</a>());</td></tr>
<tr><th id="32">32</th><td>    <a class="typedef" href="model.h.html#hannk::TensorPtr" title='hannk::TensorPtr' data-type='std::shared_ptr&lt;Tensor&gt;' data-ref="hannk::TensorPtr" data-ref-filename="hannk..TensorPtr">TensorPtr</a> <dfn class="local col9 decl" id="19output_gate_buf" title='output_gate_buf' data-type='hannk::TensorPtr' data-ref="19output_gate_buf" data-ref-filename="19output_gate_buf">output_gate_buf</dfn> =</td></tr>
<tr><th id="33">33</th><td>        <span class="namespace">std::</span><span class='ref fn' title='std::make_shared' data-ref="_ZSt11make_sharedDpOT0_" data-ref-filename="_ZSt11make_sharedDpOT0_">make_shared</span>&lt;<a class="type" href="model.h.html#hannk::Tensor" title='hannk::Tensor' data-ref="hannk::Tensor" data-ref-filename="hannk..Tensor">Tensor</a>&gt;(<q>"output_gate"</q>, <a class="local col9 ref" href="#9activ_temp" title='activ_temp' data-ref="9activ_temp" data-ref-filename="9activ_temp">activ_temp</a><span class='ref fn' title='std::__shared_ptr_access::operator-&gt;' data-ref="_ZNKSt19__shared_ptr_accessptEv" data-ref-filename="_ZNKSt19__shared_ptr_accessptEv">-&gt;</span><a class="ref fn" href="model.h.html#_ZNK5hannk6Tensor4typeEv" title='hannk::Tensor::type' data-ref="_ZNK5hannk6Tensor4typeEv" data-ref-filename="_ZNK5hannk6Tensor4typeEv">type</a>(), <span class='refarg'><a class="local col5 ref" href="#15elementwise_bounds" title='elementwise_bounds' data-ref="15elementwise_bounds" data-ref-filename="15elementwise_bounds">elementwise_bounds</a></span>, <a class="local col9 ref" href="#9activ_temp" title='activ_temp' data-ref="9activ_temp" data-ref-filename="9activ_temp">activ_temp</a><span class='ref fn' title='std::__shared_ptr_access::operator-&gt;' data-ref="_ZNKSt19__shared_ptr_accessptEv" data-ref-filename="_ZNKSt19__shared_ptr_accessptEv">-&gt;</span><a class="ref fn" href="model.h.html#_ZNK5hannk6Tensor12quantizationEv" title='hannk::Tensor::quantization' data-ref="_ZNK5hannk6Tensor12quantizationEv" data-ref-filename="_ZNK5hannk6Tensor12quantizationEv">quantization</a>());</td></tr>
<tr><th id="34">34</th><td>    <span class="namespace">std::</span><span class='type' title='std::vector' data-ref="std::vector" data-ref-filename="std..vector">vector</span>&lt;<a class="typedef" href="model.h.html#hannk::TensorPtr" title='hannk::TensorPtr' data-type='std::shared_ptr&lt;Tensor&gt;' data-ref="hannk::TensorPtr" data-ref-filename="hannk..TensorPtr">TensorPtr</a>&gt; <dfn class="local col0 decl" id="20split_outputs" title='split_outputs' data-type='std::vector&lt;TensorPtr&gt;' data-ref="20split_outputs" data-ref-filename="20split_outputs">split_outputs</dfn> = <span class='ref fn fake' title='std::vector::vector&lt;_Tp, _Alloc&gt;' data-ref="_ZNSt6vectorC1ESt16initializer_listIT_ERKT0_" data-ref-filename="_ZNSt6vectorC1ESt16initializer_listIT_ERKT0_"></span>{<a class="local col6 ref" href="#16input_gate_buf" title='input_gate_buf' data-ref="16input_gate_buf" data-ref-filename="16input_gate_buf">input_gate_buf</a>, <a class="local col7 ref" href="#17input_modulation_gate_buf" title='input_modulation_gate_buf' data-ref="17input_modulation_gate_buf" data-ref-filename="17input_modulation_gate_buf">input_modulation_gate_buf</a>, <a class="local col8 ref" href="#18forget_gate_buf" title='forget_gate_buf' data-ref="18forget_gate_buf" data-ref-filename="18forget_gate_buf">forget_gate_buf</a>, <a class="local col9 ref" href="#19output_gate_buf" title='output_gate_buf' data-ref="19output_gate_buf" data-ref-filename="19output_gate_buf">output_gate_buf</a>};</td></tr>
<tr><th id="35">35</th><td>    <a class="local col3 ref" href="#13ops" title='ops' data-ref="13ops" data-ref-filename="13ops">ops</a>.<span class='ref fn' title='std::vector::push_back' data-ref="_ZNSt6vector9push_backEOT_" data-ref-filename="_ZNSt6vector9push_backEOT_">push_back</span>(<span class='ref fn fake' title='std::unique_ptr::unique_ptr&lt;_Tp, _Dp&gt;' data-ref="_ZNSt10unique_ptrC1EOSt10unique_ptrITL0__TL0_0_E" data-ref-filename="_ZNSt10unique_ptrC1EOSt10unique_ptrITL0__TL0_0_E"></span><a class="ref fn" href="model.h.html#_ZN5hannk7make_opEDpOT0_" title='hannk::make_op' data-ref="_ZN5hannk7make_opEDpOT0_" data-ref-filename="_ZN5hannk7make_opEDpOT0_">make_op</a>&lt;<a class="type" href="ops.h.html#hannk::SplitOp" title='hannk::SplitOp' data-ref="hannk::SplitOp" data-ref-filename="hannk..SplitOp">SplitOp</a>&gt;(<span class='refarg'><a class="local col9 ref" href="#9activ_temp" title='activ_temp' data-ref="9activ_temp" data-ref-filename="9activ_temp">activ_temp</a></span>, <span class='refarg'><a class="local col0 ref" href="#20split_outputs" title='split_outputs' data-ref="20split_outputs" data-ref-filename="20split_outputs">split_outputs</a></span>, <var>0</var>));</td></tr>
<tr><th id="36">36</th><td></td></tr>
<tr><th id="37">37</th><td>    <i>// Implements the elementwise compute part of the 'LSTM' TFlite operation.</i></td></tr>
<tr><th id="38">38</th><td><i>    // This is extremely specific to TFlite's implementation choices, which are</i></td></tr>
<tr><th id="39">39</th><td><i>    // documented here: <a href="https://github.com/tensorflow/tensorflow/blob/cbeddb59c4c836637f64b3eb5c639d7db8ca4005/tensorflow/lite/kernels/internal/reference/reference_ops.h#L758-L830">https://github.com/tensorflow/tensorflow/blob/cbeddb59c4c836637f64b3eb5c639d7db8ca4005/tensorflow/lite/kernels/internal/reference/reference_ops.h#L758-L830</a></i></td></tr>
<tr><th id="40">40</th><td><i>    // According to Benoit Jacob, this approach of specific LSTM ops is deprecated,</i></td></tr>
<tr><th id="41">41</th><td><i>    // and most future LSTMs should just arrive as individual elementwise ops.</i></td></tr>
<tr><th id="42">42</th><td>    <span class="namespace">std::</span><span class='type' title='std::array' data-ref="std::array" data-ref-filename="std..array">array</span>&lt;<a class="typedef" href="../../../../include/bits/stdint-intn.h.html#int16_t" title='int16_t' data-type='__int16_t' data-ref="int16_t" data-ref-filename="int16_t">int16_t</a>, <var>256</var>&gt; <span class='ref fn fake' title='std::array&lt;short, 256&gt;::array' data-ref="_ZNSt5arrayIsLm256EEC1Ev" data-ref-filename="_ZNSt5arrayIsLm256EEC1Ev"></span><dfn class="local col1 decl" id="21program_buffer" title='program_buffer' data-type='std::array&lt;int16_t, 256&gt;' data-ref="21program_buffer" data-ref-filename="21program_buffer">program_buffer</dfn>;</td></tr>
<tr><th id="43">43</th><td>    <a class="type" href="elementwise_program.h.html#hannk::ElementwiseAssembler" title='hannk::ElementwiseAssembler' data-ref="hannk::ElementwiseAssembler" data-ref-filename="hannk..ElementwiseAssembler">ElementwiseAssembler</a> <dfn class="local col2 decl" id="22p" title='p' data-type='hannk::ElementwiseAssembler' data-ref="22p" data-ref-filename="22p">p</dfn><a class="ref fn" href="elementwise_program.h.html#_ZN5hannk20ElementwiseAssemblerC1ERSt5arrayIsXT_EE" title='hannk::ElementwiseAssembler::ElementwiseAssembler' data-ref="_ZN5hannk20ElementwiseAssemblerC1ERSt5arrayIsXT_EE" data-ref-filename="_ZN5hannk20ElementwiseAssemblerC1ERSt5arrayIsXT_EE">(</a><a class="local col1 ref" href="#21program_buffer" title='program_buffer' data-ref="21program_buffer" data-ref-filename="21program_buffer">program_buffer</a>);</td></tr>
<tr><th id="44">44</th><td></td></tr>
<tr><th id="45">45</th><td>    <span class="namespace">std::</span><span class='type' title='std::vector' data-ref="std::vector" data-ref-filename="std..vector">vector</span>&lt;<a class="typedef" href="model.h.html#hannk::TensorPtr" title='hannk::TensorPtr' data-type='std::shared_ptr&lt;Tensor&gt;' data-ref="hannk::TensorPtr" data-ref-filename="hannk..TensorPtr">TensorPtr</a>&gt; <dfn class="local col3 decl" id="23elementwise_inputs" title='elementwise_inputs' data-type='std::vector&lt;TensorPtr&gt;' data-ref="23elementwise_inputs" data-ref-filename="23elementwise_inputs">elementwise_inputs</dfn> = <span class='ref fn fake' title='std::vector::vector&lt;_Tp, _Alloc&gt;' data-ref="_ZNSt6vectorC1ESt16initializer_listIT_ERKT0_" data-ref-filename="_ZNSt6vectorC1ESt16initializer_listIT_ERKT0_"></span>{<a class="local col6 ref" href="#16input_gate_buf" title='input_gate_buf' data-ref="16input_gate_buf" data-ref-filename="16input_gate_buf">input_gate_buf</a>, <a class="local col7 ref" href="#17input_modulation_gate_buf" title='input_modulation_gate_buf' data-ref="17input_modulation_gate_buf" data-ref-filename="17input_modulation_gate_buf">input_modulation_gate_buf</a>, <a class="local col8 ref" href="#18forget_gate_buf" title='forget_gate_buf' data-ref="18forget_gate_buf" data-ref-filename="18forget_gate_buf">forget_gate_buf</a>, <a class="local col9 ref" href="#19output_gate_buf" title='output_gate_buf' data-ref="19output_gate_buf" data-ref-filename="19output_gate_buf">output_gate_buf</a>, <a class="local col5 ref" href="#5prev_state_input" title='prev_state_input' data-ref="5prev_state_input" data-ref-filename="5prev_state_input">prev_state_input</a>};</td></tr>
<tr><th id="46">46</th><td>    <span class="namespace">std::</span><span class='type' title='std::vector' data-ref="std::vector" data-ref-filename="std..vector">vector</span>&lt;<a class="typedef" href="model.h.html#hannk::TensorPtr" title='hannk::TensorPtr' data-type='std::shared_ptr&lt;Tensor&gt;' data-ref="hannk::TensorPtr" data-ref-filename="hannk..TensorPtr">TensorPtr</a>&gt; <dfn class="local col4 decl" id="24elementwise_outputs" title='elementwise_outputs' data-type='std::vector&lt;TensorPtr&gt;' data-ref="24elementwise_outputs" data-ref-filename="24elementwise_outputs">elementwise_outputs</dfn> = <span class='ref fn fake' title='std::vector::vector&lt;_Tp, _Alloc&gt;' data-ref="_ZNSt6vectorC1ESt16initializer_listIT_ERKT0_" data-ref-filename="_ZNSt6vectorC1ESt16initializer_listIT_ERKT0_"></span>{<a class="local col6 ref" href="#6activ_output" title='activ_output' data-ref="6activ_output" data-ref-filename="6activ_output">activ_output</a>, <a class="local col7 ref" href="#7state_output" title='state_output' data-ref="7state_output" data-ref-filename="7state_output">state_output</a>};</td></tr>
<tr><th id="47">47</th><td>    <em>auto</em> <dfn class="local col5 decl" id="25input_gate" title='input_gate' data-type='hannk::ElementwiseAssembler::Slot' data-ref="25input_gate" data-ref-filename="25input_gate">input_gate</dfn> = <a class="local col2 ref" href="#22p" title='p' data-ref="22p" data-ref-filename="22p">p</a>.<a class="ref fn" href="elementwise_program.h.html#_ZN5hannk20ElementwiseAssembler5inputEi" title='hannk::ElementwiseAssembler::input' data-ref="_ZN5hannk20ElementwiseAssembler5inputEi" data-ref-filename="_ZN5hannk20ElementwiseAssembler5inputEi">input</a>(<var>0</var>);</td></tr>
<tr><th id="48">48</th><td>    <em>auto</em> <dfn class="local col6 decl" id="26input_modulation_gate" title='input_modulation_gate' data-type='hannk::ElementwiseAssembler::Slot' data-ref="26input_modulation_gate" data-ref-filename="26input_modulation_gate">input_modulation_gate</dfn> = <a class="local col2 ref" href="#22p" title='p' data-ref="22p" data-ref-filename="22p">p</a>.<a class="ref fn" href="elementwise_program.h.html#_ZN5hannk20ElementwiseAssembler5inputEi" title='hannk::ElementwiseAssembler::input' data-ref="_ZN5hannk20ElementwiseAssembler5inputEi" data-ref-filename="_ZN5hannk20ElementwiseAssembler5inputEi">input</a>(<var>1</var>);</td></tr>
<tr><th id="49">49</th><td>    <em>auto</em> <dfn class="local col7 decl" id="27forget_gate" title='forget_gate' data-type='hannk::ElementwiseAssembler::Slot' data-ref="27forget_gate" data-ref-filename="27forget_gate">forget_gate</dfn> = <a class="local col2 ref" href="#22p" title='p' data-ref="22p" data-ref-filename="22p">p</a>.<a class="ref fn" href="elementwise_program.h.html#_ZN5hannk20ElementwiseAssembler5inputEi" title='hannk::ElementwiseAssembler::input' data-ref="_ZN5hannk20ElementwiseAssembler5inputEi" data-ref-filename="_ZN5hannk20ElementwiseAssembler5inputEi">input</a>(<var>2</var>);</td></tr>
<tr><th id="50">50</th><td>    <em>auto</em> <dfn class="local col8 decl" id="28output_gate" title='output_gate' data-type='hannk::ElementwiseAssembler::Slot' data-ref="28output_gate" data-ref-filename="28output_gate">output_gate</dfn> = <a class="local col2 ref" href="#22p" title='p' data-ref="22p" data-ref-filename="22p">p</a>.<a class="ref fn" href="elementwise_program.h.html#_ZN5hannk20ElementwiseAssembler5inputEi" title='hannk::ElementwiseAssembler::input' data-ref="_ZN5hannk20ElementwiseAssembler5inputEi" data-ref-filename="_ZN5hannk20ElementwiseAssembler5inputEi">input</a>(<var>3</var>);</td></tr>
<tr><th id="51">51</th><td>    <em>auto</em> <dfn class="local col9 decl" id="29prev_state" title='prev_state' data-type='hannk::ElementwiseAssembler::Slot' data-ref="29prev_state" data-ref-filename="29prev_state">prev_state</dfn> = <a class="local col2 ref" href="#22p" title='p' data-ref="22p" data-ref-filename="22p">p</a>.<a class="ref fn" href="elementwise_program.h.html#_ZN5hannk20ElementwiseAssembler5inputEi" title='hannk::ElementwiseAssembler::input' data-ref="_ZN5hannk20ElementwiseAssembler5inputEi" data-ref-filename="_ZN5hannk20ElementwiseAssembler5inputEi">input</a>(<var>4</var>);</td></tr>
<tr><th id="52">52</th><td></td></tr>
<tr><th id="53">53</th><td>    <em>const</em> <a class="typedef" href="../../../../include/bits/stdint-intn.h.html#int16_t" title='int16_t' data-type='__int16_t' data-ref="int16_t" data-ref-filename="int16_t">int16_t</a> <dfn class="local col0 decl" id="30q" title='q' data-type='const int16_t' data-ref="30q" data-ref-filename="30q">q</dfn> = <var>15</var>;</td></tr>
<tr><th id="54">54</th><td>    <em>auto</em> <dfn class="local col1 decl" id="31input_gate_output" title='input_gate_output' data-type='hannk::ElementwiseAssembler::Slot' data-ref="31input_gate_output" data-ref-filename="31input_gate_output">input_gate_output</dfn> = <a class="local col2 ref" href="#22p" title='p' data-ref="22p" data-ref-filename="22p">p</a>.<a class="ref fn" href="elementwise_program.h.html#_ZN5hannk20ElementwiseAssembler8logisticEsNS0_4SlotEs" title='hannk::ElementwiseAssembler::logistic' data-ref="_ZN5hannk20ElementwiseAssembler8logisticEsNS0_4SlotEs" data-ref-filename="_ZN5hannk20ElementwiseAssembler8logisticEsNS0_4SlotEs">logistic</a>(<a class="local col0 ref" href="#30q" title='q' data-ref="30q" data-ref-filename="30q">q</a>, <a class="ref fn fake" href="elementwise_program.h.html#50" title='hannk::ElementwiseAssembler::Slot::Slot' data-ref="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_" data-ref-filename="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_"></a><a class="local col5 ref" href="#25input_gate" title='input_gate' data-ref="25input_gate" data-ref-filename="25input_gate">input_gate</a>, <a class="local col0 ref" href="#30q" title='q' data-ref="30q" data-ref-filename="30q">q</a> - <var>3</var>);</td></tr>
<tr><th id="55">55</th><td>    <em>auto</em> <dfn class="local col2 decl" id="32input_modulation_gate_output" title='input_modulation_gate_output' data-type='hannk::ElementwiseAssembler::Slot' data-ref="32input_modulation_gate_output" data-ref-filename="32input_modulation_gate_output">input_modulation_gate_output</dfn> = <a class="local col2 ref" href="#22p" title='p' data-ref="22p" data-ref-filename="22p">p</a>.<a class="ref fn" href="elementwise_program.h.html#_ZN5hannk20ElementwiseAssembler4tanhEsNS0_4SlotEs" title='hannk::ElementwiseAssembler::tanh' data-ref="_ZN5hannk20ElementwiseAssembler4tanhEsNS0_4SlotEs" data-ref-filename="_ZN5hannk20ElementwiseAssembler4tanhEsNS0_4SlotEs">tanh</a>(<a class="local col0 ref" href="#30q" title='q' data-ref="30q" data-ref-filename="30q">q</a>, <a class="ref fn fake" href="elementwise_program.h.html#50" title='hannk::ElementwiseAssembler::Slot::Slot' data-ref="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_" data-ref-filename="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_"></a><a class="local col6 ref" href="#26input_modulation_gate" title='input_modulation_gate' data-ref="26input_modulation_gate" data-ref-filename="26input_modulation_gate">input_modulation_gate</a>, <a class="local col0 ref" href="#30q" title='q' data-ref="30q" data-ref-filename="30q">q</a> - <var>3</var>);</td></tr>
<tr><th id="56">56</th><td>    <em>auto</em> <dfn class="local col3 decl" id="33forget_gate_output" title='forget_gate_output' data-type='hannk::ElementwiseAssembler::Slot' data-ref="33forget_gate_output" data-ref-filename="33forget_gate_output">forget_gate_output</dfn> = <a class="local col2 ref" href="#22p" title='p' data-ref="22p" data-ref-filename="22p">p</a>.<a class="ref fn" href="elementwise_program.h.html#_ZN5hannk20ElementwiseAssembler8logisticEsNS0_4SlotEs" title='hannk::ElementwiseAssembler::logistic' data-ref="_ZN5hannk20ElementwiseAssembler8logisticEsNS0_4SlotEs" data-ref-filename="_ZN5hannk20ElementwiseAssembler8logisticEsNS0_4SlotEs">logistic</a>(<a class="local col0 ref" href="#30q" title='q' data-ref="30q" data-ref-filename="30q">q</a>, <a class="ref fn fake" href="elementwise_program.h.html#50" title='hannk::ElementwiseAssembler::Slot::Slot' data-ref="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_" data-ref-filename="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_"></a><a class="local col7 ref" href="#27forget_gate" title='forget_gate' data-ref="27forget_gate" data-ref-filename="27forget_gate">forget_gate</a>, <a class="local col0 ref" href="#30q" title='q' data-ref="30q" data-ref-filename="30q">q</a> - <var>3</var>);</td></tr>
<tr><th id="57">57</th><td>    <em>auto</em> <dfn class="local col4 decl" id="34output_gate_output" title='output_gate_output' data-type='hannk::ElementwiseAssembler::Slot' data-ref="34output_gate_output" data-ref-filename="34output_gate_output">output_gate_output</dfn> = <a class="local col2 ref" href="#22p" title='p' data-ref="22p" data-ref-filename="22p">p</a>.<a class="ref fn" href="elementwise_program.h.html#_ZN5hannk20ElementwiseAssembler8logisticEsNS0_4SlotEs" title='hannk::ElementwiseAssembler::logistic' data-ref="_ZN5hannk20ElementwiseAssembler8logisticEsNS0_4SlotEs" data-ref-filename="_ZN5hannk20ElementwiseAssembler8logisticEsNS0_4SlotEs">logistic</a>(<a class="local col0 ref" href="#30q" title='q' data-ref="30q" data-ref-filename="30q">q</a>, <a class="ref fn fake" href="elementwise_program.h.html#50" title='hannk::ElementwiseAssembler::Slot::Slot' data-ref="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_" data-ref-filename="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_"></a><a class="local col8 ref" href="#28output_gate" title='output_gate' data-ref="28output_gate" data-ref-filename="28output_gate">output_gate</a>, <a class="local col0 ref" href="#30q" title='q' data-ref="30q" data-ref-filename="30q">q</a> - <var>3</var>);</td></tr>
<tr><th id="58">58</th><td></td></tr>
<tr><th id="59">59</th><td>    <em>auto</em> <dfn class="local col5 decl" id="35input_times_input_modulation" title='input_times_input_modulation' data-type='hannk::ElementwiseAssembler::Slot' data-ref="35input_times_input_modulation" data-ref-filename="35input_times_input_modulation">input_times_input_modulation</dfn> = <a class="local col2 ref" href="#22p" title='p' data-ref="22p" data-ref-filename="22p">p</a>.<a class="ref fn" href="elementwise_program.h.html#_ZN5hannk20ElementwiseAssembler9mul_shiftENS0_4SlotES1_s" title='hannk::ElementwiseAssembler::mul_shift' data-ref="_ZN5hannk20ElementwiseAssembler9mul_shiftENS0_4SlotES1_s" data-ref-filename="_ZN5hannk20ElementwiseAssembler9mul_shiftENS0_4SlotES1_s">mul_shift</a>(<a class="ref fn fake" href="elementwise_program.h.html#50" title='hannk::ElementwiseAssembler::Slot::Slot' data-ref="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_" data-ref-filename="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_"></a><a class="local col1 ref" href="#31input_gate_output" title='input_gate_output' data-ref="31input_gate_output" data-ref-filename="31input_gate_output">input_gate_output</a>, <a class="ref fn fake" href="elementwise_program.h.html#50" title='hannk::ElementwiseAssembler::Slot::Slot' data-ref="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_" data-ref-filename="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_"></a><a class="local col2 ref" href="#32input_modulation_gate_output" title='input_modulation_gate_output' data-ref="32input_modulation_gate_output" data-ref-filename="32input_modulation_gate_output">input_modulation_gate_output</a>, <a class="local col0 ref" href="#30q" title='q' data-ref="30q" data-ref-filename="30q">q</a> + <var>4</var>);</td></tr>
<tr><th id="60">60</th><td>    <em>auto</em> <dfn class="local col6 decl" id="36prev_state_times_forget_state" title='prev_state_times_forget_state' data-type='hannk::ElementwiseAssembler::Slot' data-ref="36prev_state_times_forget_state" data-ref-filename="36prev_state_times_forget_state">prev_state_times_forget_state</dfn> = <a class="local col2 ref" href="#22p" title='p' data-ref="22p" data-ref-filename="22p">p</a>.<a class="ref fn" href="elementwise_program.h.html#_ZN5hannk20ElementwiseAssembler3mulENS0_4SlotES1_s" title='hannk::ElementwiseAssembler::mul' data-ref="_ZN5hannk20ElementwiseAssembler3mulENS0_4SlotES1_s" data-ref-filename="_ZN5hannk20ElementwiseAssembler3mulENS0_4SlotES1_s">mul</a>(<a class="ref fn fake" href="elementwise_program.h.html#50" title='hannk::ElementwiseAssembler::Slot::Slot' data-ref="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_" data-ref-filename="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_"></a><a class="local col3 ref" href="#33forget_gate_output" title='forget_gate_output' data-ref="33forget_gate_output" data-ref-filename="33forget_gate_output">forget_gate_output</a>, <a class="ref fn fake" href="elementwise_program.h.html#50" title='hannk::ElementwiseAssembler::Slot::Slot' data-ref="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_" data-ref-filename="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_"></a><a class="local col9 ref" href="#29prev_state" title='prev_state' data-ref="29prev_state" data-ref-filename="29prev_state">prev_state</a>);</td></tr>
<tr><th id="61">61</th><td></td></tr>
<tr><th id="62">62</th><td>    <em>auto</em> <dfn class="local col7 decl" id="37state" title='state' data-type='hannk::ElementwiseAssembler::Slot' data-ref="37state" data-ref-filename="37state">state</dfn> = <a class="local col2 ref" href="#22p" title='p' data-ref="22p" data-ref-filename="22p">p</a>.<a class="ref fn" href="elementwise_program.h.html#_ZN5hannk20ElementwiseAssembler3addENS0_4SlotES1_s" title='hannk::ElementwiseAssembler::add' data-ref="_ZN5hannk20ElementwiseAssembler3addENS0_4SlotES1_s" data-ref-filename="_ZN5hannk20ElementwiseAssembler3addENS0_4SlotES1_s">add</a>(<a class="ref fn fake" href="elementwise_program.h.html#50" title='hannk::ElementwiseAssembler::Slot::Slot' data-ref="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_" data-ref-filename="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_"></a><a class="local col5 ref" href="#35input_times_input_modulation" title='input_times_input_modulation' data-ref="35input_times_input_modulation" data-ref-filename="35input_times_input_modulation">input_times_input_modulation</a>, <a class="ref fn fake" href="elementwise_program.h.html#50" title='hannk::ElementwiseAssembler::Slot::Slot' data-ref="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_" data-ref-filename="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_"></a><a class="local col6 ref" href="#36prev_state_times_forget_state" title='prev_state_times_forget_state' data-ref="36prev_state_times_forget_state" data-ref-filename="36prev_state_times_forget_state">prev_state_times_forget_state</a>);</td></tr>
<tr><th id="63">63</th><td>    <em>auto</em> <dfn class="local col8 decl" id="38activ" title='activ' data-type='hannk::ElementwiseAssembler::Slot' data-ref="38activ" data-ref-filename="38activ">activ</dfn> = <a class="local col2 ref" href="#22p" title='p' data-ref="22p" data-ref-filename="22p">p</a>.<a class="ref fn" href="elementwise_program.h.html#_ZN5hannk20ElementwiseAssembler7mul_addENS0_4SlotES1_s" title='hannk::ElementwiseAssembler::mul_add' data-ref="_ZN5hannk20ElementwiseAssembler7mul_addENS0_4SlotES1_s" data-ref-filename="_ZN5hannk20ElementwiseAssembler7mul_addENS0_4SlotES1_s">mul_add</a>(<a class="ref fn fake" href="elementwise_program.h.html#50" title='hannk::ElementwiseAssembler::Slot::Slot' data-ref="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_" data-ref-filename="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_"></a><a class="local col4 ref" href="#34output_gate_output" title='output_gate_output' data-ref="34output_gate_output" data-ref-filename="34output_gate_output">output_gate_output</a>, <a class="local col2 ref" href="#22p" title='p' data-ref="22p" data-ref-filename="22p">p</a>.<a class="ref fn" href="elementwise_program.h.html#_ZN5hannk20ElementwiseAssembler4tanhEsNS0_4SlotEs" title='hannk::ElementwiseAssembler::tanh' data-ref="_ZN5hannk20ElementwiseAssembler4tanhEsNS0_4SlotEs" data-ref-filename="_ZN5hannk20ElementwiseAssembler4tanhEsNS0_4SlotEs">tanh</a>(<var>7</var>, <a class="ref fn fake" href="elementwise_program.h.html#50" title='hannk::ElementwiseAssembler::Slot::Slot' data-ref="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_" data-ref-filename="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_"></a><a class="local col7 ref" href="#37state" title='state' data-ref="37state" data-ref-filename="37state">state</a>, <a class="local col0 ref" href="#30q" title='q' data-ref="30q" data-ref-filename="30q">q</a> - <var>4</var>), <var>128</var>);</td></tr>
<tr><th id="64">64</th><td>    <i>// Reload new_state so it's in the right place for the outputs.</i></td></tr>
<tr><th id="65">65</th><td><i>    // TODO: Make the assembler smart enough to do this itself.</i></td></tr>
<tr><th id="66">66</th><td>    <a class="local col7 ref" href="#37state" title='state' data-ref="37state" data-ref-filename="37state">state</a> <a class="ref fn" href="elementwise_program.h.html#50" title='hannk::ElementwiseAssembler::Slot::operator=' data-ref="_ZN5hannk20ElementwiseAssembler4SlotaSEOS1_" data-ref-filename="_ZN5hannk20ElementwiseAssembler4SlotaSEOS1_">=</a> <a class="local col2 ref" href="#22p" title='p' data-ref="22p" data-ref-filename="22p">p</a>.<a class="ref fn" href="elementwise_program.h.html#_ZN5hannk20ElementwiseAssembler3addENS0_4SlotEs" title='hannk::ElementwiseAssembler::add' data-ref="_ZN5hannk20ElementwiseAssembler3addENS0_4SlotEs" data-ref-filename="_ZN5hannk20ElementwiseAssembler3addENS0_4SlotEs">add</a>(<a class="ref fn fake" href="elementwise_program.h.html#50" title='hannk::ElementwiseAssembler::Slot::Slot' data-ref="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_" data-ref-filename="_ZN5hannk20ElementwiseAssembler4SlotC1ERKS1_"></a><a class="local col7 ref" href="#37state" title='state' data-ref="37state" data-ref-filename="37state">state</a>, <var>0</var>);</td></tr>
<tr><th id="67">67</th><td></td></tr>
<tr><th id="68">68</th><td>    <em>auto</em> <dfn class="local col9 decl" id="39program_buf" title='program_buf' data-type='Halide::Runtime::Buffer&lt;short, 4&gt;' data-ref="39program_buf" data-ref-filename="39program_buf">program_buf</dfn> = <a class="local col2 ref" href="#22p" title='p' data-ref="22p" data-ref-filename="22p">p</a>.<a class="ref fn" href="elementwise_program.h.html#_ZN5hannk20ElementwiseAssembler8assembleESt16initializer_listINS0_4SlotEE" title='hannk::ElementwiseAssembler::assemble' data-ref="_ZN5hannk20ElementwiseAssembler8assembleESt16initializer_listINS0_4SlotEE" data-ref-filename="_ZN5hannk20ElementwiseAssembler8assembleESt16initializer_listINS0_4SlotEE">assemble</a>({<a class="local col8 ref" href="#38activ" title='activ' data-ref="38activ" data-ref-filename="38activ">activ</a>, <a class="local col7 ref" href="#37state" title='state' data-ref="37state" data-ref-filename="37state">state</a>});</td></tr>
<tr><th id="69">69</th><td>    <a class="local col9 ref" href="#39program_buf" title='program_buf' data-ref="39program_buf" data-ref-filename="39program_buf">program_buf</a> <a class="ref fn" href="../../../halide-install/include/HalideBuffer.h.html#_ZN6Halide7Runtime6BufferaSEONS0_6BufferIT_XT0_EEE" title='Halide::Runtime::Buffer::operator=' data-ref="_ZN6Halide7Runtime6BufferaSEONS0_6BufferIT_XT0_EEE" data-ref-filename="_ZN6Halide7Runtime6BufferaSEONS0_6BufferIT_XT0_EEE">=</a> <a class="local col9 ref" href="#39program_buf" title='program_buf' data-ref="39program_buf" data-ref-filename="39program_buf">program_buf</a>.<a class="ref fn" href="../../../halide-install/include/HalideBuffer.h.html#_ZNK6Halide7Runtime6Buffer4copyEPFPvmEPFvS2_E" title='Halide::Runtime::Buffer::copy' data-ref="_ZNK6Halide7Runtime6Buffer4copyEPFPvmEPFvS2_E" data-ref-filename="_ZNK6Halide7Runtime6Buffer4copyEPFPvmEPFvS2_E">copy</a>();</td></tr>
<tr><th id="70">70</th><td></td></tr>
<tr><th id="71">71</th><td>    <a class="local col3 ref" href="#13ops" title='ops' data-ref="13ops" data-ref-filename="13ops">ops</a>.<span class='ref fn' title='std::vector::push_back' data-ref="_ZNSt6vector9push_backEOT_" data-ref-filename="_ZNSt6vector9push_backEOT_">push_back</span>(<span class='ref fn fake' title='std::unique_ptr::unique_ptr&lt;_Tp, _Dp&gt;' data-ref="_ZNSt10unique_ptrC1EOSt10unique_ptrITL0__TL0_0_E" data-ref-filename="_ZNSt10unique_ptrC1EOSt10unique_ptrITL0__TL0_0_E"></span><a class="ref fn" href="model.h.html#_ZN5hannk7make_opEDpOT0_" title='hannk::make_op' data-ref="_ZN5hannk7make_opEDpOT0_" data-ref-filename="_ZN5hannk7make_opEDpOT0_">make_op</a>&lt;<a class="type" href="ops.h.html#hannk::ElementwiseProgramOp" title='hannk::ElementwiseProgramOp' data-ref="hannk::ElementwiseProgramOp" data-ref-filename="hannk..ElementwiseProgramOp">ElementwiseProgramOp</a>&gt;(<span class='refarg'><a class="local col3 ref" href="#23elementwise_inputs" title='elementwise_inputs' data-ref="23elementwise_inputs" data-ref-filename="23elementwise_inputs">elementwise_inputs</a></span>, <span class='refarg'><a class="local col4 ref" href="#24elementwise_outputs" title='elementwise_outputs' data-ref="24elementwise_outputs" data-ref-filename="24elementwise_outputs">elementwise_outputs</a></span>, <span class='refarg'><a class="local col9 ref" href="#39program_buf" title='program_buf' data-ref="39program_buf" data-ref-filename="39program_buf">program_buf</a></span>));</td></tr>
<tr><th id="72">72</th><td></td></tr>
<tr><th id="73">73</th><td>    <b>return</b> <span class='ref fn fake' title='std::unique_ptr::unique_ptr&lt;_Tp, _Dp&gt;' data-ref="_ZNSt10unique_ptrC1EOSt10unique_ptrITL0__TL0_0_E" data-ref-filename="_ZNSt10unique_ptrC1EOSt10unique_ptrITL0__TL0_0_E"></span><a class="ref fn" href="model.h.html#_ZN5hannk7make_opEDpOT0_" title='hannk::make_op' data-ref="_ZN5hannk7make_opEDpOT0_" data-ref-filename="_ZN5hannk7make_opEDpOT0_">make_op</a>&lt;<a class="type" href="model.h.html#hannk::OpGroup" title='hannk::OpGroup' data-ref="hannk::OpGroup" data-ref-filename="hannk..OpGroup">OpGroup</a>&gt;(<span class="namespace">std::</span><span class='ref fn' title='std::move' data-ref="_ZSt4moveOT_" data-ref-filename="_ZSt4moveOT_">move</span>(<span class='refarg'><a class="local col1 ref" href="#11inputs" title='inputs' data-ref="11inputs" data-ref-filename="11inputs">inputs</a></span>), <span class="namespace">std::</span><span class='ref fn' title='std::move' data-ref="_ZSt4moveOT_" data-ref-filename="_ZSt4moveOT_">move</span>(<span class='refarg'><a class="local col2 ref" href="#12outputs" title='outputs' data-ref="12outputs" data-ref-filename="12outputs">outputs</a></span>), <span class="namespace">std::</span><span class='ref fn' title='std::move' data-ref="_ZSt4moveOT_" data-ref-filename="_ZSt4moveOT_">move</span>(<span class='refarg'><a class="local col3 ref" href="#13ops" title='ops' data-ref="13ops" data-ref-filename="13ops">ops</a></span>));</td></tr>
<tr><th id="74">74</th><td>}</td></tr>
<tr><th id="75">75</th><td></td></tr>
<tr><th id="76">76</th><td>}  <i>// namespace hannk</i></td></tr>
<tr><th id="77">77</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2021-Aug-05</em> from project halide revision <em>v12.0.1</em>